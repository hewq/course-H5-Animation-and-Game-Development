{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library/assets/frameworks/cocos2d-html5/external/gaf/Library/GAFDataReader.js"],"names":["gaf","DataReader","data","dataRaw","buf","DataView","offset","prototype","constructor","newOffset","size","length","getOffset","maxOffset","Error","byteLength","Ubyte","getUint8","Boolean","result","Uint","getUint32","Int","getInt32","color","b","g","r","a","Ushort","getUint16","Float","getFloat32","String","strLen","from","to","str","slice","e","message","i","push","decodeURIComponent","escape","fromCharCode","apply","Uint8Array","startNestedBuffer","endNestedBuffer","pop","Point","x","y","Rect","width","height","Matrix","c","d","tx","ty","seek","pos","tell","fields","self","arguments_","arguments","callee","field","func","call","condition","key","value","parent","caller","container","exec","evaluate","array"],"mappings":"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","file":"GAFDataReader.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library","sourcesContent":["gaf.DataReader = function(data) {\n    this.dataRaw = data;\n    this.buf = new DataView(data);\n    this.offset = [0];\n};\n\ngaf.DataReader.prototype.constructor = gaf.DataReader;\n\ngaf.DataReader.prototype.newOffset = function(size){\n    this.offset[this.offset.length - 1] += size;\n    if(this.getOffset() > this.maxOffset()){\n        throw new Error(\"GAF format error\");\n    }\n    return this.offset[this.offset.length - 1] - size;\n};\n\ngaf.DataReader.prototype.maxOffset = function(){\n    if(this.offset.length == 1){\n        return this.buf.byteLength;\n    }\n    else{\n        return this.offset[this.offset.length - 2];\n    }\n};\n\ngaf.DataReader.prototype.getOffset = function(size){\n    return this.offset[this.offset.length - 1];\n};\n\ngaf.DataReader.prototype.Ubyte = function() {\n    return this.buf.getUint8(this.newOffset(1));\n};\n\ngaf.DataReader.prototype.Boolean = function() {\n    var result = this.buf.getUint8(this.newOffset(1));\n    if(result > 1){\n        throw new Error(\"GAF format error\");\n    }\n    return result;\n};\n\ngaf.DataReader.prototype.Uint = function() {\n    return this.buf.getUint32(this.newOffset(4), true);\n};\n\ngaf.DataReader.prototype.Int = function() {\n    return this.buf.getInt32(this.newOffset(4), true);\n};\n\ngaf.DataReader.prototype.color = function() {\n    return {\n        b: this.Ubyte(),\n        g: this.Ubyte(),\n        r: this.Ubyte(),\n        a: this.Ubyte()\n    };\n};\n\ngaf.DataReader.prototype.Ushort = function() {\n    return this.buf.getUint16(this.newOffset(2), true);\n};\n\ngaf.DataReader.prototype.Float = function() {\n    return this.buf.getFloat32(this.newOffset(4), true);\n};\n\ngaf.DataReader.prototype.String = function() {\n    var strLen = this.Ushort();\n    var from = this.newOffset(strLen);\n    var to = this.getOffset();\n\n    try\n    {\n        var str = this.dataRaw.slice(from, to);\n    }\n    catch(e)\n    {\n        // Internet Explorer 10 T.T\n        if(e.message == \"Object doesn't support property or method 'slice'\")\n        {\n            str = [];\n            for(var i = from; i < to; ++i)\n                str.push(this.buf.getUint8(i));\n        }\n        else\n        {\n            throw(e);\n        }\n    }\n    return decodeURIComponent(escape(String.fromCharCode.apply(null, new Uint8Array(str))));\n    \n};\n\ngaf.DataReader.prototype.startNestedBuffer = function(length) {\n    this.offset.push(this.offset[this.offset.length-1]);\n    this.offset[this.offset.length-2] += length;\n};\n\ngaf.DataReader.prototype.endNestedBuffer = function() {\n    if (this.offset.length == 1) throw new Error('No nested buffer available');\n    this.offset.pop();\n};\n\ngaf.DataReader.prototype.Point = function(){\n    return {\n        x: this.Float(),\n        y: this.Float()\n    };\n};\n\ngaf.DataReader.prototype.Rect = function(){\n    return {\n        x: this.Float(),\n        y: this.Float(),\n        width: this.Float(),\n        height: this.Float()\n    };\n};\n\ngaf.DataReader.prototype.Matrix = function(){\n    return {\n        a: this.Float(),\n        b: this.Float(),\n        c: this.Float(),\n        d: this.Float(),\n        tx: this.Float(),\n        ty: this.Float()\n    };\n};\n\ngaf.DataReader.prototype.seek = function(pos){\n    this.offset[this.offset.length-1] = pos;\n};\n\ngaf.DataReader.prototype.tell = function(){\n    return this.offset[this.offset.length-1];\n};\n\n/* Creates a fields parsing function\n* @ returns a function that will read from DataReader `field` of type `type`\n* @`key` - key for read data to be stored\n* @`data` - data to store. Can be DataReader function name or a function that will return a value\n* Note. Parameters pair `key` and `data` can be repeated any number of times*/\n\ngaf.DataReader.prototype.fields = function(){\n    var self = this;\n    var arguments_ = arguments;\n    return function(){\n        arguments.callee.result = {};\n        var i = 0;\n        if(arguments_.length % 2){\n            throw new Error('Number of arguments is not even');\n        }\n        while(i < arguments_.length){\n            var field = arguments_[i++];\n            var func = arguments_[i++];\n            if(typeof func === 'function'){\n                arguments.callee.result[field] = func();\n            }\n            else if (func in self && typeof self[func] === 'function'){\n                arguments.callee.result[field] = self[func].call(self);\n            }\n            else{\n                throw new Error('Object DataReader has no function `' + func + '`');\n            }\n        }\n        return arguments.callee.result;\n    }\n};\n\n/*\n* Creates a parsing function\n* @ returns function that will execute expression if caller's `result` field has `key` equal to `value` parameter\n* @ `key` - key in caller's `result` element\n* @ `value` - expected value of the `key` or a comparator function\n* @ `func` - function to execute if condition is true\n* */\n\ngaf.DataReader.prototype.condition = function(key, value, func){\n    var arguments_ = arguments;\n    return function() {\n        if(arguments_.length != 3){\n            throw new Error('Condition function');\n        }\n        var parent = arguments.callee.caller;\n        if(!('result' in parent)){\n            throw new Error('Condition function caller has no key `result`');\n        }\n        var container = parent.result;\n        var field = arguments_[0];\n        var value = arguments_[1];\n        var exec = arguments_[2];\n\n        var evaluate = null;\n        if(typeof value === 'function'){\n            evaluate = function(){return value(container[field]);};\n        }\n        else{\n            evaluate = function(){return value == container[field];};\n        }\n        if(evaluate()){\n            return exec();\n        }\n        else{\n            return null;\n        }\n    }\n};\n\n/*\n* Creates an array parsing function\n* @ returns function that will execute `func` number of times read from DataReader\n* @ `type` - type of count number\n* @ `func` - function to be executed\n* */\n\ngaf.DataReader.prototype.array = function(){\n    var self = this;\n    var arguments_ = arguments;\n    return function() {\n        arguments.callee.result = [];\n        var length = self[arguments_[0]].call(self);\n        for (var i = 0; i < length; ++i) {\n            var r = arguments_[1].call();\n            arguments.callee.result.push(r);\n        }\n        return arguments.callee.result;\n    }\n};\n"]}