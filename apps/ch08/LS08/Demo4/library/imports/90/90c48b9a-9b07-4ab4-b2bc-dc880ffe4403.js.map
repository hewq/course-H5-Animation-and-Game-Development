{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/layers/assets/frameworks/cocos2d-html5/cocos2d/core/layers/CCLayerCanvasRenderCmd.js"],"names":["cc","Layer","CanvasRenderCmd","renderable","_rootCtor","_isBaked","_bakeSprite","_canUseDirtyRegion","_updateCache","proto","prototype","Object","create","Node","constructor","_layerCmdCtor","_setCacheDirty","child","_cacheDirty","cachedP","_cachedParent","_setNodeDirtyForCache","updateStatus","flags","_dirtyFlags","locFlag","_dirtyFlag","orderDirty","originUpdateStatus","_syncStatus","parentCmd","_originSyncStatus","transform","recursive","_worldTransform","a","b","c","d","tx","ty","wt","originTransform","bake","_needDraw","renderer","childrenOrderDirty","children","_node","_children","i","len","length","_renderCmd","_setCachedParent","BakeSprite","setAnchorPoint","unbake","isBaked","rendering","node","locBakeSprite","getParentRenderCmd","boundingBox","_getBoundingBoxForBake","width","height","bakeContext","getCacheContext","ctx","getContext","setPosition","x","y","resetCanvasSize","setOffset","canvas","sortAllChildren","_turnToCacheMode","__instanceId","visit","_renderingToCacheCanvas","_bakeForAddChild","_parent","rect","trans","getNodeToWorldTransform","locChildren","_visible","childRect","_getBoundingBoxToCurrentNode","rectUnion","LayerColor","_blendFuncStr","_bakeRenderCmd","CustomRenderCmd","_bakeRendering","call","scaleX","scaleY","wrapper","_renderContext","context","curColor","_displayedColor","opacity","_displayedOpacity","locWidth","_contentSize","locHeight","setCompositeOperation","setGlobalAlpha","setFillStyle","r","g","setTransform","fillRect","g_NumberOfDraws","updateBlendFunc","blendFunc","_getCompositeOperationByBlendFunc","_updateSquareVertices","_updateSquareVerticesWidth","_updateSquareVerticesHeight","fillStyle","_currentFillStyle","_localZOrder","pushRenderCommand","rectApplyAffineTransform","LayerGradient","_startPoint","p","_endPoint","_startStopStr","_endStopStr","gradient","createLinearGradient","_colorStops","stop","addColorStop","_colorStopsStr","gradientDirty","colorDirty","_updateColor","contentSize","tWidth","tHeight","angle","pAngleSigned","_alongVector","p1","pRotateByAngle","factor","Math","min","abs","locStartColor","locEndColor","_endColor","startOpacity","_startOpacity","endOpacity","_endOpacity","round","toFixed","stopColor","color","stopOpacity","push"],"mappings":"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","file":"CCLayerCanvasRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/layers","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n//-----------------------//\n//  1. cc.Layer          //\n//  2. cc.LayerColor     //\n//  3. cc.LayerGradient  //\n//-----------------------//\n\n/**\n * cc.Layer's rendering objects of Canvas\n */\n(function () {\n    //Layer's canvas render command\n    cc.Layer.CanvasRenderCmd = function (renderable) {\n        this._rootCtor(renderable);\n        this._isBaked = false;\n        this._bakeSprite = null;\n        this._canUseDirtyRegion = true;\n        this._updateCache = 2; // 2: Updated child visit 1: Rendering 0: Nothing to do\n    };\n\n    var proto = cc.Layer.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n    proto.constructor = cc.Layer.CanvasRenderCmd;\n    proto._layerCmdCtor = cc.Layer.CanvasRenderCmd;\n\n    proto._setCacheDirty = function (child) {\n        if (child && this._updateCache === 0)\n            this._updateCache = 2;\n        if (this._cacheDirty === false) {\n            this._cacheDirty = true;\n            var cachedP = this._cachedParent;\n            cachedP && cachedP !== this && cachedP._setNodeDirtyForCache && cachedP._setNodeDirtyForCache();\n        }\n    };\n\n    proto.updateStatus = function () {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        if (locFlag & flags.orderDirty) {\n            this._cacheDirty = true;\n            if (this._updateCache === 0)\n                this._updateCache = 2;\n            this._dirtyFlag &= ~flags.orderDirty;\n        }\n\n        this.originUpdateStatus();\n    };\n\n    proto._syncStatus = function (parentCmd) {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        // if (locFlag & flags.orderDirty) {\n        if (this._isBaked || locFlag & flags.orderDirty) {\n            this._cacheDirty = true;\n            if (this._updateCache === 0)\n                this._updateCache = 2;\n            this._dirtyFlag &= ~flags.orderDirty;\n        }\n        this._originSyncStatus(parentCmd);\n    };\n\n    proto.transform = function (parentCmd, recursive) {\n        if (!this._worldTransform) {\n            this._worldTransform = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n        }\n        var wt = this._worldTransform;\n        var a = wt.a, b = wt.b, c = wt.c, d = wt.d, tx = wt.tx, ty = wt.ty;\n        this.originTransform(parentCmd, recursive);\n        if (( wt.a !== a || wt.b !== b || wt.c !== c || wt.d !== d ) && this._updateCache === 0)\n            this._updateCache = 2;\n    };\n\n    proto.bake = function () {\n        if (!this._isBaked) {\n            this._needDraw = true;\n            cc.renderer.childrenOrderDirty = true;\n            //limit: 1. its children's blendfunc are invalid.\n            this._isBaked = this._cacheDirty = true;\n            if (this._updateCache === 0)\n                this._updateCache = 2;\n\n            var children = this._node._children;\n            for (var i = 0, len = children.length; i < len; i++)\n                children[i]._renderCmd._setCachedParent(this);\n\n            if (!this._bakeSprite) {\n                this._bakeSprite = new cc.BakeSprite();\n                this._bakeSprite.setAnchorPoint(0, 0);\n            }\n        }\n    };\n\n    proto.unbake = function () {\n        if (this._isBaked) {\n            cc.renderer.childrenOrderDirty = true;\n            this._needDraw = false;\n            this._isBaked = false;\n            this._cacheDirty = true;\n            if (this._updateCache === 0)\n                this._updateCache = 2;\n\n            var children = this._node._children;\n            for (var i = 0, len = children.length; i < len; i++)\n                children[i]._renderCmd._setCachedParent(null);\n        }\n    };\n\n    proto.isBaked = function () {\n        return this._isBaked;\n    };\n\n    proto.rendering = function () {\n        if (this._cacheDirty) {\n            var node = this._node;\n            var children = node._children, locBakeSprite = this._bakeSprite;\n\n            //compute the bounding box of the bake layer.\n            this.transform(this.getParentRenderCmd(), true);\n\n            var boundingBox = this._getBoundingBoxForBake();\n            boundingBox.width = 0 | (boundingBox.width + 0.5);\n            boundingBox.height = 0 | (boundingBox.height + 0.5);\n\n            var bakeContext = locBakeSprite.getCacheContext();\n            var ctx = bakeContext.getContext();\n\n            locBakeSprite.setPosition(boundingBox.x, boundingBox.y);\n\n            if (this._updateCache > 0) {\n                locBakeSprite.resetCanvasSize(boundingBox.width, boundingBox.height);\n                bakeContext.setOffset(0 - boundingBox.x, ctx.canvas.height - boundingBox.height + boundingBox.y);\n                //visit for canvas\n                node.sortAllChildren();\n                cc.renderer._turnToCacheMode(this.__instanceId);\n                for (var i = 0, len = children.length; i < len; i++) {\n                    children[i].visit(this);\n                }\n                cc.renderer._renderingToCacheCanvas(bakeContext, this.__instanceId);\n                locBakeSprite.transform();                   //because bake sprite's position was changed at rendering.\n                this._updateCache--;\n            }\n\n            this._cacheDirty = false;\n        }\n    };\n\n    proto._bakeForAddChild = function (child) {\n        if (child._parent === this._node && this._isBaked)\n            child._renderCmd._setCachedParent(this);\n    };\n\n    proto._getBoundingBoxForBake = function () {\n        var rect = null, node = this._node;\n\n        //query child's BoundingBox\n        if (!node._children || node._children.length === 0)\n            return cc.rect(0, 0, 10, 10);\n        var trans = node.getNodeToWorldTransform();\n\n        var locChildren = node._children;\n        for (var i = 0, len = locChildren.length; i < len; i++) {\n            var child = locChildren[i];\n            if (child && child._visible) {\n                if (rect) {\n                    var childRect = child._getBoundingBoxToCurrentNode(trans);\n                    if (childRect)\n                        rect = cc.rectUnion(rect, childRect);\n                } else {\n                    rect = child._getBoundingBoxToCurrentNode(trans);\n                }\n            }\n        }\n        return rect;\n    };\n})();\n\n/**\n * cc.LayerColor's rendering objects of Canvas\n */\n(function () {\n    //LayerColor's canvas render command\n    cc.LayerColor.CanvasRenderCmd = function (renderable) {\n        this._layerCmdCtor(renderable);\n        this._needDraw = true;\n        this._blendFuncStr = \"source-over\";\n        this._bakeRenderCmd = new cc.CustomRenderCmd(this, this._bakeRendering);\n    };\n    var proto = cc.LayerColor.CanvasRenderCmd.prototype = Object.create(cc.Layer.CanvasRenderCmd.prototype);\n    proto.constructor = cc.LayerColor.CanvasRenderCmd;\n\n    proto.unbake = function () {\n        cc.Layer.CanvasRenderCmd.prototype.unbake.call(this);\n        this._needDraw = true;\n    };\n\n    proto.rendering = function (ctx, scaleX, scaleY) {\n        var wrapper = ctx || cc._renderContext, context = wrapper.getContext(),\n            node = this._node,\n            curColor = this._displayedColor,\n            opacity = this._displayedOpacity / 255,\n            locWidth = node._contentSize.width,\n            locHeight = node._contentSize.height;\n\n        if (opacity === 0)\n            return;\n\n        wrapper.setCompositeOperation(this._blendFuncStr);\n        wrapper.setGlobalAlpha(opacity);\n        wrapper.setFillStyle(\"rgba(\" + (0 | curColor.r) + \",\" + (0 | curColor.g) + \",\"\n            + (0 | curColor.b) + \", 1)\");  //TODO: need cache the color string\n\n        wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n        context.fillRect(0, 0, locWidth, -locHeight);\n\n        cc.g_NumberOfDraws++;\n    };\n\n    proto.updateBlendFunc = function (blendFunc) {\n        this._blendFuncStr = cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(blendFunc);\n    };\n\n    proto._updateSquareVertices =\n    proto._updateSquareVerticesWidth =\n    proto._updateSquareVerticesHeight = function () {};\n\n    proto._bakeRendering = function () {\n        if (this._cacheDirty) {\n            var node = this._node;\n            var locBakeSprite = this._bakeSprite, children = node._children;\n            var i, len = children.length;\n\n            //compute the bounding box of the bake layer.\n            this.transform(this.getParentRenderCmd(), true);\n            //compute the bounding box of the bake layer.\n            var boundingBox = this._getBoundingBoxForBake();\n            boundingBox.width = 0 | (boundingBox.width + 0.5);\n            boundingBox.height = 0 | (boundingBox.height + 0.5);\n\n            var bakeContext = locBakeSprite.getCacheContext();\n            var ctx = bakeContext.getContext();\n\n            locBakeSprite.setPosition(boundingBox.x, boundingBox.y);\n\n            if (this._updateCache > 0) {\n                ctx.fillStyle = bakeContext._currentFillStyle;\n                locBakeSprite.resetCanvasSize(boundingBox.width, boundingBox.height);\n                bakeContext.setOffset(0 - boundingBox.x, ctx.canvas.height - boundingBox.height + boundingBox.y);\n\n                var child;\n                cc.renderer._turnToCacheMode(this.__instanceId);\n                //visit for canvas\n                if (len > 0) {\n                    node.sortAllChildren();\n                    // draw children zOrder < 0\n                    for (i = 0; i < len; i++) {\n                        child = children[i];\n                        if (child._localZOrder < 0)\n                            child.visit(node);\n                        else\n                            break;\n                    }\n                    cc.renderer.pushRenderCommand(this);\n                    for (; i < len; i++) {\n                        children[i].visit(node);\n                    }\n                } else\n                    cc.renderer.pushRenderCommand(this);\n                cc.renderer._renderingToCacheCanvas(bakeContext, this.__instanceId);\n                locBakeSprite.transform();\n                this._updateCache--;\n            }\n            this._cacheDirty = false;\n        }\n    };\n\n    proto._getBoundingBoxForBake = function () {\n        var node = this._node;\n        //default size\n        var rect = cc.rect(0, 0, node._contentSize.width, node._contentSize.height);\n        var trans = node.getNodeToWorldTransform();\n        rect = cc.rectApplyAffineTransform(rect, node.getNodeToWorldTransform());\n\n        //query child's BoundingBox\n        if (!node._children || node._children.length === 0)\n            return rect;\n\n        var locChildren = node._children;\n        for (var i = 0; i < locChildren.length; i++) {\n            var child = locChildren[i];\n            if (child && child._visible) {\n                var childRect = child._getBoundingBoxToCurrentNode(trans);\n                rect = cc.rectUnion(rect, childRect);\n            }\n        }\n        return rect;\n    };\n})();\n\n/**\n * cc.LayerGradient's rendering objects of Canvas\n */\n(function () {\n    cc.LayerGradient.CanvasRenderCmd = function (renderable) {\n        cc.LayerColor.CanvasRenderCmd.call(this, renderable);\n        this._needDraw = true;\n        this._startPoint = cc.p(0, 0);\n        this._endPoint = cc.p(0, 0);\n        this._startStopStr = null;\n        this._endStopStr = null;\n    };\n    var proto = cc.LayerGradient.CanvasRenderCmd.prototype = Object.create(cc.LayerColor.CanvasRenderCmd.prototype);\n    proto.constructor = cc.LayerGradient.CanvasRenderCmd;\n\n    proto.rendering = function (ctx, scaleX, scaleY) {\n        var wrapper = ctx || cc._renderContext, context = wrapper.getContext(),\n            node = this._node,\n            opacity = this._displayedOpacity / 255;\n\n        if (opacity === 0)\n            return;\n\n        var locWidth = node._contentSize.width, locHeight = node._contentSize.height;\n        wrapper.setCompositeOperation(this._blendFuncStr);\n        wrapper.setGlobalAlpha(opacity);\n        var gradient = context.createLinearGradient(this._startPoint.x, this._startPoint.y, this._endPoint.x, this._endPoint.y);\n\n        if (node._colorStops) {  //Should always fall here now\n            for (var i = 0; i < node._colorStops.length; i++) {\n                var stop = node._colorStops[i];\n                gradient.addColorStop(stop.p, this._colorStopsStr[i]);\n            }\n        } else {\n            gradient.addColorStop(0, this._startStopStr);\n            gradient.addColorStop(1, this._endStopStr);\n        }\n\n        wrapper.setFillStyle(gradient);\n\n        wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n        context.fillRect(0, 0, locWidth, -locHeight);\n        cc.g_NumberOfDraws++;\n    };\n\n    proto.updateStatus = function () {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        if (locFlag & flags.gradientDirty) {\n            this._dirtyFlag |= flags.colorDirty;\n            this._dirtyFlag &= ~flags.gradientDirty;\n        }\n\n        this.originUpdateStatus();\n    };\n\n    proto._syncStatus = function (parentCmd) {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        if (locFlag & flags.gradientDirty) {\n            this._dirtyFlag |= flags.colorDirty;\n            this._dirtyFlag &= ~flags.gradientDirty;\n        }\n\n        this._originSyncStatus(parentCmd);\n    };\n\n    proto._updateColor = function () {\n        var node = this._node;\n        var contentSize = node._contentSize;\n        var tWidth = contentSize.width * 0.5, tHeight = contentSize.height * 0.5;\n\n        //fix the bug of gradient layer\n        var angle = cc.pAngleSigned(cc.p(0, -1), node._alongVector);\n        var p1 = cc.pRotateByAngle(cc.p(0, -1), cc.p(0, 0), angle);\n        var factor = Math.min(Math.abs(1 / p1.x), Math.abs(1 / p1.y));\n\n        this._startPoint.x = tWidth * (-p1.x * factor) + tWidth;\n        this._startPoint.y = tHeight * (p1.y * factor) - tHeight;\n        this._endPoint.x = tWidth * (p1.x * factor) + tWidth;\n        this._endPoint.y = tHeight * (-p1.y * factor) - tHeight;\n\n        var locStartColor = this._displayedColor, locEndColor = node._endColor;\n        var startOpacity = node._startOpacity / 255, endOpacity = node._endOpacity / 255;\n        this._startStopStr = \"rgba(\" + Math.round(locStartColor.r) + \",\" + Math.round(locStartColor.g) + \",\"\n            + Math.round(locStartColor.b) + \",\" + startOpacity.toFixed(4) + \")\";\n        this._endStopStr = \"rgba(\" + Math.round(locEndColor.r) + \",\" + Math.round(locEndColor.g) + \",\"\n            + Math.round(locEndColor.b) + \",\" + endOpacity.toFixed(4) + \")\";\n\n        if (node._colorStops) {\n            this._startOpacity = 0;\n            this._endOpacity = 0;\n\n            this._colorStopsStr = [];\n            for (var i = 0; i < node._colorStops.length; i++) {\n                var stopColor = node._colorStops[i].color;\n                var stopOpacity = stopColor.a == null ? 1 : stopColor.a / 255;\n                this._colorStopsStr.push(\"rgba(\" + Math.round(stopColor.r) + \",\" + Math.round(stopColor.g) + \",\"\n                    + Math.round(stopColor.b) + \",\" + stopOpacity.toFixed(4) + \")\");\n            }\n        }\n    };\n})();\n"]}