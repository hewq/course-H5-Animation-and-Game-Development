{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath/simd_benchmark/assets/frameworks/cocos2d-html5/cocos2d/kazmath/simd_benchmark/kmMat4Inverse.js"],"names":["kernelConfig","kernelName","kernelInit","init","kernelCleanup","cleanup","kernelSimd","simd","kernelNonSimd","nonSimd","kernelIterations","benchmarks","add","Benchmark","src","cc","kmMat4","dst","srcx4","dstx4","ident","Float32Array","equals","A","B","i","Math","abs","initMatrix","matrix","mulMatrix","op1","op2","r","c","ri","printMatrix","str","print","value","toFixed","checkMatrix","tmp","mat","n","inverse","inverseSIMD"],"mappings":"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","file":"kmMat4Inverse.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath/simd_benchmark","sourcesContent":["// kmMat4Inverse\n\n(function () {\n\n  // Kernel configuration\n  var kernelConfig = {\n    kernelName:       \"kmMat4Inverse\",\n    kernelInit:       init,\n    kernelCleanup:    cleanup,\n    kernelSimd:       simd,\n    kernelNonSimd:    nonSimd,\n    kernelIterations: 10000\n  };\n\n  // Hook up to the harness\n  benchmarks.add(new Benchmark(kernelConfig));\n\n  // Benchmark data, initialization and kernel functions\n  var src = new cc.kmMat4();\n  var dst = new cc.kmMat4();\n  var srcx4 = new cc.kmMat4();\n  var dstx4 = new cc.kmMat4();\n  var ident = new Float32Array(\n                    [1,0,0,0,\n                     0,1,0,0,\n                     0,0,1,0,\n                     0,0,0,1]);\n\n  function equals(A, B) {\n    for (var i = 0; i < 16; ++i) {\n      if (Math.abs (A[i] - B[i]) > 5)\n        return false;\n    }\n    return true;\n  }\n\n  function initMatrix(matrix) {\n    // These values were chosen somewhat randomly, but they will at least yield a solution.\n    matrix [0]  =  0;  matrix[1] =  1; matrix[2]  =  2; matrix[3]  =  3;\n    matrix [4]  = -1; matrix[5]  = -2; matrix[6]  = -3; matrix[7]  = -4;\n    matrix [8]  =  0;  matrix[9] =  0; matrix[10] =  2; matrix[11] =  3;\n    matrix [12] = -1; matrix[13] = -2; matrix[14] =  0; matrix[15] = -4;\n  }\n\n  function mulMatrix(dst, op1, op2) {\n    for (var r = 0; r < 4; ++r) {\n      for (var c = 0; c < 4; ++c) {\n        var ri = 4*r;\n        dst[ri + c] = op1[ri]*op2[c] + op1[ri+1]*op2[c+4] + op1[ri+2]*op2[c+8] + op1[ri+3]*op2[c+12];\n      }\n    }\n  }\n\n  function printMatrix(matrix, str) {\n    print('--------matrix ' + str + '----------');\n    for (var r = 0; r < 4; ++r) {\n      var str = \"\";\n      var ri = r*4;\n      for (var c = 0; c < 4; ++c) {\n        var value = matrix[ri + c];\n        str += \" \" + value.toFixed(2);\n      }\n      print(str);\n    }\n  }\n\n  function checkMatrix(src, dst) {\n    // when multiplied with the src matrix it should yield the identity matrix\n    var tmp   = new Float32Array(16);\n    mulMatrix(tmp, src, dst);\n    for (var i = 0; i < 16; ++i) {\n      if (Math.abs (tmp[i] - ident[i]) > 0.00001) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  function init() {\n    initMatrix(src.mat);\n    // printMatrix(src);\n    nonSimd(1);\n    // printMatrix(dst);\n    if (!checkMatrix(src.mat, dst.mat)) {\n      return false;\n    }\n\n    initMatrix(srcx4.mat);\n    simd(1);\n    // printMatrix(dst);\n    if (!checkMatrix(srcx4.mat, dstx4.mat)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  function cleanup() {\n    return init(); // Sanity checking before and after are the same\n  }\n\n  function nonSimd(n) {\n    for (var i = 0; i < n; i++) {\n      //cc.kmMat4Inverse(dst, src);\n      dst = src.inverse();\n    }\n  }\n\n  function simd(n) {\n    for (var i = 0; i < n; i++) {\n      //cc.kmMat4InverseSIMD(dstx4, srcx4);\n      dstx4 = srcx4.inverseSIMD();\n    }\n  }\n\n} ());\n"]}