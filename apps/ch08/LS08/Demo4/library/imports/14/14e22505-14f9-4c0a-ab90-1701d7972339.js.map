{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/sprites/assets/frameworks/cocos2d-html5/cocos2d/core/sprites/CCSpriteCanvasRenderCmd.js"],"names":["cc","Sprite","CanvasRenderCmd","renderable","_rootCtor","_needDraw","_textureCoord","renderX","renderY","x","y","width","height","validRect","_blendFuncStr","_colorized","_canUseDirtyRegion","_textureToRender","proto","prototype","Object","create","Node","constructor","_spriteCmdCtor","setDirtyRecursively","value","_setTexture","texture","node","_node","_texture","_textureLoaded","texSize","_contentSize","rect","setTextureRect","_updateColor","_setColorDirty","setDirtyFlag","_dirtyFlags","colorDirty","opacityDirty","isFrameDisplayed","frame","getTexture","rectEqualToRect","getRect","_rect","updateBlendFunc","blendFunc","_getCompositeOperationByBlendFunc","_setBatchNodeForAddChild","child","_handleTextureForRotatedTexture","rotated","counterclockwise","isLoaded","tempElement","getHtmlElementObj","_cutRotateImageToCanvas","tempTexture","Texture2D","initWithElement","handleLoadedTexture","_checkTextureBoundary","url","_x","_y","error","_LogInfos","RectWidth","RectHeight","rendering","ctx","scaleX","scaleY","locTextureCoord","alpha","_displayedOpacity","wrapper","_renderContext","context","getContext","locX","_offsetPosition","locHeight","locWidth","locY","image","setTransform","_worldTransform","setCompositeOperation","setGlobalAlpha","_flippedX","_flippedY","save","scale","sx","sy","sw","sh","w","h","_htmlElementObj","_pattern","setFillStyle","createPattern","fillRect","drawImage","contentSize","curColor","_displayedColor","r","g","b","restore","g_NumberOfDraws","dColor","_generateColorTexture","_textureLoadedCallback","sender","locRect","locRenderCmd","_renderCmd","_rectEqualToZero","_rectRotated","locColor","setBatchNode","_batchNode","dispatchEvent","_setTextureCoords","needConvert","undefined","locTextureRect","scaleFactor","contentScaleFactor","nCanvas","document","createElement","translate","rotate"],"mappings":"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","file":"CCSpriteCanvasRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/sprites","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n    cc.Sprite.CanvasRenderCmd = function (renderable) {\n        this._rootCtor(renderable);\n        this._needDraw = true;\n        this._textureCoord = {\n            renderX: 0,                             //the x of texture coordinate for render, when texture tinted, its value doesn't equal x.\n            renderY: 0,                             //the y of texture coordinate for render, when texture tinted, its value doesn't equal y.\n            x: 0,                                   //the x of texture coordinate for node.\n            y: 0,                                   //the y of texture coordinate for node.\n            width: 0,\n            height: 0,\n            validRect: false\n        };\n        this._blendFuncStr = \"source-over\";\n        this._colorized = false;\n        this._canUseDirtyRegion = true;\n        this._textureToRender = null;\n    };\n\n    var proto = cc.Sprite.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n    proto.constructor = cc.Sprite.CanvasRenderCmd;\n    proto._spriteCmdCtor = cc.Sprite.CanvasRenderCmd;\n\n    proto.setDirtyRecursively = function (value) {\n    };\n\n    proto._setTexture = function (texture) {\n        var node = this._node;\n        if (node._texture !== texture) {\n            node._textureLoaded = texture ? texture._textureLoaded : false;\n            node._texture = texture;\n\n            var texSize = texture._contentSize;\n            var rect = cc.rect(0, 0, texSize.width, texSize.height);\n            node.setTextureRect(rect);\n            this._updateColor();\n        }\n    };\n\n    proto._setColorDirty = function () {\n        this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty | cc.Node._dirtyFlags.opacityDirty);\n    };\n\n    proto.isFrameDisplayed = function (frame) {      //TODO there maybe has a bug\n        var node = this._node;\n        if (frame.getTexture() !== node._texture)\n            return false;\n        return cc.rectEqualToRect(frame.getRect(), node._rect);\n    };\n\n    proto.updateBlendFunc = function (blendFunc) {\n        this._blendFuncStr = cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(blendFunc);\n    };\n\n    proto._setBatchNodeForAddChild = function (child) {\n        return true;\n    };\n\n    proto._handleTextureForRotatedTexture = function (texture, rect, rotated, counterclockwise) {\n        if (rotated && texture.isLoaded()) {\n            var tempElement = texture.getHtmlElementObj();\n            tempElement = cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(tempElement, rect, counterclockwise);\n            var tempTexture = new cc.Texture2D();\n            tempTexture.initWithElement(tempElement);\n            tempTexture.handleLoadedTexture();\n            texture = tempTexture;\n            rect.x = rect.y = 0;\n            this._node._rect = cc.rect(0, 0, rect.width, rect.height);\n        }\n        return texture;\n    };\n\n    proto._checkTextureBoundary = function (texture, rect, rotated) {\n        if (texture && texture.url) {\n            var _x = rect.x + rect.width, _y = rect.y + rect.height;\n            if (_x > texture.width)\n                cc.error(cc._LogInfos.RectWidth, texture.url);\n            if (_y > texture.height)\n                cc.error(cc._LogInfos.RectHeight, texture.url);\n        }\n    };\n\n    proto.rendering = function (ctx, scaleX, scaleY) {\n        var node = this._node;\n        var locTextureCoord = this._textureCoord, alpha = (this._displayedOpacity / 255);\n        var texture = this._textureToRender || node._texture;\n\n        if ((texture && (locTextureCoord.width === 0 || locTextureCoord.height === 0 || !texture._textureLoaded)) || alpha === 0)\n            return;\n\n        var wrapper = ctx || cc._renderContext, context = wrapper.getContext();\n        var locX = node._offsetPosition.x, locHeight = node._rect.height, locWidth = node._rect.width,\n            locY = -node._offsetPosition.y - locHeight, image;\n\n        wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n        wrapper.setCompositeOperation(this._blendFuncStr);\n        wrapper.setGlobalAlpha(alpha);\n\n        if (node._flippedX || node._flippedY)\n            wrapper.save();\n        if (node._flippedX) {\n            locX = -locX - locWidth;\n            context.scale(-1, 1);\n        }\n        if (node._flippedY) {\n            locY = node._offsetPosition.y;\n            context.scale(1, -1);\n        }\n\n        var sx, sy, sw, sh, x, y, w, h;\n        if (this._colorized) {\n            sx = 0;\n            sy = 0;\n        } else {\n            sx = locTextureCoord.renderX;\n            sy = locTextureCoord.renderY;\n        }\n        sw = locTextureCoord.width;\n        sh = locTextureCoord.height;\n\n        x = locX;\n        y = locY;\n        w = locWidth;\n        h = locHeight;\n\n        if (texture && texture._htmlElementObj) {\n            image = texture._htmlElementObj;\n            if (texture._pattern !== \"\") {\n                wrapper.setFillStyle(context.createPattern(image, texture._pattern));\n                context.fillRect(x, y, w, h);\n            } else {\n                context.drawImage(image,\n                    sx, sy, sw, sh,\n                    x, y, w, h);\n            }\n        } else {\n            var contentSize = node._contentSize;\n            if (locTextureCoord.validRect) {\n                var curColor = this._displayedColor;\n                wrapper.setFillStyle(\"rgba(\" + curColor.r + \",\" + curColor.g + \",\" + curColor.b + \",1)\");\n                context.fillRect(x, y, contentSize.width * scaleX, contentSize.height * scaleY);\n            }\n        }\n        if (node._flippedX || node._flippedY)\n            wrapper.restore();\n        cc.g_NumberOfDraws++;\n    };\n\n    proto._updateColor = function () {\n        var node = this._node;\n\n        var texture = node._texture, rect = this._textureCoord;\n        var dColor = this._displayedColor;\n\n        if (texture) {\n            if (dColor.r !== 255 || dColor.g !== 255 || dColor.b !== 255) {\n                this._textureToRender = texture._generateColorTexture(dColor.r, dColor.g, dColor.b, rect);\n                this._colorized = true;\n            } else if (texture) {\n                this._textureToRender = texture;\n                this._colorized = false;\n            }\n        }\n    };\n\n    proto._textureLoadedCallback = function (sender) {\n        var node = this;\n        if (node._textureLoaded)\n            return;\n\n        node._textureLoaded = true;\n        var locRect = node._rect, locRenderCmd = this._renderCmd;\n        if (!locRect) {\n            locRect = cc.rect(0, 0, sender.width, sender.height);\n        } else if (cc._rectEqualToZero(locRect)) {\n            locRect.width = sender.width;\n            locRect.height = sender.height;\n        }\n\n        node.texture = sender;\n        node.setTextureRect(locRect, node._rectRotated);\n\n        //set the texture's color after the it loaded\n        var locColor = locRenderCmd._displayedColor;\n        if (locColor.r !== 255 || locColor.g !== 255 || locColor.b !== 255)\n            locRenderCmd._updateColor();\n\n        // by default use \"Self Render\".\n        // if the sprite is added to a batchnode, then it will automatically switch to \"batchnode Render\"\n        node.setBatchNode(node._batchNode);\n        node.dispatchEvent(\"load\");\n    };\n\n    proto._setTextureCoords = function (rect, needConvert) {\n        if (needConvert === undefined)\n            needConvert = true;\n        var locTextureRect = this._textureCoord,\n            scaleFactor = needConvert ? cc.contentScaleFactor() : 1;\n        locTextureRect.renderX = locTextureRect.x = 0 | (rect.x * scaleFactor);\n        locTextureRect.renderY = locTextureRect.y = 0 | (rect.y * scaleFactor);\n        locTextureRect.width = 0 | (rect.width * scaleFactor);\n        locTextureRect.height = 0 | (rect.height * scaleFactor);\n        locTextureRect.validRect = !(locTextureRect.width === 0 || locTextureRect.height === 0 || locTextureRect.x < 0 || locTextureRect.y < 0);\n    };\n\n    cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas = function (texture, rect, counterclockwise) {\n        if (!texture)\n            return null;\n\n        if (!rect)\n            return texture;\n\n        counterclockwise = counterclockwise == null ? true : counterclockwise;   // texture package is counterclockwise, spine is clockwise\n\n        var nCanvas = document.createElement(\"canvas\");\n        nCanvas.width = rect.width;\n        nCanvas.height = rect.height;\n        var ctx = nCanvas.getContext(\"2d\");\n        ctx.translate(nCanvas.width / 2, nCanvas.height / 2);\n        if (counterclockwise)\n            ctx.rotate(-1.5707963267948966);\n        else\n            ctx.rotate(1.5707963267948966);\n        ctx.drawImage(texture, rect.x, rect.y, rect.height, rect.width, -rect.height / 2, -rect.width / 2, rect.height, rect.width);\n        return nCanvas;\n    };\n})();\n"]}