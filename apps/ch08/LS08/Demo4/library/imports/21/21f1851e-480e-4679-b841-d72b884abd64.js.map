{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccb-reader/assets/frameworks/cocos2d-html5/extensions/ccb-reader/CCBReader.js"],"names":["CCB_VERSION","CCB_PROPTYPE_POSITION","CCB_PROPTYPE_SIZE","CCB_PROPTYPE_POINT","CCB_PROPTYPE_POINTLOCK","CCB_PROPTYPE_SCALELOCK","CCB_PROPTYPE_DEGREES","CCB_PROPTYPE_INTEGER","CCB_PROPTYPE_FLOAT","CCB_PROPTYPE_FLOATVAR","CCB_PROPTYPE_CHECK","CCB_PROPTYPE_SPRITEFRAME","CCB_PROPTYPE_TEXTURE","CCB_PROPTYPE_BYTE","CCB_PROPTYPE_COLOR3","CCB_PROPTYPE_COLOR4VAR","CCB_PROPTYPE_FLIP","CCB_PROPTYPE_BLENDMODE","CCB_PROPTYPE_FNTFILE","CCB_PROPTYPE_TEXT","CCB_PROPTYPE_FONTTTF","CCB_PROPTYPE_INTEGERLABELED","CCB_PROPTYPE_BLOCK","CCB_PROPTYPE_ANIMATION","CCB_PROPTYPE_CCBFILE","CCB_PROPTYPE_STRING","CCB_PROPTYPE_BLOCKCCCONTROL","CCB_PROPTYPE_FLOATSCALE","CCB_PROPTYPE_FLOATXY","CCB_FLOAT0","CCB_FLOAT1","CCB_FLOAT_MINUS1","CCB_FLOAT05","CCB_FLOAT_INTEGER","CCB_FLOAT_FULL","CCB_PLATFORM_ALL","CCB_PLATFORM_IOS","CCB_PLATFORM_MAC","CCB_TARGETTYPE_NONE","CCB_TARGETTYPE_DOCUMENTROOT","CCB_TARGETTYPE_OWNER","CCB_KEYFRAME_EASING_INSTANT","CCB_KEYFRAME_EASING_LINEAR","CCB_KEYFRAME_EASING_CUBIC_IN","CCB_KEYFRAME_EASING_CUBIC_OUT","CCB_KEYFRAME_EASING_CUBIC_INOUT","CCB_KEYFRAME_EASING_ELASTIC_IN","CCB_KEYFRAME_EASING_ELASTIC_OUT","CCB_KEYFRAME_EASING_ELASTIC_INOUT","CCB_KEYFRAME_EASING_BOUNCE_IN","CCB_KEYFRAME_EASING_BOUNCE_OUT","CCB_KEYFRAME_EASING_BOUNCE_INOUT","CCB_KEYFRAME_EASING_BACK_IN","CCB_KEYFRAME_EASING_BACK_OUT","CCB_KEYFRAME_EASING_BACK_INOUT","CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT","CCB_POSITIONTYPE_RELATIVE_TOP_LEFT","CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT","CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT","CCB_POSITIONTYPE_PERCENT","CCB_POSITIONTYPE_MULTIPLY_RESOLUTION","CCB_SIZETYPE_ABSOLUTE","CCB_SIZETYPE_PERCENT","CCB_SIZETYPE_RELATIVE_CONTAINER","CCB_SIZETYPE_HORIZONTAL_PERCENT","CCB_SIZETYPE_VERTICAL_PERCENT","CCB_SIZETYPE_MULTIPLY_RESOLUTION","CCB_SCALETYPE_ABSOLUTE","CCB_SCALETYPE_MULTIPLY_RESOLUTION","cc","BuilderReader","Class","extend","_jsControlled","_data","_ccbRootPath","_bytes","_currentByte","_currentBit","_stringCache","_loadedSpriteSheets","_owner","_animationManager","_animationManagers","_animatedProps","_ccNodeLoaderLibrary","_ccNodeLoaderListener","_ccbMemberVariableAssigner","_ccbSelectorResolver","_ownerOutletNames","_ownerOutletNodes","_nodesWithAnimationManagers","_animationManagerForNodes","_ownerCallbackNames","_ownerCallbackNodes","_ownerCallbackEvents","_readNodeGraphFromData","ctor","ccNodeLoaderLibrary","ccbMemberVariableAssigner","ccbSelectorResolver","ccNodeLoaderListener","arguments","length","ccbReader","getCCBRootPath","setCCBRootPath","rootPath","initWithData","data","owner","BuilderAnimationManager","setRootContainerSize","director","getWinSize","_loadBinarySync","url","self","req","getXMLHttpRequest","errInfo","open","arrayInfo","test","navigator","userAgent","setRequestHeader","send","status","log","fileContents","_convertResponseBodyToText","_stringConvertToArray","_fileDataCache","overrideMimeType","responseText","readNodeGraphFromFile","ccbFileName","parentSize","animationManager","loader","getRes","realUrl","getUrl","loadBinarySync","cache","readNodeGraphFromData","locAnimationManager","setOwner","_Dictionary","nodeGraph","readFileWithCleanUp","getAutoPlaySequenceId","runAnimations","locNodes","locAnimations","locAnimationManagers","getAllKeys","allKeys","i","push","objectForKey","createSceneWithNodeGraphFromFile","node","scene","Scene","addChild","getCCBMemberVariableAssigner","getCCBSelectorResolver","getAnimationManager","setAnimationManager","getAnimatedProperties","getLoadedSpriteSheet","getOwner","readInt","signed","numBits","bit","Error","current","a","num","s","readByte","byteValue","readBool","readFloat","type","pF","_decodeFloat","precisionBits","exponentBits","size","bias","Math","pow","signal","_readBitsOnly","exponent","significand","divisor","curByte","startBit","mask","NaN","Infinity","start","offsetLeft","offsetRight","lastByte","diff","sum","_shl","b","readCachedString","isJSControlled","getOwnerCallbackNames","getOwnerCallbackNodes","getOwnerCallbackControlEvents","getOwnerOutletNames","getOwnerOutletNodes","getNodesWithAnimationManagers","getAnimationManagersForNodes","getAnimationManagers","setAnimationManagers","animationManagers","addOwnerCallbackName","name","addOwnerCallbackNode","addOwnerCallbackControlEvents","event","addDocumentCallbackName","addDocumentCallbackNode","addDocumentCallbackControlEvents","controlEvents","cleanUp","_readHeader","_readStringCache","_readSequences","_readNodeGraph","setObject","_cleanUpNodeGraph","addOwnerOutletName","addOwnerOutletNode","userObject","getChildren","len","_readCallbackKeyframesForSeq","seq","numKeyframes","channel","BuilderSequenceProperty","locJsControlled","locKeyframes","getKeyframes","time","callbackName","callbackType","value","keyframe","BuilderKeyframe","setTime","setValue","getKeyframeCallbacks","setCallbackChannel","_readSoundKeyframesForSeq","soundFile","pitch","pan","gain","setSoundChannel","sequences","getSequences","numSeqs","BuilderSequence","setDuration","setName","setSequenceId","setChainedSequenceId","setAutoPlaySequenceId","readKeyframe","easingType","easingOpt","setEasingType","setEasingOpt","color","spriteSheet","spriteFile","texture","textureCache","addImage","locContentSize","getContentSize","bounds","rect","width","height","SpriteFrame","frameCache","spriteFrameCache","indexOf","addSpriteFrames","getSpriteFrame","magicBytes","_readStringFromBytes","version","startIndex","strLen","reverse","strValue","locData","String","fromCharCode","numStrings","_readStringCacheEntry","b0","b1","numBytes","str","locCurrentByte","hexChar","toString","toUpperCase","decodeURIComponent","parent","className","jsControlledName","locActionManager","memberVarAssignmentType","memberVarAssignmentName","ccNodeLoader","getCCNodeLoader","loadCCNode","getRootNode","setRootNode","setDocumentControllerName","seqs","locAnimatedProps","numSequence","seqId","seqNodeProps","numProps","j","seqProp","setType","getName","k","keyFrame","getType","count","addNode","parseProperties","isCCBFileNode","ccbFileNode","embeddedNode","setPosition","getPosition","setRotation","getRotation","setScaleX","getScaleX","setScaleY","getScaleY","setTag","getTag","setVisible","moveAnimationsFromNode","target","locMemberAssigner","assigned","onAssignCCBMemberVariable","addDocumentOutletName","addDocumentOutletNode","getCustomProperties","customAssigned","onAssignCCBCustomProperty","customProperties","customPropKeys","customPropValue","numChildren","child","onNodeLoaded","_readUTF8","_ccbResolutionScale","setResolutionScale","scale","getResolutionScale","loadAsScene","ccbFilePath","ccbRootPath","getResourcePath","getNode","load","_controllerClassCache","registerController","controllerName","controller","reader","NodeLoaderLibrary","newDefaultCCNodeLoaderLibrary","toLowerCase","lastIndexOf","callbackNode","callbackControlEvents","outletName","outletNode","ownerCallbackNames","ownerCallbackNodes","ownerCallbackControlEvents","ControlButton","addTargetWithActionForControlEvents","setCallback","ownerOutletNames","ownerOutletNodes","nodesWithAnimationManagers","animationManagersForNodes","controllerClassCache","innerNode","getDocumentControllerName","controllerClass","rootNode","documentCallbackNames","getDocumentCallbackNames","documentCallbackNodes","getDocumentCallbackNodes","documentCallbackControlEvents","getDocumentCallbackControlEvents","documentOutletNames","getDocumentOutletNames","documentOutletNodes","getDocumentOutletNodes","onDidLoadFromCCB","isFunction","keyframeCallbacks","callbackSplit","split","kfCallbackName","setCallFunc","callFunc","_resourcePath","setResourcePath","lastPathComponent","pathStr","slashPos","substring","deletePathExtension","dotPos","sourceStr","endsWith","ending","concat","stringA","stringB","register","_binaryLoader"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,IAAIA,cAAc,CAAlB;;AAEA,IAAIC,wBAAwB,CAA5B;AACA,IAAIC,oBAAoB,CAAxB;AACA,IAAIC,qBAAqB,CAAzB;AACA,IAAIC,yBAAyB,CAA7B;AACA,IAAIC,yBAAyB,CAA7B;AACA,IAAIC,uBAAuB,CAA3B;AACA,IAAIC,uBAAuB,CAA3B;AACA,IAAIC,qBAAqB,CAAzB;AACA,IAAIC,wBAAwB,CAA5B;AACA,IAAIC,qBAAqB,CAAzB;AACA,IAAIC,2BAA2B,EAA/B;AACA,IAAIC,uBAAuB,EAA3B;AACA,IAAIC,oBAAoB,EAAxB;AACA,IAAIC,sBAAsB,EAA1B;AACA,IAAIC,yBAAyB,EAA7B;AACA,IAAIC,oBAAoB,EAAxB;AACA,IAAIC,yBAAyB,EAA7B;AACA,IAAIC,uBAAuB,EAA3B;AACA,IAAIC,oBAAoB,EAAxB;AACA,IAAIC,uBAAuB,EAA3B;AACA,IAAIC,8BAA8B,EAAlC;AACA,IAAIC,qBAAqB,EAAzB;AACA,IAAIC,yBAAyB,EAA7B;AACA,IAAIC,uBAAuB,EAA3B;AACA,IAAIC,sBAAsB,EAA1B;AACA,IAAIC,8BAA8B,EAAlC;AACA,IAAIC,0BAA0B,EAA9B;AACA,IAAIC,uBAAuB,EAA3B;;AAEA,IAAIC,aAAa,CAAjB;AACA,IAAIC,aAAa,CAAjB;AACA,IAAIC,mBAAmB,CAAvB;AACA,IAAIC,cAAc,CAAlB;AACA,IAAIC,oBAAoB,CAAxB;AACA,IAAIC,iBAAiB,CAArB;;AAEA,IAAIC,mBAAmB,CAAvB;AACA,IAAIC,mBAAmB,CAAvB;AACA,IAAIC,mBAAmB,CAAvB;;AAEA,IAAIC,sBAAsB,CAA1B;AACA,IAAIC,8BAA8B,CAAlC;AACA,IAAIC,uBAAuB,CAA3B;;AAEA,IAAIC,8BAA8B,CAAlC;AACA,IAAIC,6BAA6B,CAAjC;AACA,IAAIC,+BAA+B,CAAnC;AACA,IAAIC,gCAAgC,CAApC;AACA,IAAIC,kCAAkC,CAAtC;AACA,IAAIC,iCAAiC,CAArC;AACA,IAAIC,kCAAkC,CAAtC;AACA,IAAIC,oCAAoC,CAAxC;AACA,IAAIC,gCAAgC,CAApC;AACA,IAAIC,iCAAiC,CAArC;AACA,IAAIC,mCAAmC,EAAvC;AACA,IAAIC,8BAA8B,EAAlC;AACA,IAAIC,+BAA+B,EAAnC;AACA,IAAIC,iCAAiC,EAArC;;AAEA,IAAIC,wCAAwC,CAA5C;AACA,IAAIC,qCAAqC,CAAzC;AACA,IAAIC,sCAAsC,CAA1C;AACA,IAAIC,yCAAyC,CAA7C;AACA,IAAIC,2BAA2B,CAA/B;AACA,IAAIC,uCAAuC,CAA3C;;AAEA,IAAIC,wBAAwB,CAA5B;AACA,IAAIC,uBAAuB,CAA3B;AACA,IAAIC,kCAAkC,CAAtC;AACA,IAAIC,kCAAkC,CAAtC;AACA,IAAIC,gCAAgC,CAApC;AACA,IAAIC,mCAAmC,CAAvC;;AAEA,IAAIC,yBAAyB,CAA7B;AACA,IAAIC,oCAAoC,CAAxC;;AAEA;;;AAGAC,GAAGC,aAAH,GAAmBD,GAAGE,KAAH,CAASC,MAAT,CAAgB;AAC/BC,mBAAe,KADgB;AAE/BC,WAAO,IAFwB;AAG/BC,kBAAc,EAHiB;;AAK/BC,YAAQ,CALuB;AAM/BC,kBAAc,CANiB;AAO/BC,iBAAa,CAPkB;;AAS/BC,kBAAc,IATiB;AAU/BC,yBAAqB,IAVU;;AAY/BC,YAAQ,IAZuB;AAa/BC,uBAAmB,IAbY;AAc/BC,wBAAoB,IAdW;AAe/BC,oBAAgB,IAfe;;AAiB/BC,0BAAsB,IAjBS;AAkB/BC,2BAAuB,IAlBQ;AAmB/BC,gCAA4B,IAnBG;AAoB/BC,0BAAsB,IApBS;;AAsB/BC,uBAAmB,IAtBY;AAuB/BC,uBAAmB,IAvBY;AAwB/BC,iCAA6B,IAxBE;AAyB/BC,+BAA2B,IAzBI;;AA2B/BC,yBAAqB,IA3BU;AA4B/BC,yBAAqB,IA5BU;AA6B/BC,0BAAsB,IA7BS;;AA+B/BC,4BAAwB,KA/BO;;AAiC/BC,UAAM,cAAUC,mBAAV,EAA+BC,yBAA/B,EAA0DC,mBAA1D,EAA+EC,oBAA/E,EAAqG;AACvG,aAAKtB,YAAL,GAAoB,EAApB;AACA,aAAKC,mBAAL,GAA2B,EAA3B;AACA,aAAKF,WAAL,GAAmB,CAAC,CAApB;AACA,aAAKD,YAAL,GAAoB,CAAC,CAArB;;AAEA,YAAIyB,UAAUC,MAAV,KAAqB,CAAzB,EAA4B;AACxB,gBAAIL,+BAA+B7B,GAAGC,aAAtC,EAAqD;AACjD,oBAAIkC,YAAYN,mBAAhB;;AAEA;AACA,qBAAKlB,mBAAL,GAA2BwB,UAAUxB,mBAArC;AACA,qBAAKK,oBAAL,GAA4BmB,UAAUnB,oBAAtC;;AAEA,qBAAKE,0BAAL,GAAkCiB,UAAUjB,0BAA5C;AACA,qBAAKC,oBAAL,GAA4BgB,UAAUhB,oBAAtC;AACA,qBAAKF,qBAAL,GAA6BkB,UAAUlB,qBAAvC;;AAEA,qBAAKO,mBAAL,GAA2BW,UAAUX,mBAArC;AACA,qBAAKC,mBAAL,GAA2BU,UAAUV,mBAArC;AACA,qBAAKC,oBAAL,GAA4BS,UAAUT,oBAAtC;AACA,qBAAKN,iBAAL,GAAyBe,UAAUf,iBAAnC;AACA,qBAAKC,iBAAL,GAAyBc,UAAUd,iBAAnC;AACA,qBAAKf,YAAL,GAAoB6B,UAAU7B,YAA9B;AACH,aAjBD,MAiBO;AACH,qBAAKU,oBAAL,GAA4Ba,mBAA5B;AACA,qBAAKX,0BAAL,GAAkCY,yBAAlC;AACA,qBAAKX,oBAAL,GAA4BY,mBAA5B;AACA,qBAAKd,qBAAL,GAA6Be,oBAA7B;AACH;AACJ;AACJ,KAhE8B;;AAkE/BI,oBAAgB,0BAAY;AACxB,eAAO,KAAK9B,YAAZ;AACH,KApE8B;;AAsE/B+B,oBAAgB,wBAAUC,QAAV,EAAoB;AAChC,aAAKhC,YAAL,GAAoBgC,QAApB;AACH,KAxE8B;;AA0E/BC,kBAAc,sBAAUC,IAAV,EAAgBC,KAAhB,EAAuB;AACjC;AACA,aAAK5B,iBAAL,GAAyB,IAAIb,GAAG0C,uBAAP,EAAzB;;AAEA;AACA;AACA,aAAKrC,KAAL,GAAamC,IAAb;AACA,aAAKjC,MAAL,GAAciC,KAAKN,MAAnB;AACA,aAAKzB,WAAL,GAAmB,CAAnB;AACA,aAAKD,YAAL,GAAoB,CAApB;;AAEA,aAAKI,MAAL,GAAc6B,KAAd;;AAEA;AACA,aAAK5B,iBAAL,CAAuB8B,oBAAvB,CAA4C3C,GAAG4C,QAAH,CAAYC,UAAZ,EAA5C;;AAEA,eAAO,IAAP;AACH,KA3F8B;;AA6F/BC,qBAAiB,yBAAUC,GAAV,EAAe;AAC5B,YAAIC,OAAO,IAAX;AACA,YAAIC,MAAM,KAAKC,iBAAL,EAAV;AACA,YAAIC,UAAU,UAAUJ,GAAV,GAAgB,UAA9B;AACAE,YAAIG,IAAJ,CAAS,KAAT,EAAgBL,GAAhB,EAAqB,KAArB;AACA,YAAIM,YAAY,IAAhB;AACA,YAAI,QAAQC,IAAR,CAAaC,UAAUC,SAAvB,KAAqC,CAAC,SAASF,IAAT,CAAcC,UAAUC,SAAxB,CAA1C,EAA8E;AAC1EP,gBAAIQ,gBAAJ,CAAqB,gBAArB,EAAuC,gBAAvC;AACAR,gBAAIS,IAAJ,CAAS,IAAT;AACA,gBAAIT,IAAIU,MAAJ,KAAe,GAAnB,EAAwB;AACpB3D,mBAAG4D,GAAH,CAAOT,OAAP;AACA,uBAAO,IAAP;AACH;;AAED,gBAAIU,eAAe7D,GAAG8D,0BAAH,CAA8Bb,IAAI,cAAJ,CAA9B,CAAnB;AACA,gBAAIY,YAAJ,EAAkB;AACdR,4BAAY,KAAKU,qBAAL,CAA2BF,YAA3B,CAAZ;AACA,qBAAKG,cAAL,CAAoBjB,GAApB,IAA2BM,SAA3B;AACH;AACJ,SAbD,MAaO;AACH,gBAAIJ,IAAIgB,gBAAR,EACIhB,IAAIgB,gBAAJ,CAAqB,qCAArB;AACJhB,gBAAIS,IAAJ,CAAS,IAAT;AACA,gBAAIT,IAAIU,MAAJ,KAAe,GAAnB,EAAwB;AACpB3D,mBAAG4D,GAAH,CAAOT,OAAP;AACA,uBAAO,IAAP;AACH;;AAEDE,wBAAY,KAAKU,qBAAL,CAA2Bd,IAAIiB,YAA/B,CAAZ;AACA,iBAAKF,cAAL,CAAoBjB,GAApB,IAA2BM,SAA3B;AACH;AACD,eAAOA,SAAP;AACH,KA7H8B;;AA+H/Bc,2BAAuB,+BAAUC,WAAV,EAAuB3B,KAAvB,EAA8B4B,UAA9B,EAA0CC,gBAA1C,EAA4D;AAC/E,YAAID,cAAc,IAAlB,EAAwB;AACpBA,yBAAarE,GAAG4C,QAAH,CAAYC,UAAZ,EAAb;AACH,SAFD,MAEO,IAAIwB,sBAAuBrE,GAAG0C,uBAA9B,EAAuD;AAC1D4B,+BAAmBD,UAAnB;AACAA,yBAAarE,GAAG4C,QAAH,CAAYC,UAAZ,EAAb;AACH;;AAED,YAAIL,OAAOxC,GAAGuE,MAAH,CAAUC,MAAV,CAAiBJ,WAAjB,CAAX;AACA,YAAI,CAAC5B,IAAL,EAAW;AACP,gBAAIiC,UAAUzE,GAAGuE,MAAH,CAAUG,MAAV,CAAiBN,WAAjB,CAAd;AACA5B,mBAAOxC,GAAGuE,MAAH,CAAUI,cAAV,CAAyBF,OAAzB,CAAP;AACAzE,eAAGuE,MAAH,CAAUK,KAAV,CAAgBR,WAAhB,IAA+B5B,IAA/B;AACH;;AAED,eAAO,KAAKqC,qBAAL,CAA2BrC,IAA3B,EAAiCC,KAAjC,EAAwC4B,UAAxC,EAAoDC,gBAApD,CAAP;AACH,KA/I8B;;AAiJ/BO,2BAAuB,+BAAUrC,IAAV,EAAgBC,KAAhB,EAAuB4B,UAAvB,EAAmC;AACtD,aAAK9B,YAAL,CAAkBC,IAAlB,EAAwBC,KAAxB;AACA,YAAIqC,sBAAsB,KAAKjE,iBAA/B;AACAiE,4BAAoBnC,oBAApB,CAAyC0B,UAAzC;AACAS,4BAAoBC,QAApB,CAA6BtC,KAA7B;;AAEA,aAAKrB,iBAAL,GAAyB,EAAzB;AACA,aAAKC,iBAAL,GAAyB,EAAzB;AACA,aAAKG,mBAAL,GAA2B,EAA3B;AACA,aAAKC,mBAAL,GAA2B,EAA3B;AACA,aAAKC,oBAAL,GAA4B,EAA5B;AACA,aAAKZ,kBAAL,GAA0B,IAAId,GAAGgF,WAAP,EAA1B;;AAEA,YAAIC,YAAY,KAAKC,mBAAL,CAAyB,IAAzB,CAAhB;;AAEA,YAAID,aAAaH,oBAAoBK,qBAApB,OAAgD,CAAC,CAAlE,EAAqE;AACjE;AACAL,gCAAoBM,aAApB,CAAkCN,oBAAoBK,qBAApB,EAAlC,EAA+E,CAA/E;AACH;;AAED,YAAI,KAAK/E,aAAT,EAAwB;AACpB,gBAAIiF,WAAW,EAAf;AACA,gBAAIC,gBAAgB,EAApB;;AAEA,gBAAIC,uBAAuB,KAAKzE,kBAAhC;AACA,gBAAI0E,aAAaD,qBAAqBE,OAArB,EAAjB;AACA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,WAAWtD,MAA/B,EAAuCwD,GAAvC,EAA4C;AACxCL,yBAASM,IAAT,CAAcH,WAAWE,CAAX,CAAd;AACAJ,8BAAcK,IAAd,CAAmBJ,qBAAqBK,YAArB,CAAkCJ,WAAWE,CAAX,CAAlC,CAAnB;AACH;;AAED,iBAAKpE,2BAAL,GAAmC+D,QAAnC;AACA,iBAAK9D,yBAAL,GAAiC+D,aAAjC;AACH;;AAED,eAAOL,SAAP;AACH,KArL8B;;AAuL/BY,sCAAkC,0CAAUzB,WAAV,EAAuB3B,KAAvB,EAA8B4B,UAA9B,EAA0CC,gBAA1C,EAA4D;AAC1F,YAAIwB,OAAO,KAAK3B,qBAAL,CAA2BC,WAA3B,EAAwC3B,KAAxC,EAA+C4B,UAA/C,EAA2DC,gBAA3D,CAAX;AACA,YAAIyB,QAAQ,IAAI/F,GAAGgG,KAAP,EAAZ;AACAD,cAAME,QAAN,CAAeH,IAAf;AACA,eAAOC,KAAP;AACH,KA5L8B;;AA8L/BG,kCAA8B,wCAAY;AACtC,eAAO,KAAKhF,0BAAZ;AACH,KAhM8B;;AAkM/BiF,4BAAwB,kCAAY;AAChC,eAAO,KAAKhF,oBAAZ;AACH,KApM8B;;AAsM/BiF,yBAAqB,+BAAY;AAC7B,eAAO,KAAKvF,iBAAZ;AACH,KAxM8B;;AA0M/BwF,yBAAqB,6BAAU/B,gBAAV,EAA4B;AAC7C,aAAKzD,iBAAL,GAAyByD,gBAAzB;AACH,KA5M8B;;AA8M/BgC,2BAAuB,iCAAY;AAC/B,eAAO,KAAKvF,cAAZ;AACH,KAhN8B;;AAkN/BwF,0BAAsB,gCAAY;AAC9B,eAAO,KAAK5F,mBAAZ;AACH,KApN8B;;AAsN/B6F,cAAU,oBAAY;AAClB,eAAO,KAAK5F,MAAZ;AACH,KAxN8B;;AA0N/B6F,aAAS,iBAAUC,MAAV,EAAkB;AACvB,YAAIC,UAAU,CAAd;AACA,YAAInE,OAAO,KAAKnC,KAAL,CAAW,KAAKG,YAAhB,CAAX;AACA,YAAIoG,MAAM,CAAC,EAAEpE,OAAQ,KAAK,KAAK/B,WAAL,EAAf,CAAX;AACA,eAAO,CAACmG,GAAR,EAAa;AACTD;AACAC,kBAAM,CAAC,EAAEpE,OAAQ,KAAK,KAAK/B,WAAL,EAAf,CAAP;AACA,gBAAI,KAAKA,WAAL,IAAoB,CAAxB,EAA2B;AACvB,qBAAKA,WAAL,GAAmB,CAAnB;AACA,qBAAKD,YAAL;AACAgC,uBAAO,KAAKnC,KAAL,CAAW,KAAKG,YAAhB,CAAP;AACA,oBAAI,KAAKA,YAAL,GAAoB,KAAKH,KAAL,CAAW6B,MAAnC,EACI,MAAM,IAAI2E,KAAJ,CAAU,uBAAV,CAAN;AACP;AACJ;;AAED,YAAIC,UAAU,CAAd;AACA,aAAK,IAAIC,IAAIJ,UAAU,CAAvB,EAA0BI,KAAK,CAA/B,EAAkCA,GAAlC,EAAuC;AACnCH,kBAAM,CAAC,EAAEpE,OAAQ,KAAK,KAAK/B,WAAL,EAAf,CAAP;AACA,gBAAI,KAAKA,WAAL,IAAoB,CAAxB,EAA2B;AACvB,qBAAKA,WAAL,GAAmB,CAAnB;AACA,qBAAKD,YAAL;AACAgC,uBAAO,KAAKnC,KAAL,CAAW,KAAKG,YAAhB,CAAP;AACA,oBAAI,KAAKA,YAAL,GAAoB,KAAKH,KAAL,CAAW6B,MAAnC,EACI,MAAM,IAAI2E,KAAJ,CAAU,uBAAV,CAAN;AACP;AACD,gBAAID,GAAJ,EAAS;AACLE,2BAAW,KAAKC,CAAhB;AACH;AACJ;AACDD,mBAAW,KAAKH,OAAhB;;AAEA,YAAIK,GAAJ;AACA,YAAIN,MAAJ,EAAY;AACR,gBAAIO,IAAIH,UAAU,CAAlB;AACA,gBAAIG,CAAJ,EAAO;AACHD,sBAAM,IAAKF,UAAU,CAArB;AACH,aAFD,MAEO;AACHE,sBAAM,IAAK,CAACF,OAAD,GAAW,CAAtB;AACH;AACJ,SAPD,MAOO;AACHE,kBAAMF,UAAU,CAAhB;AACH;;AAED,YAAI,KAAKrG,WAAT,EAAsB;AAClB,iBAAKA,WAAL,GAAmB,CAAnB;AACA,iBAAKD,YAAL;AACH;;AAED,eAAOwG,GAAP;AACH,KA5Q8B;;AA8Q/BE,cAAU,oBAAY;AAClB,YAAIC,YAAY,KAAK9G,KAAL,CAAW,KAAKG,YAAhB,CAAhB;AACA,aAAKA,YAAL;AACA,eAAO2G,SAAP;AACH,KAlR8B;;AAoR/BC,cAAU,oBAAY;AAClB,eAAO,CAAC,CAAC,KAAK/G,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAT;AACH,KAtR8B;;AAwR/B6G,eAAW,qBAAY;AACnB,YAAIC,OAAO,KAAKjH,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAX;;AAEA,gBAAQ8G,IAAR;AACI,iBAAK9J,UAAL;AACI,uBAAO,CAAP;AACJ,iBAAKC,UAAL;AACI,uBAAO,CAAP;AACJ,iBAAKC,gBAAL;AACI,uBAAO,CAAC,CAAR;AACJ,iBAAKC,WAAL;AACI,uBAAO,GAAP;AACJ,iBAAKC,iBAAL;AACI,uBAAO,KAAK6I,OAAL,CAAa,IAAb,CAAP;AACJ;AACI;;;AAGA,oBAAIc,KAAK,KAAKC,YAAL,CAAkB,EAAlB,EAAsB,CAAtB,CAAT,CAJJ,CAIuC;AACnC;AACA,uBAAOD,EAAP;AAjBR;AAmBH,KA9S8B;;AAgT/BC,kBAAc,sBAAUC,aAAV,EAAyBC,YAAzB,EAAuC;AACjD,YAAIxF,SAASuF,gBAAgBC,YAAhB,GAA+B,CAA5C;AACA,YAAIC,OAAOzF,UAAU,CAArB;AACA,YAAI,KAAK1B,YAAL,GAAoBmH,IAApB,IAA4B,KAAKtH,KAAL,CAAW6B,MAA3C,EAAmD;AAC/C,kBAAM,IAAI2E,KAAJ,CAAU,oBAAV,CAAN;AACH;;AAED,YAAIe,OAAOC,KAAKC,GAAL,CAAS,CAAT,EAAYJ,eAAe,CAA3B,IAAgC,CAA3C;AACA,YAAIK,SAAS,KAAKC,aAAL,CAAmBP,gBAAgBC,YAAnC,EAAiD,CAAjD,EAAoDC,IAApD,CAAb;AACA,YAAIM,WAAW,KAAKD,aAAL,CAAmBP,aAAnB,EAAkCC,YAAlC,EAAgDC,IAAhD,CAAf;AACA,YAAIO,cAAc,CAAlB;AACA,YAAIC,UAAU,CAAd;AACA,YAAIC,UAAU,CAAd,CAZiD,CAYhC;AACjB,WAAG;AACC,gBAAIjB,YAAY,KAAK9G,KAAL,CAAW,KAAKG,YAAL,GAAoBmH,IAApB,GAA4B,EAAES,OAA9B,GAAyC,CAApD,CAAhB;AACA,gBAAIC,WAAWZ,gBAAgB,CAAhB,IAAqB,CAApC;AACA,gBAAIa,OAAO,KAAKD,QAAhB;AACA,mBAAOC,SAAS,CAAhB,EAAmB;AACf,oBAAInB,YAAYmB,IAAhB,EAAsB;AAClBJ,mCAAe,IAAIC,OAAnB;AACH;AACDA,2BAAW,CAAX;AACH;AACJ,SAVD,QAUSV,iBAAiBY,QAV1B;;AAYA,aAAK7H,YAAL,IAAqBmH,IAArB;;AAEA,eAAOM,aAAa,CAACL,QAAQ,CAAT,IAAc,CAA3B,GAA+BM,cAAcK,GAAd,GAAoBR,SAAS,CAACS,QAAV,GAAqB,CAACA,QAAzE,GACD,CAAC,IAAIT,SAAS,CAAC,CAAf,KAAqBE,YAAYC,WAAZ,GAA0B,CAACD,QAAD,GAAYJ,KAAKC,GAAL,CAAS,CAAT,EAAY,CAACF,IAAD,GAAQ,CAApB,IAAyBM,WAArC,GAC/CL,KAAKC,GAAL,CAAS,CAAT,EAAYG,WAAWL,IAAvB,KAAgC,IAAIM,WAApC,CADqB,GAC8B,CADnD,CADN;AAGH,KA9U8B;;AAgV/BF,mBAAe,uBAAUS,KAAV,EAAiBvG,MAAjB,EAAyByF,IAAzB,EAA+B;AAC1C,YAAIe,aAAa,CAACD,QAAQvG,MAAT,IAAmB,CAApC;AACA,YAAIyG,cAAcF,QAAQ,CAA1B;AACA,YAAIL,UAAUT,QAAQc,SAAS,CAAjB,IAAsB,CAApC;AACA,YAAIG,WAAWjB,QAAQ,EAAEc,QAAQvG,MAAV,KAAqB,CAA7B,CAAf;AACA,YAAI2G,OAAOT,UAAUQ,QAArB;;AAEA,YAAIE,MAAO,KAAKzI,KAAL,CAAW,KAAKG,YAAL,GAAoBmH,IAApB,GAA2BS,OAA3B,GAAqC,CAAhD,KAAsDO,WAAvD,GAAuE,CAAC,MAAME,OAAO,IAAIF,WAAX,GAAyBzG,MAA/B,CAAD,IAA2C,CAA5H;;AAEA,YAAI2G,QAAQH,UAAZ,EAAwB;AACpBI,mBAAO,CAAC,KAAKzI,KAAL,CAAW,KAAKG,YAAL,GAAoBmH,IAApB,GAA2BiB,QAA3B,GAAsC,CAAjD,IAAuD,CAAC,KAAKF,UAAN,IAAoB,CAA5E,KAAmF,CAACG,UAAU,CAAX,IAAgBF,WAA1G;AACAC;AACH;;AAED,eAAOC,IAAP,EAAa;AACTC,mBAAO,KAAKC,IAAL,CAAU,KAAK1I,KAAL,CAAW,KAAKG,YAAL,GAAoBmH,IAApB,GAA2BiB,QAA3B,GAAsC,CAAjD,CAAV,EAA+D,CAACC,UAAU,CAAX,IAAgBF,WAA/E,CAAP;AACAC;AACH;;AAED,eAAOE,GAAP;AACH,KApW8B;;AAsW/BC,UAAM,cAAUhC,CAAV,EAAaiC,CAAb,EAAgB;AAClB,aAAK,EAAEA,CAAP,EAAU,EAAEA,CAAZ,EAAejC,IAAI,CAAC,CAACA,KAAK,aAAa,CAAnB,IAAwB,UAAzB,MAAyC,UAAzC,GAAsDA,IAAI,CAA1D,GAA8D,CAACA,IAAI,UAAL,IAAmB,CAAnB,GAAuB,UAAvB,GAAoC,CAArH;AACA,eAAOA,CAAP;AACH,KAzW8B;;AA2W/BkC,sBAAkB,4BAAY;AAC1B,eAAO,KAAKvI,YAAL,CAAkB,KAAK+F,OAAL,CAAa,KAAb,CAAlB,CAAP;AACH,KA7W8B;;AA+W/ByC,oBAAgB,0BAAY;AACxB,eAAO,KAAK9I,aAAZ;AACH,KAjX8B;;AAmX/B+I,2BAAuB,iCAAY;AAC/B,eAAO,KAAK3H,mBAAZ;AACH,KArX8B;;AAuX/B4H,2BAAuB,iCAAY;AAC/B,eAAO,KAAK3H,mBAAZ;AACH,KAzX8B;;AA2X/B4H,mCAA+B,yCAAY;AACvC,eAAO,KAAK3H,oBAAZ;AACH,KA7X8B;;AA+X/B4H,yBAAqB,+BAAY;AAC7B,eAAO,KAAKlI,iBAAZ;AACH,KAjY8B;;AAmY/BmI,yBAAqB,+BAAY;AAC7B,eAAO,KAAKlI,iBAAZ;AACH,KArY8B;;AAuY/BmI,mCAA+B,yCAAY;AACvC,eAAO,KAAKlI,2BAAZ;AACH,KAzY8B;;AA2Y/BmI,kCAA8B,wCAAY;AACtC,eAAO,KAAKlI,yBAAZ;AACH,KA7Y8B;;AA+Y/BmI,0BAAsB,gCAAY;AAC9B,eAAO,KAAK5I,kBAAZ;AACH,KAjZ8B;;AAmZ/B6I,0BAAsB,8BAAUC,iBAAV,EAA6B;AAC/C,aAAK9I,kBAAL,GAA0B8I,iBAA1B;AACH,KArZ8B;;AAuZ/BC,0BAAsB,8BAAUC,IAAV,EAAgB;AAClC,aAAKtI,mBAAL,CAAyBmE,IAAzB,CAA8BmE,IAA9B;AACH,KAzZ8B;;AA2Z/BC,0BAAsB,8BAAUjE,IAAV,EAAgB;AAClC,aAAKrE,mBAAL,CAAyBkE,IAAzB,CAA8BG,IAA9B;AACH,KA7Z8B;;AA+Z/BkE,mCAA+B,uCAAUC,KAAV,EAAiB;AAC5C,aAAKvI,oBAAL,CAA0BiE,IAA1B,CAA+BsE,KAA/B;AACH,KAja8B;;AAma/BC,6BAAyB,iCAAUJ,IAAV,EAAgB;AACrC,aAAKjJ,iBAAL,CAAuBqJ,uBAAvB,CAA+CJ,IAA/C;AACH,KAra8B;;AAua/BK,6BAAyB,iCAAUrE,IAAV,EAAgB;AACrC,aAAKjF,iBAAL,CAAuBsJ,uBAAvB,CAA+CrE,IAA/C;AACH,KAza8B;;AA2a/BsE,sCAAkC,0CAAUC,aAAV,EAAyB;AACvD,aAAKxJ,iBAAL,CAAuBuJ,gCAAvB,CAAwDC,aAAxD;AACH,KA7a8B;;AA+a/BnF,yBAAqB,6BAAUoF,OAAV,EAAmB;AACpC,YAAI,CAAC,KAAKC,WAAL,EAAL,EACI,OAAO,IAAP;AACJ,YAAI,CAAC,KAAKC,gBAAL,EAAL,EACI,OAAO,IAAP;AACJ,YAAI,CAAC,KAAKC,cAAL,EAAL,EACI,OAAO,IAAP;;AAEJ,YAAI3E,OAAO,KAAK4E,cAAL,EAAX;AACA,aAAK5J,kBAAL,CAAwB6J,SAAxB,CAAkC,KAAK9J,iBAAvC,EAA0DiF,IAA1D;;AAEA,YAAIwE,OAAJ,EACI,KAAKM,iBAAL,CAAuB9E,IAAvB;AACJ,eAAOA,IAAP;AACH,KA7b8B;;AA+b/B+E,wBAAoB,4BAAUf,IAAV,EAAgB;AAChC,aAAK1I,iBAAL,CAAuBuE,IAAvB,CAA4BmE,IAA5B;AACH,KAjc8B;;AAmc/BgB,wBAAoB,4BAAUhF,IAAV,EAAgB;AAChC,YAAIA,QAAQ,IAAZ,EACI;;AAEJ,aAAKzE,iBAAL,CAAuBsE,IAAvB,CAA4BG,IAA5B;AACH,KAxc8B;;AA0c/B8E,uBAAmB,2BAAU9E,IAAV,EAAgB;AAC/BA,aAAKiF,UAAL,GAAkB,IAAlB;AACA,YAAIC,cAAclF,KAAKkF,WAAL,EAAlB;AACA,aAAK,IAAItF,IAAI,CAAR,EAAWuF,MAAMD,YAAY9I,MAAlC,EAA0CwD,IAAIuF,GAA9C,EAAmDvF,GAAnD,EAAwD;AACpD,iBAAKkF,iBAAL,CAAuBI,YAAYtF,CAAZ,CAAvB;AACH;AACJ,KAhd8B;;AAkd/BwF,kCAA8B,sCAAUC,GAAV,EAAe;AACzC,YAAIC,eAAe,KAAK3E,OAAL,CAAa,KAAb,CAAnB;;AAEA,YAAI,CAAC2E,YAAL,EACI,OAAO,IAAP;;AAEJ,YAAIC,UAAU,IAAIrL,GAAGsL,uBAAP,EAAd;AACA,YAAIC,kBAAkB,KAAKnL,aAA3B;AAAA,YAA0C0E,sBAAsB,KAAKjE,iBAArE;AAAA,YAAwF2K,eAAeH,QAAQI,YAAR,EAAvG;AACA,aAAK,IAAI/F,IAAI,CAAb,EAAgBA,IAAI0F,YAApB,EAAkC1F,GAAlC,EAAuC;AACnC,gBAAIgG,OAAO,KAAKrE,SAAL,EAAX;AACA,gBAAIsE,eAAe,KAAK1C,gBAAL,EAAnB;AACA,gBAAI2C,eAAe,KAAKnF,OAAL,CAAa,KAAb,CAAnB;;AAEA,gBAAIoF,QAAQ,CAACF,YAAD,EAAeC,YAAf,CAAZ;;AAEA,gBAAIE,WAAW,IAAI9L,GAAG+L,eAAP,EAAf;AACAD,qBAASE,OAAT,CAAiBN,IAAjB;AACAI,qBAASG,QAAT,CAAkBJ,KAAlB;;AAEA,gBAAIN,eAAJ,EACIzG,oBAAoBoH,oBAApB,GAA2CvG,IAA3C,CAAgDiG,eAAe,GAAf,GAAqBD,YAArE;;AAEJH,yBAAa7F,IAAb,CAAkBmG,QAAlB;AACH;;AAED;AACAX,YAAIgB,kBAAJ,CAAuBd,OAAvB;;AAEA,eAAO,IAAP;AACH,KA/e8B;;AAif/Be,+BAA2B,mCAAUjB,GAAV,EAAe;AACtC,YAAIC,eAAe,KAAK3E,OAAL,CAAa,KAAb,CAAnB;;AAEA,YAAI,CAAC2E,YAAL,EACI,OAAO,IAAP;;AAEJ,YAAIC,UAAU,IAAIrL,GAAGsL,uBAAP,EAAd;AACA,YAAIE,eAAeH,QAAQI,YAAR,EAAnB;AACA,aAAK,IAAI/F,IAAI,CAAb,EAAgBA,IAAI0F,YAApB,EAAkC1F,GAAlC,EAAuC;AACnC,gBAAIgG,OAAO,KAAKrE,SAAL,EAAX;AACA,gBAAIgF,YAAY,KAAKpD,gBAAL,EAAhB;AACA,gBAAIqD,QAAQ,KAAKjF,SAAL,EAAZ;AACA,gBAAIkF,MAAM,KAAKlF,SAAL,EAAV;AACA,gBAAImF,OAAO,KAAKnF,SAAL,EAAX;;AAEA,gBAAIwE,QAAQ,CAACQ,SAAD,EAAYC,KAAZ,EAAmBC,GAAnB,EAAwBC,IAAxB,CAAZ;AACA,gBAAIV,WAAW,IAAI9L,GAAG+L,eAAP,EAAf;AACAD,qBAASE,OAAT,CAAiBN,IAAjB;AACAI,qBAASG,QAAT,CAAkBJ,KAAlB;;AAEAL,yBAAa7F,IAAb,CAAkBmG,QAAlB;AACH;;AAED;AACAX,YAAIsB,eAAJ,CAAoBpB,OAApB;AACA,eAAO,IAAP;AACH,KA3gB8B;AA4gB/BZ,oBAAgB,0BAAY;AACxB,YAAIiC,YAAY,KAAK7L,iBAAL,CAAuB8L,YAAvB,EAAhB;AACA,YAAIC,UAAU,KAAKnG,OAAL,CAAa,KAAb,CAAd;AACA,aAAK,IAAIf,IAAI,CAAb,EAAgBA,IAAIkH,OAApB,EAA6BlH,GAA7B,EAAkC;AAC9B,gBAAIyF,MAAM,IAAInL,GAAG6M,eAAP,EAAV;AACA1B,gBAAI2B,WAAJ,CAAgB,KAAKzF,SAAL,EAAhB;AACA8D,gBAAI4B,OAAJ,CAAY,KAAK9D,gBAAL,EAAZ;AACAkC,gBAAI6B,aAAJ,CAAkB,KAAKvG,OAAL,CAAa,KAAb,CAAlB;AACA0E,gBAAI8B,oBAAJ,CAAyB,KAAKxG,OAAL,CAAa,IAAb,CAAzB;;AAEA,gBAAI,CAAC,KAAKyE,4BAAL,CAAkCC,GAAlC,CAAL,EACI,OAAO,KAAP;AACJ,gBAAI,CAAC,KAAKiB,yBAAL,CAA+BjB,GAA/B,CAAL,EACI,OAAO,KAAP;;AAEJuB,sBAAU/G,IAAV,CAAewF,GAAf;AACH;AACD,aAAKtK,iBAAL,CAAuBqM,qBAAvB,CAA6C,KAAKzG,OAAL,CAAa,IAAb,CAA7C;AACA,eAAO,IAAP;AACH,KA/hB8B;;AAiiB/B0G,kBAAc,sBAAU7F,IAAV,EAAgB;AAC1B,YAAIwE,WAAW,IAAI9L,GAAG+L,eAAP,EAAf;AACAD,iBAASE,OAAT,CAAiB,KAAK3E,SAAL,EAAjB;AACA,YAAI+F,aAAa,KAAK3G,OAAL,CAAa,KAAb,CAAjB;AACA,YAAI4G,YAAY,CAAhB;AACA,YAAIxB,QAAQ,IAAZ;;AAEA,YAAIuB,eAAe9O,4BAAf,IACG8O,eAAe7O,6BADlB,IAEG6O,eAAe5O,+BAFlB,IAGG4O,eAAe3O,8BAHlB,IAIG2O,eAAe1O,+BAJlB,IAKG0O,eAAezO,iCALtB,EAKyD;AACrD0O,wBAAY,KAAKhG,SAAL,EAAZ;AACH;;AAEDyE,iBAASwB,aAAT,CAAuBF,UAAvB;AACAtB,iBAASyB,YAAT,CAAsBF,SAAtB;;AAEA,YAAI/F,SAASjL,kBAAb,EAAiC;AAC7BwP,oBAAQ,CAAC,CAAC,KAAKxL,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAV;AACH,SAFD,MAEO,IAAI8G,SAAS9K,iBAAb,EAAgC;AACnCqP,oBAAQ,KAAKxL,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAR;AACH,SAFM,MAEA,IAAI8G,SAAS7K,mBAAb,EAAkC;AACrCoP,oBAAQ7L,GAAGwN,KAAH,CAAS,KAAKnN,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAT,EAA0C,KAAKH,KAAL,CAAW,KAAKG,YAAL,EAAX,CAA1C,EAA2E,KAAKH,KAAL,CAAW,KAAKG,YAAL,EAAX,CAA3E,CAAR;AACH,SAFM,MAEA,IAAI8G,SAAS/J,oBAAb,EAAmC;AACtCsO,oBAAQ,CAAC,KAAKxE,SAAL,EAAD,EAAmB,KAAKA,SAAL,EAAnB,CAAR;AACH,SAFM,MAEA,IAAIC,SAASrL,oBAAb,EAAmC;AACtC4P,oBAAQ,KAAKxE,SAAL,EAAR;AACH,SAFM,MAEA,IAAIC,SAAStL,sBAAT,IAAmCsL,SAAS1L,qBAA5C,IAAqE0L,SAAS/J,oBAAlF,EAAwG;AAC3GsO,oBAAQ,CAAC,KAAKxE,SAAL,EAAD,EAAmB,KAAKA,SAAL,EAAnB,CAAR;AACH,SAFM,MAEA,IAAIC,SAAShL,wBAAb,EAAuC;AAC1C,gBAAImR,cAAc,KAAKxE,gBAAL,EAAlB;AACA,gBAAIyE,aAAa,KAAKzE,gBAAL,EAAjB;;AAEA,gBAAIwE,gBAAgB,EAApB,EAAwB;AACpBC,6BAAa,KAAKpN,YAAL,GAAoBoN,UAAjC;AACA,oBAAIC,UAAU3N,GAAG4N,YAAH,CAAgBC,QAAhB,CAAyBH,UAAzB,CAAd;AACA,oBAAII,iBAAiBH,QAAQI,cAAR,EAArB;AACA,oBAAIC,SAAShO,GAAGiO,IAAH,CAAQ,CAAR,EAAW,CAAX,EAAcH,eAAeI,KAA7B,EAAoCJ,eAAeK,MAAnD,CAAb;AACAtC,wBAAQ,IAAI7L,GAAGoO,WAAP,CAAmBT,OAAnB,EAA4BK,MAA5B,CAAR;AACH,aAND,MAMO;AACHP,8BAAc,KAAKnN,YAAL,GAAoBmN,WAAlC;AACA,oBAAIY,aAAarO,GAAGsO,gBAApB;AACA;AACA,oBAAI,KAAK3N,mBAAL,CAAyB4N,OAAzB,CAAiCd,WAAjC,MAAkD,CAAC,CAAvD,EAA0D;AACtDY,+BAAWG,eAAX,CAA2Bf,WAA3B;AACA,yBAAK9M,mBAAL,CAAyBgF,IAAzB,CAA8B8H,WAA9B;AACH;AACD5B,wBAAQwC,WAAWI,cAAX,CAA0Bf,UAA1B,CAAR;AACH;AACJ;AACD5B,iBAASG,QAAT,CAAkBJ,KAAlB;AACA,eAAOC,QAAP;AACH,KAvlB8B;;AAylB/BvB,iBAAa,uBAAY;AACrB;AACA,YAAI,CAAC,KAAKlK,KAAV,EACI,OAAO,KAAP;;AAEJ;AACA,YAAIqO,aAAa,KAAKC,oBAAL,CAA0B,KAAKnO,YAA/B,EAA6C,CAA7C,EAAgD,IAAhD,CAAjB;AACA,aAAKA,YAAL,IAAqB,CAArB;;AAEA,YAAIkO,eAAe,MAAnB,EAA2B;AACvB,mBAAO,KAAP;AACH;;AAED;AACA,YAAIE,UAAU,KAAKnI,OAAL,CAAa,KAAb,CAAd;AACA,YAAImI,YAAYjT,WAAhB,EAA6B;AACzBqE,eAAG4D,GAAH,CAAO,oDAAoDgL,OAApD,GAA8D,WAA9D,GAA4EjT,WAA5E,GAA0F,GAAjG;AACA,mBAAO,KAAP;AACH;;AAED,aAAKyE,aAAL,GAAqB,CAAC,CAAC,KAAKC,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAvB;AACA,aAAKK,iBAAL,CAAuBT,aAAvB,GAAuC,KAAKA,aAA5C;AACA;AACA,eAAO,IAAP;AACH,KAjnB8B;;AAmnB/BuO,0BAAsB,8BAAUE,UAAV,EAAsBC,MAAtB,EAA8BC,OAA9B,EAAuC;AACzDA,kBAAUA,WAAW,KAArB;AACA,YAAIC,WAAW,EAAf;AACA,YAAItJ,CAAJ;AAAA,YAAOuJ,UAAU,KAAK5O,KAAtB;AACA,YAAI0O,OAAJ,EAAa;AACT,iBAAKrJ,IAAIoJ,SAAS,CAAlB,EAAqBpJ,KAAK,CAA1B,EAA6BA,GAA7B;AACIsJ,4BAAYE,OAAOC,YAAP,CAAoBF,QAAQJ,aAAanJ,CAArB,CAApB,CAAZ;AADJ;AAEH,SAHD,MAGO;AACH,iBAAKA,IAAI,CAAT,EAAYA,IAAIoJ,MAAhB,EAAwBpJ,GAAxB;AACIsJ,4BAAYE,OAAOC,YAAP,CAAoBF,QAAQJ,aAAanJ,CAArB,CAApB,CAAZ;AADJ;AAEH;AACD,eAAOsJ,QAAP;AACH,KA/nB8B;;AAioB/BxE,sBAAkB,4BAAY;AAC1B,YAAI4E,aAAa,KAAK3I,OAAL,CAAa,KAAb,CAAjB;AACA,aAAK,IAAIf,IAAI,CAAb,EAAgBA,IAAI0J,UAApB,EAAgC1J,GAAhC;AACI,iBAAK2J,qBAAL;AADJ,SAEA,OAAO,IAAP;AACH,KAtoB8B;;AAwoB/BA,2BAAuB,iCAAY;AAC/B,YAAIC,KAAK,KAAKjP,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAT;AACA,YAAI+O,KAAK,KAAKlP,KAAL,CAAW,KAAKG,YAAL,EAAX,CAAT;;AAEA,YAAIgP,WAAWF,MAAM,CAAN,GAAUC,EAAzB;;AAEA,YAAIE,MAAM,EAAV;AAAA,YAAcR,UAAU,KAAK5O,KAA7B;AAAA,YAAoCqP,iBAAiB,KAAKlP,YAA1D;AACA,aAAK,IAAIkF,IAAI,CAAb,EAAgBA,IAAI8J,QAApB,EAA8B9J,GAA9B,EAAmC;AAC/B,gBAAIiK,UAAUV,QAAQS,iBAAiBhK,CAAzB,EAA4BkK,QAA5B,CAAqC,IAArC,EAA2CC,WAA3C,EAAd;AACAF,sBAAUA,QAAQzN,MAAR,GAAiB,CAAjB,GAAqByN,OAArB,GAA+B,MAAMA,OAA/C;AACAF,mBAAO,MAAME,OAAb;AACH;AACDF,cAAMK,mBAAmBL,GAAnB,CAAN;;AAEA,aAAKjP,YAAL,IAAqBgP,QAArB;AACA,aAAK9O,YAAL,CAAkBiF,IAAlB,CAAuB8J,GAAvB;AACH,KAxpB8B;;AA0pB/B/E,oBAAgB,wBAAUqF,MAAV,EAAkB;AAC9B;AACA,YAAIC,YAAY,KAAK/G,gBAAL,EAAhB;;AAEA,YAAIgH,gBAAJ;AAAA,YAAsB1E,kBAAkB,KAAKnL,aAA7C;AAAA,YAA4D8P,mBAAmB,KAAKrP,iBAApF;AACA,YAAI0K,eAAJ,EACI0E,mBAAmB,KAAKhH,gBAAL,EAAnB;;AAEJ,YAAIkH,0BAA0B,KAAK1J,OAAL,CAAa,KAAb,CAA9B;AACA,YAAI2J,uBAAJ;AACA,YAAID,4BAA4BlS,mBAAhC,EAAqD;AACjDmS,sCAA0B,KAAKnH,gBAAL,EAA1B;AACH;;AAED,YAAIoH,eAAe,KAAKrP,oBAAL,CAA0BsP,eAA1B,CAA0CN,SAA1C,CAAnB;AACA,YAAI,CAACK,YAAL,EAAmB;AACfA,2BAAe,KAAKrP,oBAAL,CAA0BsP,eAA1B,CAA0C,QAA1C,CAAf;AACA;AACA;AACH;AACD,YAAIxK,OAAOuK,aAAaE,UAAb,CAAwBR,MAAxB,EAAgC,IAAhC,CAAX;;AAEA;AACA,YAAI,CAACG,iBAAiBM,WAAjB,EAAL,EACIN,iBAAiBO,WAAjB,CAA6B3K,IAA7B;;AAEJ,YAAIyF,mBAAmBzF,SAASoK,iBAAiBM,WAAjB,EAAhC,EAAgE;AAC5DN,6BAAiBQ,yBAAjB,CAA2CT,gBAA3C;AACH;;AAED;AACA,YAAIU,OAAO,IAAI3Q,GAAGgF,WAAP,EAAX;AACA,aAAKjE,cAAL,GAAsB,EAAtB;;AAEA,YAAI2E,CAAJ;AAAA,YAAOkL,mBAAmB,KAAK7P,cAA/B;AACA,YAAI8P,cAAc,KAAKpK,OAAL,CAAa,KAAb,CAAlB;AACA,aAAKf,IAAI,CAAT,EAAYA,IAAImL,WAAhB,EAA6B,EAAEnL,CAA/B,EAAkC;AAC9B,gBAAIoL,QAAQ,KAAKrK,OAAL,CAAa,KAAb,CAAZ;AACA,gBAAIsK,eAAe,IAAI/Q,GAAGgF,WAAP,EAAnB;;AAEA,gBAAIgM,WAAW,KAAKvK,OAAL,CAAa,KAAb,CAAf;;AAEA,iBAAK,IAAIwK,IAAI,CAAb,EAAgBA,IAAID,QAApB,EAA8B,EAAEC,CAAhC,EAAmC;AAC/B,oBAAIC,UAAU,IAAIlR,GAAGsL,uBAAP,EAAd;AACA4F,wBAAQnE,OAAR,CAAgB,KAAK9D,gBAAL,EAAhB;AACAiI,wBAAQC,OAAR,CAAgB,KAAK1K,OAAL,CAAa,KAAb,CAAhB;;AAEAmK,iCAAiBjL,IAAjB,CAAsBuL,QAAQE,OAAR,EAAtB;AACA,oBAAIhG,eAAe,KAAK3E,OAAL,CAAa,KAAb,CAAnB;AACA,oBAAI+E,eAAe0F,QAAQzF,YAAR,EAAnB;AACA,qBAAK,IAAI4F,IAAI,CAAb,EAAgBA,IAAIjG,YAApB,EAAkC,EAAEiG,CAApC,EAAuC;AACnC,wBAAIC,WAAW,KAAKnE,YAAL,CAAkB+D,QAAQK,OAAR,EAAlB,CAAf;AACA/F,iCAAa7F,IAAb,CAAkB2L,QAAlB;AACH;AACDP,6BAAapG,SAAb,CAAuBuG,OAAvB,EAAgCA,QAAQE,OAAR,EAAhC;AACH;AACDT,iBAAKhG,SAAL,CAAeoG,YAAf,EAA6BD,KAA7B;AACH;;AAED,YAAIH,KAAKa,KAAL,KAAe,CAAnB,EACItB,iBAAiBuB,OAAjB,CAAyB3L,IAAzB,EAA+B6K,IAA/B;;AAEJ;AACAN,qBAAaqB,eAAb,CAA6B5L,IAA7B,EAAmCiK,MAAnC,EAA2C,IAA3C;;AAEA;AACA,YAAI4B,gBAAgB,CAAC,CAAC7L,KAAK8L,WAA3B;AACA,YAAID,aAAJ,EAAmB;AACf,gBAAIE,eAAe/L,KAAK8L,WAAxB;AACAC,yBAAaC,WAAb,CAAyBhM,KAAKiM,WAAL,EAAzB;AACAF,yBAAaG,WAAb,CAAyBlM,KAAKmM,WAAL,EAAzB;AACAJ,yBAAaK,SAAb,CAAuBpM,KAAKqM,SAAL,EAAvB;AACAN,yBAAaO,SAAb,CAAuBtM,KAAKuM,SAAL,EAAvB;AACAR,yBAAaS,MAAb,CAAoBxM,KAAKyM,MAAL,EAApB;AACAV,yBAAaW,UAAb,CAAwB,IAAxB;AACA;;AAEAtC,6BAAiBuC,sBAAjB,CAAwC3M,IAAxC,EAA8C+L,YAA9C;AACA/L,iBAAK8L,WAAL,GAAmB,IAAnB;AACA9L,mBAAO+L,YAAP;AACH;AACD,YAAIa,SAAS,IAAb;AAAA,YAAmBC,oBAAoB,IAAvC;AACA,YAAIxC,4BAA4BlS,mBAAhC,EAAqD;AACjD,gBAAI,CAACsN,eAAL,EAAsB;AAClB,oBAAI4E,4BAA4BjS,2BAAhC,EAA6D;AACzDwU,6BAASxC,iBAAiBM,WAAjB,EAAT;AACH,iBAFD,MAEO,IAAIL,4BAA4BhS,oBAAhC,EAAsD;AACzDuU,6BAAS,KAAK9R,MAAd;AACH;;AAED,oBAAI,CAAC8R,MAAL,EAAa;AACT,wBAAIE,WAAW,KAAf;;AAEA,wBAAIF,OAAOG,yBAAX,EACID,WAAWF,OAAOG,yBAAP,CAAiCH,MAAjC,EAAyCtC,uBAAzC,EAAkEtK,IAAlE,CAAX;;AAEJ6M,wCAAoB,KAAKzR,0BAAzB;AACA,wBAAI,CAAC0R,QAAD,IAAaD,qBAAqB,IAAlC,IAA0CA,kBAAkBE,yBAAhE,EAA2F;AACvFF,0CAAkBE,yBAAlB,CAA4CH,MAA5C,EAAoDtC,uBAApD,EAA6EtK,IAA7E;AACH;AACJ;AACJ,aAlBD,MAkBO;AACH,oBAAIqK,4BAA4BjS,2BAAhC,EAA6D;AACzDgS,qCAAiB4C,qBAAjB,CAAuC1C,uBAAvC;AACAF,qCAAiB6C,qBAAjB,CAAuCjN,IAAvC;AACH,iBAHD,MAGO;AACH,yBAAK1E,iBAAL,CAAuBuE,IAAvB,CAA4ByK,uBAA5B;AACA,yBAAK/O,iBAAL,CAAuBsE,IAAvB,CAA4BG,IAA5B;AACH;AACJ;AACJ;;AAED;AACA,YAAIuK,aAAa2C,mBAAb,GAAmC9Q,MAAnC,GAA4C,CAAhD,EAAmD;AAC/C,gBAAI+Q,iBAAiB,KAArB;AACA,gBAAI,CAAC1H,eAAL,EAAsB;AAClBmH,yBAAS5M,IAAT;AACA,oBAAI4M,UAAU,IAAV,IAAkBA,OAAOQ,yBAAP,IAAoC,IAA1D,EAAgE;AAC5D,wBAAIC,mBAAmB9C,aAAa2C,mBAAb,EAAvB;AACA,wBAAII,iBAAiBD,iBAAiB1N,OAAjB,EAArB;AACA,yBAAKC,IAAI,CAAT,EAAYA,IAAI0N,eAAelR,MAA/B,EAAuCwD,GAAvC,EAA4C;AACxC,4BAAI2N,kBAAkBF,iBAAiBvN,YAAjB,CAA8BwN,eAAe1N,CAAf,CAA9B,CAAtB;AACAuN,yCAAiBP,OAAOQ,yBAAP,CAAiCR,MAAjC,EAAyCU,eAAe1N,CAAf,CAAzC,EAA4D2N,eAA5D,CAAjB;AACAV,4CAAoB,KAAKzR,0BAAzB;AACA,4BAAI,CAAC+R,cAAD,IAAoBN,qBAAqB,IAAzC,IAAmDA,kBAAkBO,yBAAlB,IAA+C,IAAtG,EACID,iBAAiBN,kBAAkBO,yBAAlB,CAA4CR,MAA5C,EAAoDU,eAAe1N,CAAf,CAApD,EAAuE2N,eAAvE,CAAjB;AACP;AACJ;AACJ;AACJ;;AAED,aAAKtS,cAAL,GAAsB,IAAtB;;AAEA;AACA,YAAIuS,cAAc,KAAK7M,OAAL,CAAa,KAAb,CAAlB;AACA,aAAKf,IAAI,CAAT,EAAYA,IAAI4N,WAAhB,EAA6B5N,GAA7B,EAAkC;AAC9B,gBAAI6N,QAAQ,KAAK7I,cAAL,CAAoB5E,IAApB,CAAZ;AACAA,iBAAKG,QAAL,CAAcsN,KAAd;AACH;;AAED;AACA;AACA;AACA,YAAI,CAAC5B,aAAL,EAAoB;AAChB;AACA,gBAAI7L,QAAQ,IAAR,IAAgBA,KAAK0N,YAAzB,EACI1N,KAAK0N,YAAL,CAAkB1N,IAAlB,EAAwBuK,YAAxB,EADJ,KAEK,IAAI,KAAKpP,qBAAL,IAA8B,IAAlC,EACD,KAAKA,qBAAL,CAA2BuS,YAA3B,CAAwC1N,IAAxC,EAA8CuK,YAA9C;AACP;;AAED,eAAOvK,IAAP;AACH,KAlzB8B;;AAozB/B2N,eAAW,qBAAY,CACtB;AArzB8B,CAAhB,CAAnB;;AAwzBAzT,GAAGC,aAAH,CAAiByT,mBAAjB,GAAuC,CAAvC;AACA1T,GAAGC,aAAH,CAAiB0T,kBAAjB,GAAsC,UAAUC,KAAV,EAAiB;AACnD5T,OAAGC,aAAH,CAAiByT,mBAAjB,GAAuCE,KAAvC;AACH,CAFD;;AAIA5T,GAAGC,aAAH,CAAiB4T,kBAAjB,GAAsC,YAAY;AAC9C,WAAO7T,GAAGC,aAAH,CAAiByT,mBAAxB;AACH,CAFD;;AAIA1T,GAAGC,aAAH,CAAiB6T,WAAjB,GAA+B,UAAUC,WAAV,EAAuBtR,KAAvB,EAA8B4B,UAA9B,EAA0C2P,WAA1C,EAAuD;AAClFA,kBAAcA,eAAehU,GAAGC,aAAH,CAAiBgU,eAAjB,EAA7B;;AAEA,QAAIC,UAAUlU,GAAGC,aAAH,CAAiBkU,IAAjB,CAAsBJ,WAAtB,EAAmCtR,KAAnC,EAA0C4B,UAA1C,EAAsD2P,WAAtD,CAAd;;AAEA,QAAIjO,QAAQ,IAAI/F,GAAGgG,KAAP,EAAZ;AACAD,UAAME,QAAN,CAAeiO,OAAf;AACA,WAAOnO,KAAP;AACH,CARD;;AAUA/F,GAAGC,aAAH,CAAiBmU,qBAAjB,GAAyC,EAAzC;AACApU,GAAGC,aAAH,CAAiBoU,kBAAjB,GAAsC,UAAUC,cAAV,EAA0BC,UAA1B,EAAsC;AACxEvU,OAAGC,aAAH,CAAiBmU,qBAAjB,CAAuCE,cAAvC,IAAyDtU,GAAGE,KAAH,CAASC,MAAT,CAAgBoU,UAAhB,CAAzD;AACH,CAFD;AAGAvU,GAAGC,aAAH,CAAiBkU,IAAjB,GAAwB,UAAUJ,WAAV,EAAuBtR,KAAvB,EAA8B4B,UAA9B,EAA0C2P,WAA1C,EAAuD;AAC3EA,kBAAcA,eAAehU,GAAGC,aAAH,CAAiBgU,eAAjB,EAA7B;AACA,QAAIO,SAAS,IAAIxU,GAAGC,aAAP,CAAqBD,GAAGyU,iBAAH,CAAqBC,6BAArB,EAArB,CAAb;AACAF,WAAOnS,cAAP,CAAsB2R,WAAtB;AACA,QAAKD,YAAY7R,MAAZ,GAAqB,CAAtB,IAA6B6R,YAAYY,WAAZ,GAA0BC,WAA1B,CAAsC,OAAtC,MAAmDb,YAAY7R,MAAZ,GAAqB,CAAzG,EACI6R,cAAcA,cAAc,OAA5B;;AAEJ,QAAIjO,OAAO0O,OAAOrQ,qBAAP,CAA6B4P,WAA7B,EAA0CtR,KAA1C,EAAiD4B,UAAjD,CAAX;AACA,QAAIqB,CAAJ;AACA,QAAIiG,YAAJ,EAAkBkJ,YAAlB,EAAgCC,qBAAhC,EAAuDC,UAAvD,EAAmEC,UAAnE;AACA;AACA,QAAIvS,KAAJ,EAAW;AACP;AACA,YAAIwS,qBAAqBT,OAAOrL,qBAAP,EAAzB;AACA,YAAI+L,qBAAqBV,OAAOpL,qBAAP,EAAzB;AACA,YAAI+L,6BAA6BX,OAAOnL,6BAAP,EAAjC;AACA,aAAK3D,IAAI,CAAT,EAAYA,IAAIuP,mBAAmB/S,MAAnC,EAA2CwD,GAA3C,EAAgD;AAC5CiG,2BAAesJ,mBAAmBvP,CAAnB,CAAf;AACAmP,2BAAeK,mBAAmBxP,CAAnB,CAAf;AACAoP,oCAAwBK,2BAA2BzP,CAA3B,CAAxB;AACA,gBAAImP,wBAAwB7U,GAAGoV,aAA/B,EACIP,aAAaQ,mCAAb,CAAiD5S,KAAjD,EAAwDA,MAAMkJ,YAAN,CAAxD,EAA6EmJ,qBAA7E,EADJ,CACgH;AADhH,iBAGID,aAAaS,WAAb,CAAyB7S,MAAMkJ,YAAN,CAAzB,EAA8ClJ,KAA9C;AACP;;AAED;AACA,YAAI8S,mBAAmBf,OAAOlL,mBAAP,EAAvB;AACA,YAAIkM,mBAAmBhB,OAAOjL,mBAAP,EAAvB;AACA,aAAK7D,IAAI,CAAT,EAAYA,IAAI6P,iBAAiBrT,MAAjC,EAAyCwD,GAAzC,EAA8C;AAC1CqP,yBAAaQ,iBAAiB7P,CAAjB,CAAb;AACAsP,yBAAaQ,iBAAiB9P,CAAjB,CAAb;AACAjD,kBAAMsS,UAAN,IAAoBC,UAApB;AACH;AACJ;;AAED,QAAIS,6BAA6BjB,OAAOhL,6BAAP,EAAjC;AACA,QAAIkM,4BAA4BlB,OAAO/K,4BAAP,EAAhC;AACA,QAAI,CAACgM,0BAAD,IAA+B,CAACC,yBAApC,EACI,OAAO5P,IAAP;;AAEJ,QAAI6P,uBAAuB3V,GAAGC,aAAH,CAAiBmU,qBAA5C;AACA;AACA,SAAK1O,IAAI,CAAT,EAAYA,IAAI+P,2BAA2BvT,MAA3C,EAAmDwD,GAAnD,EAAwD;AACpD,YAAIkQ,YAAYH,2BAA2B/P,CAA3B,CAAhB;AACA,YAAIpB,mBAAmBoR,0BAA0BhQ,CAA1B,CAAvB;;AAEA,YAAIuL,CAAJ;AACA2E,kBAAUtR,gBAAV,GAA6BA,gBAA7B;;AAEA,YAAIgQ,iBAAiBhQ,iBAAiBuR,yBAAjB,EAArB;AACA,YAAI,CAACvB,cAAL,EAAqB;;AAErB;AACA,YAAIwB,kBAAkBH,qBAAqBrB,cAArB,CAAtB;AACA,YAAI,CAACwB,eAAL,EAAsB,MAAM,IAAIjP,KAAJ,CAAU,+BAA+ByN,cAAzC,CAAN;AACtB,YAAIC,aAAa,IAAIuB,eAAJ,EAAjB;AACAvB,mBAAWD,cAAX,GAA4BA,cAA5B;;AAEAsB,kBAAUrB,UAAV,GAAuBA,UAAvB;AACAA,mBAAWwB,QAAX,GAAsBH,SAAtB;;AAEA;AACA,YAAII,wBAAwB1R,iBAAiB2R,wBAAjB,EAA5B;AACA,YAAIC,wBAAwB5R,iBAAiB6R,wBAAjB,EAA5B;AACA,YAAIC,gCAAgC9R,iBAAiB+R,gCAAjB,EAApC;AACA,aAAKpF,IAAI,CAAT,EAAYA,IAAI+E,sBAAsB9T,MAAtC,EAA8C+O,GAA9C,EAAmD;AAC/CtF,2BAAeqK,sBAAsB/E,CAAtB,CAAf;AACA4D,2BAAeqB,sBAAsBjF,CAAtB,CAAf;AACA6D,oCAAwBsB,8BAA8BnF,CAA9B,CAAxB;AACA,gBAAI4D,wBAAwB7U,GAAGoV,aAA/B,EACIP,aAAaQ,mCAAb,CAAiDd,UAAjD,EAA6DA,WAAW5I,YAAX,CAA7D,EAAuFmJ,qBAAvF,EADJ,CAC0H;AAD1H,iBAGID,aAAaS,WAAb,CAAyBf,WAAW5I,YAAX,CAAzB,EAAmD4I,UAAnD;AACP;;AAED;AACA,YAAI+B,sBAAsBhS,iBAAiBiS,sBAAjB,EAA1B;AACA,YAAIC,sBAAsBlS,iBAAiBmS,sBAAjB,EAA1B;AACA,aAAKxF,IAAI,CAAT,EAAYA,IAAIqF,oBAAoBpU,MAApC,EAA4C+O,GAA5C,EAAiD;AAC7C8D,yBAAauB,oBAAoBrF,CAApB,CAAb;AACA+D,yBAAawB,oBAAoBvF,CAApB,CAAb;;AAEAsD,uBAAWQ,UAAX,IAAyBC,UAAzB;AACH;;AAED,YAAIT,WAAWmC,gBAAX,IAA+B1W,GAAG2W,UAAH,CAAcpC,WAAWmC,gBAAzB,CAAnC,EACInC,WAAWmC,gBAAX;;AAEJ;AACA,YAAIE,oBAAoBtS,iBAAiB4H,oBAAjB,EAAxB;AACA,aAAK+E,IAAI,CAAT,EAAYA,IAAI2F,kBAAkB1U,MAAlC,EAA0C+O,GAA1C,EAA+C;AAC3C,gBAAI4F,gBAAgBD,kBAAkB3F,CAAlB,EAAqB6F,KAArB,CAA2B,GAA3B,CAApB;AACA,gBAAIlL,eAAeiL,cAAc,CAAd,CAAnB;AACA,gBAAIE,iBAAiBF,cAAc,CAAd,CAArB;;AAEA,gBAAIjL,gBAAgB,CAApB,EAAuB;AAAE;AACrBtH,iCAAiB0S,WAAjB,CAA6BhX,GAAGiX,QAAH,CAAY1C,WAAWwC,cAAX,CAAZ,EAAwCxC,UAAxC,CAA7B,EAAkFqC,kBAAkB3F,CAAlB,CAAlF;AACH,aAFD,MAEO,IAAIrF,gBAAgB,CAAhB,IAAqBnJ,KAAzB,EAAgC;AAAC;AACpC6B,iCAAiB0S,WAAjB,CAA6BhX,GAAGiX,QAAH,CAAYxU,MAAMsU,cAAN,CAAZ,EAAmCtU,KAAnC,CAA7B,EAAwEmU,kBAAkB3F,CAAlB,CAAxE;AACH;AACJ;AACJ;;AAED;AACA3M,qBAAiBc,aAAjB,CAA+Bd,iBAAiBa,qBAAjB,EAA/B,EAAyE,CAAzE;;AAEA,WAAOW,IAAP;AACH,CA5GD;;AA8GA9F,GAAGC,aAAH,CAAiBiX,aAAjB,GAAiC,EAAjC;AACAlX,GAAGC,aAAH,CAAiBkX,eAAjB,GAAmC,UAAU7U,QAAV,EAAoB;AACnDtC,OAAGC,aAAH,CAAiBiX,aAAjB,GAAiC5U,QAAjC;AACH,CAFD;;AAIAtC,GAAGC,aAAH,CAAiBgU,eAAjB,GAAmC,YAAY;AAC3C,WAAOjU,GAAGC,aAAH,CAAiBiX,aAAxB;AACH,CAFD;;AAIAlX,GAAGC,aAAH,CAAiBmX,iBAAjB,GAAqC,UAAUC,OAAV,EAAmB;AACpD,QAAIC,WAAWD,QAAQzC,WAAR,CAAoB,GAApB,CAAf;AACA,QAAI0C,aAAa,CAAC,CAAlB,EAAqB;AACjB,eAAOD,QAAQE,SAAR,CAAkBD,WAAW,CAA7B,EAAgCD,QAAQnV,MAAR,GAAiBoV,QAAjD,CAAP;AACH;AACD,WAAOD,OAAP;AACH,CAND;;AAQArX,GAAGC,aAAH,CAAiBuX,mBAAjB,GAAuC,UAAUH,OAAV,EAAmB;AACtD,QAAII,SAASJ,QAAQzC,WAAR,CAAoB,GAApB,CAAb;AACA,QAAI6C,WAAW,CAAC,CAAhB,EAAmB;AACf,eAAOJ,QAAQE,SAAR,CAAkB,CAAlB,EAAqBE,MAArB,CAAP;AACH;AACD,WAAOJ,OAAP;AACH,CAND;;AAQArX,GAAGC,aAAH,CAAiB0U,WAAjB,GAA+B,UAAU+C,SAAV,EAAqB;AAChD,WAAOA,UAAU/C,WAAV,EAAP;AACH,CAFD;;AAIA3U,GAAGC,aAAH,CAAiB0X,QAAjB,GAA4B,UAAUD,SAAV,EAAqBE,MAArB,EAA6B;AACrD,QAAIF,UAAUxV,MAAV,IAAoB0V,OAAO1V,MAA/B,EACI,OAAQwV,UAAU9C,WAAV,CAAsBgD,MAAtB,MAAkC,CAA1C,CADJ,KAGI,OAAO,KAAP;AACP,CALD;;AAOA5X,GAAGC,aAAH,CAAiB4X,MAAjB,GAA0B,UAAUC,OAAV,EAAmBC,OAAnB,EAA4B;AAClD,WAAOD,UAAUC,OAAjB;AACH,CAFD;;AAIA/X,GAAGuE,MAAH,CAAUyT,QAAV,CAAmB,CAAC,MAAD,CAAnB,EAA6BhY,GAAGiY,aAAhC","file":"CCBReader.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccb-reader","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\nvar CCB_VERSION = 5;\n\nvar CCB_PROPTYPE_POSITION = 0;\nvar CCB_PROPTYPE_SIZE = 1;\nvar CCB_PROPTYPE_POINT = 2;\nvar CCB_PROPTYPE_POINTLOCK = 3;\nvar CCB_PROPTYPE_SCALELOCK = 4;\nvar CCB_PROPTYPE_DEGREES = 5;\nvar CCB_PROPTYPE_INTEGER = 6;\nvar CCB_PROPTYPE_FLOAT = 7;\nvar CCB_PROPTYPE_FLOATVAR = 8;\nvar CCB_PROPTYPE_CHECK = 9;\nvar CCB_PROPTYPE_SPRITEFRAME = 10;\nvar CCB_PROPTYPE_TEXTURE = 11;\nvar CCB_PROPTYPE_BYTE = 12;\nvar CCB_PROPTYPE_COLOR3 = 13;\nvar CCB_PROPTYPE_COLOR4VAR = 14;\nvar CCB_PROPTYPE_FLIP = 15;\nvar CCB_PROPTYPE_BLENDMODE = 16;\nvar CCB_PROPTYPE_FNTFILE = 17;\nvar CCB_PROPTYPE_TEXT = 18;\nvar CCB_PROPTYPE_FONTTTF = 19;\nvar CCB_PROPTYPE_INTEGERLABELED = 20;\nvar CCB_PROPTYPE_BLOCK = 21;\nvar CCB_PROPTYPE_ANIMATION = 22;\nvar CCB_PROPTYPE_CCBFILE = 23;\nvar CCB_PROPTYPE_STRING = 24;\nvar CCB_PROPTYPE_BLOCKCCCONTROL = 25;\nvar CCB_PROPTYPE_FLOATSCALE = 26;\nvar CCB_PROPTYPE_FLOATXY = 27;\n\nvar CCB_FLOAT0 = 0;\nvar CCB_FLOAT1 = 1;\nvar CCB_FLOAT_MINUS1 = 2;\nvar CCB_FLOAT05 = 3;\nvar CCB_FLOAT_INTEGER = 4;\nvar CCB_FLOAT_FULL = 5;\n\nvar CCB_PLATFORM_ALL = 0;\nvar CCB_PLATFORM_IOS = 1;\nvar CCB_PLATFORM_MAC = 2;\n\nvar CCB_TARGETTYPE_NONE = 0;\nvar CCB_TARGETTYPE_DOCUMENTROOT = 1;\nvar CCB_TARGETTYPE_OWNER = 2;\n\nvar CCB_KEYFRAME_EASING_INSTANT = 0;\nvar CCB_KEYFRAME_EASING_LINEAR = 1;\nvar CCB_KEYFRAME_EASING_CUBIC_IN = 2;\nvar CCB_KEYFRAME_EASING_CUBIC_OUT = 3;\nvar CCB_KEYFRAME_EASING_CUBIC_INOUT = 4;\nvar CCB_KEYFRAME_EASING_ELASTIC_IN = 5;\nvar CCB_KEYFRAME_EASING_ELASTIC_OUT = 6;\nvar CCB_KEYFRAME_EASING_ELASTIC_INOUT = 7;\nvar CCB_KEYFRAME_EASING_BOUNCE_IN = 8;\nvar CCB_KEYFRAME_EASING_BOUNCE_OUT = 9;\nvar CCB_KEYFRAME_EASING_BOUNCE_INOUT = 10;\nvar CCB_KEYFRAME_EASING_BACK_IN = 11;\nvar CCB_KEYFRAME_EASING_BACK_OUT = 12;\nvar CCB_KEYFRAME_EASING_BACK_INOUT = 13;\n\nvar CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT = 0;\nvar CCB_POSITIONTYPE_RELATIVE_TOP_LEFT = 1;\nvar CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT = 2;\nvar CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT = 3;\nvar CCB_POSITIONTYPE_PERCENT = 4;\nvar CCB_POSITIONTYPE_MULTIPLY_RESOLUTION = 5;\n\nvar CCB_SIZETYPE_ABSOLUTE = 0;\nvar CCB_SIZETYPE_PERCENT = 1;\nvar CCB_SIZETYPE_RELATIVE_CONTAINER = 2;\nvar CCB_SIZETYPE_HORIZONTAL_PERCENT = 3;\nvar CCB_SIZETYPE_VERTICAL_PERCENT = 4;\nvar CCB_SIZETYPE_MULTIPLY_RESOLUTION = 5;\n\nvar CCB_SCALETYPE_ABSOLUTE = 0;\nvar CCB_SCALETYPE_MULTIPLY_RESOLUTION = 1;\n\n/**\n * Parse CCBI file which is generated by CocosBuilder\n */\ncc.BuilderReader = cc.Class.extend({\n    _jsControlled: false,\n    _data: null,\n    _ccbRootPath: \"\",\n\n    _bytes: 0,\n    _currentByte: 0,\n    _currentBit: 0,\n\n    _stringCache: null,\n    _loadedSpriteSheets: null,\n\n    _owner: null,\n    _animationManager: null,\n    _animationManagers: null,\n    _animatedProps: null,\n\n    _ccNodeLoaderLibrary: null,\n    _ccNodeLoaderListener: null,\n    _ccbMemberVariableAssigner: null,\n    _ccbSelectorResolver: null,\n\n    _ownerOutletNames: null,\n    _ownerOutletNodes: null,\n    _nodesWithAnimationManagers: null,\n    _animationManagerForNodes: null,\n\n    _ownerCallbackNames: null,\n    _ownerCallbackNodes: null,\n    _ownerCallbackEvents: null,\n\n    _readNodeGraphFromData: false,\n\n    ctor: function (ccNodeLoaderLibrary, ccbMemberVariableAssigner, ccbSelectorResolver, ccNodeLoaderListener) {\n        this._stringCache = [];\n        this._loadedSpriteSheets = [];\n        this._currentBit = -1;\n        this._currentByte = -1;\n\n        if (arguments.length !== 0) {\n            if (ccNodeLoaderLibrary instanceof cc.BuilderReader) {\n                var ccbReader = ccNodeLoaderLibrary;\n\n                /* Borrow data from the 'parent' CCBReader. */\n                this._loadedSpriteSheets = ccbReader._loadedSpriteSheets;\n                this._ccNodeLoaderLibrary = ccbReader._ccNodeLoaderLibrary;\n\n                this._ccbMemberVariableAssigner = ccbReader._ccbMemberVariableAssigner;\n                this._ccbSelectorResolver = ccbReader._ccbSelectorResolver;\n                this._ccNodeLoaderListener = ccbReader._ccNodeLoaderListener;\n\n                this._ownerCallbackNames = ccbReader._ownerCallbackNames;\n                this._ownerCallbackNodes = ccbReader._ownerCallbackNodes;\n                this._ownerCallbackEvents = ccbReader._ownerCallbackEvents;\n                this._ownerOutletNames = ccbReader._ownerOutletNames;\n                this._ownerOutletNodes = ccbReader._ownerOutletNodes;\n                this._ccbRootPath = ccbReader._ccbRootPath;\n            } else {\n                this._ccNodeLoaderLibrary = ccNodeLoaderLibrary;\n                this._ccbMemberVariableAssigner = ccbMemberVariableAssigner;\n                this._ccbSelectorResolver = ccbSelectorResolver;\n                this._ccNodeLoaderListener = ccNodeLoaderListener;\n            }\n        }\n    },\n\n    getCCBRootPath: function () {\n        return this._ccbRootPath;\n    },\n\n    setCCBRootPath: function (rootPath) {\n        this._ccbRootPath = rootPath;\n    },\n\n    initWithData: function (data, owner) {\n        //setup action manager\n        this._animationManager = new cc.BuilderAnimationManager();\n\n        //setup byte array\n        //Array replace to CCData in Javascript\n        this._data = data;\n        this._bytes = data.length;\n        this._currentBit = 0;\n        this._currentByte = 0;\n\n        this._owner = owner;\n\n        //setup resolution scale and container size\n        this._animationManager.setRootContainerSize(cc.director.getWinSize());\n\n        return true;\n    },\n\n    _loadBinarySync: function (url) {\n        var self = this;\n        var req = this.getXMLHttpRequest();\n        var errInfo = \"load \" + url + \" failed!\";\n        req.open('GET', url, false);\n        var arrayInfo = null;\n        if (/msie/i.test(navigator.userAgent) && !/opera/i.test(navigator.userAgent)) {\n            req.setRequestHeader(\"Accept-Charset\", \"x-user-defined\");\n            req.send(null);\n            if (req.status !== 200) {\n                cc.log(errInfo);\n                return null;\n            }\n\n            var fileContents = cc._convertResponseBodyToText(req[\"responseBody\"]);\n            if (fileContents) {\n                arrayInfo = this._stringConvertToArray(fileContents);\n                this._fileDataCache[url] = arrayInfo;\n            }\n        } else {\n            if (req.overrideMimeType)\n                req.overrideMimeType('text\\/plain; charset=x-user-defined');\n            req.send(null);\n            if (req.status !== 200) {\n                cc.log(errInfo);\n                return null;\n            }\n\n            arrayInfo = this._stringConvertToArray(req.responseText);\n            this._fileDataCache[url] = arrayInfo;\n        }\n        return arrayInfo;\n    },\n\n    readNodeGraphFromFile: function (ccbFileName, owner, parentSize, animationManager) {\n        if (parentSize == null) {\n            parentSize = cc.director.getWinSize();\n        } else if (parentSize instanceof  cc.BuilderAnimationManager) {\n            animationManager = parentSize;\n            parentSize = cc.director.getWinSize();\n        }\n\n        var data = cc.loader.getRes(ccbFileName);\n        if (!data) {\n            var realUrl = cc.loader.getUrl(ccbFileName);\n            data = cc.loader.loadBinarySync(realUrl);\n            cc.loader.cache[ccbFileName] = data;\n        }\n\n        return this.readNodeGraphFromData(data, owner, parentSize, animationManager);\n    },\n\n    readNodeGraphFromData: function (data, owner, parentSize) {\n        this.initWithData(data, owner);\n        var locAnimationManager = this._animationManager;\n        locAnimationManager.setRootContainerSize(parentSize);\n        locAnimationManager.setOwner(owner);\n\n        this._ownerOutletNames = [];\n        this._ownerOutletNodes = [];\n        this._ownerCallbackNames = [];\n        this._ownerCallbackNodes = [];\n        this._ownerCallbackEvents = [];\n        this._animationManagers = new cc._Dictionary();\n\n        var nodeGraph = this.readFileWithCleanUp(true);\n\n        if (nodeGraph && locAnimationManager.getAutoPlaySequenceId() !== -1) {\n            //auto play animations\n            locAnimationManager.runAnimations(locAnimationManager.getAutoPlaySequenceId(), 0);\n        }\n\n        if (this._jsControlled) {\n            var locNodes = [];\n            var locAnimations = [];\n\n            var locAnimationManagers = this._animationManagers;\n            var getAllKeys = locAnimationManagers.allKeys();\n            for (var i = 0; i < getAllKeys.length; i++) {\n                locNodes.push(getAllKeys[i]);\n                locAnimations.push(locAnimationManagers.objectForKey(getAllKeys[i]));\n            }\n\n            this._nodesWithAnimationManagers = locNodes;\n            this._animationManagerForNodes = locAnimations;\n        }\n\n        return nodeGraph;\n    },\n\n    createSceneWithNodeGraphFromFile: function (ccbFileName, owner, parentSize, animationManager) {\n        var node = this.readNodeGraphFromFile(ccbFileName, owner, parentSize, animationManager);\n        var scene = new cc.Scene();\n        scene.addChild(node);\n        return scene;\n    },\n\n    getCCBMemberVariableAssigner: function () {\n        return this._ccbMemberVariableAssigner;\n    },\n\n    getCCBSelectorResolver: function () {\n        return this._ccbSelectorResolver;\n    },\n\n    getAnimationManager: function () {\n        return this._animationManager;\n    },\n\n    setAnimationManager: function (animationManager) {\n        this._animationManager = animationManager;\n    },\n\n    getAnimatedProperties: function () {\n        return this._animatedProps;\n    },\n\n    getLoadedSpriteSheet: function () {\n        return this._loadedSpriteSheets;\n    },\n\n    getOwner: function () {\n        return this._owner;\n    },\n\n    readInt: function (signed) {\n        var numBits = 0;\n        var data = this._data[this._currentByte];\n        var bit = !!(data & (1 << this._currentBit++));\n        while (!bit) {\n            numBits++;\n            bit = !!(data & (1 << this._currentBit++));\n            if (this._currentBit >= 8) {\n                this._currentBit = 0;\n                this._currentByte++;\n                data = this._data[this._currentByte];\n                if (this._currentByte > this._data.length)\n                    throw new Error(\"out of the data bound\");\n            }\n        }\n\n        var current = 0;\n        for (var a = numBits - 1; a >= 0; a--) {\n            bit = !!(data & (1 << this._currentBit++));\n            if (this._currentBit >= 8) {\n                this._currentBit = 0;\n                this._currentByte++;\n                data = this._data[this._currentByte];\n                if (this._currentByte > this._data.length)\n                    throw new Error(\"out of the data bound\");\n            }\n            if (bit) {\n                current |= 1 << a;\n            }\n        }\n        current |= 1 << numBits;\n\n        var num;\n        if (signed) {\n            var s = current % 2;\n            if (s) {\n                num = 0 | (current / 2);\n            } else {\n                num = 0 | (-current / 2);\n            }\n        } else {\n            num = current - 1;\n        }\n\n        if (this._currentBit) {\n            this._currentBit = 0;\n            this._currentByte++;\n        }\n\n        return num;\n    },\n\n    readByte: function () {\n        var byteValue = this._data[this._currentByte];\n        this._currentByte++;\n        return byteValue;\n    },\n\n    readBool: function () {\n        return !!this._data[this._currentByte++];\n    },\n\n    readFloat: function () {\n        var type = this._data[this._currentByte++];\n\n        switch (type) {\n            case CCB_FLOAT0:\n                return 0;\n            case CCB_FLOAT1:\n                return 1;\n            case CCB_FLOAT_MINUS1:\n                return -1;\n            case CCB_FLOAT05:\n                return 0.5;\n            case CCB_FLOAT_INTEGER:\n                return this.readInt(true);\n            default:\n                /* using a memcpy since the compiler isn't\n                 * doing the float ptr math correctly on device.\n                 */\n                var pF = this._decodeFloat(23, 8); //this._bytes + this._currentByte;\n                //this._currentByte += 4;\n                return pF;\n        }\n    },\n\n    _decodeFloat: function (precisionBits, exponentBits) {\n        var length = precisionBits + exponentBits + 1;\n        var size = length >> 3;\n        if (this._currentByte + size >= this._data.length) {\n            throw new Error(\"Index out of bound\");\n        }\n\n        var bias = Math.pow(2, exponentBits - 1) - 1;\n        var signal = this._readBitsOnly(precisionBits + exponentBits, 1, size);\n        var exponent = this._readBitsOnly(precisionBits, exponentBits, size);\n        var significand = 0;\n        var divisor = 2;\n        var curByte = 0; //length + (-precisionBits >> 3) - 1;\n        do {\n            var byteValue = this._data[this._currentByte + size - (++curByte) - 1];\n            var startBit = precisionBits % 8 || 8;\n            var mask = 1 << startBit;\n            while (mask >>= 1) {\n                if (byteValue & mask) {\n                    significand += 1 / divisor;\n                }\n                divisor *= 2;\n            }\n        } while (precisionBits -= startBit);\n\n        this._currentByte += size;\n\n        return exponent === (bias << 1) + 1 ? significand ? NaN : signal ? -Infinity : +Infinity\n            : (1 + signal * -2) * (exponent || significand ? !exponent ? Math.pow(2, -bias + 1) * significand\n            : Math.pow(2, exponent - bias) * (1 + significand) : 0);\n    },\n\n    _readBitsOnly: function (start, length, size) {\n        var offsetLeft = (start + length) % 8;\n        var offsetRight = start % 8;\n        var curByte = size - (start >> 3) - 1;\n        var lastByte = size + (-(start + length) >> 3);\n        var diff = curByte - lastByte;\n\n        var sum = (this._data[this._currentByte + size - curByte - 1] >> offsetRight) & ((1 << (diff ? 8 - offsetRight : length)) - 1);\n\n        if (diff && offsetLeft) {\n            sum += (this._data[this._currentByte + size - lastByte - 1] & ((1 << offsetLeft) - 1)) << (diff-- << 3) - offsetRight;\n            lastByte++;\n        }\n\n        while (diff) {\n            sum += this._shl(this._data[this._currentByte + size - lastByte - 1], (diff-- << 3) - offsetRight);\n            lastByte++;\n        }\n\n        return sum;\n    },\n\n    _shl: function (a, b) {\n        for (++b; --b; a = ((a %= 0x7fffffff + 1) & 0x40000000) === 0x40000000 ? a * 2 : (a - 0x40000000) * 2 + 0x7fffffff + 1);\n        return a;\n    },\n\n    readCachedString: function () {\n        return this._stringCache[this.readInt(false)];\n    },\n\n    isJSControlled: function () {\n        return this._jsControlled;\n    },\n\n    getOwnerCallbackNames: function () {\n        return this._ownerCallbackNames;\n    },\n\n    getOwnerCallbackNodes: function () {\n        return this._ownerCallbackNodes;\n    },\n\n    getOwnerCallbackControlEvents: function () {\n        return this._ownerCallbackEvents;\n    },\n\n    getOwnerOutletNames: function () {\n        return this._ownerOutletNames;\n    },\n\n    getOwnerOutletNodes: function () {\n        return this._ownerOutletNodes;\n    },\n\n    getNodesWithAnimationManagers: function () {\n        return this._nodesWithAnimationManagers;\n    },\n\n    getAnimationManagersForNodes: function () {\n        return this._animationManagerForNodes;\n    },\n\n    getAnimationManagers: function () {\n        return this._animationManagers;\n    },\n\n    setAnimationManagers: function (animationManagers) {\n        this._animationManagers = animationManagers;\n    },\n\n    addOwnerCallbackName: function (name) {\n        this._ownerCallbackNames.push(name);\n    },\n\n    addOwnerCallbackNode: function (node) {\n        this._ownerCallbackNodes.push(node);\n    },\n\n    addOwnerCallbackControlEvents: function (event) {\n        this._ownerCallbackEvents.push(event);\n    },\n\n    addDocumentCallbackName: function (name) {\n        this._animationManager.addDocumentCallbackName(name);\n    },\n\n    addDocumentCallbackNode: function (node) {\n        this._animationManager.addDocumentCallbackNode(node);\n    },\n\n    addDocumentCallbackControlEvents: function (controlEvents) {\n        this._animationManager.addDocumentCallbackControlEvents(controlEvents);\n    },\n\n    readFileWithCleanUp: function (cleanUp) {\n        if (!this._readHeader())\n            return null;\n        if (!this._readStringCache())\n            return null;\n        if (!this._readSequences())\n            return null;\n\n        var node = this._readNodeGraph();\n        this._animationManagers.setObject(this._animationManager, node);\n\n        if (cleanUp)\n            this._cleanUpNodeGraph(node);\n        return node;\n    },\n\n    addOwnerOutletName: function (name) {\n        this._ownerOutletNames.push(name);\n    },\n\n    addOwnerOutletNode: function (node) {\n        if (node == null)\n            return;\n\n        this._ownerOutletNodes.push(node);\n    },\n\n    _cleanUpNodeGraph: function (node) {\n        node.userObject = null;\n        var getChildren = node.getChildren();\n        for (var i = 0, len = getChildren.length; i < len; i++) {\n            this._cleanUpNodeGraph(getChildren[i]);\n        }\n    },\n\n    _readCallbackKeyframesForSeq: function (seq) {\n        var numKeyframes = this.readInt(false);\n\n        if (!numKeyframes)\n            return true;\n\n        var channel = new cc.BuilderSequenceProperty();\n        var locJsControlled = this._jsControlled, locAnimationManager = this._animationManager, locKeyframes = channel.getKeyframes();\n        for (var i = 0; i < numKeyframes; i++) {\n            var time = this.readFloat();\n            var callbackName = this.readCachedString();\n            var callbackType = this.readInt(false);\n\n            var value = [callbackName, callbackType];\n\n            var keyframe = new cc.BuilderKeyframe();\n            keyframe.setTime(time);\n            keyframe.setValue(value);\n\n            if (locJsControlled)\n                locAnimationManager.getKeyframeCallbacks().push(callbackType + \":\" + callbackName);\n\n            locKeyframes.push(keyframe);\n        }\n\n        // Assign to sequence\n        seq.setCallbackChannel(channel);\n\n        return true;\n    },\n\n    _readSoundKeyframesForSeq: function (seq) {\n        var numKeyframes = this.readInt(false);\n\n        if (!numKeyframes)\n            return true;\n\n        var channel = new cc.BuilderSequenceProperty();\n        var locKeyframes = channel.getKeyframes();\n        for (var i = 0; i < numKeyframes; i++) {\n            var time = this.readFloat();\n            var soundFile = this.readCachedString();\n            var pitch = this.readFloat();\n            var pan = this.readFloat();\n            var gain = this.readFloat();\n\n            var value = [soundFile, pitch, pan, gain];\n            var keyframe = new cc.BuilderKeyframe();\n            keyframe.setTime(time);\n            keyframe.setValue(value);\n\n            locKeyframes.push(keyframe);\n        }\n\n        // Assign to sequence\n        seq.setSoundChannel(channel);\n        return true;\n    },\n    _readSequences: function () {\n        var sequences = this._animationManager.getSequences();\n        var numSeqs = this.readInt(false);\n        for (var i = 0; i < numSeqs; i++) {\n            var seq = new cc.BuilderSequence();\n            seq.setDuration(this.readFloat());\n            seq.setName(this.readCachedString());\n            seq.setSequenceId(this.readInt(false));\n            seq.setChainedSequenceId(this.readInt(true));\n\n            if (!this._readCallbackKeyframesForSeq(seq))\n                return false;\n            if (!this._readSoundKeyframesForSeq(seq))\n                return false;\n\n            sequences.push(seq);\n        }\n        this._animationManager.setAutoPlaySequenceId(this.readInt(true));\n        return true;\n    },\n\n    readKeyframe: function (type) {\n        var keyframe = new cc.BuilderKeyframe();\n        keyframe.setTime(this.readFloat());\n        var easingType = this.readInt(false);\n        var easingOpt = 0;\n        var value = null;\n\n        if (easingType === CCB_KEYFRAME_EASING_CUBIC_IN\n            || easingType === CCB_KEYFRAME_EASING_CUBIC_OUT\n            || easingType === CCB_KEYFRAME_EASING_CUBIC_INOUT\n            || easingType === CCB_KEYFRAME_EASING_ELASTIC_IN\n            || easingType === CCB_KEYFRAME_EASING_ELASTIC_OUT\n            || easingType === CCB_KEYFRAME_EASING_ELASTIC_INOUT) {\n            easingOpt = this.readFloat();\n        }\n\n        keyframe.setEasingType(easingType);\n        keyframe.setEasingOpt(easingOpt);\n\n        if (type === CCB_PROPTYPE_CHECK) {\n            value = !!this._data[this._currentByte++];\n        } else if (type === CCB_PROPTYPE_BYTE) {\n            value = this._data[this._currentByte++];\n        } else if (type === CCB_PROPTYPE_COLOR3) {\n            value = cc.color(this._data[this._currentByte++], this._data[this._currentByte++], this._data[this._currentByte++]);\n        } else if (type === CCB_PROPTYPE_FLOATXY) {\n            value = [this.readFloat(), this.readFloat()];\n        } else if (type === CCB_PROPTYPE_DEGREES) {\n            value = this.readFloat();\n        } else if (type === CCB_PROPTYPE_SCALELOCK || type === CCB_PROPTYPE_POSITION || type === CCB_PROPTYPE_FLOATXY) {\n            value = [this.readFloat(), this.readFloat()];\n        } else if (type === CCB_PROPTYPE_SPRITEFRAME) {\n            var spriteSheet = this.readCachedString();\n            var spriteFile = this.readCachedString();\n\n            if (spriteSheet === \"\") {\n                spriteFile = this._ccbRootPath + spriteFile;\n                var texture = cc.textureCache.addImage(spriteFile);\n                var locContentSize = texture.getContentSize();\n                var bounds = cc.rect(0, 0, locContentSize.width, locContentSize.height);\n                value = new cc.SpriteFrame(texture, bounds);\n            } else {\n                spriteSheet = this._ccbRootPath + spriteSheet;\n                var frameCache = cc.spriteFrameCache;\n                // Load the sprite sheet only if it is not loaded\n                if (this._loadedSpriteSheets.indexOf(spriteSheet) === -1) {\n                    frameCache.addSpriteFrames(spriteSheet);\n                    this._loadedSpriteSheets.push(spriteSheet);\n                }\n                value = frameCache.getSpriteFrame(spriteFile);\n            }\n        }\n        keyframe.setValue(value);\n        return keyframe;\n    },\n\n    _readHeader: function () {\n        /* If no bytes loaded, don't crash about it. */\n        if (!this._data)\n            return false;\n\n        /* Read magic bytes */\n        var magicBytes = this._readStringFromBytes(this._currentByte, 4, true);\n        this._currentByte += 4;\n\n        if (magicBytes !== 'ccbi') {\n            return false;\n        }\n\n        /* Read version. */\n        var version = this.readInt(false);\n        if (version !== CCB_VERSION) {\n            cc.log(\"WARNING! Incompatible ccbi file version (file: \" + version + \" reader: \" + CCB_VERSION + \")\");\n            return false;\n        }\n\n        this._jsControlled = !!this._data[this._currentByte++];\n        this._animationManager._jsControlled = this._jsControlled;\n        // no need to set if it is \"jscontrolled\". It is obvious.\n        return true;\n    },\n\n    _readStringFromBytes: function (startIndex, strLen, reverse) {\n        reverse = reverse || false;\n        var strValue = \"\";\n        var i, locData = this._data;\n        if (reverse) {\n            for (i = strLen - 1; i >= 0; i--)\n                strValue += String.fromCharCode(locData[startIndex + i]);\n        } else {\n            for (i = 0; i < strLen; i++)\n                strValue += String.fromCharCode(locData[startIndex + i]);\n        }\n        return strValue;\n    },\n\n    _readStringCache: function () {\n        var numStrings = this.readInt(false);\n        for (var i = 0; i < numStrings; i++)\n            this._readStringCacheEntry();\n        return true;\n    },\n\n    _readStringCacheEntry: function () {\n        var b0 = this._data[this._currentByte++];\n        var b1 = this._data[this._currentByte++];\n\n        var numBytes = b0 << 8 | b1;\n\n        var str = \"\", locData = this._data, locCurrentByte = this._currentByte;\n        for (var i = 0; i < numBytes; i++) {\n            var hexChar = locData[locCurrentByte + i].toString(\"16\").toUpperCase();\n            hexChar = hexChar.length > 1 ? hexChar : \"0\" + hexChar;\n            str += \"%\" + hexChar;\n        }\n        str = decodeURIComponent(str);\n\n        this._currentByte += numBytes;\n        this._stringCache.push(str);\n    },\n\n    _readNodeGraph: function (parent) {\n        /* Read class name. */\n        var className = this.readCachedString();\n\n        var jsControlledName, locJsControlled = this._jsControlled, locActionManager = this._animationManager;\n        if (locJsControlled)\n            jsControlledName = this.readCachedString();\n\n        var memberVarAssignmentType = this.readInt(false);\n        var memberVarAssignmentName;\n        if (memberVarAssignmentType !== CCB_TARGETTYPE_NONE) {\n            memberVarAssignmentName = this.readCachedString();\n        }\n\n        var ccNodeLoader = this._ccNodeLoaderLibrary.getCCNodeLoader(className);\n        if (!ccNodeLoader) {\n            ccNodeLoader = this._ccNodeLoaderLibrary.getCCNodeLoader(\"CCNode\");\n            //cc.log(\"no corresponding node loader for\" + className);\n            //return null;\n        }\n        var node = ccNodeLoader.loadCCNode(parent, this);\n\n        //set root node\n        if (!locActionManager.getRootNode())\n            locActionManager.setRootNode(node);\n\n        if (locJsControlled && node === locActionManager.getRootNode()) {\n            locActionManager.setDocumentControllerName(jsControlledName);\n        }\n\n        //read animated properties\n        var seqs = new cc._Dictionary();\n        this._animatedProps = [];\n\n        var i, locAnimatedProps = this._animatedProps;\n        var numSequence = this.readInt(false);\n        for (i = 0; i < numSequence; ++i) {\n            var seqId = this.readInt(false);\n            var seqNodeProps = new cc._Dictionary();\n\n            var numProps = this.readInt(false);\n\n            for (var j = 0; j < numProps; ++j) {\n                var seqProp = new cc.BuilderSequenceProperty();\n                seqProp.setName(this.readCachedString());\n                seqProp.setType(this.readInt(false));\n\n                locAnimatedProps.push(seqProp.getName());\n                var numKeyframes = this.readInt(false);\n                var locKeyframes = seqProp.getKeyframes();\n                for (var k = 0; k < numKeyframes; ++k) {\n                    var keyFrame = this.readKeyframe(seqProp.getType());\n                    locKeyframes.push(keyFrame);\n                }\n                seqNodeProps.setObject(seqProp, seqProp.getName());\n            }\n            seqs.setObject(seqNodeProps, seqId);\n        }\n\n        if (seqs.count() > 0)\n            locActionManager.addNode(node, seqs);\n\n        //read properties\n        ccNodeLoader.parseProperties(node, parent, this);\n\n        //handle sub ccb files(remove middle node)\n        var isCCBFileNode = !!node.ccbFileNode;\n        if (isCCBFileNode) {\n            var embeddedNode = node.ccbFileNode;\n            embeddedNode.setPosition(node.getPosition());\n            embeddedNode.setRotation(node.getRotation());\n            embeddedNode.setScaleX(node.getScaleX());\n            embeddedNode.setScaleY(node.getScaleY());\n            embeddedNode.setTag(node.getTag());\n            embeddedNode.setVisible(true);\n            //embeddedNode.ignoreAnchorPointForPosition(node.isIgnoreAnchorPointForPosition());\n\n            locActionManager.moveAnimationsFromNode(node, embeddedNode);\n            node.ccbFileNode = null;\n            node = embeddedNode;\n        }\n        var target = null, locMemberAssigner = null;\n        if (memberVarAssignmentType !== CCB_TARGETTYPE_NONE) {\n            if (!locJsControlled) {\n                if (memberVarAssignmentType === CCB_TARGETTYPE_DOCUMENTROOT) {\n                    target = locActionManager.getRootNode();\n                } else if (memberVarAssignmentType === CCB_TARGETTYPE_OWNER) {\n                    target = this._owner;\n                }\n\n                if (!target) {\n                    var assigned = false;\n\n                    if (target.onAssignCCBMemberVariable)\n                        assigned = target.onAssignCCBMemberVariable(target, memberVarAssignmentName, node);\n\n                    locMemberAssigner = this._ccbMemberVariableAssigner;\n                    if (!assigned && locMemberAssigner != null && locMemberAssigner.onAssignCCBMemberVariable) {\n                        locMemberAssigner.onAssignCCBMemberVariable(target, memberVarAssignmentName, node);\n                    }\n                }\n            } else {\n                if (memberVarAssignmentType === CCB_TARGETTYPE_DOCUMENTROOT) {\n                    locActionManager.addDocumentOutletName(memberVarAssignmentName);\n                    locActionManager.addDocumentOutletNode(node);\n                } else {\n                    this._ownerOutletNames.push(memberVarAssignmentName);\n                    this._ownerOutletNodes.push(node);\n                }\n            }\n        }\n\n        // Assign custom properties.\n        if (ccNodeLoader.getCustomProperties().length > 0) {\n            var customAssigned = false;\n            if (!locJsControlled) {\n                target = node;\n                if (target != null && target.onAssignCCBCustomProperty != null) {\n                    var customProperties = ccNodeLoader.getCustomProperties();\n                    var customPropKeys = customProperties.allKeys();\n                    for (i = 0; i < customPropKeys.length; i++) {\n                        var customPropValue = customProperties.objectForKey(customPropKeys[i]);\n                        customAssigned = target.onAssignCCBCustomProperty(target, customPropKeys[i], customPropValue);\n                        locMemberAssigner = this._ccbMemberVariableAssigner;\n                        if (!customAssigned && (locMemberAssigner != null) && (locMemberAssigner.onAssignCCBCustomProperty != null))\n                            customAssigned = locMemberAssigner.onAssignCCBCustomProperty(target, customPropKeys[i], customPropValue);\n                    }\n                }\n            }\n        }\n\n        this._animatedProps = null;\n\n        /* Read and add children. */\n        var numChildren = this.readInt(false);\n        for (i = 0; i < numChildren; i++) {\n            var child = this._readNodeGraph(node);\n            node.addChild(child);\n        }\n\n        // FIX ISSUE #1860: \"onNodeLoaded will be called twice if ccb was added as a CCBFile\".\n        // If it's a sub-ccb node, skip notification to CCNodeLoaderListener since it will be\n        // notified at LINE #734: CCNode * child = this->readNodeGraph(node);\n        if (!isCCBFileNode) {\n            // Call onNodeLoaded\n            if (node != null && node.onNodeLoaded)\n                node.onNodeLoaded(node, ccNodeLoader);\n            else if (this._ccNodeLoaderListener != null)\n                this._ccNodeLoaderListener.onNodeLoaded(node, ccNodeLoader);\n        }\n\n        return node;\n    },\n\n    _readUTF8: function () {\n    }\n});\n\ncc.BuilderReader._ccbResolutionScale = 1;\ncc.BuilderReader.setResolutionScale = function (scale) {\n    cc.BuilderReader._ccbResolutionScale = scale;\n};\n\ncc.BuilderReader.getResolutionScale = function () {\n    return cc.BuilderReader._ccbResolutionScale;\n};\n\ncc.BuilderReader.loadAsScene = function (ccbFilePath, owner, parentSize, ccbRootPath) {\n    ccbRootPath = ccbRootPath || cc.BuilderReader.getResourcePath();\n\n    var getNode = cc.BuilderReader.load(ccbFilePath, owner, parentSize, ccbRootPath);\n\n    var scene = new cc.Scene();\n    scene.addChild(getNode);\n    return scene;\n};\n\ncc.BuilderReader._controllerClassCache = {};\ncc.BuilderReader.registerController = function (controllerName, controller) {\n    cc.BuilderReader._controllerClassCache[controllerName] = cc.Class.extend(controller);\n};\ncc.BuilderReader.load = function (ccbFilePath, owner, parentSize, ccbRootPath) {\n    ccbRootPath = ccbRootPath || cc.BuilderReader.getResourcePath();\n    var reader = new cc.BuilderReader(cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary());\n    reader.setCCBRootPath(ccbRootPath);\n    if ((ccbFilePath.length < 5) || (ccbFilePath.toLowerCase().lastIndexOf(\".ccbi\") !== ccbFilePath.length - 5))\n        ccbFilePath = ccbFilePath + \".ccbi\";\n\n    var node = reader.readNodeGraphFromFile(ccbFilePath, owner, parentSize);\n    var i;\n    var callbackName, callbackNode, callbackControlEvents, outletName, outletNode;\n    // Assign owner callbacks & member variables\n    if (owner) {\n        // Callbacks\n        var ownerCallbackNames = reader.getOwnerCallbackNames();\n        var ownerCallbackNodes = reader.getOwnerCallbackNodes();\n        var ownerCallbackControlEvents = reader.getOwnerCallbackControlEvents();\n        for (i = 0; i < ownerCallbackNames.length; i++) {\n            callbackName = ownerCallbackNames[i];\n            callbackNode = ownerCallbackNodes[i];\n            callbackControlEvents = ownerCallbackControlEvents[i];\n            if (callbackNode instanceof cc.ControlButton)\n                callbackNode.addTargetWithActionForControlEvents(owner, owner[callbackName], callbackControlEvents);        //register all type of events\n            else\n                callbackNode.setCallback(owner[callbackName], owner);\n        }\n\n        // Variables\n        var ownerOutletNames = reader.getOwnerOutletNames();\n        var ownerOutletNodes = reader.getOwnerOutletNodes();\n        for (i = 0; i < ownerOutletNames.length; i++) {\n            outletName = ownerOutletNames[i];\n            outletNode = ownerOutletNodes[i];\n            owner[outletName] = outletNode;\n        }\n    }\n\n    var nodesWithAnimationManagers = reader.getNodesWithAnimationManagers();\n    var animationManagersForNodes = reader.getAnimationManagersForNodes();\n    if (!nodesWithAnimationManagers || !animationManagersForNodes)\n        return node;\n\n    var controllerClassCache = cc.BuilderReader._controllerClassCache;\n    // Attach animation managers to nodes and assign root node callbacks and member variables\n    for (i = 0; i < nodesWithAnimationManagers.length; i++) {\n        var innerNode = nodesWithAnimationManagers[i];\n        var animationManager = animationManagersForNodes[i];\n\n        var j;\n        innerNode.animationManager = animationManager;\n\n        var controllerName = animationManager.getDocumentControllerName();\n        if (!controllerName) continue;\n\n        // Create a controller\n        var controllerClass = controllerClassCache[controllerName];\n        if (!controllerClass) throw new Error(\"Can not find controller : \" + controllerName);\n        var controller = new controllerClass();\n        controller.controllerName = controllerName;\n\n        innerNode.controller = controller;\n        controller.rootNode = innerNode;\n\n        // Callbacks\n        var documentCallbackNames = animationManager.getDocumentCallbackNames();\n        var documentCallbackNodes = animationManager.getDocumentCallbackNodes();\n        var documentCallbackControlEvents = animationManager.getDocumentCallbackControlEvents();\n        for (j = 0; j < documentCallbackNames.length; j++) {\n            callbackName = documentCallbackNames[j];\n            callbackNode = documentCallbackNodes[j];\n            callbackControlEvents = documentCallbackControlEvents[j];\n            if (callbackNode instanceof cc.ControlButton)\n                callbackNode.addTargetWithActionForControlEvents(controller, controller[callbackName], callbackControlEvents);        //register all type of events\n            else\n                callbackNode.setCallback(controller[callbackName], controller);\n        }\n\n        // Variables\n        var documentOutletNames = animationManager.getDocumentOutletNames();\n        var documentOutletNodes = animationManager.getDocumentOutletNodes();\n        for (j = 0; j < documentOutletNames.length; j++) {\n            outletName = documentOutletNames[j];\n            outletNode = documentOutletNodes[j];\n\n            controller[outletName] = outletNode;\n        }\n\n        if (controller.onDidLoadFromCCB && cc.isFunction(controller.onDidLoadFromCCB))\n            controller.onDidLoadFromCCB();\n\n        // Setup timeline callbacks\n        var keyframeCallbacks = animationManager.getKeyframeCallbacks();\n        for (j = 0; j < keyframeCallbacks.length; j++) {\n            var callbackSplit = keyframeCallbacks[j].split(\":\");\n            var callbackType = callbackSplit[0];\n            var kfCallbackName = callbackSplit[1];\n\n            if (callbackType == 1) { // Document callback\n                animationManager.setCallFunc(cc.callFunc(controller[kfCallbackName], controller), keyframeCallbacks[j]);\n            } else if (callbackType == 2 && owner) {// Owner callback\n                animationManager.setCallFunc(cc.callFunc(owner[kfCallbackName], owner), keyframeCallbacks[j]);\n            }\n        }\n    }\n\n    //auto play animations\n    animationManager.runAnimations(animationManager.getAutoPlaySequenceId(), 0);\n\n    return node;\n};\n\ncc.BuilderReader._resourcePath = \"\";\ncc.BuilderReader.setResourcePath = function (rootPath) {\n    cc.BuilderReader._resourcePath = rootPath;\n};\n\ncc.BuilderReader.getResourcePath = function () {\n    return cc.BuilderReader._resourcePath;\n};\n\ncc.BuilderReader.lastPathComponent = function (pathStr) {\n    var slashPos = pathStr.lastIndexOf(\"/\");\n    if (slashPos !== -1) {\n        return pathStr.substring(slashPos + 1, pathStr.length - slashPos);\n    }\n    return pathStr;\n};\n\ncc.BuilderReader.deletePathExtension = function (pathStr) {\n    var dotPos = pathStr.lastIndexOf(\".\");\n    if (dotPos !== -1) {\n        return pathStr.substring(0, dotPos);\n    }\n    return pathStr;\n};\n\ncc.BuilderReader.toLowerCase = function (sourceStr) {\n    return sourceStr.toLowerCase();\n};\n\ncc.BuilderReader.endsWith = function (sourceStr, ending) {\n    if (sourceStr.length >= ending.length)\n        return (sourceStr.lastIndexOf(ending) === 0);\n    else\n        return false;\n};\n\ncc.BuilderReader.concat = function (stringA, stringB) {\n    return stringA + stringB;\n};\n\ncc.loader.register([\"ccbi\"], cc._binaryLoader);\n"]}