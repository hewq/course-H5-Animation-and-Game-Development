{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/utils/assets/frameworks/cocos2d-html5/cocos2d/core/utils/CCProfiler.js"],"names":["cc","profiler","_showFPS","_inited","_frames","_frameRate","_lastSPF","_accumDt","_afterVisitListener","_FPSLabel","document","createElement","_SPFLabel","_drawsLabel","_fps","LEVEL_DET_FACTOR","_levelDetCycle","LEVELS","_fpsCount","_currLevel","_analyseCount","_totalFPS","id","style","position","padding","textAlign","backgroundColor","bottom","DIRECTOR_STATS_POSITION","y","left","x","width","height","labels","i","color","font","lineHeight","appendChild","analyseFPS","fps","lastId","length","ratio","average","onFrameRateChange","toFixed","_changeCount","afterVisit","director","getSecondsPerFrame","getDeltaTime","DIRECTOR_FPS_INTERVAL","mode","_renderType","game","RENDER_TYPE_CANVAS","innerHTML","toString","g_NumberOfDraws","getFrameRate","setProfileDuration","duration","isNaN","resumeProfiling","eventManager","addListener","stopProfiling","removeListener","isShowingStats","showStats","init","parentElement","container","hideStats","removeChild","addCustomListener","Director","EVENT_AFTER_VISIT"],"mappings":"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","file":"CCProfiler.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/utils","sourcesContent":["cc.profiler = (function () {\n    var _showFPS = false;\n    var _inited = false;\n    var _frames = 0, _frameRate = 0, _lastSPF = 0, _accumDt = 0;\n    var _afterVisitListener = null,\n        _FPSLabel = document.createElement('div'),\n        _SPFLabel = document.createElement('div'),\n        _drawsLabel = document.createElement('div'),\n        _fps = document.createElement('div');\n\n    var LEVEL_DET_FACTOR = 0.6, _levelDetCycle = 10;\n    var LEVELS = [0, 10, 20, 30];\n    var _fpsCount = [0, 0, 0, 0];\n    var _currLevel = 3, _analyseCount = 0, _totalFPS = 0;\n\n    _fps.id = 'fps';\n    _fps.style.position = 'absolute';\n    _fps.style.padding = '3px';\n    _fps.style.textAlign = 'left';\n    _fps.style.backgroundColor = 'rgb(0, 0, 34)';\n    _fps.style.bottom = cc.DIRECTOR_STATS_POSITION.y + '0px';\n    _fps.style.left = cc.DIRECTOR_STATS_POSITION.x + 'px';\n    _fps.style.width = '45px';\n    _fps.style.height = '80px';\n\n    var labels = [_drawsLabel, _SPFLabel, _FPSLabel];\n    for (var i = 0; i < 3; ++i) {\n        var style = labels[i].style;\n        style.color = 'rgb(0, 255, 255)';\n        style.font = 'bold 12px Helvetica, Arial';\n        style.lineHeight = '20px';\n        style.width = '100%';\n        _fps.appendChild(labels[i]);\n    }\n\n    var analyseFPS = function (fps) {\n        var lastId = LEVELS.length - 1, i = lastId, ratio, average = 0;\n        _analyseCount++;\n        _totalFPS += fps;\n\n        for (; i >= 0; i--) {\n            if (fps >= LEVELS[i]) {\n                _fpsCount[i]++;\n                break;\n            }\n        }\n\n        if (_analyseCount >= _levelDetCycle) {\n            average = _totalFPS / _levelDetCycle;\n            for (i = lastId; i > 0; i--) {\n                ratio = _fpsCount[i] / _levelDetCycle;\n                // Determined level\n                if (ratio >= LEVEL_DET_FACTOR && average >= LEVELS[i]) {\n                    // Level changed\n                    if (i != _currLevel) {\n                        _currLevel = i;\n                        profiler.onFrameRateChange && profiler.onFrameRateChange(average.toFixed(2));\n                    }\n                    break;\n                }\n                // If no level determined, that means the framerate is not stable\n            }\n\n            _changeCount = 0;\n            _analyseCount = 0;\n            _totalFPS = 0;\n            for (i = lastId; i > 0; i--) {\n                _fpsCount[i] = 0;\n            }\n        }\n    };\n\n    var afterVisit = function () {\n        _lastSPF = cc.director.getSecondsPerFrame();\n        _frames++;\n        _accumDt += cc.director.getDeltaTime();\n        \n        if (_accumDt > cc.DIRECTOR_FPS_INTERVAL) {\n            _frameRate = _frames / _accumDt;\n            _frames = 0;\n            _accumDt = 0;\n\n            if (profiler.onFrameRateChange) {\n                analyseFPS(_frameRate);\n            }\n\n            if (_showFPS) {\n                var mode = cc._renderType === cc.game.RENDER_TYPE_CANVAS ? \"\\n canvas\" : \"\\n webgl\";\n                _SPFLabel.innerHTML = _lastSPF.toFixed(3);\n                _FPSLabel.innerHTML = _frameRate.toFixed(1).toString() + mode;\n                _drawsLabel.innerHTML = (0 | cc.g_NumberOfDraws).toString();\n            }\n        }\n    };\n\n    var profiler = {\n        onFrameRateChange: null,\n\n        getSecondsPerFrame: function () {\n            return _lastSPF;\n        },\n        getFrameRate: function () {\n            return _frameRate;\n        },\n\n        setProfileDuration: function (duration) {\n            if (!isNaN(duration) && duration > 0) {\n                _levelDetCycle = duration / cc.DIRECTOR_FPS_INTERVAL;\n            }\n        },\n\n        resumeProfiling: function () {\n            cc.eventManager.addListener(_afterVisitListener, 1);\n        },\n\n        stopProfiling: function () {\n            cc.eventManager.removeListener(_afterVisitListener);\n        },\n\n        isShowingStats: function () {\n            return _showFPS;\n        },\n\n        showStats: function () {\n            if (!_inited) {\n                this.init();\n            }\n\n            if (_fps.parentElement === null) {\n                cc.container.appendChild(_fps);\n            }\n            _showFPS = true;\n        },\n\n        hideStats: function () {\n            _showFPS = false;\n            if (_fps.parentElement === cc.container) {\n                cc.container.removeChild(_fps);\n            }\n        },\n\n        init: function () {\n            if (!_inited) {\n                _afterVisitListener = cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT, afterVisit);\n                _inited = true;\n            }\n        }\n    };\n\n    return profiler;\n})();\n"]}