{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/physics/assets/frameworks/cocos2d-html5/cocos2d/physics/CCPhysicsSprite.js"],"names":["box2dAPI","_ignoreBodyRotation","_body","_PTMRatio","_rotation","ctor","fileName","rect","cc","Sprite","prototype","call","undefined","PhysicsSprite","init","isString","frameName","substr","length","spriteFrame","spriteFrameCache","getSpriteFrame","initWithSpriteFrame","isObject","Texture2D","initWithTexture","SpriteFrame","setBody","body","getBody","setPTMRatio","r","getPTMRatio","getPosition","pos","GetPosition","locPTMRatio","p","x","y","setPosition","angle","GetAngle","setTransform","Box2D","b2Vec2","setNodeDirty","getRotation","radiansToDegrees","_rotationRadians","setRotation","locBody","SetTransform","degreesToRadians","_syncPosition","locPosition","_position","_syncRotation","a","_rotationX","setIgnoreBodyRotation","b","chipmunkAPI","renderer","pushRenderCommand","_renderCmd","visit","getPositionX","getPositionY","newPosOrxValue","yValue","setPositionX","xValue","setPositionY","getNodeToParentTransform","isDirty","isSleeping","setDirty","_createRenderCmd","_renderType","game","RENDER_TYPE_CANVAS","CanvasRenderCmd","WebGLRenderCmd","extend","_className","_p","defineGetterSetter","dirty","create","createWithSpriteFrameName","createWithSpriteFrame"],"mappings":"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","file":"CCPhysicsSprite.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/physics","sourcesContent":["/**\n * Copyright (c) 2012 Scott Lembcke and Howling Moon Software\n * Copyright (c) 2008-2010 Ricardo Quesada\n * Copyright (c) 2011-2012 cocos2d-x.org\n * Copyright (c) 2013-2014 Chukong Technologies Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/** A CCSprite subclass that is bound to a physics body.\n It works with:\n - Chipmunk: Preprocessor macro CC_ENABLE_CHIPMUNK_INTEGRATION should be defined\n - Objective-Chipmunk: Preprocessor macro CC_ENABLE_CHIPMUNK_INTEGRATION should be defined\n - Box2d: Preprocessor macro CC_ENABLE_BOX2D_INTEGRATION should be defined\n\n Features and Limitations:\n - Scale and Skew properties are ignored.\n - Position and rotation are going to updated from the physics body\n - If you update the rotation or position manually, the physics body will be updated\n - You can't eble both Chipmunk support and Box2d support at the same time. Only one can be enabled at compile time\n */\n(function () {\n    var box2dAPI = {\n        _ignoreBodyRotation: false,\n        _body: null,\n        _PTMRatio: 32,\n        _rotation: 1,\n        /**\n         * Create a PhysicsSprite with filename and rect\n         * Constructor of cc.PhysicsSprite for Box2d\n         * @param {String|cc.Texture2D|cc.SpriteFrame} fileName\n         * @param {cc.Rect} rect\n         * @example\n         *\n         * 1.Create a sprite with image path and rect\n         * var physicsSprite1 = new cc.PhysicsSprite(\"res/HelloHTML5World.png\");\n         * var physicsSprite2 = new cc.PhysicsSprite(\"res/HelloHTML5World.png\",cc.rect(0,0,480,320));\n         *\n         * 2.Create a sprite with a sprite frame name. Must add \"#\" before fame name.\n         * var physicsSprite = new cc.PhysicsSprite('#grossini_dance_01.png');\n         *\n         * 3.Create a sprite with a sprite frame\n         * var spriteFrame = cc.spriteFrameCache.getSpriteFrame(\"grossini_dance_01.png\");\n         * var physicsSprite = new cc.PhysicsSprite(spriteFrame);\n         *\n         * 4.Creates a sprite with an existing texture contained in a CCTexture2D object\n         *      After creation, the rect will be the size of the texture, and the offset will be (0,0).\n         * var texture = cc.textureCache.addImage(\"HelloHTML5World.png\");\n         * var physicsSprite1 = new cc.PhysicsSprite(texture);\n         * var physicsSprite2 = new cc.PhysicsSprite(texture, cc.rect(0,0,480,320));\n         *\n         */\n        ctor: function (fileName, rect) {\n            cc.Sprite.prototype.ctor.call(this);\n\n            if (fileName === undefined) {\n                cc.PhysicsSprite.prototype.init.call(this);\n            } else if (cc.isString(fileName)) {\n                if (fileName[0] === \"#\") {\n                    //init with a sprite frame name\n                    var frameName = fileName.substr(1, fileName.length - 1);\n                    var spriteFrame = cc.spriteFrameCache.getSpriteFrame(frameName);\n                    this.initWithSpriteFrame(spriteFrame);\n                } else {\n                    //init  with filename and rect\n                    this.init(fileName, rect);\n                }\n            } else if (cc.isObject(fileName)) {\n                if (fileName instanceof cc.Texture2D) {\n                    //init  with texture and rect\n                    this.initWithTexture(fileName, rect);\n                } else if (fileName instanceof cc.SpriteFrame) {\n                    //init with a sprite frame\n                    this.initWithSpriteFrame(fileName);\n                }\n            }\n            //this._transformCmd = new cc.PhysicsSpriteTransformCmdCanvas(this);\n            //cc.rendererCanvas.pushRenderCommand(this._transformCmd);\n        },\n\n        //visit: function(){\n        //    cc.Sprite.prototype.visit.call(this);\n        //    cc.rendererCanvas.pushRenderCommand(this._transformCmd);\n        //},\n\n        /**\n         * set body\n         * @param {Box2D.Dynamics.b2Body} body\n         */\n        setBody: function (body) {\n            this._body = body;\n        },\n\n        /**\n         * get body\n         * @return {Box2D.Dynamics.b2Body}\n         */\n        getBody: function () {\n            return this._body;\n        },\n\n        /**\n         * set PTM ratio\n         * @param {Number} r\n         */\n        setPTMRatio: function (r) {\n            this._PTMRatio = r;\n        },\n\n        /**\n         * get PTM ration\n         * @return {Number}\n         */\n        getPTMRatio: function () {\n            return this._PTMRatio;\n        },\n\n        /**\n         * get position\n         * @return {cc.Point}\n         */\n        getPosition: function () {\n            var pos = this._body.GetPosition();\n            var locPTMRatio = this._PTMRatio;\n            return cc.p(pos.x * locPTMRatio, pos.y * locPTMRatio);\n        },\n\n        /**\n         * set position\n         * @param {cc.Point} p\n         */\n        setPosition: function (p) {\n            var angle = this._body.GetAngle();\n            var locPTMRatio = this._PTMRatio;\n            this._body.setTransform(Box2D.b2Vec2(p.x / locPTMRatio, p.y / locPTMRatio), angle);\n            this.setNodeDirty();\n        },\n\n        /**\n         * get rotation\n         * @return {Number}\n         */\n        getRotation: function () {\n            return (this._ignoreBodyRotation ? cc.radiansToDegrees(this._rotationRadians) : cc.radiansToDegrees(this._body.GetAngle()));\n        },\n\n        /**\n         * set rotation\n         * @param {Number} r\n         */\n        setRotation: function (r) {\n            if (this._ignoreBodyRotation) {\n                this._rotation = r;\n            } else {\n                var locBody = this._body;\n                var p = locBody.GetPosition();\n                locBody.SetTransform(p, cc.degreesToRadians(r));\n            }\n            this.setNodeDirty();\n        },\n\n        _syncPosition: function () {\n            var locPosition = this._position,\n                pos = this._body.GetPosition(),\n                x = pos.x * this._PTMRatio,\n                y = pos.y * this._PTMRatio;\n            if (locPosition.x !== pos.x || locPosition.y !== pos.y) {\n                cc.Sprite.prototype.setPosition.call(this, x, y);\n            }\n        },\n        _syncRotation: function () {\n            this._rotationRadians = this._body.GetAngle();\n            var a = cc.radiansToDegrees(this._rotationRadians);\n            if (this._rotationX !== a) {\n                cc.Sprite.prototype.setRotation.call(this, a);\n            }\n        },\n\n        /**\n         * set whether to ingore body's rotation\n         * @param {Boolean} b\n         */\n        setIgnoreBodyRotation: function (b) {\n            this._ignoreBodyRotation = b;\n        }\n    };\n\n    var chipmunkAPI = {\n        _ignoreBodyRotation: false,\n        _body: null, //physics body\n        _rotation: 1,\n\n        /**\n         * Create a PhysicsSprite with filename and rect\n         * Constructor of cc.PhysicsSprite for chipmunk\n         * @param {String|cc.Texture2D|cc.SpriteFrame} fileName\n         * @param {cc.Rect} rect\n         * @example\n         *\n         * 1.Create a sprite with image path and rect\n         * var physicsSprite1 = new cc.PhysicsSprite(\"res/HelloHTML5World.png\");\n         * var physicsSprite2 = new cc.PhysicsSprite(\"res/HelloHTML5World.png\",cc.rect(0,0,480,320));\n         *\n         * 2.Create a sprite with a sprite frame name. Must add \"#\" before frame name.\n         * var physicsSprite = new cc.PhysicsSprite('#grossini_dance_01.png');\n         *\n         * 3.Create a sprite with a sprite frame\n         * var spriteFrame = cc.spriteFrameCache.getSpriteFrame(\"grossini_dance_01.png\");\n         * var physicsSprite = new cc.PhysicsSprite(spriteFrame);\n         *\n         * 4.Creates a sprite with an exsiting texture contained in a CCTexture2D object\n         *      After creation, the rect will be the size of the texture, and the offset will be (0,0).\n         * var texture = cc.textureCache.addImage(\"HelloHTML5World.png\");\n         * var physicsSprite1 = new cc.PhysicsSprite(texture);\n         * var physicsSprite2 = new cc.PhysicsSprite(texture, cc.rect(0,0,480,320));\n         *\n         */\n        ctor: function (fileName, rect) {\n            cc.Sprite.prototype.ctor.call(this);\n\n            if (fileName === undefined) {\n                cc.PhysicsSprite.prototype.init.call(this);\n            } else if (cc.isString(fileName)) {\n                if (fileName[0] === \"#\") {\n                    //init with a sprite frame name\n                    var frameName = fileName.substr(1, fileName.length - 1);\n                    var spriteFrame = cc.spriteFrameCache.getSpriteFrame(frameName);\n                    this.initWithSpriteFrame(spriteFrame);\n                } else {\n                    //init  with filename and rect\n                    this.init(fileName, rect);\n                }\n            } else if (cc.isObject(fileName)) {\n                if (fileName instanceof cc.Texture2D) {\n                    //init  with texture and rect\n                    this.initWithTexture(fileName, rect);\n                } else if (fileName instanceof cc.SpriteFrame) {\n                    //init with a sprite frame\n                    this.initWithSpriteFrame(fileName);\n                }\n            }\n\n            cc.renderer.pushRenderCommand(this._renderCmd);\n        },\n\n        visit: function () {\n            cc.renderer.pushRenderCommand(this._renderCmd);\n            cc.Sprite.prototype.visit.call(this);\n        },\n\n        /**\n         * set body\n         * @param {cp.Body} body\n         */\n        setBody: function (body) {\n            this._body = body;\n        },\n\n        /**\n         * get body\n         * @returns {cp.Body}\n         */\n        getBody: function () {\n            return this._body;\n        },\n\n        /**\n         * get position\n         * @return {cc.Point}\n         */\n        getPosition: function () {\n            var locBody = this._body;\n            return {x: locBody.p.x, y: locBody.p.y};\n        },\n\n        /**\n         * get position x\n         * @return {Number}\n         */\n        getPositionX: function () {\n            return this._body.p.x;\n        },\n\n        /**\n         * get position y\n         * @return {Number}\n         */\n        getPositionY: function () {\n            return this._body.p.y;\n        },\n\n        /**\n         * set position\n         * @param {cc.Point|Number}newPosOrxValue\n         * @param {Number}yValue\n         */\n        setPosition: function (newPosOrxValue, yValue) {\n            if (yValue === undefined) {\n                this._body.p.x = newPosOrxValue.x;\n                this._body.p.y = newPosOrxValue.y;\n            } else {\n                this._body.p.x = newPosOrxValue;\n                this._body.p.y = yValue;\n            }\n        },\n\n        /**\n         * set position x\n         * @param {Number} xValue\n         */\n        setPositionX: function (xValue) {\n            this._body.p.x = xValue;\n        },\n\n        /**\n         * set position y\n         * @param {Number} yValue\n         */\n        setPositionY: function (yValue) {\n            this._body.p.y = yValue;\n        },\n\n        _syncPosition: function () {\n            var locPosition = this._position, locBody = this._body;\n            if (locPosition.x !== locBody.p.x || locPosition.y !== locBody.p.y) {\n                cc.Sprite.prototype.setPosition.call(this, locBody.p.x, locBody.p.y);\n            }\n        },\n\n        /**\n         * get rotation\n         * @return {Number}\n         */\n        getRotation: function () {\n            return this._ignoreBodyRotation ? this._rotationX : -cc.radiansToDegrees(this._body.a);\n        },\n\n        /**\n         * set rotation\n         * @param {Number} r\n         */\n        setRotation: function (r) {\n            if (this._ignoreBodyRotation) {\n                cc.Sprite.prototype.setRotation.call(this, r);\n            } else {\n                this._body.a = -cc.degreesToRadians(r);\n            }\n        },\n        _syncRotation: function () {\n            var a = -cc.radiansToDegrees(this._body.a);\n            if (this._rotationX !== a) {\n                cc.Sprite.prototype.setRotation.call(this, a);\n            }\n        },\n\n        /**\n         * get the affine transform matrix of node to parent coordinate frame\n         * @return {cc.AffineTransform}\n         */\n        getNodeToParentTransform: function () {\n            return this._renderCmd.getNodeToParentTransform();\n        },\n\n        /**\n         * whether dirty\n         * @return {Boolean}\n         */\n        isDirty: function () {\n            return !this._body.isSleeping();\n        },\n        setDirty: function () {\n        },\n\n        /**\n         * set whether to ignore rotation of body\n         * @param {Boolean} b\n         */\n        setIgnoreBodyRotation: function (b) {\n            this._ignoreBodyRotation = b;\n        },\n\n        _createRenderCmd: function () {\n            if (cc._renderType === cc.game.RENDER_TYPE_CANVAS)\n                return new cc.PhysicsSprite.CanvasRenderCmd(this);\n            else\n                return new cc.PhysicsSprite.WebGLRenderCmd(this);\n        }\n    };\n    /**\n     * @class\n     */\n    cc.PhysicsSprite = cc.Sprite.extend(chipmunkAPI);\n    cc.PhysicsSprite._className = \"PhysicsSprite\";\n    var _p = cc.PhysicsSprite.prototype;\n    // Extended properties\n    /** @expose */\n    _p.body;\n    cc.defineGetterSetter(_p, \"body\", _p.getBody, _p.setBody);\n    /** @expose */\n    _p.dirty;\n    cc.defineGetterSetter(_p, \"dirty\", _p.isDirty, _p.setDirty);\n\n\n    /**\n     * Create a PhysicsSprite with filename and rect\n     * @deprecated since v3.0, please use new cc.PhysicsSprite(fileName, rect) instead\n     * @param {String|cc.Texture2D|cc.SpriteFrame} fileName\n     * @param {cc.Rect} rect\n     * @return {cc.PhysicsSprite}\n     */\n    cc.PhysicsSprite.create = function (fileName, rect) {\n        return new cc.PhysicsSprite(fileName, rect);\n    };\n\n    /**\n     * @deprecated since v3.0, please use new cc.PhysicsSprite(spriteFrameName) instead\n     * @type {Function}\n     */\n    cc.PhysicsSprite.createWithSpriteFrameName = cc.PhysicsSprite.create;\n\n    /**\n     * @deprecated since v3.0, please use new cc.PhysicsSprite(spriteFrame) instead\n     * @type {Function}\n     */\n    cc.PhysicsSprite.createWithSpriteFrame = cc.PhysicsSprite.create;\n})();\n"]}