{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/base-classes/assets/frameworks/cocos2d-html5/extensions/ccui/base-classes/UIScale9SpriteWebGLRenderCmd.js"],"names":["cc","Node","WebGLRenderCmd","ccui","Scale9Sprite","renderable","call","_needDraw","_color","Uint32Array","_dirty","_shaderProgram","shaderCache","programForKey","SHADER_SPRITE_POSITION_TEXTURECOLOR","proto","prototype","Object","create","constructor","needDraw","_node","loaded","_uploadSliced","vertices","uvs","color","z","f32buffer","ui32buffer","offset","off","r","c","transform","parentCmd","recursive","originTransform","_rebuildQuads","_setColorDirty","uploadData","vertexDataOffset","node","_displayedOpacity","_quadsDirty","opacity","_displayedColor","g","b","_opacityModifyRGB","a","_vertexZ","_vertices","_uvs","types","RenderingType","len","_renderingType","SIMPLE","_vertCount","i","srcOff","SLICED","setState","state","NORMAL","GRAY","SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY"],"mappings":"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","file":"UIScale9SpriteWebGLRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/base-classes","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function() {\n    if(!cc.Node.WebGLRenderCmd) return;\n\n    ccui.Scale9Sprite.WebGLRenderCmd = function (renderable) {\n        cc.Node.WebGLRenderCmd.call(this, renderable);\n\n        this._needDraw = true;\n\n        this._color = new Uint32Array(1);\n        this._dirty = false;\n        this._shaderProgram = cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR);\n    };\n\n\n\n    var Scale9Sprite = ccui.Scale9Sprite;\n    var proto = ccui.Scale9Sprite.WebGLRenderCmd.prototype = Object.create(cc.Node.WebGLRenderCmd.prototype);\n    proto.constructor = ccui.Scale9Sprite.WebGLRenderCmd;\n\n    proto.needDraw = function () {\n        return this._needDraw && this._node.loaded();\n    };\n\n    proto._uploadSliced = function (vertices, uvs, color, z, f32buffer, ui32buffer, offset) {\n        var off;\n        for (var r = 0; r < 3; ++r) {\n            for (var c = 0; c < 3; ++c) {\n                off = r*8 + c*2;\n                // lb\n                f32buffer[offset] = vertices[off];\n                f32buffer[offset+1] = vertices[off+1];\n                f32buffer[offset+2] = z;\n                ui32buffer[offset+3] = color[0];\n                f32buffer[offset+4] = uvs[off];\n                f32buffer[offset+5] = uvs[off+1];\n                offset += 6;\n                // rb\n                f32buffer[offset] = vertices[off+2];\n                f32buffer[offset + 1] = vertices[off+3];\n                f32buffer[offset + 2] = z;\n                ui32buffer[offset + 3] = color[0];\n                f32buffer[offset + 4] = uvs[off+2];\n                f32buffer[offset + 5] = uvs[off+3];\n                offset += 6;\n                // lt\n                f32buffer[offset] = vertices[off+8];\n                f32buffer[offset + 1] = vertices[off+9];\n                f32buffer[offset + 2] = z;\n                ui32buffer[offset + 3] = color[0];\n                f32buffer[offset + 4] = uvs[off+8];\n                f32buffer[offset + 5] = uvs[off+9];\n                offset += 6;\n                // rt\n                f32buffer[offset] = vertices[off+10];\n                f32buffer[offset + 1] = vertices[off+11];\n                f32buffer[offset + 2] = z;\n                ui32buffer[offset + 3] = color[0];\n                f32buffer[offset + 4] = uvs[off+10];\n                f32buffer[offset + 5] = uvs[off+11];\n                offset += 6;\n            }\n        }\n        return 36;\n    };\n\n    proto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n        this._node._rebuildQuads();\n    };\n\n    proto._setColorDirty = function () {\n    };\n\n    proto.uploadData = function (f32buffer, ui32buffer, vertexDataOffset){\n        var node = this._node;\n        if (this._displayedOpacity === 0) {\n            return 0;\n        }\n\n        // Rebuild vertex data\n        if (node._quadsDirty) {\n            node._rebuildQuads();\n        }\n\n        // Color & z\n        var opacity = this._displayedOpacity;\n        var r = this._displayedColor.r,\n            g = this._displayedColor.g,\n            b = this._displayedColor.b;\n        if (node._opacityModifyRGB) {\n            var a = opacity / 255;\n            r *= a;\n            g *= a;\n            b *= a;\n        }\n        this._color[0] = ((opacity<<24) | (b<<16) | (g<<8) | r);\n        var z = node._vertexZ;\n\n        // Upload data\n        var vertices = node._vertices;\n        var uvs = node._uvs;\n        var types = Scale9Sprite.RenderingType;\n        var offset = vertexDataOffset;\n        var len = 0;\n        switch (node._renderingType) {\n          case types.SIMPLE:\n              // Inline for performance\n              len = this._node._vertCount;\n              for (var i = 0, srcOff = 0; i < len; i++, srcOff += 2) {\n                  f32buffer[offset] = vertices[srcOff];\n                  f32buffer[offset + 1] = vertices[srcOff+1];\n                  f32buffer[offset + 2] = z;\n                  ui32buffer[offset + 3] = this._color[0];\n                  f32buffer[offset + 4] = uvs[srcOff];\n                  f32buffer[offset + 5] = uvs[srcOff+1];\n                  offset += 6;\n              }\n              break;\n          case types.SLICED:\n              len = this._uploadSliced(vertices, uvs, this._color, z, f32buffer, ui32buffer, offset);\n              break;\n        }\n        return len;\n    };\n\n    proto.setState = function (state) {\n        if (state === Scale9Sprite.state.NORMAL) {\n            this._shaderProgram = cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR);\n        } else if (state === Scale9Sprite.state.GRAY) {\n            this._shaderProgram = cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY);\n        }\n    };\n\n\n})();\n"]}