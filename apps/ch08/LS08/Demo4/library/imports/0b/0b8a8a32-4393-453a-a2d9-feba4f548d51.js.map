{"version":3,"sources":["../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/webconsole.js"],"names":["webutils","require","Object","defineProperty","get","bind","configurable","enumerable","WebConsoleActor","aConnection","aParentActor","conn","parentActor","_actorPool","ActorPool","addActorPool","_prefs","dbg","makeDebugger","_netEvents","Map","_gripDepth","_listeners","Set","_lastConsoleInputEvaluation","undefined","objectGrip","traits","customNetworkRequest","_parentIsContentActor","evaluateJSAsync","transferredResponseSize","prototype","DebuggerServer","ContentActor","window","isRootActor","_getWindowForBrowserConsole","WCA__getWindowForBrowserConsole","_lastChromeWindow","closed","Services","wm","getMostRecentWindow","onChromeWindowOpened","obs","removeObserver","addObserver","_handleNewWindow","WCA__handleNewWindow","_hadChromeWindow","contextChangedMsg","l10n","getStr","console","logStringMessage","Cu","getWeakReference","_evalWindow","evalWindow","aWindow","_progressListenerActive","events","on","_onWillNavigate","consoleServiceListener","consoleAPIListener","networkMonitor","consoleProgressListener","consoleReflowListener","_webConsoleCommandsCache","actorPrefix","globalDebugObject","threadActor","grip","WCA_grip","actor","actorID","hasNativeConsoleAPI","WCA_hasNativeConsoleAPI","isNative","wrappedJSObject","Console","ex","_findProtoChain","ThreadActor","_removeFromProtoChain","disconnect","WCA_disconnect","destroy","serverLoggingListener","off","_onChangedToplevelDocument","removeActorPool","_onObserverNotification","clear","enabled","createEnvironmentActor","WCA_createEnvironmentActor","aEnvironment","EnvironmentActor","addActor","createValueGrip","WCA_createValueGrip","aValue","makeDebuggeeValue","WCA_makeDebuggeeValue","aUseObjectGlobal","global","getGlobalForObject","dbgGlobal","makeGlobalObjectReference","WCA_objectGrip","aObject","aPool","ObjectActor","getGripDepth","incrementGripDepth","decrementGripDepth","v","sources","DevToolsUtils","reportException","Error","env","getGlobalDebugObject","longStringGrip","WCA_longStringGrip","aString","LongStringActor","_createStringGrip","NEA__createStringGrip","stringIsLong","getActorByID","WCA_getActorByID","aActorID","releaseActor","WCA_releaseActor","aActor","removeActor","getLastConsoleInputEvaluation","WCU_getLastConsoleInputEvaluation","onStartListeners","WCA_onStartListeners","aRequest","startedListeners","appId","messageManager","docShell","listeners","length","listener","shift","ConsoleAPIListener","init","push","ConsoleReflowListener","ServerLoggingListener","forEach","add","nativeConsoleAPI","onStopListeners","WCA_onStopListeners","stoppedListeners","toDetach","stopMonitor","MONITOR_FILE_ACTIVITY","delete","onGetCachedMessages","WCA_onGetCachedMessages","types","messageTypes","error","message","messages","type","cache","getCachedMessages","aMessage","prepareConsoleMessageForRemote","_type","Ci","nsIScriptError","preparePageErrorForRemote","timeStamp","from","onEvaluateJSAsync","WCA_onEvaluateJSAsync","resultID","Date","now","send","response","onEvaluateJS","sendActorEvent","WCA_onEvaluateJS","input","text","timestamp","evalOptions","bindObjectActor","frameActor","url","selectedNodeActor","evalInfo","evalWithDebugger","evalResult","result","helperResult","errorMessage","errorGrip","return","yield","throw","unsafeDereference","toString","resultGrip","e","exception","exceptionMessage","onAutocomplete","WCA_onAutocomplete","frameActorId","dbgObject","environment","getActor","frame","log","JSPropertyProvider","cursor","matches","reqText","substr","lastNonAlphaIsDot","test","helpers","sandbox","create","addWebConsoleCommands","getOwnPropertyNames","concat","filter","n","startsWith","matchProp","sort","onClearMessagesCache","WCA_onClearMessagesCache","windowId","WebConsoleUtils","getInnerWindowId","ConsoleAPIStorage","Cc","getService","nsIConsoleAPIStorage","clearEvents","CONSOLE_WORKER_IDS","aId","reset","onGetPreferences","WCA_onGetPreferences","prefs","preferences","key","onSetPreferences","WCA_onSetPreferences","saveRequestAndResponseBodies","updated","keys","_getWebConsoleCommands","aDebuggerGlobal","chromeWindow","consoleActor","maybeExport","obj","name","desc","getOwnPropertyDescriptor","value","WCA_evalWithDebugger","aOptions","trimmedString","trim","reportError","dbgWindow","bindSelf","objActor","jsObj","bindings","_self","selectedNode","rawNode","found$","found$$","find","$","$$","evalInput","evalWithBindings","executeInGlobalWithBindings","onConsoleServiceMessage","WCA_onConsoleServiceMessage","packet","pageError","WCA_preparePageErrorForRemote","aPageError","stack","s","filename","source","lineNumber","line","columnNumber","column","functionName","functionDisplayName","parent","lineText","sourceLine","LONG_STRING_INITIAL_LENGTH","sourceName","category","warning","flags","warningFlag","errorFlag","exceptionFlag","strict","strictFlag","info","infoFlag","private","isFromPrivateWindow","stacktrace","onConsoleAPICall","WCA_onConsoleAPICall","onNetworkEvent","WCA_onNetworkEvent","aEvent","aChannel","getNetworkEventActor","eventActor","WCA_getNetworkEventActor","channel","NetworkEventActor","onSendHTTPRequest","WCA_onSendHTTPRequest","details","request","XMLHttpRequest","open","method","headers","setRequestHeader","body","set","onFileActivity","WCA_onFileActivity","aFileURI","uri","onReflowActivity","WCA_onReflowActivity","aReflowInfo","interruptible","start","end","sourceURL","onServerLogCall","WCA_onServerLogCall","msg","cloneInto","WCA_prepareConsoleMessageForRemote","cloneObject","workerType","indexOf","innerID","ID","consoleID","arguments","Array","map","aObj","dbgObj","styles","WCA_chromeWindow","QueryInterface","nsIInterfaceRequestor","getInterface","nsIWebNavigation","nsIDocShell","chromeEventHandler","ownerDocument","defaultView","WCA__onObserverNotification","aSubject","aTopic","WCA__onWillNavigate","isTopLevel","WCA__onChangedToplevelDocument","slice","requestTypes","startListeners","stopListeners","evaluateJS","autocomplete","clearMessagesCache","getPreferences","setPreferences","sendHTTPRequest","exports","aWebConsoleActor","_request","httpVersion","cookies","headersSize","postData","_response","content","_timings","_longStringActors","NEA_grip","startedDateTime","_startedDateTime","parse","isXHR","_isXHR","fromCache","_fromCache","_private","release","NEA_release","onRelease","NEA_onRelease","NEA_init","aNetworkEvent","prop","_discardRequestBody","discardRequestBody","_discardResponseBody","discardResponseBody","onGetRequestHeaders","NEA_onGetRequestHeaders","rawHeaders","onGetRequestCookies","NEA_onGetRequestCookies","onGetRequestPostData","NEA_onGetRequestPostData","postDataDiscarded","onGetSecurityInfo","NEA_onGetSecurityInfo","securityInfo","_securityInfo","onGetResponseHeaders","NEA_onGetResponseHeaders","onGetResponseCookies","NEA_onGetResponseCookies","onGetResponseContent","NEA_onGetResponseContent","contentDiscarded","onGetEventTimings","NEA_onGetEventTimings","timings","totalTime","_totalTime","addRequestHeaders","NEA_addRequestHeaders","aHeaders","aRawHeaders","_prepareHeaders","updateType","addRequestCookies","NEA_addRequestCookies","aCookies","addRequestPostData","NEA_addRequestPostData","aPostData","dataSize","addResponseStart","NEA_addResponseStart","aInfo","status","statusText","addSecurityInfo","NEA_addSecurityInfo","state","addResponseHeaders","NEA_addResponseHeaders","addResponseCookies","NEA_addResponseCookies","addResponseContent","NEA_addResponseContent","aContent","aDiscardedResponseBody","mimeType","contentSize","transferredSize","addEventTimings","NEA_addEventTimings","aTotal","aTimings","NEA__prepareHeaders","header"],"mappings":"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","file":"webconsole.js","sourceRoot":"../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors","sourcesContent":["/****************************************************************************\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n \n http://www.cocos2d-x.org\n \n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n \n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n \n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/* -*- js-indent-level: 2; indent-tabs-mode: nil -*- */\n/* vim: set ts=2 et sw=2 tw=80: */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n\"use strict\";\n\n// const { Cc, Ci, Cu } = require(\"chrome\");\n// const { DebuggerServer, ActorPool } = require(\"devtools/server/main\");\n// const { EnvironmentActor, ThreadActor } = require(\"devtools/server/actors/script\");\n// const { ObjectActor, LongStringActor, createValueGrip, stringIsLong } = require(\"devtools/server/actors/object\");\n// const DevToolsUtils = require(\"devtools/toolkit/DevToolsUtils\");\n\n// Cu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\n\n// XPCOMUtils.defineLazyModuleGetter(this, \"Services\",\n//                                   \"resource://gre/modules/Services.jsm\");\n// XPCOMUtils.defineLazyGetter(this, \"NetworkMonitor\", () => {\n//   return require(\"devtools/toolkit/webconsole/network-monitor\")\n//          .NetworkMonitor;\n// });\n// XPCOMUtils.defineLazyGetter(this, \"NetworkMonitorChild\", () => {\n//   return require(\"devtools/toolkit/webconsole/network-monitor\")\n//          .NetworkMonitorChild;\n// });\n// XPCOMUtils.defineLazyGetter(this, \"ConsoleProgressListener\", () => {\n//   return require(\"devtools/toolkit/webconsole/network-monitor\")\n//          .ConsoleProgressListener;\n// });\n// XPCOMUtils.defineLazyGetter(this, \"events\", () => {\n//   return require(\"sdk/event/core\");\n// });\n// XPCOMUtils.defineLazyGetter(this, \"ServerLoggingListener\", () => {\n//   return require(\"devtools/toolkit/webconsole/server-logger\")\n//          .ServerLoggingListener;\n// });\n\nlet webutils = require('script/debugger/webconsole/utils.js', 'debug');\n\nObject.defineProperty(this, \"JSPropertyProvider\", {\n  get: function() {\n    // if (prop == \"WebConsoleUtils\") {\n    //   prop = \"Utils\";\n    // }\n    return webutils[\"JSPropertyProvider\"];\n  }.bind(null, \"JSPropertyProvider\"),\n  configurable: true,\n  enumerable: true\n});\n\n\n/**\n * The WebConsoleActor implements capabilities needed for the Web Console\n * feature.\n *\n * @constructor\n * @param object aConnection\n *        The connection to the client, DebuggerServerConnection.\n * @param object [aParentActor]\n *        Optional, the parent actor.\n */\nfunction WebConsoleActor(aConnection, aParentActor)\n{\n  this.conn = aConnection;\n  this.parentActor = aParentActor;\n\n  this._actorPool = new ActorPool(this.conn);\n  this.conn.addActorPool(this._actorPool);\n\n  this._prefs = {};\n\n  this.dbg = this.parentActor.makeDebugger();\n\n  this._netEvents = new Map();\n  this._gripDepth = 0;\n  this._listeners = new Set();\n  this._lastConsoleInputEvaluation = undefined;\n\n  this.objectGrip = this.objectGrip.bind(this);\n  // this._onWillNavigate = this._onWillNavigate.bind(this);\n  // this._onChangedToplevelDocument = this._onChangedToplevelDocument.bind(this);\n  // events.on(this.parentActor, \"changed-toplevel-document\", this._onChangedToplevelDocument);\n  // // this._onObserverNotification = this._onObserverNotification.bind(this);\n  // if (this.parentActor.isRootActor) {\n  //   Services.obs.addObserver(this._onObserverNotification,\n  //                            \"last-pb-context-exited\", false);\n  // }\n\n  this.traits = {\n    customNetworkRequest: !this._parentIsContentActor,\n    evaluateJSAsync: true,\n    transferredResponseSize: true\n  };\n}\n\n// WebConsoleActor.l10n = new WebConsoleUtils.l10n(\"chrome://global/locale/console.properties\");\n\nWebConsoleActor.prototype =\n{\n  /**\n   * Debugger instance.\n   *\n   * @see jsdebugger.jsm\n   */\n  dbg: null,\n\n  /**\n   * This is used by the ObjectActor to keep track of the depth of grip() calls.\n   * @private\n   * @type number\n   */\n  _gripDepth: null,\n\n  /**\n   * Actor pool for all of the actors we send to the client.\n   * @private\n   * @type object\n   * @see ActorPool\n   */\n  _actorPool: null,\n\n  /**\n   * Web Console-related preferences.\n   * @private\n   * @type object\n   */\n  _prefs: null,\n\n  /**\n   * Holds a map between nsIChannel objects and NetworkEventActors for requests\n   * created with sendHTTPRequest.\n   *\n   * @private\n   * @type Map\n   */\n  _netEvents: null,\n\n  /**\n   * Holds a set of all currently registered listeners.\n   *\n   * @private\n   * @type Set\n   */\n  _listeners: null,\n\n  /**\n   * The debugger server connection instance.\n   * @type object\n   */\n  conn: null,\n\n  /**\n   * List of supported features by the console actor.\n   * @type object\n   */\n  traits: null,\n\n  /**\n   * Boolean getter that tells if the parent actor is a ContentActor.\n   *\n   * @private\n   * @type boolean\n   */\n  get _parentIsContentActor() {\n    return \"ContentActor\" in DebuggerServer &&\n            this.parentActor instanceof DebuggerServer.ContentActor;\n  },\n\n  /**\n   * The window we work with.\n   * @type nsIDOMWindow\n   */\n  get window() {\n    if (this.parentActor.isRootActor) {\n      return this._getWindowForBrowserConsole();\n    }\n    return this.parentActor.window;\n  },\n\n  /**\n   * Get a window to use for the browser console.\n   *\n   * @private\n   * @return nsIDOMWindow\n   *         The window to use, or null if no window could be found.\n   */\n  _getWindowForBrowserConsole: function WCA__getWindowForBrowserConsole()\n  {\n    // Check if our last used chrome window is still live.\n    let window = this._lastChromeWindow && this._lastChromeWindow.get();\n    // If not, look for a new one.\n    if (!window || window.closed) {\n      window = this.parentActor.window;\n      if (!window) {\n        // Try to find the Browser Console window to use instead.\n        window = Services.wm.getMostRecentWindow(\"devtools:webconsole\");\n        // We prefer the normal chrome window over the console window,\n        // so we'll look for those windows in order to replace our reference.\n        let onChromeWindowOpened = () => {\n          // We'll look for this window when someone next requests window()\n          Services.obs.removeObserver(onChromeWindowOpened, \"domwindowopened\");\n          this._lastChromeWindow = null;\n        };\n        Services.obs.addObserver(onChromeWindowOpened, \"domwindowopened\", false);\n      }\n\n      this._handleNewWindow(window);\n    }\n\n    return window;\n  },\n\n  /**\n   * Store a newly found window on the actor to be used in the future.\n   *\n   * @private\n   * @param nsIDOMWindow window\n   *        The window to store on the actor (can be null).\n   */\n  _handleNewWindow: function WCA__handleNewWindow(window)\n  {\n    if (window) {\n      if (this._hadChromeWindow) {\n        let contextChangedMsg = WebConsoleActor.l10n.getStr(\"evaluationContextChanged\");\n        Services.console.logStringMessage(contextChangedMsg);\n      }\n      this._lastChromeWindow = Cu.getWeakReference(window);\n      this._hadChromeWindow = true;\n    } else {\n      this._lastChromeWindow = null;\n    }\n  },\n\n  /**\n   * Whether we've been using a window before.\n   *\n   * @private\n   * @type boolean\n   */\n  _hadChromeWindow: false,\n\n  /**\n   * A weak reference to the last chrome window we used to work with.\n   *\n   * @private\n   * @type nsIWeakReference\n   */\n  _lastChromeWindow: null,\n\n  // The evalWindow is used at the scope for JS evaluation.\n  _evalWindow: null,\n  get evalWindow() {\n    return this._evalWindow || this.window;\n  },\n\n  set evalWindow(aWindow) {\n    this._evalWindow = aWindow;\n\n    if (!this._progressListenerActive) {\n      events.on(this.parentActor, \"will-navigate\", this._onWillNavigate);\n      this._progressListenerActive = true;\n    }\n  },\n\n  /**\n   * Flag used to track if we are listening for events from the progress\n   * listener of the tab actor. We use the progress listener to clear\n   * this.evalWindow on page navigation.\n   *\n   * @private\n   * @type boolean\n   */\n  _progressListenerActive: false,\n\n  /**\n   * The ConsoleServiceListener instance.\n   * @type object\n   */\n  consoleServiceListener: null,\n\n  /**\n   * The ConsoleAPIListener instance.\n   */\n  consoleAPIListener: null,\n\n  /**\n   * The NetworkMonitor instance.\n   */\n  networkMonitor: null,\n\n  /**\n   * The ConsoleProgressListener instance.\n   */\n  consoleProgressListener: null,\n\n  /**\n   * The ConsoleReflowListener instance.\n   */\n  consoleReflowListener: null,\n\n  /**\n   * The Web Console Commands names cache.\n   * @private\n   * @type array\n   */\n  _webConsoleCommandsCache: null,\n\n  actorPrefix: \"console\",\n\n  get globalDebugObject() {\n    return this.parentActor.threadActor.globalDebugObject;\n  },\n\n  grip: function WCA_grip()\n  {\n    return { actor: this.actorID };\n  },\n\n  hasNativeConsoleAPI: function WCA_hasNativeConsoleAPI(aWindow) {\n    let isNative = false;\n    try {\n      // We are very explicitly examining the \"console\" property of\n      // the non-Xrayed object here.\n      let console = aWindow.wrappedJSObject.console;\n      isNative = console instanceof aWindow.Console;\n    }\n    catch (ex) { }\n    return isNative;\n  },\n\n  _findProtoChain: ThreadActor.prototype._findProtoChain,\n  _removeFromProtoChain: ThreadActor.prototype._removeFromProtoChain,\n\n  /**\n   * Destroy the current WebConsoleActor instance.\n   */\n  disconnect: function WCA_disconnect()\n  {\n    if (this.consoleServiceListener) {\n      this.consoleServiceListener.destroy();\n      this.consoleServiceListener = null;\n    }\n    if (this.consoleAPIListener) {\n      this.consoleAPIListener.destroy();\n      this.consoleAPIListener = null;\n    }\n    if (this.networkMonitor) {\n      this.networkMonitor.destroy();\n      this.networkMonitor = null;\n    }\n    if (this.consoleProgressListener) {\n      this.consoleProgressListener.destroy();\n      this.consoleProgressListener = null;\n    }\n    if (this.consoleReflowListener) {\n      this.consoleReflowListener.destroy();\n      this.consoleReflowListener = null;\n    }\n    if (this.serverLoggingListener) {\n      this.serverLoggingListener.destroy();\n      this.serverLoggingListener = null;\n    }\n\n    events.off(this.parentActor, \"changed-toplevel-document\",\n               this._onChangedToplevelDocument);\n\n    this.conn.removeActorPool(this._actorPool);\n\n    if (this.parentActor.isRootActor) {\n      Services.obs.removeObserver(this._onObserverNotification,\n                                  \"last-pb-context-exited\");\n    }\n\n    this._actorPool = null;\n    this._webConsoleCommandsCache = null;\n    this._lastConsoleInputEvaluation = null;\n    this._evalWindow = null;\n    this._netEvents.clear();\n    this.dbg.enabled = false;\n    this.dbg = null;\n    this.conn = null;\n  },\n\n  /**\n   * Create and return an environment actor that corresponds to the provided\n   * Debugger.Environment. This is a straightforward clone of the ThreadActor's\n   * method except that it stores the environment actor in the web console\n   * actor's pool.\n   *\n   * @param Debugger.Environment aEnvironment\n   *        The lexical environment we want to extract.\n   * @return The EnvironmentActor for aEnvironment or undefined for host\n   *         functions or functions scoped to a non-debuggee global.\n   */\n  createEnvironmentActor: function WCA_createEnvironmentActor(aEnvironment) {\n    if (!aEnvironment) {\n      return undefined;\n    }\n\n    if (aEnvironment.actor) {\n      return aEnvironment.actor;\n    }\n\n    let actor = new EnvironmentActor(aEnvironment, this);\n    this._actorPool.addActor(actor);\n    aEnvironment.actor = actor;\n\n    return actor;\n  },\n\n  /**\n   * Create a grip for the given value.\n   *\n   * @param mixed aValue\n   * @return object\n   */\n  createValueGrip: function WCA_createValueGrip(aValue)\n  {\n    return createValueGrip(aValue, this._actorPool, this.objectGrip);\n  },\n\n  /**\n   * Make a debuggee value for the given value.\n   *\n   * @param mixed aValue\n   *        The value you want to get a debuggee value for.\n   * @param boolean aUseObjectGlobal\n   *        If |true| the object global is determined and added as a debuggee,\n   *        otherwise |this.window| is used when makeDebuggeeValue() is invoked.\n   * @return object\n   *         Debuggee value for |aValue|.\n   */\n  makeDebuggeeValue: function WCA_makeDebuggeeValue(aValue, aUseObjectGlobal)\n  {\n    let global = this.window;\n    if (aUseObjectGlobal && typeof aValue == \"object\") {\n      try {\n        global = Cu.getGlobalForObject(aValue);\n      }\n      catch (ex) {\n        // The above can throw an exception if aValue is not an actual object.\n      }\n    }\n    let dbgGlobal = this.dbg.makeGlobalObjectReference(global);\n    return dbgGlobal.makeDebuggeeValue(aValue);\n  },\n\n  /**\n   * Create a grip for the given object.\n   *\n   * @param object aObject\n   *        The object you want.\n   * @param object aPool\n   *        An ActorPool where the new actor instance is added.\n   * @param object\n   *        The object grip.\n   */\n  objectGrip: function WCA_objectGrip(aObject, aPool)\n  {\n    let actor = new ObjectActor(aObject, {\n      getGripDepth: () => this._gripDepth,\n      incrementGripDepth: () => this._gripDepth++,\n      decrementGripDepth: () => this._gripDepth--,\n      createValueGrip: v => this.createValueGrip(v),\n      sources: () => DevToolsUtils.reportException(\"WebConsoleActor\",\n        Error(\"sources not yet implemented\")),\n      createEnvironmentActor: (env) => this.createEnvironmentActor(env),\n      getGlobalDebugObject: () => this.globalDebugObject\n    });\n    aPool.addActor(actor);\n    return actor.grip();\n  },\n\n  /**\n   * Create a grip for the given string.\n   *\n   * @param string aString\n   *        The string you want to create the grip for.\n   * @param object aPool\n   *        An ActorPool where the new actor instance is added.\n   * @return object\n   *         A LongStringActor object that wraps the given string.\n   */\n  longStringGrip: function WCA_longStringGrip(aString, aPool)\n  {\n    let actor = new LongStringActor(aString);\n    aPool.addActor(actor);\n    return actor.grip();\n  },\n\n  /**\n   * Create a long string grip if needed for the given string.\n   *\n   * @private\n   * @param string aString\n   *        The string you want to create a long string grip for.\n   * @return string|object\n   *         A string is returned if |aString| is not a long string.\n   *         A LongStringActor grip is returned if |aString| is a long string.\n   */\n  _createStringGrip: function NEA__createStringGrip(aString)\n  {\n    if (aString && stringIsLong(aString)) {\n      return this.longStringGrip(aString, this._actorPool);\n    }\n    return aString;\n  },\n\n  /**\n   * Get an object actor by its ID.\n   *\n   * @param string aActorID\n   * @return object\n   */\n  getActorByID: function WCA_getActorByID(aActorID)\n  {\n    return this._actorPool.get(aActorID);\n  },\n\n  /**\n   * Release an actor.\n   *\n   * @param object aActor\n   *        The actor instance you want to release.\n   */\n  releaseActor: function WCA_releaseActor(aActor)\n  {\n    this._actorPool.removeActor(aActor.actorID);\n  },\n\n  /**\n   * Returns the latest web console input evaluation.\n   * This is undefined if no evaluations have been completed.\n   *\n   * @return object\n   */\n  getLastConsoleInputEvaluation: function WCU_getLastConsoleInputEvaluation()\n  {\n    return this._lastConsoleInputEvaluation;\n  },\n\n  //////////////////\n  // Request handlers for known packet types.\n  //////////////////\n\n  /**\n   * Handler for the \"startListeners\" request.\n   *\n   * @param object aRequest\n   *        The JSON request object received from the Web Console client.\n   * @return object\n   *         The response object which holds the startedListeners array.\n   */\n  onStartListeners: function WCA_onStartListeners(aRequest)\n  {\n    let startedListeners = [];\n    let window = !this.parentActor.isRootActor ? this.window : null;\n    let appId = null;\n    let messageManager = null;\n\n    if (this._parentIsContentActor) {\n      appId = this.parentActor.docShell.appId;\n      messageManager = this.parentActor.messageManager;\n    }\n\n    while (aRequest.listeners.length > 0) {\n      let listener = aRequest.listeners.shift();\n      switch (listener) {\n        case \"PageError\":\n          // if (!this.consoleServiceListener) {\n          //   this.consoleServiceListener =\n          //     new ConsoleServiceListener(window, this);\n          //   this.consoleServiceListener.init();\n          // }\n          // startedListeners.push(listener);\n          break;\n        case \"ConsoleAPI\":\n          if (!this.consoleAPIListener) {\n            this.consoleAPIListener =\n              new ConsoleAPIListener(window, this);\n            this.consoleAPIListener.init();\n          }\n          startedListeners.push(listener);\n          break;\n        case \"NetworkActivity\":\n          // if (!this.networkMonitor) {\n          //   if (appId || messageManager) {\n          //     this.networkMonitor =\n          //       new NetworkMonitorChild(appId, messageManager,\n          //                               this.parentActor.actorID, this);\n          //   }\n          //   else {\n          //     this.networkMonitor = new NetworkMonitor({ window: window }, this);\n          //   }\n          //   this.networkMonitor.init();\n          // }\n          // startedListeners.push(listener);\n          break;\n        case \"FileActivity\":\n          // if (this.window instanceof Ci.nsIDOMWindow) {\n          //   if (!this.consoleProgressListener) {\n          //     this.consoleProgressListener =\n          //       new ConsoleProgressListener(this.window, this);\n          //   }\n          //   this.consoleProgressListener.startMonitor(this.consoleProgressListener.\n          //                                             MONITOR_FILE_ACTIVITY);\n          //   startedListeners.push(listener);\n          // }\n          break;\n        case \"ReflowActivity\":\n          if (!this.consoleReflowListener) {\n            this.consoleReflowListener =\n              new ConsoleReflowListener(this.window, this);\n          }\n          startedListeners.push(listener);\n          break;\n        case \"ServerLogging\":\n          if (!this.serverLoggingListener) {\n            this.serverLoggingListener =\n              new ServerLoggingListener(this.window, this);\n          }\n          startedListeners.push(listener);\n          break;\n      }\n    }\n\n    // Update the live list of running listeners\n    startedListeners.forEach(this._listeners.add, this._listeners);\n\n    return {\n      startedListeners: startedListeners,\n      nativeConsoleAPI: this.hasNativeConsoleAPI(this.window),\n      traits: this.traits,\n    };\n  },\n\n  /**\n   * Handler for the \"stopListeners\" request.\n   *\n   * @param object aRequest\n   *        The JSON request object received from the Web Console client.\n   * @return object\n   *         The response packet to send to the client: holds the\n   *         stoppedListeners array.\n   */\n  onStopListeners: function WCA_onStopListeners(aRequest)\n  {\n    let stoppedListeners = [];\n\n    // If no specific listeners are requested to be detached, we stop all\n    // listeners.\n    let toDetach = aRequest.listeners ||\n                   [\"PageError\", \"ConsoleAPI\", \"NetworkActivity\",\n                    \"FileActivity\", \"ServerLogging\"];\n\n    while (toDetach.length > 0) {\n      let listener = toDetach.shift();\n      switch (listener) {\n        case \"PageError\":\n          if (this.consoleServiceListener) {\n            this.consoleServiceListener.destroy();\n            this.consoleServiceListener = null;\n          }\n          stoppedListeners.push(listener);\n          break;\n        case \"ConsoleAPI\":\n          if (this.consoleAPIListener) {\n            this.consoleAPIListener.destroy();\n            this.consoleAPIListener = null;\n          }\n          stoppedListeners.push(listener);\n          break;\n        case \"NetworkActivity\":\n          if (this.networkMonitor) {\n            this.networkMonitor.destroy();\n            this.networkMonitor = null;\n          }\n          stoppedListeners.push(listener);\n          break;\n        case \"FileActivity\":\n          if (this.consoleProgressListener) {\n            this.consoleProgressListener.stopMonitor(this.consoleProgressListener.\n                                                     MONITOR_FILE_ACTIVITY);\n            this.consoleProgressListener = null;\n          }\n          stoppedListeners.push(listener);\n          break;\n        case \"ReflowActivity\":\n          if (this.consoleReflowListener) {\n            this.consoleReflowListener.destroy();\n            this.consoleReflowListener = null;\n          }\n          stoppedListeners.push(listener);\n          break;\n        case \"ServerLogging\":\n          if (this.serverLoggingListener) {\n            this.serverLoggingListener.destroy();\n            this.serverLoggingListener = null;\n          }\n          stoppedListeners.push(listener);\n          break;\n      }\n    }\n\n    // Update the live list of running listeners\n    stoppedListeners.forEach(this._listeners.delete, this._listeners);\n\n    return { stoppedListeners: stoppedListeners };\n  },\n\n  /**\n   * Handler for the \"getCachedMessages\" request. This method sends the cached\n   * error messages and the window.console API calls to the client.\n   *\n   * @param object aRequest\n   *        The JSON request object received from the Web Console client.\n   * @return object\n   *         The response packet to send to the client: it holds the cached\n   *         messages array.\n   */\n  onGetCachedMessages: function WCA_onGetCachedMessages(aRequest)\n  {\n    let types = aRequest.messageTypes;\n    if (!types) {\n      return {\n        error: \"missingParameter\",\n        message: \"The messageTypes parameter is missing.\",\n      };\n    }\n\n    let messages = [];\n\n    while (types.length > 0) {\n      let type = types.shift();\n      switch (type) {\n        case \"ConsoleAPI\": {\n          if (!this.consoleAPIListener) {\n            break;\n          }\n          let cache = this.consoleAPIListener\n                      .getCachedMessages(!this.parentActor.isRootActor);\n          cache.forEach((aMessage) => {\n            let message = this.prepareConsoleMessageForRemote(aMessage);\n            message._type = type;\n            messages.push(message);\n          });\n          break;\n        }\n        case \"PageError\": {\n          if (!this.consoleServiceListener) {\n            break;\n          }\n          let cache = this.consoleServiceListener\n                      .getCachedMessages(!this.parentActor.isRootActor);\n          cache.forEach((aMessage) => {\n            let message = null;\n            if (aMessage instanceof Ci.nsIScriptError) {\n              message = this.preparePageErrorForRemote(aMessage);\n              message._type = type;\n            }\n            else {\n              message = {\n                _type: \"LogMessage\",\n                message: this._createStringGrip(aMessage.message),\n                timeStamp: aMessage.timeStamp,\n              };\n            }\n            messages.push(message);\n          });\n          break;\n        }\n      }\n    }\n\n    return {\n      from: this.actorID,\n      messages: messages,\n    };\n  },\n\n  /**\n   * Handler for the \"evaluateJSAsync\" request. This method evaluates the given\n   * JavaScript string and sends back a packet with a unique ID.\n   * The result will be returned later as an unsolicited `evaluationResult`,\n   * that can be associated back to this request via the `resultID` field.\n   *\n   * @param object aRequest\n   *        The JSON request object received from the Web Console client.\n   * @return object\n   *         The response packet to send to with the unique id in the\n   *         `resultID` field.\n   */\n  onEvaluateJSAsync: function WCA_onEvaluateJSAsync(aRequest)\n  {\n    // We want to be able to run console commands without waiting\n    // for the first to return (see Bug 1088861).\n\n    // First, send a response packet with the id only.\n    let resultID = Date.now();\n    this.conn.send({\n      from: this.actorID,\n      resultID: resultID\n    });\n\n    // Then, execute the script that may pause.\n    let response = this.onEvaluateJS(aRequest);\n    response.resultID = resultID;\n\n    // Finally, send an unsolicited evaluationResult packet with\n    // the normal return value\n    this.conn.sendActorEvent(this.actorID, \"evaluationResult\", response);\n  },\n\n  /**\n   * Handler for the \"evaluateJS\" request. This method evaluates the given\n   * JavaScript string and sends back the result.\n   *\n   * @param object aRequest\n   *        The JSON request object received from the Web Console client.\n   * @return object\n   *         The evaluation response packet.\n   */\n  onEvaluateJS: function WCA_onEvaluateJS(aRequest)\n  {\n    let input = aRequest.text;\n    let timestamp = Date.now();\n\n    let evalOptions = {\n      bindObjectActor: aRequest.bindObjectActor,\n      frameActor: aRequest.frameActor,\n      url: aRequest.url,\n      selectedNodeActor: aRequest.selectedNodeActor,\n    };\n\n    let evalInfo = this.evalWithDebugger(input, evalOptions);\n    let evalResult = evalInfo.result;\n    let helperResult = evalInfo.helperResult;\n\n    let result, errorMessage, errorGrip = null;\n    if (evalResult) {\n      if (\"return\" in evalResult) {\n        result = evalResult.return;\n      } else if (\"yield\" in evalResult) {\n        result = evalResult.yield;\n      } else if (\"throw\" in evalResult) {\n        let error = evalResult.throw;\n        errorGrip = this.createValueGrip(error);\n        errorMessage = error && (typeof error === \"object\")\n          ? error.unsafeDereference().toString()\n          : \"\" + error;\n      }\n    }\n\n    // If a value is encountered that the debugger server doesn't support yet,\n    // the console should remain functional.\n    let resultGrip;\n    try {\n      resultGrip = this.createValueGrip(result);\n    } catch (e) {\n      errorMessage = e;\n    }\n\n    this._lastConsoleInputEvaluation = result;\n\n    return {\n      from: this.actorID,\n      input: input,\n      result: resultGrip,\n      timestamp: timestamp,\n      exception: errorGrip,\n      exceptionMessage: this._createStringGrip(errorMessage),\n      helperResult: helperResult,\n    };\n  },\n\n  /**\n   * The Autocomplete request handler.\n   *\n   * @param object aRequest\n   *        The request message - what input to autocomplete.\n   * @return object\n   *         The response message - matched properties.\n   */\n  onAutocomplete: function WCA_onAutocomplete(aRequest)\n  {\n    let frameActorId = aRequest.frameActor;\n    let dbgObject = null;\n    let environment = null;\n\n    // This is the case of the paused debugger\n    if (frameActorId) {\n      let frameActor = this.conn.getActor(frameActorId);\n      if (frameActor) {\n        let frame = frameActor.frame;\n        environment = frame.environment;\n      }\n      else {\n        log(\"Web Console Actor: the frame actor was not found: \" +\n                       frameActorId);\n      }\n    }\n    // This is the general case (non-paused debugger)\n    else {\n      dbgObject = this.dbg.makeGlobalObjectReference(this.evalWindow);\n    }\n\n    let result = JSPropertyProvider(dbgObject, environment, aRequest.text,\n                                    aRequest.cursor, frameActorId) || {};\n    let matches = result.matches || [];\n    let reqText = aRequest.text.substr(0, aRequest.cursor);\n\n    // We consider '$' as alphanumerc because it is used in the names of some\n    // helper functions.\n    let lastNonAlphaIsDot = /[.][a-zA-Z0-9$]*$/.test(reqText);\n    if (!lastNonAlphaIsDot) {\n      if (!this._webConsoleCommandsCache) {\n        let helpers = {\n          sandbox: Object.create(null)\n        };\n        addWebConsoleCommands(helpers);\n        this._webConsoleCommandsCache =\n          Object.getOwnPropertyNames(helpers.sandbox);\n      }\n      matches = matches.concat(this._webConsoleCommandsCache\n          .filter(n => n.startsWith(result.matchProp)));\n    }\n\n    return {\n      from: this.actorID,\n      matches: matches.sort(),\n      matchProp: result.matchProp,\n    };\n  },\n\n  /**\n   * The \"clearMessagesCache\" request handler.\n   */\n  onClearMessagesCache: function WCA_onClearMessagesCache()\n  {\n    // TODO: Bug 717611 - Web Console clear button does not clear cached errors\n    let windowId = !this.parentActor.isRootActor ?\n                   WebConsoleUtils.getInnerWindowId(this.window) : null;\n    let ConsoleAPIStorage = Cc[\"@mozilla.org/consoleAPI-storage;1\"]\n                              .getService(Ci.nsIConsoleAPIStorage);\n    ConsoleAPIStorage.clearEvents(windowId);\n\n    CONSOLE_WORKER_IDS.forEach((aId) => {\n      ConsoleAPIStorage.clearEvents(aId);\n    });\n\n    if (this.parentActor.isRootActor) {\n      Services.console.logStringMessage(null); // for the Error Console\n      Services.console.reset();\n    }\n    return {};\n  },\n\n  /**\n   * The \"getPreferences\" request handler.\n   *\n   * @param object aRequest\n   *        The request message - which preferences need to be retrieved.\n   * @return object\n   *         The response message - a { key: value } object map.\n   */\n  onGetPreferences: function WCA_onGetPreferences(aRequest)\n  {\n    let prefs = Object.create(null);\n    for (let key of aRequest.preferences) {\n      prefs[key] = !!this._prefs[key];\n    }\n    return { preferences: prefs };\n  },\n\n  /**\n   * The \"setPreferences\" request handler.\n   *\n   * @param object aRequest\n   *        The request message - which preferences need to be updated.\n   */\n  onSetPreferences: function WCA_onSetPreferences(aRequest)\n  {\n    for (let key in aRequest.preferences) {\n      this._prefs[key] = aRequest.preferences[key];\n\n      if (key == \"NetworkMonitor.saveRequestAndResponseBodies\" &&\n          this.networkMonitor) {\n        this.networkMonitor.saveRequestAndResponseBodies = this._prefs[key];\n      }\n    }\n    return { updated: Object.keys(aRequest.preferences) };\n  },\n\n  //////////////////\n  // End of request handlers.\n  //////////////////\n\n  /**\n   * Create an object with the API we expose to the Web Console during\n   * JavaScript evaluation.\n   * This object inherits properties and methods from the Web Console actor.\n   *\n   * @private\n   * @param object aDebuggerGlobal\n   *        A Debugger.Object that wraps a content global. This is used for the\n   *        Web Console Commands.\n   * @return object\n   *         The same object as |this|, but with an added |sandbox| property.\n   *         The sandbox holds methods and properties that can be used as\n   *         bindings during JS evaluation.\n   */\n  _getWebConsoleCommands: function(aDebuggerGlobal)\n  {\n    let helpers = {\n      window: this.evalWindow,\n      chromeWindow: this.chromeWindow.bind(this),\n      makeDebuggeeValue: aDebuggerGlobal.makeDebuggeeValue.bind(aDebuggerGlobal),\n      createValueGrip: this.createValueGrip.bind(this),\n      sandbox: Object.create(null),\n      helperResult: null,\n      consoleActor: this,\n    };\n    addWebConsoleCommands(helpers);\n\n    let evalWindow = this.evalWindow;\n    function maybeExport(obj, name) {\n      if (typeof obj[name] != \"function\") {\n        return;\n      }\n\n      // By default, chrome-implemented functions that are exposed to content\n      // refuse to accept arguments that are cross-origin for the caller. This\n      // is generally the safe thing, but causes problems for certain console\n      // helpers like cd(), where we users sometimes want to pass a cross-origin\n      // window. To circumvent this restriction, we use exportFunction along\n      // with a special option designed for this purpose. See bug 1051224.\n      // obj[name] =\n      //   Cu.exportFunction(obj[name], evalWindow, { allowCrossOriginArguments: true });\n    }\n    for (let name in helpers.sandbox) {\n      let desc = Object.getOwnPropertyDescriptor(helpers.sandbox, name);\n      maybeExport(desc, 'get');\n      maybeExport(desc, 'set');\n      maybeExport(desc, 'value');\n      if (desc.value) {\n        // Make sure the helpers can be used during eval.\n        desc.value = aDebuggerGlobal.makeDebuggeeValue(desc.value);\n      }\n      Object.defineProperty(helpers.sandbox, name, desc);\n    }\n    return helpers;\n  },\n\n  /**\n   * Evaluates a string using the debugger API.\n   *\n   * To allow the variables view to update properties from the Web Console we\n   * provide the \"bindObjectActor\" mechanism: the Web Console tells the\n   * ObjectActor ID for which it desires to evaluate an expression. The\n   * Debugger.Object pointed at by the actor ID is bound such that it is\n   * available during expression evaluation (executeInGlobalWithBindings()).\n   *\n   * Example:\n   *   _self['foobar'] = 'test'\n   * where |_self| refers to the desired object.\n   *\n   * The |frameActor| property allows the Web Console client to provide the\n   * frame actor ID, such that the expression can be evaluated in the\n   * user-selected stack frame.\n   *\n   * For the above to work we need the debugger and the Web Console to share\n   * a connection, otherwise the Web Console actor will not find the frame\n   * actor.\n   *\n   * The Debugger.Frame comes from the jsdebugger's Debugger instance, which\n   * is different from the Web Console's Debugger instance. This means that\n   * for evaluation to work, we need to create a new instance for the Web\n   * Console Commands helpers - they need to be Debugger.Objects coming from the\n   * jsdebugger's Debugger instance.\n   *\n   * When |bindObjectActor| is used objects can come from different iframes,\n   * from different domains. To avoid permission-related errors when objects\n   * come from a different window, we also determine the object's own global,\n   * such that evaluation happens in the context of that global. This means that\n   * evaluation will happen in the object's iframe, rather than the top level\n   * window.\n   *\n   * @param string aString\n   *        String to evaluate.\n   * @param object [aOptions]\n   *        Options for evaluation:\n   *        - bindObjectActor: the ObjectActor ID to use for evaluation.\n   *          |evalWithBindings()| will be called with one additional binding:\n   *          |_self| which will point to the Debugger.Object of the given\n   *          ObjectActor.\n   *        - frameActor: the FrameActor ID to use for evaluation. The given\n   *        debugger frame is used for evaluation, instead of the global window.\n   *        - selectedNodeActor: the NodeActor ID of the currently selected node\n   *        in the Inspector (or null, if there is no selection). This is used\n   *        for helper functions that make reference to the currently selected\n   *        node, like $0.\n   * @return object\n   *         An object that holds the following properties:\n   *         - dbg: the debugger where the string was evaluated.\n   *         - frame: (optional) the frame where the string was evaluated.\n   *         - window: the Debugger.Object for the global where the string was\n   *         evaluated.\n   *         - result: the result of the evaluation.\n   *         - helperResult: any result coming from a Web Console commands\n   *         function.\n   *         - url: the url to evaluate the script as. Defaults to\n   *         \"debugger eval code\".\n   */\n  evalWithDebugger: function WCA_evalWithDebugger(aString, aOptions = {})\n  {\n    let trimmedString = aString.trim();\n    // The help function needs to be easy to guess, so we make the () optional.\n    if (trimmedString == \"help\" || trimmedString == \"?\") {\n      aString = \"help()\";\n    }\n\n    // Add easter egg for console.mihai().\n    if (trimmedString == \"console.mihai()\" || trimmedString == \"console.mihai();\") {\n      aString = \"\\\"http://incompleteness.me/blog/2015/02/09/console-dot-mihai/\\\"\";\n    }\n\n    // Find the Debugger.Frame of the given FrameActor.\n    let frame = null, frameActor = null;\n    if (aOptions.frameActor) {\n      frameActor = this.conn.getActor(aOptions.frameActor);\n      if (frameActor) {\n        frame = frameActor.frame;\n      }\n      else {\n        Cu.reportError(\"Web Console Actor: the frame actor was not found: \" +\n                       aOptions.frameActor);\n      }\n    }\n\n    // If we've been given a frame actor in whose scope we should evaluate the\n    // expression, be sure to use that frame's Debugger (that is, the JavaScript\n    // debugger's Debugger) for the whole operation, not the console's Debugger.\n    // (One Debugger will treat a different Debugger's Debugger.Object instances\n    // as ordinary objects, not as references to be followed, so mixing\n    // debuggers causes strange behaviors.)\n    let dbg = frame ? frameActor.threadActor.dbg : this.dbg;\n    let dbgWindow = dbg.makeGlobalObjectReference(this.evalWindow);\n\n    // If we have an object to bind to |_self|, create a Debugger.Object\n    // referring to that object, belonging to dbg.\n    let bindSelf = null;\n    if (aOptions.bindObjectActor) {\n      let objActor = this.getActorByID(aOptions.bindObjectActor);\n      if (objActor) {\n        let jsObj = objActor.obj.unsafeDereference();\n        // If we use the makeDebuggeeValue method of jsObj's own global, then\n        // we'll get a D.O that sees jsObj as viewed from its own compartment -\n        // that is, without wrappers. The evalWithBindings call will then wrap\n        // jsObj appropriately for the evaluation compartment.\n        let global = Cu.getGlobalForObject(jsObj);\n        dbgWindow = dbg.makeGlobalObjectReference(global);\n        bindSelf = dbgWindow.makeDebuggeeValue(jsObj);\n      }\n    }\n\n    // Get the Web Console commands for the given debugger window.\n    let helpers = this._getWebConsoleCommands(dbgWindow);\n    let bindings = helpers.sandbox;\n    if (bindSelf) {\n      bindings._self = bindSelf;\n    }\n\n    if (aOptions.selectedNodeActor) {\n      let actor = this.conn.getActor(aOptions.selectedNodeActor);\n      if (actor) {\n        helpers.selectedNode = actor.rawNode;\n      }\n    }\n\n    // Check if the Debugger.Frame or Debugger.Object for the global include\n    // $ or $$. We will not overwrite these functions with the Web Console\n    // commands.\n    let found$ = false, found$$ = false;\n    if (frame) {\n      let env = frame.environment;\n      if (env) {\n        found$ = !!env.find(\"$\");\n        found$$ = !!env.find(\"$$\");\n      }\n    }\n    else {\n      found$ = !!dbgWindow.getOwnPropertyDescriptor(\"$\");\n      found$$ = !!dbgWindow.getOwnPropertyDescriptor(\"$$\");\n    }\n\n    let $ = null, $$ = null;\n    if (found$) {\n      $ = bindings.$;\n      delete bindings.$;\n    }\n    if (found$$) {\n      $$ = bindings.$$;\n      delete bindings.$$;\n    }\n\n    // Ready to evaluate the string.\n    helpers.evalInput = aString;\n\n    let evalOptions;\n    if (typeof aOptions.url == \"string\") {\n      evalOptions = { url: aOptions.url };\n    }\n\n    let result;\n    if (frame) {\n      result = frame.evalWithBindings(aString, bindings, evalOptions);\n    }\n    else {\n      result = dbgWindow.executeInGlobalWithBindings(aString, bindings, evalOptions);\n    }\n\n    let helperResult = helpers.helperResult;\n    delete helpers.evalInput;\n    delete helpers.helperResult;\n    delete helpers.selectedNode;\n\n    if ($) {\n      bindings.$ = $;\n    }\n    if ($$) {\n      bindings.$$ = $$;\n    }\n\n    if (bindings._self) {\n      delete bindings._self;\n    }\n\n    return {\n      result: result,\n      helperResult: helperResult,\n      dbg: dbg,\n      frame: frame,\n      window: dbgWindow,\n    };\n  },\n\n  //////////////////\n  // Event handlers for various listeners.\n  //////////////////\n\n  /**\n   * Handler for messages received from the ConsoleServiceListener. This method\n   * sends the nsIConsoleMessage to the remote Web Console client.\n   *\n   * @param nsIConsoleMessage aMessage\n   *        The message we need to send to the client.\n   */\n  onConsoleServiceMessage: function WCA_onConsoleServiceMessage(aMessage)\n  {\n    let packet;\n    if (aMessage instanceof Ci.nsIScriptError) {\n      packet = {\n        from: this.actorID,\n        type: \"pageError\",\n        pageError: this.preparePageErrorForRemote(aMessage),\n      };\n    }\n    else {\n      packet = {\n        from: this.actorID,\n        type: \"logMessage\",\n        message: this._createStringGrip(aMessage.message),\n        timeStamp: aMessage.timeStamp,\n      };\n    }\n    this.conn.send(packet);\n  },\n\n  /**\n   * Prepare an nsIScriptError to be sent to the client.\n   *\n   * @param nsIScriptError aPageError\n   *        The page error we need to send to the client.\n   * @return object\n   *         The object you can send to the remote client.\n   */\n  preparePageErrorForRemote: function WCA_preparePageErrorForRemote(aPageError)\n  {\n    let stack = null;\n    // Convert stack objects to the JSON attributes expected by client code\n    if (aPageError.stack) {\n      stack = [];\n      let s = aPageError.stack;\n      while (s !== null) {\n        stack.push({\n          filename: s.source,\n          lineNumber: s.line,\n          columnNumber: s.column,\n          functionName: s.functionDisplayName\n        });\n        s = s.parent;\n      }\n    }\n    let lineText = aPageError.sourceLine;\n    if (lineText && lineText.length > DebuggerServer.LONG_STRING_INITIAL_LENGTH) {\n      lineText = lineText.substr(0, DebuggerServer.LONG_STRING_INITIAL_LENGTH);\n    }\n\n    return {\n      errorMessage: this._createStringGrip(aPageError.errorMessage),\n      sourceName: aPageError.sourceName,\n      lineText: lineText,\n      lineNumber: aPageError.lineNumber,\n      columnNumber: aPageError.columnNumber,\n      category: aPageError.category,\n      timeStamp: aPageError.timeStamp,\n      warning: !!(aPageError.flags & aPageError.warningFlag),\n      error: !!(aPageError.flags & aPageError.errorFlag),\n      exception: !!(aPageError.flags & aPageError.exceptionFlag),\n      strict: !!(aPageError.flags & aPageError.strictFlag),\n      info: !!(aPageError.flags & aPageError.infoFlag),\n      private: aPageError.isFromPrivateWindow,\n      stacktrace: stack\n    };\n  },\n\n  /**\n   * Handler for window.console API calls received from the ConsoleAPIListener.\n   * This method sends the object to the remote Web Console client.\n   *\n   * @see ConsoleAPIListener\n   * @param object aMessage\n   *        The console API call we need to send to the remote client.\n   */\n  onConsoleAPICall: function WCA_onConsoleAPICall(aMessage)\n  {\n    let packet = {\n      from: this.actorID,\n      type: \"consoleAPICall\",\n      message: this.prepareConsoleMessageForRemote(aMessage),\n    };\n    this.conn.send(packet);\n  },\n\n  /**\n   * Handler for network events. This method is invoked when a new network event\n   * is about to be recorded.\n   *\n   * @see NetworkEventActor\n   * @see NetworkMonitor from webconsole/utils.js\n   *\n   * @param object aEvent\n   *        The initial network request event information.\n   * @param nsIHttpChannel aChannel\n   *        The network request nsIHttpChannel object.\n   * @return object\n   *         A new NetworkEventActor is returned. This is used for tracking the\n   *         network request and response.\n   */\n  onNetworkEvent: function WCA_onNetworkEvent(aEvent, aChannel)\n  {\n    let actor = this.getNetworkEventActor(aChannel);\n    actor.init(aEvent);\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEvent\",\n      eventActor: actor.grip()\n    };\n\n    this.conn.send(packet);\n\n    return actor;\n  },\n\n  /**\n   * Get the NetworkEventActor for a nsIChannel, if it exists,\n   * otherwise create a new one.\n   *\n   * @param nsIHttpChannel aChannel\n   *        The channel for the network event.\n   * @return object\n   *         The NetworkEventActor for the given channel.\n   */\n  getNetworkEventActor: function WCA_getNetworkEventActor(aChannel) {\n    let actor = this._netEvents.get(aChannel);\n    if (actor) {\n      // delete from map as we should only need to do this check once\n      this._netEvents.delete(aChannel);\n      actor.channel = null;\n      return actor;\n    }\n\n    actor = new NetworkEventActor(aChannel, this);\n    this._actorPool.addActor(actor);\n    return actor;\n  },\n\n  /**\n   * Send a new HTTP request from the target's window.\n   *\n   * @param object aMessage\n   *        Object with 'request' - the HTTP request details.\n   */\n  onSendHTTPRequest: function WCA_onSendHTTPRequest(aMessage)\n  {\n    let details = aMessage.request;\n\n    // send request from target's window\n    let request = new this.window.XMLHttpRequest();\n    request.open(details.method, details.url, true);\n\n    for (let {name, value} of details.headers) {\n      request.setRequestHeader(name, value);\n    }\n    request.send(details.body);\n\n    let actor = this.getNetworkEventActor(request.channel);\n\n    // map channel to actor so we can associate future events with it\n    this._netEvents.set(request.channel, actor);\n\n    return {\n      from: this.actorID,\n      eventActor: actor.grip()\n    };\n  },\n\n  /**\n   * Handler for file activity. This method sends the file request information\n   * to the remote Web Console client.\n   *\n   * @see ConsoleProgressListener\n   * @param string aFileURI\n   *        The requested file URI.\n   */\n  onFileActivity: function WCA_onFileActivity(aFileURI)\n  {\n    let packet = {\n      from: this.actorID,\n      type: \"fileActivity\",\n      uri: aFileURI,\n    };\n    this.conn.send(packet);\n  },\n\n  /**\n   * Handler for reflow activity. This method forwards reflow events to the\n   * remote Web Console client.\n   *\n   * @see ConsoleReflowListener\n   * @param Object aReflowInfo\n   */\n  onReflowActivity: function WCA_onReflowActivity(aReflowInfo)\n  {\n    let packet = {\n      from: this.actorID,\n      type: \"reflowActivity\",\n      interruptible: aReflowInfo.interruptible,\n      start: aReflowInfo.start,\n      end: aReflowInfo.end,\n      sourceURL: aReflowInfo.sourceURL,\n      sourceLine: aReflowInfo.sourceLine,\n      functionName: aReflowInfo.functionName\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Handler for server logging. This method forwards log events to the\n   * remote Web Console client.\n   *\n   * @see ServerLoggingListener\n   * @param object aMessage\n   *        The console API call on the server we need to send to the remote client.\n   */\n  onServerLogCall: function WCA_onServerLogCall(aMessage)\n  {\n    // Clone all data into the content scope (that's where\n    // passed arguments comes from).\n    let msg = Cu.cloneInto(aMessage, this.window);\n\n    // All arguments within the message need to be converted into\n    // debuggees to properly send it to the client side.\n    // Use the default target: this.window as the global object\n    // since that's the correct scope for data in the message.\n    // The 'false' argument passed into prepareConsoleMessageForRemote()\n    // ensures that makeDebuggeeValue uses content debuggee.\n    // See also:\n    // * makeDebuggeeValue()\n    // * prepareConsoleMessageForRemote()\n    msg = this.prepareConsoleMessageForRemote(msg, false);\n\n    let packet = {\n      from: this.actorID,\n      type: \"serverLogCall\",\n      message: msg,\n    };\n\n    this.conn.send(packet);\n  },\n\n  //////////////////\n  // End of event handlers for various listeners.\n  //////////////////\n\n  /**\n   * Prepare a message from the console API to be sent to the remote Web Console\n   * instance.\n   *\n   * @param object aMessage\n   *        The original message received from console-api-log-event.\n   * @param boolean aUseObjectGlobal\n   *        If |true| the object global is determined and added as a debuggee,\n   *        otherwise |this.window| is used when makeDebuggeeValue() is invoked.\n   * @return object\n   *         The object that can be sent to the remote client.\n   */\n  prepareConsoleMessageForRemote:\n  function WCA_prepareConsoleMessageForRemote(aMessage, aUseObjectGlobal = true)\n  {\n    let result = WebConsoleUtils.cloneObject(aMessage);\n\n    result.workerType = CONSOLE_WORKER_IDS.indexOf(result.innerID) == -1\n                          ? 'none' : result.innerID;\n\n    delete result.wrappedJSObject;\n    delete result.ID;\n    delete result.innerID;\n    delete result.consoleID;\n\n    result.arguments = Array.map(aMessage.arguments || [], (aObj) => {\n      let dbgObj = this.makeDebuggeeValue(aObj, aUseObjectGlobal);\n      return this.createValueGrip(dbgObj);\n    });\n\n    result.styles = Array.map(aMessage.styles || [], (aString) => {\n      return this.createValueGrip(aString);\n    });\n\n    result.category = aMessage.category || \"webdev\";\n\n    return result;\n  },\n\n  /**\n   * Find the XUL window that owns the content window.\n   *\n   * @return Window\n   *         The XUL window that owns the content window.\n   */\n  chromeWindow: function WCA_chromeWindow()\n  {\n    let window = null;\n    try {\n      window = this.window.QueryInterface(Ci.nsIInterfaceRequestor)\n             .getInterface(Ci.nsIWebNavigation).QueryInterface(Ci.nsIDocShell)\n             .chromeEventHandler.ownerDocument.defaultView;\n    }\n    catch (ex) {\n      // The above can fail because chromeEventHandler is not available for all\n      // kinds of |this.window|.\n    }\n\n    return window;\n  },\n\n  /**\n   * Notification observer for the \"last-pb-context-exited\" topic.\n   *\n   * @private\n   * @param object aSubject\n   *        Notification subject - in this case it is the inner window ID that\n   *        was destroyed.\n   * @param string aTopic\n   *        Notification topic.\n   */\n  _onObserverNotification: function WCA__onObserverNotification(aSubject, aTopic)\n  {\n    switch (aTopic) {\n      case \"last-pb-context-exited\":\n        this.conn.send({\n          from: this.actorID,\n          type: \"lastPrivateContextExited\",\n        });\n        break;\n    }\n  },\n\n  /**\n   * The \"will-navigate\" progress listener. This is used to clear the current\n   * eval scope.\n   */\n  _onWillNavigate: function WCA__onWillNavigate({ window, isTopLevel })\n  {\n    if (isTopLevel) {\n      this._evalWindow = null;\n      events.off(this.parentActor, \"will-navigate\", this._onWillNavigate);\n      this._progressListenerActive = false;\n    }\n  },\n\n  /**\n   * This listener is called when we switch to another frame,\n   * mostly to unregister previous listeners and start listening on the new document.\n   */\n  _onChangedToplevelDocument: function WCA__onChangedToplevelDocument()\n  {\n    // Convert the Set to an Array\n    let listeners = [...this._listeners];\n\n    // Unregister existing listener on the previous document\n    // (pass a copy of the array as it will shift from it)\n    this.onStopListeners({listeners: listeners.slice()});\n\n    // This method is called after this.window is changed,\n    // so we register new listener on this new window\n    this.onStartListeners({listeners: listeners});\n\n    // Also reset the cached top level chrome window being targeted\n    this._lastChromeWindow  = null;\n  },\n};\n\nWebConsoleActor.prototype.requestTypes =\n{\n  startListeners: WebConsoleActor.prototype.onStartListeners,\n  stopListeners: WebConsoleActor.prototype.onStopListeners,\n  getCachedMessages: WebConsoleActor.prototype.onGetCachedMessages,\n  evaluateJS: WebConsoleActor.prototype.onEvaluateJS,\n  evaluateJSAsync: WebConsoleActor.prototype.onEvaluateJSAsync,\n  autocomplete: WebConsoleActor.prototype.onAutocomplete,\n  clearMessagesCache: WebConsoleActor.prototype.onClearMessagesCache,\n  getPreferences: WebConsoleActor.prototype.onGetPreferences,\n  setPreferences: WebConsoleActor.prototype.onSetPreferences,\n  sendHTTPRequest: WebConsoleActor.prototype.onSendHTTPRequest\n};\n\nexports.WebConsoleActor = WebConsoleActor;\n\n/**\n * Creates an actor for a network event.\n *\n * @constructor\n * @param object aChannel\n *        The nsIChannel associated with this event.\n * @param object aWebConsoleActor\n *        The parent WebConsoleActor instance for this object.\n */\nfunction NetworkEventActor(aChannel, aWebConsoleActor)\n{\n  this.parent = aWebConsoleActor;\n  this.conn = this.parent.conn;\n  this.channel = aChannel;\n\n  this._request = {\n    method: null,\n    url: null,\n    httpVersion: null,\n    headers: [],\n    cookies: [],\n    headersSize: null,\n    postData: {},\n  };\n\n  this._response = {\n    headers: [],\n    cookies: [],\n    content: {},\n  };\n\n  this._timings = {};\n\n  // Keep track of LongStringActors owned by this NetworkEventActor.\n  this._longStringActors = new Set();\n}\n\nNetworkEventActor.prototype =\n{\n  _request: null,\n  _response: null,\n  _timings: null,\n  _longStringActors: null,\n\n  actorPrefix: \"netEvent\",\n\n  /**\n   * Returns a grip for this actor for returning in a protocol message.\n   */\n  grip: function NEA_grip()\n  {\n    return {\n      actor: this.actorID,\n      startedDateTime: this._startedDateTime,\n      timeStamp: Date.parse(this._startedDateTime),\n      url: this._request.url,\n      method: this._request.method,\n      isXHR: this._isXHR,\n      fromCache: this._fromCache,\n      private: this._private,\n    };\n  },\n\n  /**\n   * Releases this actor from the pool.\n   */\n  release: function NEA_release()\n  {\n    for (let grip of this._longStringActors) {\n      let actor = this.parent.getActorByID(grip.actor);\n      if (actor) {\n        this.parent.releaseActor(actor);\n      }\n    }\n    this._longStringActors = new Set();\n\n    if (this.channel) {\n      this.parent._netEvents.delete(this.channel);\n    }\n    this.parent.releaseActor(this);\n  },\n\n  /**\n   * Handle a protocol request to release a grip.\n   */\n  onRelease: function NEA_onRelease()\n  {\n    this.release();\n    return {};\n  },\n\n  /**\n   * Set the properties of this actor based on it's corresponding\n   * network event.\n   *\n   * @param object aNetworkEvent\n   *        The network event associated with this actor.\n   */\n  init: function NEA_init(aNetworkEvent)\n  {\n    this._startedDateTime = aNetworkEvent.startedDateTime;\n    this._isXHR = aNetworkEvent.isXHR;\n    this._fromCache = aNetworkEvent.fromCache;\n\n    for (let prop of ['method', 'url', 'httpVersion', 'headersSize']) {\n      this._request[prop] = aNetworkEvent[prop];\n    }\n\n    this._discardRequestBody = aNetworkEvent.discardRequestBody;\n    this._discardResponseBody = aNetworkEvent.discardResponseBody;\n    this._private = aNetworkEvent.private;\n  },\n\n  /**\n   * The \"getRequestHeaders\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network request headers.\n   */\n  onGetRequestHeaders: function NEA_onGetRequestHeaders()\n  {\n    return {\n      from: this.actorID,\n      headers: this._request.headers,\n      headersSize: this._request.headersSize,\n      rawHeaders: this._request.rawHeaders,\n    };\n  },\n\n  /**\n   * The \"getRequestCookies\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network request cookies.\n   */\n  onGetRequestCookies: function NEA_onGetRequestCookies()\n  {\n    return {\n      from: this.actorID,\n      cookies: this._request.cookies,\n    };\n  },\n\n  /**\n   * The \"getRequestPostData\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network POST data.\n   */\n  onGetRequestPostData: function NEA_onGetRequestPostData()\n  {\n    return {\n      from: this.actorID,\n      postData: this._request.postData,\n      postDataDiscarded: this._discardRequestBody,\n    };\n  },\n\n  /**\n   * The \"getSecurityInfo\" packet type handler.\n   *\n   * @return object\n   *         The response packet - connection security information.\n   */\n  onGetSecurityInfo: function NEA_onGetSecurityInfo()\n  {\n    return {\n      from: this.actorID,\n      securityInfo: this._securityInfo,\n    };\n  },\n\n  /**\n   * The \"getResponseHeaders\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network response headers.\n   */\n  onGetResponseHeaders: function NEA_onGetResponseHeaders()\n  {\n    return {\n      from: this.actorID,\n      headers: this._response.headers,\n      headersSize: this._response.headersSize,\n      rawHeaders: this._response.rawHeaders,\n    };\n  },\n\n  /**\n   * The \"getResponseCookies\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network response cookies.\n   */\n  onGetResponseCookies: function NEA_onGetResponseCookies()\n  {\n    return {\n      from: this.actorID,\n      cookies: this._response.cookies,\n    };\n  },\n\n  /**\n   * The \"getResponseContent\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network response content.\n   */\n  onGetResponseContent: function NEA_onGetResponseContent()\n  {\n    return {\n      from: this.actorID,\n      content: this._response.content,\n      contentDiscarded: this._discardResponseBody,\n    };\n  },\n\n  /**\n   * The \"getEventTimings\" packet type handler.\n   *\n   * @return object\n   *         The response packet - network event timings.\n   */\n  onGetEventTimings: function NEA_onGetEventTimings()\n  {\n    return {\n      from: this.actorID,\n      timings: this._timings,\n      totalTime: this._totalTime\n    };\n  },\n\n  /******************************************************************\n   * Listeners for new network event data coming from NetworkMonitor.\n   ******************************************************************/\n\n  /**\n   * Add network request headers.\n   *\n   * @param array aHeaders\n   *        The request headers array.\n   * @param string aRawHeaders\n   *        The raw headers source.\n   */\n  addRequestHeaders: function NEA_addRequestHeaders(aHeaders, aRawHeaders)\n  {\n    this._request.headers = aHeaders;\n    this._prepareHeaders(aHeaders);\n\n    var rawHeaders = this.parent._createStringGrip(aRawHeaders);\n    if (typeof rawHeaders == \"object\") {\n      this._longStringActors.add(rawHeaders);\n    }\n    this._request.rawHeaders = rawHeaders;\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"requestHeaders\",\n      headers: aHeaders.length,\n      headersSize: this._request.headersSize,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add network request cookies.\n   *\n   * @param array aCookies\n   *        The request cookies array.\n   */\n  addRequestCookies: function NEA_addRequestCookies(aCookies)\n  {\n    this._request.cookies = aCookies;\n    this._prepareHeaders(aCookies);\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"requestCookies\",\n      cookies: aCookies.length,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add network request POST data.\n   *\n   * @param object aPostData\n   *        The request POST data.\n   */\n  addRequestPostData: function NEA_addRequestPostData(aPostData)\n  {\n    this._request.postData = aPostData;\n    aPostData.text = this.parent._createStringGrip(aPostData.text);\n    if (typeof aPostData.text == \"object\") {\n      this._longStringActors.add(aPostData.text);\n    }\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"requestPostData\",\n      dataSize: aPostData.text.length,\n      discardRequestBody: this._discardRequestBody,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add the initial network response information.\n   *\n   * @param object aInfo\n   *        The response information.\n   * @param string aRawHeaders\n   *        The raw headers source.\n   */\n  addResponseStart: function NEA_addResponseStart(aInfo, aRawHeaders)\n  {\n    var rawHeaders = this.parent._createStringGrip(aRawHeaders);\n    if (typeof rawHeaders == \"object\") {\n      this._longStringActors.add(rawHeaders);\n    }\n    this._response.rawHeaders = rawHeaders;\n\n    this._response.httpVersion = aInfo.httpVersion;\n    this._response.status = aInfo.status;\n    this._response.statusText = aInfo.statusText;\n    this._response.headersSize = aInfo.headersSize;\n    this._discardResponseBody = aInfo.discardResponseBody;\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"responseStart\",\n      response: aInfo\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add connection security information.\n   *\n   * @param object info\n   *        The object containing security information.\n   */\n  addSecurityInfo: function NEA_addSecurityInfo(info)\n  {\n    this._securityInfo = info;\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"securityInfo\",\n      state: info.state,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add network response headers.\n   *\n   * @param array aHeaders\n   *        The response headers array.\n   */\n  addResponseHeaders: function NEA_addResponseHeaders(aHeaders)\n  {\n    this._response.headers = aHeaders;\n    this._prepareHeaders(aHeaders);\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"responseHeaders\",\n      headers: aHeaders.length,\n      headersSize: this._response.headersSize,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add network response cookies.\n   *\n   * @param array aCookies\n   *        The response cookies array.\n   */\n  addResponseCookies: function NEA_addResponseCookies(aCookies)\n  {\n    this._response.cookies = aCookies;\n    this._prepareHeaders(aCookies);\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"responseCookies\",\n      cookies: aCookies.length,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add network response content.\n   *\n   * @param object aContent\n   *        The response content.\n   * @param boolean aDiscardedResponseBody\n   *        Tells if the response content was recorded or not.\n   */\n  addResponseContent:\n  function NEA_addResponseContent(aContent, aDiscardedResponseBody)\n  {\n    this._response.content = aContent;\n    aContent.text = this.parent._createStringGrip(aContent.text);\n    if (typeof aContent.text == \"object\") {\n      this._longStringActors.add(aContent.text);\n    }\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"responseContent\",\n      mimeType: aContent.mimeType,\n      contentSize: aContent.text.length,\n      transferredSize: aContent.transferredSize,\n      discardResponseBody: aDiscardedResponseBody,\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Add network event timing information.\n   *\n   * @param number aTotal\n   *        The total time of the network event.\n   * @param object aTimings\n   *        Timing details about the network event.\n   */\n  addEventTimings: function NEA_addEventTimings(aTotal, aTimings)\n  {\n    this._totalTime = aTotal;\n    this._timings = aTimings;\n\n    let packet = {\n      from: this.actorID,\n      type: \"networkEventUpdate\",\n      updateType: \"eventTimings\",\n      totalTime: aTotal\n    };\n\n    this.conn.send(packet);\n  },\n\n  /**\n   * Prepare the headers array to be sent to the client by using the\n   * LongStringActor for the header values, when needed.\n   *\n   * @private\n   * @param array aHeaders\n   */\n  _prepareHeaders: function NEA__prepareHeaders(aHeaders)\n  {\n    for (let header of aHeaders) {\n      header.value = this.parent._createStringGrip(header.value);\n      if (typeof header.value == \"object\") {\n        this._longStringActors.add(header.value);\n      }\n    }\n  },\n};\n\nNetworkEventActor.prototype.requestTypes =\n{\n  \"release\": NetworkEventActor.prototype.onRelease,\n  \"getRequestHeaders\": NetworkEventActor.prototype.onGetRequestHeaders,\n  \"getRequestCookies\": NetworkEventActor.prototype.onGetRequestCookies,\n  \"getRequestPostData\": NetworkEventActor.prototype.onGetRequestPostData,\n  \"getResponseHeaders\": NetworkEventActor.prototype.onGetResponseHeaders,\n  \"getResponseCookies\": NetworkEventActor.prototype.onGetResponseCookies,\n  \"getResponseContent\": NetworkEventActor.prototype.onGetResponseContent,\n  \"getEventTimings\": NetworkEventActor.prototype.onGetEventTimings,\n  \"getSecurityInfo\": NetworkEventActor.prototype.onGetSecurityInfo,\n};\n"]}