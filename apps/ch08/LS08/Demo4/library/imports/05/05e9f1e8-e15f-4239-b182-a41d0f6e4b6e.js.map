{"version":3,"sources":["../../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/display/assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/display/CCSkinRenderCmd.js"],"names":["ccs","Skin","RenderCmd","_realWorldTM","transform","parentCmd","recursive","_transform","a","b","c","d","tx","ty","_worldTransform","node","_node","pt","t","wt","dirty","_dirtyFlag","cc","Node","_dirtyFlags","transformDirty","originTransform","affineTransformConcatIn","bone","getNodeToArmatureTransform","vertices","_vertices","lx","_offsetPosition","x","rx","_rect","width","by","y","height","rwtm","getArmature","_renderCmd","getNodeToWorldTransform","affineTransformConcat","getNodeToWorldTransformAR","displayTransform","_anchorPointInPoints","pointApplyAffineTransform","CanvasRenderCmd","renderable","_spriteCmdCtor","proto","prototype","Object","create","Sprite","inject","constructor","_updateCurrentRegions","temp","_currentRegion","_oldRegion","RegionStatus","DirtyDouble","_regionFlag","isEmpty","union","updateRegion","getLocalBB","WebGLRenderCmd"],"mappings":"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","file":"CCSkinRenderCmd.js","sourceRoot":"../../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/display","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n    ccs.Skin.RenderCmd = {\n        _realWorldTM: null,\n        transform: function (parentCmd, recursive) {\n            if (!this._transform) {\n                this._transform = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n                this._worldTransform = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n            }\n\n            var node = this._node,\n                pt = parentCmd ? parentCmd._worldTransform : null,\n                t = this._transform,\n                wt = this._worldTransform,\n                dirty = this._dirtyFlag & cc.Node._dirtyFlags.transformDirty;\n\n            if (dirty || pt) {\n                this.originTransform();\n                cc.affineTransformConcatIn(this._transform, node.bone.getNodeToArmatureTransform());\n                this._dirtyFlag &= ~cc.Node._dirtyFlags.transformDirty;\n            }\n\n            if (pt) {\n                wt.a = t.a * pt.a + t.b * pt.c;\n                wt.b = t.a * pt.b + t.b * pt.d;\n                wt.c = t.c * pt.a + t.d * pt.c;\n                wt.d = t.c * pt.b + t.d * pt.d;\n                wt.tx = t.tx * pt.a + t.ty * pt.c + pt.tx;\n                wt.ty = t.tx * pt.b + t.ty * pt.d + pt.ty;\n\n                var vertices = this._vertices;\n                if (vertices) {\n                    var lx = node._offsetPosition.x, rx = lx + node._rect.width,\n                        by = node._offsetPosition.y, ty = by + node._rect.height;\n\n                    vertices[0].x = lx * wt.a + ty * wt.c + wt.tx; // tl\n                    vertices[0].y = lx * wt.b + ty * wt.d + wt.ty;\n                    vertices[1].x = lx * wt.a + by * wt.c + wt.tx; // bl\n                    vertices[1].y = lx * wt.b + by * wt.d + wt.ty;\n                    vertices[2].x = rx * wt.a + ty * wt.c + wt.tx; // tr\n                    vertices[2].y = rx * wt.b + ty * wt.d + wt.ty;\n                    vertices[3].x = rx * wt.a + by * wt.c + wt.tx; // br\n                    vertices[3].y = rx * wt.b + by * wt.d + wt.ty;\n                }\n            }\n            else {\n                wt.a = t.a;\n                wt.b = t.b;\n                wt.c = t.c;\n                wt.d = t.d;\n                wt.tx = t.tx;\n                wt.ty = t.ty;\n            }\n            var rwtm = this._realWorldTM;\n            if (rwtm) {\n                rwtm.a = t.a; rwtm.b = t.b; rwtm.c = t.c; rwtm.d = t.d; rwtm.tx = t.tx; rwtm.ty = t.ty;\n                cc.affineTransformConcatIn(rwtm, this._node.bone.getArmature()._renderCmd._worldTransform);\n            }\n        },\n\n        getNodeToWorldTransform: function () {\n            return cc.affineTransformConcat(this._transform, this._node.bone.getArmature().getNodeToWorldTransform());\n        },\n\n        getNodeToWorldTransformAR: function () {\n            var displayTransform = this._transform, node = this._node;\n            this._anchorPointInPoints = cc.pointApplyAffineTransform(this._anchorPointInPoints, displayTransform);\n            displayTransform.tx = this._anchorPointInPoints.x;\n            displayTransform.ty = this._anchorPointInPoints.y;\n            return cc.affineTransformConcat(displayTransform, node.bone.getArmature().getNodeToWorldTransform());\n        }\n    };\n\n    ccs.Skin.CanvasRenderCmd = function (renderable) {\n        this._spriteCmdCtor(renderable);\n        this._realWorldTM = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n    };\n\n    var proto = ccs.Skin.CanvasRenderCmd.prototype = Object.create(cc.Sprite.CanvasRenderCmd.prototype);\n    cc.inject(ccs.Skin.RenderCmd, proto);\n\n    proto.constructor = ccs.Skin.CanvasRenderCmd;\n\n    proto._updateCurrentRegions = function () {\n        var temp = this._currentRegion;\n        this._currentRegion = this._oldRegion;\n        this._oldRegion = temp;\n        //hittest will call the transform, and set region flag to DirtyDouble, and the changes need to be considered for rendering\n        if (cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble === this._regionFlag && (!this._currentRegion.isEmpty())) {\n            this._oldRegion.union(this._currentRegion);\n        }\n        this._currentRegion.updateRegion(this.getLocalBB(), this._realWorldTM);\n    };\n\n    ccs.Skin.WebGLRenderCmd = function (renderable) {\n        this._spriteCmdCtor(renderable);\n    };\n\n    proto = ccs.Skin.WebGLRenderCmd.prototype = Object.create(cc.Sprite.WebGLRenderCmd.prototype);\n    cc.inject(ccs.Skin.RenderCmd, proto);\n    proto.constructor = ccs.Skin.WebGLRenderCmd;\n})();\n"]}