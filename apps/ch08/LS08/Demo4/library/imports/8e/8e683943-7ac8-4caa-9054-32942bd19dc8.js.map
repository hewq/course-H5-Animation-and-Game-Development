{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/progress-timer/assets/frameworks/cocos2d-html5/cocos2d/progress-timer/CCProgressTimerCanvasRenderCmd.js"],"names":["cc","ProgressTimer","CanvasRenderCmd","renderableObject","_rootCtor","_needDraw","_PI180","Math","PI","_barRect","rect","_origin","p","_radius","_startAngle","_endAngle","_counterClockWise","_canUseDirtyRegion","proto","prototype","Object","create","Node","constructor","rendering","ctx","scaleX","scaleY","wrapper","_renderContext","context","getContext","node","_node","locSprite","_sprite","locTextureCoord","_renderCmd","_textureCoord","alpha","_displayedOpacity","width","height","_texture","validRect","setTransform","_worldTransform","setCompositeOperation","_blendFuncStr","setGlobalAlpha","locRect","_rect","locOffsetPosition","_offsetPosition","locX","x","locY","y","locWidth","locHeight","save","_flippedX","scale","_flippedY","_type","TYPE_BAR","locBarRect","beginPath","clip","closePath","TYPE_RADIAL","locOriginX","locOriginY","arc","lineTo","texture","_textureToRender","image","getHtmlElementObj","_colorized","drawImage","renderX","renderY","restore","g_NumberOfDraws","releaseData","resetVertexData","_updateProgress","setDirtyFlag","_dirtyFlags","contentDirty","sw","sh","locMidPoint","_midPoint","round","sqrt","locStartAngle","locEndAngle","locCounterClockWise","locOrigin","_reverseDirection","_percentage","locBarChangeRate","_barChangeRate","percentageF","drewSize","size","drawingSize","currentDrawSize","startPoint","needToLeft","needToTop","flipXNeed","flipYNeed","_syncStatus","parentCmd","flags","locFlag","_dirtyFlag","parentNode","_cascadeColorEnabled","colorDirty","_cascadeOpacityEnabled","opacityDirty","transformDirty","spriteCmd","spriteFlag","_syncDisplayColor","_syncDisplayOpacity","_updateColor","transform","orderDirty","updateStatus","_updateDisplayColor","_updateDisplayOpacity","getParentRenderCmd","_notifyRegionStatus","RegionStatus","Dirty"],"mappings":"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","file":"CCProgressTimerCanvasRenderCmd.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/progress-timer","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * cc.ProgressTimer's rendering objects of Canvas\n */\n(function () {\n    cc.ProgressTimer.CanvasRenderCmd = function (renderableObject) {\n        this._rootCtor(renderableObject);\n        this._needDraw = true;\n\n        this._PI180 = Math.PI / 180;\n        this._barRect = cc.rect(0, 0, 0, 0);\n        this._origin = cc.p(0, 0);\n        this._radius = 0;\n        this._startAngle = 270;\n        this._endAngle = 270;\n        this._counterClockWise = false;\n        this._canUseDirtyRegion = true;\n    };\n\n    var proto = cc.ProgressTimer.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n    proto.constructor = cc.ProgressTimer.CanvasRenderCmd;\n\n    proto.rendering = function (ctx, scaleX, scaleY) {\n        var wrapper = ctx || cc._renderContext, context = wrapper.getContext(), node = this._node, locSprite = node._sprite;\n        var locTextureCoord = locSprite._renderCmd._textureCoord, alpha = locSprite._renderCmd._displayedOpacity / 255;\n\n        if (locTextureCoord.width === 0 || locTextureCoord.height === 0)\n            return;\n        if (!locSprite._texture || !locTextureCoord.validRect || alpha === 0)\n            return;\n\n        wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n        wrapper.setCompositeOperation(locSprite._blendFuncStr);\n        wrapper.setGlobalAlpha(alpha);\n\n        var locRect = locSprite._rect, locOffsetPosition = locSprite._offsetPosition;\n        var locX = locOffsetPosition.x,\n            locY = -locOffsetPosition.y - locRect.height,\n            locWidth = locRect.width,\n            locHeight = locRect.height;\n\n        wrapper.save();\n        if (locSprite._flippedX) {\n            locX = -locX - locWidth;\n            context.scale(-1, 1);\n        }\n        if (locSprite._flippedY) {\n            locY = locOffsetPosition.y;\n            context.scale(1, -1);\n        }\n\n        //clip\n        if (node._type === cc.ProgressTimer.TYPE_BAR) {\n            var locBarRect = this._barRect;\n            context.beginPath();\n            context.rect(locBarRect.x, locBarRect.y, locBarRect.width, locBarRect.height);\n            context.clip();\n            context.closePath();\n        } else if (node._type === cc.ProgressTimer.TYPE_RADIAL) {\n            var locOriginX = this._origin.x;\n            var locOriginY = this._origin.y;\n            context.beginPath();\n            context.arc(locOriginX, locOriginY, this._radius, this._PI180 * this._startAngle, this._PI180 * this._endAngle, this._counterClockWise);\n            context.lineTo(locOriginX, locOriginY);\n            context.clip();\n            context.closePath();\n        }\n\n        //draw sprite\n        var texture = locSprite._renderCmd._textureToRender || locSprite._texture;\n        var image = texture.getHtmlElementObj();\n        if (locSprite._renderCmd._colorized) {\n            context.drawImage(image,\n                0, 0, locTextureCoord.width, locTextureCoord.height,\n                locX, locY, locWidth, locHeight);\n        } else {\n            context.drawImage(image,\n                locTextureCoord.renderX, locTextureCoord.renderY, locTextureCoord.width, locTextureCoord.height,\n                locX, locY, locWidth, locHeight);\n        }\n        wrapper.restore();\n        cc.g_NumberOfDraws++;\n    };\n\n    proto.releaseData = function () {\n    };\n\n    proto.resetVertexData = function () {\n    };\n\n    proto._updateProgress = function () {\n        this.setDirtyFlag(cc.Node._dirtyFlags.contentDirty);\n        var node = this._node;\n        var locSprite = node._sprite;\n        var sw = locSprite.width, sh = locSprite.height;\n        var locMidPoint = node._midPoint;\n\n        if (node._type === cc.ProgressTimer.TYPE_RADIAL) {\n            this._radius = Math.round(Math.sqrt(sw * sw + sh * sh));\n            var locStartAngle, locEndAngle, locCounterClockWise = false, locOrigin = this._origin;\n            locOrigin.x = sw * locMidPoint.x;\n            locOrigin.y = -sh * locMidPoint.y;\n\n            if (node._reverseDirection) {\n                locEndAngle = 270;\n                locStartAngle = 270 - 3.6 * node._percentage;\n            } else {\n                locStartAngle = -90;\n                locEndAngle = -90 + 3.6 * node._percentage;\n            }\n\n            if (locSprite._flippedX) {\n                locOrigin.x -= sw * (node._midPoint.x * 2);\n                locStartAngle = -locStartAngle;\n                locEndAngle = -locEndAngle;\n                locStartAngle -= 180;\n                locEndAngle -= 180;\n                locCounterClockWise = !locCounterClockWise;\n            }\n            if (locSprite._flippedY) {\n                locOrigin.y += sh * (node._midPoint.y * 2);\n                locCounterClockWise = !locCounterClockWise;\n                locStartAngle = -locStartAngle;\n                locEndAngle = -locEndAngle;\n            }\n\n            this._startAngle = locStartAngle;\n            this._endAngle = locEndAngle;\n            this._counterClockWise = locCounterClockWise;\n        } else {\n            var locBarChangeRate = node._barChangeRate;\n            var percentageF = node._percentage / 100;\n            var locBarRect = this._barRect;\n\n            var drewSize = cc.size((sw * (1 - locBarChangeRate.x)), (sh * (1 - locBarChangeRate.y)));\n            var drawingSize = cc.size((sw - drewSize.width) * percentageF, (sh - drewSize.height) * percentageF);\n            var currentDrawSize = cc.size(drewSize.width + drawingSize.width, drewSize.height + drawingSize.height);\n\n            var startPoint = cc.p(sw * locMidPoint.x, sh * locMidPoint.y);\n\n            var needToLeft = startPoint.x - currentDrawSize.width / 2;\n            if ((locMidPoint.x > 0.5) && (currentDrawSize.width / 2 >= sw - startPoint.x))\n                needToLeft = sw - currentDrawSize.width;\n\n            var needToTop = startPoint.y - currentDrawSize.height / 2;\n            if ((locMidPoint.y > 0.5) && (currentDrawSize.height / 2 >= sh - startPoint.y))\n                needToTop = sh - currentDrawSize.height;\n\n            //left pos\n            locBarRect.x = 0;\n            var flipXNeed = 1;\n            if (locSprite._flippedX) {\n                locBarRect.x -= currentDrawSize.width;\n                flipXNeed = -1;\n            }\n\n            if (needToLeft > 0)\n                locBarRect.x += needToLeft * flipXNeed;\n\n            //right pos\n            locBarRect.y = 0;\n            var flipYNeed = 1;\n            if (locSprite._flippedY) {\n                locBarRect.y += currentDrawSize.height;\n                flipYNeed = -1;\n            }\n\n            if (needToTop > 0)\n                locBarRect.y -= needToTop * flipYNeed;\n\n            //clip width and clip height\n            locBarRect.width = currentDrawSize.width;\n            locBarRect.height = -currentDrawSize.height;\n        }\n    };\n\n    proto._syncStatus = function (parentCmd) {\n        var node = this._node;\n        if (!node._sprite)\n            return;\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        var parentNode = parentCmd ? parentCmd._node : null;\n\n        if (parentNode && parentNode._cascadeColorEnabled && (parentCmd._dirtyFlag & flags.colorDirty))\n            locFlag |= flags.colorDirty;\n\n        if (parentNode && parentNode._cascadeOpacityEnabled && (parentCmd._dirtyFlag & flags.opacityDirty))\n            locFlag |= flags.opacityDirty;\n\n        if (parentCmd && (parentCmd._dirtyFlag & flags.transformDirty))\n            locFlag |= flags.transformDirty;\n\n        this._dirtyFlag = locFlag;\n\n        var spriteCmd = node._sprite._renderCmd;\n        var spriteFlag = spriteCmd._dirtyFlag;\n\n        var colorDirty = spriteFlag & flags.colorDirty,\n            opacityDirty = spriteFlag & flags.opacityDirty;\n\n        if (colorDirty) {\n            spriteCmd._syncDisplayColor();\n            spriteCmd._dirtyFlag &= ~flags.colorDirty;\n            this._dirtyFlag &= ~flags.colorDirty;\n        }\n\n        if (opacityDirty) {\n            spriteCmd._syncDisplayOpacity();\n            spriteCmd._dirtyFlag &= ~flags.opacityDirty;\n            this._dirtyFlag &= ~flags.opacityDirty;\n        }\n\n        if (colorDirty || opacityDirty) {\n            spriteCmd._updateColor();\n        }\n\n        if (locFlag & flags.transformDirty) {\n            //update the transform\n            this.transform(parentCmd);\n        }\n\n        if (locFlag & flags.orderDirty) {\n            this._dirtyFlag &= ~flags.orderDirty;\n        }\n    };\n\n    proto.updateStatus = function () {\n        var node = this._node;\n        if (!node._sprite)\n            return;\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        var spriteCmd = node._sprite._renderCmd;\n        var spriteFlag = spriteCmd._dirtyFlag;\n\n        var colorDirty = spriteFlag & flags.colorDirty,\n            opacityDirty = spriteFlag & flags.opacityDirty;\n\n        if (colorDirty) {\n            spriteCmd._updateDisplayColor();\n            spriteCmd._dirtyFlag = spriteCmd._dirtyFlag & flags.colorDirty ^ spriteCmd._dirtyFlag;\n            this._dirtyFlag = this._dirtyFlag & flags.colorDirty ^ this._dirtyFlag;\n        }\n\n        if (opacityDirty) {\n            spriteCmd._updateDisplayOpacity();\n            spriteCmd._dirtyFlag = spriteCmd._dirtyFlag & flags.opacityDirty ^ spriteCmd._dirtyFlag;\n            this._dirtyFlag = this._dirtyFlag & flags.opacityDirty ^ this._dirtyFlag;\n        }\n\n        if (colorDirty || opacityDirty) {\n            spriteCmd._updateColor();\n        }\n\n        if (locFlag & flags.transformDirty) {\n            //update the transform\n            this.transform(this.getParentRenderCmd(), true);\n        }\n        if(locFlag & flags.contentDirty) {\n            this._notifyRegionStatus && this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);\n        }\n        this._dirtyFlag = 0;\n    };\n})();\n"]}