{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/extensions/spine/assets/frameworks/cocos2d-html5/extensions/spine/CCSkeletonWebGLRenderCmd.js"],"names":["spine","sp","Skeleton","WebGLRenderCmd","renderableObject","_rootCtor","_needDraw","_matrix","cc","math","Matrix4","identity","_currTexture","_currBlendFunc","vertexType","renderer","VertexType","CUSTOM","setShaderProgram","shaderCache","programForKey","SHADER_SPRITE_POSITION_TEXTURECOLOR","proto","prototype","Object","create","Node","constructor","uploadData","f32buffer","ui32buffer","vertexDataOffset","node","_node","color","_displayedColor","locSkeleton","_skeleton","attachment","slot","i","n","premultiAlpha","_premultipliedAlpha","r","g","b","a","_displayedOpacity","debugSlotsInfo","_debugSlots","drawOrder","length","vertCount","RegionAttachment","MeshAttachment","regionUVs","regionTextureAtlas","getTextureAtlas","texture","getRealTexture","batchBroken","_updateBatchedInfo","_getBlendFunc","data","blendMode","_glProgramState","uploadAll","BATCH_VERTEX_COUNT","_batchRendering","slotDebugPoints","_uploadRegionAttachmentData","_uploadMeshAttachmentData","_increaseBatchingSize","TRIANGLE","triangles","_debugBones","wt","_worldTransform","mat","c","tx","d","ty","kmGLMatrixMode","KM_GL_MODELVIEW","current_stack","stack","push","top","drawingUtil","_drawingUtil","setDrawColor","setLineWidth","slots","points","drawPoly","bone","bones","x","worldX","y","worldY","drawLine","p","setPointSize","drawPoint","kmGLPopMatrix","ret","BlendMode","Normal","src","ONE","SRC_ALPHA","dst","ONE_MINUS_SRC_ALPHA","Additive","Multiply","DST_COLOR","Screen","ONE_MINUS_SRC_COLOR","_blendFunc","_createChildFormSkeletonData","_updateChild","premultipliedAlpha","nodeColor","nodeR","nodeG","nodeB","nodeA","vertices","Utils","setArraySize","Array","computeWorldVertices","uvs","skeleton","skeletonColor","slotColor","regionColor","alpha","multiplier","colors","tempColor","set","wa","wb","wc","wd","wx","wy","z","vertexZ","offset","srcIdx","vx","vy","VERTEX","OX1","OY1","OX2","OY2","OX3","OY3","OX4","OY4","verticesLength","worldVerticesLength","meshColor"],"mappings":"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","file":"CCSkeletonWebGLRenderCmd.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/extensions/spine","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n\nvar spine = sp.spine;\n\nsp.Skeleton.WebGLRenderCmd = function (renderableObject) {\n    this._rootCtor(renderableObject);\n    this._needDraw = true;\n    this._matrix = new cc.math.Matrix4();\n    this._matrix.identity();\n    this._currTexture = null;\n    this._currBlendFunc = {};\n    this.vertexType = cc.renderer.VertexType.CUSTOM;\n    this.setShaderProgram(cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR));\n};\n\nvar proto = sp.Skeleton.WebGLRenderCmd.prototype = Object.create(cc.Node.WebGLRenderCmd.prototype);\nproto.constructor = sp.Skeleton.WebGLRenderCmd;\n\nproto.uploadData = function (f32buffer, ui32buffer, vertexDataOffset){\n    var node = this._node;\n    var color = this._displayedColor, locSkeleton = node._skeleton;\n\n    var attachment, slot, i, n;\n    var premultiAlpha = node._premultipliedAlpha;\n\n    locSkeleton.r = color.r / 255;\n    locSkeleton.g = color.g / 255;\n    locSkeleton.b = color.b / 255;\n    locSkeleton.a = this._displayedOpacity / 255;\n    if (premultiAlpha) {\n        locSkeleton.r *= locSkeleton.a;\n        locSkeleton.g *= locSkeleton.a;\n        locSkeleton.b *= locSkeleton.a;\n    }\n\n    var debugSlotsInfo = null;\n    if (this._node._debugSlots) {\n        debugSlotsInfo = [];\n    }\n\n    for (i = 0, n = locSkeleton.drawOrder.length; i < n; i++) {\n        slot = locSkeleton.drawOrder[i];\n        if (!slot.attachment)\n            continue;\n        attachment = slot.attachment;\n\n        // get the vertices length\n        var vertCount = 0;\n        if (attachment instanceof spine.RegionAttachment) {\n            vertCount = 6; // a quad = two triangles = six vertices\n        }\n        else if (attachment instanceof spine.MeshAttachment) {\n            vertCount = attachment.regionUVs.length / 2;\n        }\n        else {\n            continue;\n        }\n\n        // no vertices to render\n        if (vertCount === 0) {\n            continue;\n        }\n\n        var regionTextureAtlas = node.getTextureAtlas(attachment);\n\n        // Broken for changing batch info\n        this._currTexture = regionTextureAtlas.texture.getRealTexture();\n        var batchBroken = cc.renderer._updateBatchedInfo(this._currTexture, this._getBlendFunc(slot.data.blendMode, premultiAlpha), this._glProgramState);\n\n        // keep the same logic with RendererWebGL.js, avoid vertex data overflow\n        var uploadAll = vertexDataOffset / 6 + vertCount > (cc.BATCH_VERTEX_COUNT - 200) * 0.5;\n        // Broken for vertex data overflow\n        if (!batchBroken && uploadAll) {\n            // render the cached data\n            cc.renderer._batchRendering();\n            batchBroken = true;\n        }\n        if (batchBroken) {\n            vertexDataOffset = 0;\n        }\n\n        // update the vertex buffer\n        var slotDebugPoints = null;\n        if (attachment instanceof spine.RegionAttachment) {\n            slotDebugPoints = this._uploadRegionAttachmentData(attachment, slot, premultiAlpha, f32buffer, ui32buffer, vertexDataOffset);\n        }\n        else if (attachment instanceof spine.MeshAttachment) {\n            this._uploadMeshAttachmentData(attachment, slot, premultiAlpha, f32buffer, ui32buffer, vertexDataOffset);\n        }\n        else {\n            continue;\n        }\n\n        if (this._node._debugSlots) {\n            debugSlotsInfo[i] = slotDebugPoints;\n        }\n\n        // update the index buffer\n        if (attachment instanceof spine.RegionAttachment) {\n            cc.renderer._increaseBatchingSize(vertCount, cc.renderer.VertexType.TRIANGLE);\n        } else {\n            cc.renderer._increaseBatchingSize(vertCount, cc.renderer.VertexType.CUSTOM, attachment.triangles);\n        }\n\n        // update the index data\n        vertexDataOffset += vertCount * 6;\n    }\n\n    if (node._debugBones || node._debugSlots) {\n        // flush previous vertices\n        cc.renderer._batchRendering();\n\n        var wt = this._worldTransform, mat = this._matrix.mat;\n        mat[0] = wt.a;\n        mat[4] = wt.c;\n        mat[12] = wt.tx;\n        mat[1] = wt.b;\n        mat[5] = wt.d;\n        mat[13] = wt.ty;\n        cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);\n        cc.current_stack.stack.push(cc.current_stack.top);\n        cc.current_stack.top = this._matrix;\n        var drawingUtil = cc._drawingUtil;\n\n        if (node._debugSlots && debugSlotsInfo && debugSlotsInfo.length > 0) {\n            // Slots.\n            drawingUtil.setDrawColor(0, 0, 255, 255);\n            drawingUtil.setLineWidth(1);\n\n            for (i = 0, n = locSkeleton.slots.length; i < n; i++) {\n                var points = debugSlotsInfo[i];\n                if (points) {\n                    drawingUtil.drawPoly(points, 4, true);\n                }\n            }\n        }\n\n        if (node._debugBones) {\n            // Bone lengths.\n            var bone;\n            drawingUtil.setLineWidth(2);\n            drawingUtil.setDrawColor(255, 0, 0, 255);\n\n            for (i = 0, n = locSkeleton.bones.length; i < n; i++) {\n                bone = locSkeleton.bones[i];\n                var x = bone.data.length * bone.a + bone.worldX;\n                var y = bone.data.length * bone.c + bone.worldY;\n                drawingUtil.drawLine(cc.p(bone.worldX, bone.worldY), cc.p(x, y));\n            }\n\n            // Bone origins.\n            drawingUtil.setPointSize(4);\n            drawingUtil.setDrawColor(0, 0, 255, 255); // Root bone is blue.\n\n            for (i = 0, n = locSkeleton.bones.length; i < n; i++) {\n                bone = locSkeleton.bones[i];\n                drawingUtil.drawPoint(cc.p(bone.worldX, bone.worldY));\n                if (i == 0) {\n                    drawingUtil.setDrawColor(0, 255, 0, 255);\n                }\n            }\n        }\n        cc.kmGLPopMatrix();\n    }\n\n    return 0;\n};\n\nproto._getBlendFunc = function (blendMode, premultiAlpha) {\n    var ret = this._currBlendFunc;\n    switch (blendMode) {\n        case spine.BlendMode.Normal:\n            ret.src = premultiAlpha ? cc.ONE : cc.SRC_ALPHA;\n            ret.dst = cc.ONE_MINUS_SRC_ALPHA;\n            break;\n        case spine.BlendMode.Additive:\n            ret.src = premultiAlpha ? cc.ONE : cc.SRC_ALPHA;\n            ret.dst = cc.ONE;\n            break;\n        case spine.BlendMode.Multiply:\n            ret.src = cc.DST_COLOR;\n            ret.dst = cc.ONE_MINUS_SRC_ALPHA;\n            break;\n        case spine.BlendMode.Screen:\n            ret.src = cc.ONE;\n            ret.dst = cc.ONE_MINUS_SRC_COLOR;\n            break;\n        default:\n            ret = this._node._blendFunc;\n            break;\n    }\n\n    return ret;\n};\n\nproto._createChildFormSkeletonData = function(){};\n\nproto._updateChild = function(){};\n\nproto._uploadRegionAttachmentData = function(attachment, slot, premultipliedAlpha, f32buffer, ui32buffer, vertexDataOffset) {\n    // the vertices in format:\n    // [\n    //   X1, Y1, C1R, C1G, C1B, C1A, U1, V1,    // bottom left\n    //   X2, Y2, C2R, C2G, C2B, C2A, U2, V2,    // top left\n    //   X3, Y3, C3R, C3G, C3B, C3A, U3, V3,    // top right\n    //   X4, Y4, C4R, C4G, C4B, C4A, U4, V4     // bottom right\n    // ]\n    //\n    var nodeColor = this._displayedColor;\n    var nodeR = nodeColor.r,\n        nodeG = nodeColor.g,\n        nodeB = nodeColor.b,\n        nodeA = this._displayedOpacity;\n\n    var vertices = spine.Utils.setArraySize(new Array(), 8, 0);\n    attachment.computeWorldVertices(slot.bone, vertices, 0, 2);\n\n    var uvs = attachment.uvs;\n\n    // get the colors data\n    var skeleton = slot.bone.skeleton;\n    var skeletonColor = skeleton.color;\n    var slotColor = slot.color;\n    var regionColor = attachment.color;\n    var alpha = skeletonColor.a * slotColor.a * regionColor.a;\n    var multiplier = premultipliedAlpha ? alpha : 1;\n    var colors = attachment.tempColor;\n    colors.set(skeletonColor.r * slotColor.r * regionColor.r * multiplier,\n        skeletonColor.g * slotColor.g * regionColor.g * multiplier,\n        skeletonColor.b * slotColor.b * regionColor.b * multiplier,\n        alpha);\n    \n    var wt = this._worldTransform,\n        wa = wt.a, wb = wt.b, wc = wt.c, wd = wt.d,\n        wx = wt.tx, wy = wt.ty,\n        z = this._node.vertexZ;\n\n    var offset = vertexDataOffset;\n    // generate 6 vertices data (two triangles) from the quad vertices\n    // using two angles : (0, 1, 2) & (0, 2, 3)\n    for (var i = 0; i < 6; i++) {\n        var srcIdx = i < 4 ? i % 3 : i - 2;\n        var vx = vertices[srcIdx * 2],\n            vy = vertices[srcIdx * 2 + 1];\n        var x = vx * wa + vy * wc + wx,\n            y = vx * wb + vy * wd + wy;\n        var r = colors.r * nodeR,\n            g = colors.g * nodeG,\n            b = colors.b * nodeB,\n            a = colors.a * nodeA;\n        var color = ((a<<24) | (b<<16) | (g<<8) | r);\n        f32buffer[offset] = x;\n        f32buffer[offset + 1] = y;\n        f32buffer[offset + 2] = z;\n        ui32buffer[offset + 3] = color;\n        f32buffer[offset + 4] = uvs[srcIdx * 2];\n        f32buffer[offset + 5] = uvs[srcIdx * 2 + 1];\n        offset += 6;\n    }\n\n    if (this._node._debugSlots) {\n        // return the quad points info if debug slot enabled\n        var VERTEX = spine.RegionAttachment;\n        return [\n            cc.p(vertices[VERTEX.OX1], vertices[VERTEX.OY1]),\n            cc.p(vertices[VERTEX.OX2], vertices[VERTEX.OY2]),\n            cc.p(vertices[VERTEX.OX3], vertices[VERTEX.OY3]),\n            cc.p(vertices[VERTEX.OX4], vertices[VERTEX.OY4])\n        ];\n    }\n};\n\nproto._uploadMeshAttachmentData = function(attachment, slot, premultipliedAlpha, f32buffer, ui32buffer, vertexDataOffset) {\n    var wt = this._worldTransform,\n        wa = wt.a, wb = wt.b, wc = wt.c, wd = wt.d,\n        wx = wt.tx, wy = wt.ty,\n        z = this._node.vertexZ;\n    // get the vertex data\n    var verticesLength = attachment.worldVerticesLength;\n    var vertices = spine.Utils.setArraySize(new Array(), verticesLength, 0);\n    attachment.computeWorldVertices(slot, 0, verticesLength, vertices, 0, 2);\n\n    var uvs = attachment.uvs;\n\n    // get the colors data\n    var skeleton = slot.bone.skeleton;\n    var skeletonColor = skeleton.color, slotColor = slot.color, meshColor = attachment.color;\n    var alpha = skeletonColor.a * slotColor.a * meshColor.a;\n    var multiplier = premultipliedAlpha ? alpha : 1;\n    var colors = attachment.tempColor;\n    colors.set(skeletonColor.r * slotColor.r * meshColor.r * multiplier,\n        skeletonColor.g * slotColor.g * meshColor.g * multiplier,\n        skeletonColor.b * slotColor.b * meshColor.b * multiplier,\n        alpha);\n            \n    var offset = vertexDataOffset;\n    var nodeColor = this._displayedColor;\n    var nodeR = nodeColor.r,\n        nodeG = nodeColor.g,\n        nodeB = nodeColor.b,\n        nodeA = this._displayedOpacity;\n    for (var i = 0, n = vertices.length; i < n; i += 2) {\n        var vx = vertices[i],\n            vy = vertices[i + 1];\n        var x = vx * wa + vy * wb + wx,\n            y = vx * wc + vy * wd + wy;\n        var r = colors.r * nodeR,\n            g = colors.g * nodeG,\n            b = colors.b * nodeB,\n            a = colors.a * nodeA;\n        var color = ((a<<24) | (b<<16) | (g<<8) | r);\n\n        f32buffer[offset] = x;\n        f32buffer[offset + 1] = y;\n        f32buffer[offset + 2] = z;\n        ui32buffer[offset + 3] = color;\n        f32buffer[offset + 4] = uvs[i];\n        f32buffer[offset + 5] = uvs[i + 1];\n        offset += 6;\n    }\n};\n\n})();\n"]}