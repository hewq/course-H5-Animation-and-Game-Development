{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/timeline/assets/frameworks/cocos2d-html5/extensions/cocostudio/timeline/CCSkeletonNode.js"],"names":["ccs","SkeletonNode","BoneNode","type","p","cc","size","rect","extend","_subBonesMap","_squareVertices","_squareColors","_noMVPVertices","_skinGroupMap","_sortedAllBonesDirty","_sortedAllBones","_batchedBoneVetices","_batchedBoneColors","_batchedVeticesCount","_batchBoneCommand","_subOrderedAllBones","ctor","x","y","_rootSkeleton","prototype","call","_rackLength","_rackWidth","_updateVertices","getBoneNode","boneName","item","getAllSubBonesMap","changeSkins","boneSkinNameMap","boneSkin","name","bone","displaySkin","suit","_suitMap","addSkinGroup","groupName","getBoundingBox","minx","miny","maxx","maxy","boundingBox","getVisibleSkinsRect","first","width","height","rectGetMinX","rectGetMinY","rectGetMaxX","rectGetMaxY","allBones","getAllSubBones","i","length","r","rectApplyAffineTransform","getNodeToParentTransform","getRootSkeletonNode","Math","min","max","_visit","parentCmd","cmd","_renderCmd","getParentRenderCmd","_visible","_propagateFlagsDown","_syncStatus","node","_children","visit","_checkSubBonesDirty","subOrderedAllBones","subOrderedBone","subOrderedBoneCmd","_visitSkins","_debug","renderer","pushRenderCommand","_drawNode","_dirtyFlag","_subBonesDirty","_updateOrderedAllbones","_subBonesOrderDirty","_sortOrderedAllBones","boneStack","childBones","_childBones","isVisible","push","top","pop","topCmd","topChildren","getChildBones","childbone","_sortArray","squareVertices","anchorPointInPoints","_anchorPointInPoints","radiusl","radiusw","radiusl_2","radiusw_2","_updateAllDrawBones","_subDrawBones","isDebugDrawEnabled","create"],"mappings":"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","file":"CCSkeletonNode.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/timeline","sourcesContent":["/****************************************************************************\n Copyright (c) 2015-2016 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n//9980397\n\n/**\n * SkeletonNode\n * base class\n * @class\n */\nccs.SkeletonNode = (function () {\n\n    var BoneNode = ccs.BoneNode;\n\n    var type = {\n        p: cc.p,\n        size: cc.size,\n        rect: cc.rect\n    };\n\n    var SkeletonNode = BoneNode.extend(/** @lends ccs.SkeletonNode# */{\n        _subBonesMap: null,\n\n        _squareVertices: null,\n        _squareColors: null,\n        _noMVPVertices: null,\n        _skinGroupMap: null,\n\n        _sortedAllBonesDirty: false,\n        _sortedAllBones: null,\n        _batchedBoneVetices: null,\n        _batchedBoneColors: null,\n        _batchedVeticesCount: null,\n        _batchBoneCommand: null,\n        _subOrderedAllBones: null,\n\n        ctor: function () {\n            this._squareVertices = [\n                {x: 0, y: 0}, {x: 0, y: 0}, {x: 0, y: 0}, {x: 0, y: 0},\n                {x: 0, y: 0}, {x: 0, y: 0}, {x: 0, y: 0}, {x: 0, y: 0}\n            ];\n            this._rootSkeleton = this;\n            BoneNode.prototype.ctor.call(this);\n            this._subBonesMap = {};\n            this._subOrderedAllBones = [];\n\n            this._skinGroupMap = {};\n\n            this._rackLength = this._rackWidth = 20;\n            this._updateVertices();\n        },\n\n        getBoneNode: function (boneName) {\n            var item = this._subBonesMap[boneName];\n            if (item)\n                return item;\n            return null;\n        },\n\n        getAllSubBonesMap: function () {\n            return this._subBonesMap;\n        },\n\n        changeSkins: function (boneSkinNameMap) {\n            //boneSkinNameMap\n            //suitName\n            if (typeof boneSkinNameMap === \"object\") {\n                var boneSkin;\n                for (var name in boneSkinNameMap) {\n                    boneSkin = boneSkinNameMap[name];\n                    var bone = this.getBoneNode(name);\n                    if (null !== bone)\n                        bone.displaySkin(boneSkin, true);\n                }\n            } else {\n                var suit = this._suitMap[boneSkinNameMap/*suitName*/];\n                if (suit)\n                    this.changeSkins(suit, true);\n            }\n        },\n\n        addSkinGroup: function (groupName, boneSkinNameMap) {\n            this._skinGroupMap[groupName] = boneSkinNameMap;\n        },\n\n        getBoundingBox: function () {\n            var minx, miny, maxx, maxy = 0;\n            minx = miny = maxx = maxy;\n            var boundingBox = this.getVisibleSkinsRect();\n            var first = true;\n            if (boundingBox.x !== 0 || boundingBox.y !== 0 || boundingBox.width !== 0 || boundingBox.height !== 0) {\n                minx = cc.rectGetMinX(boundingBox);\n                miny = cc.rectGetMinY(boundingBox);\n                maxx = cc.rectGetMaxX(boundingBox);\n                maxy = cc.rectGetMaxY(boundingBox);\n                first = false;\n            }\n            var allBones = this.getAllSubBones();\n            for (var bone, i = 0; i < allBones.length; i++) {\n                bone = allBones[i];\n                var r = cc.rectApplyAffineTransform(bone.getVisibleSkinsRect(), bone.getNodeToParentTransform(bone.getRootSkeletonNode()));\n                if (r.x === 0 && r.y === 0 && r.width === 0 && r.height === 0)\n                    continue;\n\n                if (first) {\n                    minx = cc.rectGetMinX(r);\n                    miny = cc.rectGetMinY(r);\n                    maxx = cc.rectGetMaxX(r);\n                    maxy = cc.rectGetMaxY(r);\n\n                    first = false;\n                } else {\n                    minx = Math.min(cc.rectGetMinX(r), minx);\n                    miny = Math.min(cc.rectGetMinY(r), miny);\n                    maxx = Math.max(cc.rectGetMaxX(r), maxx);\n                    maxy = Math.max(cc.rectGetMaxY(r), maxy);\n                }\n            }\n            boundingBox.x = minx;\n            boundingBox.y = miny;\n            boundingBox.width = maxx - minx;\n            boundingBox.height = maxy - miny;\n            return cc.rectApplyAffineTransform(boundingBox, this.getNodeToParentTransform());\n        },\n\n        _visit: function (parentCmd) {\n            var cmd = this._renderCmd;\n            parentCmd = parentCmd || cmd.getParentRenderCmd();\n\n            // quick return if not visible\n            if (!this._visible) {\n                cmd._propagateFlagsDown(parentCmd);\n                return;\n            }\n            cmd._syncStatus(parentCmd);\n\n            var i, node;\n            if (this._children.length !== 0) {\n                for (i = 0; i < this._children.length; i++) {\n                    node = this._children[i];\n                    node.visit(this);\n                }\n            }\n\n            this._checkSubBonesDirty();\n            var subOrderedAllBones = this._subOrderedAllBones,\n                subOrderedBone, subOrderedBoneCmd;\n            for (i = 0; i < subOrderedAllBones.length; i++) {\n                subOrderedBone = subOrderedAllBones[i];\n                subOrderedBone._visitSkins();\n            }\n\n            if (cmd._debug)\n                for (i = 0; i < subOrderedAllBones.length; i++) {\n                    subOrderedBoneCmd = subOrderedAllBones[i]._renderCmd;\n                    cc.renderer.pushRenderCommand(subOrderedBoneCmd._drawNode._renderCmd);\n                }\n            cmd._dirtyFlag = 0;\n        },\n\n        _checkSubBonesDirty: function () {\n            if (this._subBonesDirty) {\n                this._updateOrderedAllbones();\n                this._subBonesDirty = false;\n            }\n            if (this._subBonesOrderDirty) {\n                this._sortOrderedAllBones();\n                this._subBonesOrderDirty = false;\n            }\n        },\n\n        _updateOrderedAllbones: function () {\n            this._subOrderedAllBones.length = 0;\n            // update sub bones, get All Visible SubBones\n            // get all sub bones as visit with visible\n            var boneStack = [];\n            var childBones = this._childBones;\n            for (var bone, i = 0; i < childBones.length; i++) {\n                bone = childBones[i];\n                if (bone.isVisible())\n                    boneStack.push(bone);\n            }\n            while (boneStack.length > 0) {\n                var top = boneStack.pop();\n                var topCmd = top._renderCmd;\n                topCmd._syncStatus(topCmd.getParentRenderCmd());\n                this._subOrderedAllBones.push(top);\n\n                var topChildren = top.getChildBones();\n\n                for (var childbone, i = 0; i < topChildren.length; i++) {\n                    childbone = topChildren[i];\n                    if (childbone.isVisible())\n                        boneStack.push(childbone);\n                }\n            }\n        },\n\n        _sortOrderedAllBones: function () {\n            this._sortArray(this._subOrderedAllBones);\n        },\n\n        // protected\n        _updateVertices: function () {\n            var squareVertices = this._squareVertices,\n                anchorPointInPoints = this._renderCmd._anchorPointInPoints;\n            if (this._rackLength != squareVertices[6].x - anchorPointInPoints.x ||\n                this._rackWidth != squareVertices[3].y - anchorPointInPoints.y) {\n                var radiusl = this._rackLength * .5;\n                var radiusw = this._rackWidth * .5;\n                var radiusl_2 = radiusl * .25;\n                var radiusw_2 = radiusw * .25;\n                squareVertices[5].y = squareVertices[2].y = squareVertices[1].y = squareVertices[6].y\n                    = squareVertices[0].x = squareVertices[4].x = squareVertices[7].x = squareVertices[3].x = .0;\n                squareVertices[5].x = -radiusl; squareVertices[0].y = -radiusw;\n                squareVertices[6].x = radiusl;  squareVertices[3].y = radiusw;\n                squareVertices[1].x = radiusl_2; squareVertices[7].y = radiusw_2;\n                squareVertices[2].x = -radiusl_2; squareVertices[4].y = -radiusw_2;\n                for (var i = 0; i < squareVertices.length; i++) {\n                    squareVertices[i].x += anchorPointInPoints.x;\n                    squareVertices[i].y += anchorPointInPoints.y;\n                }\n            }\n        },\n\n        _updateAllDrawBones: function () {\n            this._subDrawBones = {}; //.clear()\n            for (var name in this._subBonesMap) {\n                var bone = this._subBonesMap[name];\n                if (bone.isVisible() && bone.isDebugDrawEnabled())\n                    this._subDrawBones.push(bone);\n            }\n            this._sortArray(this._sortedAllBones);\n            this._subDrawBones = false;\n        }\n\n    });\n\n    SkeletonNode.create = function () {\n        return new SkeletonNode;\n    };\n\n    return SkeletonNode;\n\n})();\n"]}