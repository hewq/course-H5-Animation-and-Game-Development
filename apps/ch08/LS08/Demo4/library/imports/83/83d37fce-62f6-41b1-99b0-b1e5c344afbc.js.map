{"version":3,"sources":["../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/jsb_loaders.js"],"names":["cc","_emptyLoader","load","realUrl","url","res","cb","loader","register","_txtLoader","result","jsb","fileUtils","getStringFromFile","_jsonLoader","data","JSON","parse","e","error","_imgLoader","loadImg","err","tex","cache","_plistLoader","content","plistParser","_binaryLoader","loadBinarySync","_fntLoader","INFO_EXP","COMMON_EXP","PAGE_EXP","CHAR_EXP","KERNING_EXP","ITEM_EXP","INT_EXP","_parseStrToObj","str","arr","match","obj","i","li","length","tempStr","index","indexOf","key","substring","value","parseInt","parseFnt","fntStr","self","fnt","infoObj","paddingArr","split","padding","left","top","right","bottom","commonObj","commonHeight","_renderType","_RENDER_TYPE_WEBGL","texSize","configuration","getMaxTextureSize","width","height","log","pageObj","atlasName","path","changeBasename","charLines","fontDefDictionary","charObj","charId","rect","x","y","xOffset","yOffset","xAdvance","kerningDict","kerningLines","kerningObj"],"mappings":"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","file":"jsb_loaders.js","sourceRoot":"../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script","sourcesContent":["/*\n * Copyright (c) 2014-2016 Chukong Technologies Inc.\n * Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n//\n// cocos2d loader plugins.\n//\n// This helper file should be required after jsb_cocos2d.js\n//\n\ncc._emptyLoader = {\n    load : function(realUrl, url, res, cb){\n        cb && cb(null, null);\n        return null;\n    }\n};\n\ncc.loader.register([\n                        \"mp3\", \"ogg\", \"wav\", \"mp4\", \"m4a\", \n                        \"font\", \"eot\", \"ttf\", \"woff\", \"svg\", \"gaf\"\n                    ], \n                    cc._emptyLoader);\n\ncc._txtLoader = {\n    load : function(realUrl, url, res, cb){\n        var result = jsb.fileUtils.getStringFromFile(realUrl);\n        cb && cb(null, result);\n        return result;\n    }\n};\ncc.loader.register([\"txt\", \"xml\", \"vsh\", \"fsh\", \"tmx\", \"tsx\"], cc._txtLoader);\n\ncc._jsonLoader = {\n    load : function(realUrl, url, res, cb){\n        var data = jsb.fileUtils.getStringFromFile(realUrl), result;\n        try{\n            result = JSON.parse(data);\n        }catch(e){\n            cc.error(e);\n            result = null;\n        }\n        cb && cb(null, result);\n        return result;\n    }\n};\ncc.loader.register([\"json\", \"ExportJson\"], cc._jsonLoader);\n\ncc._imgLoader = {\n    load : function(realUrl, url, res, cb){\n        cc.loader.loadImg(realUrl, function(err, tex){\n            if(err) {\n                cb && cb(err);\n                return;\n            }\n            cc.loader.cache[url] = tex;\n            cb && cb(null, tex);\n        });\n    }\n};\ncc.loader.register([\"png\", \"jpg\", \"bmp\",\"jpeg\",\"gif\", \"webp\"], cc._imgLoader);\n\ncc._plistLoader = {\n    load : function(realUrl, url, res, cb){\n        var content = jsb.fileUtils.getStringFromFile(realUrl);\n        var result = cc.plistParser.parse(content);\n        cb && cb(null, result);\n        return result;\n    }\n};\ncc.loader.register([\"plist\"], cc._plistLoader);\n\ncc._binaryLoader = {\n    load : function(realUrl, url, res, cb){\n        var result = cc.loader.loadBinarySync(realUrl);\n        cb && cb(null, result);\n        return result;\n    }\n};\ncc.loader.register([\"ccbi\"], cc._binaryLoader);\n\n\ncc._fntLoader = {\n    INFO_EXP : /info [^\\n]*(\\n|$)/gi,\n    COMMON_EXP : /common [^\\n]*(\\n|$)/gi,\n    PAGE_EXP : /page [^\\n]*(\\n|$)/gi,\n    CHAR_EXP : /char [^\\n]*(\\n|$)/gi,\n    KERNING_EXP : /kerning [^\\n]*(\\n|$)/gi,\n    ITEM_EXP : /\\w+=[^ \\r\\n]+/gi,\n    INT_EXP : /^[\\-]?\\d+$/,\n\n    _parseStrToObj : function(str){\n        var arr = str.match(this.ITEM_EXP);\n        var obj = {};\n        if(arr){\n            for(var i = 0, li = arr.length; i < li; i++){\n                var tempStr = arr[i];\n                var index = tempStr.indexOf(\"=\");\n                var key = tempStr.substring(0, index);\n                var value = tempStr.substring(index + 1);\n                if(value.match(this.INT_EXP)) value = parseInt(value);\n                else if(value[0] == '\"') value = value.substring(1, value.length - 1);\n                obj[key] = value;\n            }\n        }\n        return obj;\n    },\n    parseFnt : function(fntStr, url){\n        var self = this, fnt = {};\n        //padding\n        var infoObj = self._parseStrToObj(fntStr.match(self.INFO_EXP)[0]);\n        var paddingArr = infoObj[\"padding\"].split(\",\");\n        var padding = {\n            left : parseInt(paddingArr[0]),\n            top : parseInt(paddingArr[1]),\n            right : parseInt(paddingArr[2]),\n            bottom : parseInt(paddingArr[3])\n        };\n\n        //common\n        var commonObj = self._parseStrToObj(fntStr.match(self.COMMON_EXP)[0]);\n        fnt.commonHeight = commonObj[\"lineHeight\"];\n        if (cc._renderType === cc._RENDER_TYPE_WEBGL) {\n            var texSize = cc.configuration.getMaxTextureSize();\n            if(commonObj[\"scaleW\"] > texSize.width || commonObj[\"scaleH\"] > texSize.height)\n                cc.log(\"cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported\");\n        }\n        if(commonObj[\"pages\"] !== 1) cc.log(\"cc.LabelBMFont._parseCommonArguments(): only supports 1 page\");\n\n        //page\n        var pageObj = self._parseStrToObj(fntStr.match(self.PAGE_EXP)[0]);\n        if(pageObj[\"id\"] !== 0) cc.log(\"cc.LabelBMFont._parseImageFileName() : file could not be found\");\n        fnt.atlasName = cc.path.changeBasename(url, pageObj[\"file\"]);\n\n        //char\n        var charLines = fntStr.match(self.CHAR_EXP);\n        var fontDefDictionary = fnt.fontDefDictionary = {};\n        for(var i = 0, li = charLines.length; i < li; i++){\n            var charObj = self._parseStrToObj(charLines[i]);\n            var charId = charObj[\"id\"];\n            fontDefDictionary[charId] = {\n                rect : {x : charObj[\"x\"], y : charObj[\"y\"], width : charObj[\"width\"], height : charObj[\"height\"]},\n                xOffset : charObj[\"xoffset\"],\n                yOffset : charObj[\"yoffset\"],\n                xAdvance : charObj[\"xadvance\"]\n            };\n        }\n\n        //kerning\n        var kerningDict = fnt.kerningDict = {};\n        var kerningLines = fntStr.match(self.KERNING_EXP);\n        if(kerningLines){\n            for(var i = 0, li = kerningLines.length; i < li; i++){\n                var kerningObj = self._parseStrToObj(kerningLines[i]);\n                kerningDict[(kerningObj[\"first\"] << 16) | (kerningObj[\"second\"] & 0xffff)] = kerningObj[\"amount\"];\n            }\n        }\n        return fnt;\n    },\n\n    load : function(realUrl, url, res, cb){\n        var data = jsb.fileUtils.getStringFromFile(realUrl), result = null;\n        if (data)\n            result = this.parseFnt(data, url);\n        cb && cb(null, result);\n        return result;\n    }\n};\ncc.loader.register([\"fnt\"], cc._fntLoader);\n"]}