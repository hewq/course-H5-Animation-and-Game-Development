{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/sprites/assets/frameworks/cocos2d-html5/cocos2d/core/sprites/CCSpriteWebGLRenderCmd.js"],"names":["cc","Sprite","WebGLRenderCmd","renderable","_rootCtor","_needDraw","_vertices","x","y","u","v","_color","Uint32Array","_dirty","_recursiveDirty","_shaderProgram","shaderCache","programForKey","SHADER_SPRITE_POSITION_TEXTURECOLOR","proto","prototype","Object","create","Node","constructor","_spriteCmdCtor","updateBlendFunc","blendFunc","setDirtyFlag","dirtyFlag","call","setDirtyRecursively","value","locChildren","_node","_children","child","l","length","i","_renderCmd","_setBatchNodeForAddChild","node","_batchNode","log","_LogInfos","Sprite_addChild","texture","_webTextureObj","textureAtlas","Sprite_addChild_2","appendChild","_reorderChildDirty","_setReorderChildDirtyRecursively","_handleTextureForRotatedTexture","isFrameDisplayed","frame","rectEqualToRect","getRect","_rect","getTexture","getName","_texture","pointEqualToPoint","getOffset","_unflippedOffsetPositionFromCenter","_textureLoadedCallback","sender","_textureLoaded","locRect","rect","width","height","_rectEqualToZero","setTextureRect","_rectRotated","setBatchNode","dispatchEvent","renderer","childrenOrderDirty","_setTextureCoords","needConvert","undefined","rectPointsToPixels","tex","uvs","atlasWidth","pixelsWidth","atlasHeight","pixelsHeight","left","right","top","bottom","tempSwap","FIX_ARTIFACTS_BY_STRECHING_TEXEL","_flippedX","_flippedY","_setColorDirty","_updateBlendFunc","Sprite__updateBlendFunc","_blendFunc","hasPremultipliedAlpha","src","ONE","dst","BLEND_DST","SRC_ALPHA","opacityModifyRGB","_setTexture","texSize","_contentSize","_checkTextureBoundary","rotated","url","_x","_y","error","RectWidth","RectHeight","transform","parentCmd","recursive","originTransform","lx","_offsetPosition","rx","by","ty","wt","_worldTransform","wtx","tx","wty","lxa","a","lxb","b","rxa","rxb","tyc","c","tyd","d","byc","byd","vertices","needDraw","locTexture","uploadData","f32buffer","ui32buffer","vertexDataOffset","_displayedOpacity","opacity","r","_displayedColor","g","_opacityModifyRGB","z","_vertexZ","len","vertex","offset"],"mappings":"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","file":"CCSpriteWebGLRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/sprites","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n//Sprite's WebGL render command\n(function () {\n\n    cc.Sprite.WebGLRenderCmd = function (renderable) {\n        this._rootCtor(renderable);\n        this._needDraw = true;\n\n        this._vertices = [\n            {x: 0, y: 0, u: 0, v: 0}, // tl\n            {x: 0, y: 0, u: 0, v: 0}, // bl\n            {x: 0, y: 0, u: 0, v: 0}, // tr\n            {x: 0, y: 0, u: 0, v: 0}  // br\n        ];\n        this._color = new Uint32Array(1);\n        this._dirty = false;\n        this._recursiveDirty = false;\n\n        this._shaderProgram = cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR);\n    };\n\n    var proto = cc.Sprite.WebGLRenderCmd.prototype = Object.create(cc.Node.WebGLRenderCmd.prototype);\n    proto.constructor = cc.Sprite.WebGLRenderCmd;\n    proto._spriteCmdCtor = cc.Sprite.WebGLRenderCmd;\n\n    proto.updateBlendFunc = function (blendFunc) {\n    };\n\n    proto.setDirtyFlag = function (dirtyFlag) {\n        cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this, dirtyFlag);\n        this._dirty = true;\n    };\n\n    proto.setDirtyRecursively = function (value) {\n        this._recursiveDirty = value;\n        this._dirty = value;\n        // recursively set dirty\n        var locChildren = this._node._children, child, l = locChildren ? locChildren.length : 0;\n        for (var i = 0; i < l; i++) {\n            child = locChildren[i];\n            (child instanceof cc.Sprite) && child._renderCmd.setDirtyRecursively(value);\n        }\n    };\n\n    proto._setBatchNodeForAddChild = function (child) {\n        var node = this._node;\n        if (node._batchNode) {\n            if (!(child instanceof cc.Sprite)) {\n                cc.log(cc._LogInfos.Sprite_addChild);\n                return false;\n            }\n            if (child.texture._webTextureObj !== node.textureAtlas.texture._webTextureObj)\n                cc.log(cc._LogInfos.Sprite_addChild_2);\n\n            //put it in descendants array of batch node\n            node._batchNode.appendChild(child);\n            if (!node._reorderChildDirty)\n                node._setReorderChildDirtyRecursively();\n        }\n        return true;\n    };\n\n    proto._handleTextureForRotatedTexture = function (texture) {\n        return texture;\n    };\n\n    proto.isFrameDisplayed = function (frame) {\n        var node = this._node;\n        return (cc.rectEqualToRect(frame.getRect(), node._rect) && frame.getTexture().getName() === node._texture.getName()\n        && cc.pointEqualToPoint(frame.getOffset(), node._unflippedOffsetPositionFromCenter));\n    };\n\n    proto._textureLoadedCallback = function (sender) {\n        if (this._textureLoaded)\n            return;\n\n        this._textureLoaded = true;\n        var locRect = this._rect;\n        if (!locRect) {\n            locRect = cc.rect(0, 0, sender.width, sender.height);\n        } else if (cc._rectEqualToZero(locRect)) {\n            locRect.width = sender.width;\n            locRect.height = sender.height;\n        }\n\n        this.texture = sender;\n        this.setTextureRect(locRect, this._rectRotated);\n\n        // by default use \"Self Render\".\n        // if the sprite is added to a batchnode, then it will automatically switch to \"batchnode Render\"\n        this.setBatchNode(this._batchNode);\n        this.dispatchEvent(\"load\");\n\n        // Force refresh the render command list\n        cc.renderer.childrenOrderDirty = true;\n    };\n\n    proto._setTextureCoords = function (rect, needConvert) {\n        if (needConvert === undefined)\n            needConvert = true;\n        if (needConvert)\n            rect = cc.rectPointsToPixels(rect);\n        var node = this._node;\n\n        var tex = node._batchNode ? node.textureAtlas.texture : node._texture;\n        var uvs = this._vertices;\n        if (!tex)\n            return;\n\n        var atlasWidth = tex.pixelsWidth;\n        var atlasHeight = tex.pixelsHeight;\n\n        var left, right, top, bottom, tempSwap;\n        if (node._rectRotated) {\n            if (cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL) {\n                left = (2 * rect.x + 1) / (2 * atlasWidth);\n                right = left + (rect.height * 2 - 2) / (2 * atlasWidth);\n                top = (2 * rect.y + 1) / (2 * atlasHeight);\n                bottom = top + (rect.width * 2 - 2) / (2 * atlasHeight);\n            } else {\n                left = rect.x / atlasWidth;\n                right = (rect.x + rect.height) / atlasWidth;\n                top = rect.y / atlasHeight;\n                bottom = (rect.y + rect.width) / atlasHeight;\n            }\n\n            if (node._flippedX) {\n                tempSwap = top;\n                top = bottom;\n                bottom = tempSwap;\n            }\n\n            if (node._flippedY) {\n                tempSwap = left;\n                left = right;\n                right = tempSwap;\n            }\n\n            uvs[0].u = right;  // tl\n            uvs[0].v = top;    // tl\n            uvs[1].u = left;   // bl\n            uvs[1].v = top;    // bl\n            uvs[2].u = right;  // tr\n            uvs[2].v = bottom; // tr\n            uvs[3].u = left;   // br\n            uvs[3].v = bottom; // br\n        } else {\n            if (cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL) {\n                left = (2 * rect.x + 1) / (2 * atlasWidth);\n                right = left + (rect.width * 2 - 2) / (2 * atlasWidth);\n                top = (2 * rect.y + 1) / (2 * atlasHeight);\n                bottom = top + (rect.height * 2 - 2) / (2 * atlasHeight);\n            } else {\n                left = rect.x / atlasWidth;\n                right = (rect.x + rect.width) / atlasWidth;\n                top = rect.y / atlasHeight;\n                bottom = (rect.y + rect.height) / atlasHeight;\n            }\n\n            if (node._flippedX) {\n                tempSwap = left;\n                left = right;\n                right = tempSwap;\n            }\n\n            if (node._flippedY) {\n                tempSwap = top;\n                top = bottom;\n                bottom = tempSwap;\n            }\n\n            uvs[0].u = left;   // tl\n            uvs[0].v = top;    // tl\n            uvs[1].u = left;   // bl\n            uvs[1].v = bottom; // bl\n            uvs[2].u = right;  // tr\n            uvs[2].v = top;    // tr\n            uvs[3].u = right;  // br\n            uvs[3].v = bottom; // br\n        }\n    };\n\n    proto._setColorDirty = function () {\n    };\n\n    proto._updateBlendFunc = function () {\n        if (this._batchNode) {\n            cc.log(cc._LogInfos.Sprite__updateBlendFunc);\n            return;\n        }\n\n        // it's possible to have an untextured sprite\n        var node = this._node,\n            blendFunc = node._blendFunc;\n        if (!node._texture || !node._texture.hasPremultipliedAlpha()) {\n            if (blendFunc.src === cc.ONE && blendFunc.dst === cc.BLEND_DST) {\n                blendFunc.src = cc.SRC_ALPHA;\n            }\n            node.opacityModifyRGB = false;\n        } else {\n            if (blendFunc.src === cc.SRC_ALPHA && blendFunc.dst === cc.BLEND_DST) {\n                blendFunc.src = cc.ONE;\n            }\n            node.opacityModifyRGB = true;\n        }\n    };\n\n    proto._setTexture = function (texture) {\n        var node = this._node;\n        if (node._texture !== texture) {\n            node._textureLoaded = texture ? texture._textureLoaded : false;\n            node._texture = texture;\n\n            // Update texture rect and blend func\n            if (texture) {\n                var texSize = texture._contentSize;\n                var rect = cc.rect(0, 0, texSize.width, texSize.height);\n                node.setTextureRect(rect);\n                this._updateBlendFunc();\n            }\n\n            if (node._textureLoaded) {\n                // Force refresh the render command list\n                cc.renderer.childrenOrderDirty = true;\n            }\n        }\n    };\n\n    proto._checkTextureBoundary = function (texture, rect, rotated) {\n        if (texture && texture.url) {\n            var _x, _y;\n            if (rotated) {\n                _x = rect.x + rect.height;\n                _y = rect.y + rect.width;\n            } else {\n                _x = rect.x + rect.width;\n                _y = rect.y + rect.height;\n            }\n            if (_x > texture.width) {\n                cc.error(cc._LogInfos.RectWidth, texture.url);\n            }\n            if (_y > texture.height) {\n                cc.error(cc._LogInfos.RectHeight, texture.url);\n            }\n        }\n    };\n\n    proto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n\n        var node = this._node,\n            lx = node._offsetPosition.x, rx = lx + node._rect.width,\n            by = node._offsetPosition.y, ty = by + node._rect.height,\n            wt = this._worldTransform,\n            wtx = wt.tx, wty = wt.ty,\n            lxa = lx * wt.a, lxb = lx * wt.b, rxa = rx * wt.a, rxb = rx * wt.b,\n            tyc = ty * wt.c, tyd = ty * wt.d, byc = by * wt.c, byd = by * wt.d;\n\n        var vertices = this._vertices;\n        vertices[0].x = lxa + tyc + wtx; // tl\n        vertices[0].y = lxb + tyd + wty;\n        vertices[1].x = lxa + byc + wtx; // bl\n        vertices[1].y = lxb + byd + wty;\n        vertices[2].x = rxa + tyc + wtx; // tr\n        vertices[2].y = rxb + tyd + wty;\n        vertices[3].x = rxa + byc + wtx; // br\n        vertices[3].y = rxb + byd + wty;\n    };\n\n    proto.needDraw = function () {\n        var node = this._node, locTexture = node._texture;\n        return (this._needDraw && locTexture);\n    };\n\n    proto.uploadData = function (f32buffer, ui32buffer, vertexDataOffset) {\n        var node = this._node, locTexture = node._texture;\n        if (!(locTexture && locTexture._textureLoaded && node._rect.width && node._rect.height) || !this._displayedOpacity)\n            return 0;\n\n        // Fill in vertex data with quad information (4 vertices for sprite)\n        var opacity = this._displayedOpacity;\n        var r = this._displayedColor.r,\n            g = this._displayedColor.g,\n            b = this._displayedColor.b;\n        if (node._opacityModifyRGB) {\n            var a = opacity / 255;\n            r *= a;\n            g *= a;\n            b *= a;\n        }\n        this._color[0] = ((opacity << 24) | (b << 16) | (g << 8) | r);\n        var z = node._vertexZ;\n\n        var vertices = this._vertices;\n        var i, len = vertices.length, vertex, offset = vertexDataOffset;\n        for (i = 0; i < len; ++i) {\n            vertex = vertices[i];\n            f32buffer[offset] = vertex.x;\n            f32buffer[offset + 1] = vertex.y;\n            f32buffer[offset + 2] = z;\n            ui32buffer[offset + 3] = this._color[0];\n            f32buffer[offset + 4] = vertex.u;\n            f32buffer[offset + 5] = vertex.v;\n            offset += 6;\n        }\n\n        return len;\n    };\n})();\n"]}