{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccb-reader/assets/frameworks/cocos2d-html5/extensions/ccb-reader/CCBAnimationManager.js"],"names":["_pos","cc","p","BuilderAnimationManagerDelegate","Class","extend","completedAnimationSequenceNamed","name","BuilderAnimationManager","_sequences","_nodeSequences","_baseValues","_autoPlaySequenceId","_rootNode","_owner","_rootContainerSize","_delegate","_runningSequence","_documentOutletNames","_documentOutletNodes","_documentCallbackNames","_documentCallbackNodes","_documentCallbackControlEvents","_documentControllerName","_lastCompletedSequenceName","_keyframeCallbacks","_keyframeCallFuncs","_animationCompleteCallbackFunc","_target","_jsControlled","ctor","size","init","_Dictionary","getSequences","setSequences","seqs","getAutoPlaySequenceId","setAutoPlaySequenceId","autoPlaySequenceId","getRootNode","setRootNode","rootNode","getOwner","setOwner","owner","addDocumentCallbackNode","node","push","addDocumentCallbackName","addDocumentCallbackControlEvents","controlEvents","addDocumentOutletNode","addDocumentOutletName","setDocumentControllerName","getDocumentControllerName","getDocumentCallbackNames","getDocumentCallbackNodes","getDocumentCallbackControlEvents","getDocumentOutletNames","getDocumentOutletNodes","getLastCompletedSequenceName","getKeyframeCallbacks","getRootContainerSize","setRootContainerSize","rootContainerSize","width","height","getDelegate","setDelegate","delegate","getRunningSequenceName","getName","getContainerSize","getContentSize","addNode","seq","setObject","setBaseValue","value","propName","props","objectForKey","moveAnimationsFromNode","fromNode","toNode","locBaseValues","baseValue","removeObjectForKey","locNodeSequences","getActionForCallbackChannel","channel","lastKeyframeTime","actions","keyframes","getKeyframes","numKeyframes","length","i","keyframe","timeSinceLastKeyframe","getTime","delayTime","keyVal","getValue","selectorName","selectorTarget","callbackName","callback","target","CCB_TARGETTYPE_DOCUMENTROOT","CCB_TARGETTYPE_OWNER","selCallFunc","onResolveCCBCCCallFuncSelector","log","callFunc","sequence","getActionForSoundChannel","soundFile","BuilderReader","getResourcePath","pitch","parseFloat","pan","gain","BuilderSoundEffect","create","runAnimationsForSequenceNamed","runAnimationsForSequenceIdTweenDuration","_getSequenceId","runAnimationsForSequenceNamedTweenDuration","tweenDuration","nSeqId","Error","stopAllActions","allKeys","len","seqNodeProps","j","seqNodePropNames","propKeys","seqProp","_setFirstFrame","_runAction","nodeBaseValues","baseKeys","selBaseKey","indexOf","_setAnimatedProperty","_getSequence","completeAction","getDuration","_sequenceCompleted","runAction","action","getCallbackChannel","getSoundChannel","runAnimations","isString","setAnimationCompletedCallback","callbackFunc","setCompletedAnimationCallback","setCallFunc","callbackNamed","debug","_getBaseValue","sequenceName","element","locSequences","getSequenceId","sequenceId","_getAction","keyframe0","keyframe1","duration","getArr","type","getValueArr","x","y","BuilderRotateTo","BuilderRotateXTo","BuilderRotateYTo","fadeTo","selColor","tintTo","r","g","b","isVisible","show","hide","BuilderSetSpriteFrame","containerSize","getParent","absPos","getAbsolutePosition","moveTo","CCB_SCALETYPE_MULTIPLY_RESOLUTION","resolutionScale","getResolutionScale","scaleTo","skewTo","kf1","BuilderKeyframe","setValue","setTime","setEasingType","CCB_KEYFRAME_EASING_LINEAR","tweenAction","nType","_position","setRelativeScale","_skewX","_skewY","setRotation","_rotationX","_rotationY","_realOpacity","setSpriteFrame","setColor","setVisible","setNodeDirty","_getEaseAction","easingType","easingOpt","CCB_KEYFRAME_EASING_INSTANT","CCB_KEYFRAME_EASING_CUBIC_IN","easing","easeIn","CCB_KEYFRAME_EASING_CUBIC_OUT","easeOut","CCB_KEYFRAME_EASING_CUBIC_INOUT","easeInOut","CCB_KEYFRAME_EASING_BACK_IN","easeBackIn","CCB_KEYFRAME_EASING_BACK_OUT","easeBackOut","CCB_KEYFRAME_EASING_BACK_INOUT","easeBackInOut","CCB_KEYFRAME_EASING_BOUNCE_IN","easeBounceIn","CCB_KEYFRAME_EASING_BOUNCE_OUT","easeBounceOut","CCB_KEYFRAME_EASING_BOUNCE_INOUT","easeBounceInOut","CCB_KEYFRAME_EASING_ELASTIC_IN","easeElasticIn","CCB_KEYFRAME_EASING_ELASTIC_OUT","easeElasticOut","CCB_KEYFRAME_EASING_ELASTIC_INOUT","easeElasticInOut","keyframeFirst","timeFirst","kf0","getEasingType","getEasingOpt","locRunningSequence","locRunningName","nextSeqId","getChainedSequenceId","call","ActionInstant","_spriteFrame","initWithSpriteFrame","spriteFrame","update","time","ret","ActionInterval","_startAngle","_dstAngle","_diffAngle","initWithDuration","angle","prototype","startWithTarget","getRotation","file","_file","dt","audioEngine","playEffect"],"mappings":"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","file":"CCBAnimationManager.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccb-reader","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n\nvar _pos = cc.p();\n\ncc.BuilderAnimationManagerDelegate = cc.Class.extend({\n    completedAnimationSequenceNamed: function (name) {\n    }\n});\n\ncc.BuilderAnimationManager = cc.Class.extend({\n    _sequences: null,\n    _nodeSequences: null,\n    _baseValues: null,\n    _autoPlaySequenceId: 0,\n\n    _rootNode: null,\n    _owner: null,\n    _rootContainerSize: null,\n\n    _delegate: null,\n    _runningSequence: null,\n\n    _documentOutletNames: null,\n    _documentOutletNodes: null,\n    _documentCallbackNames: null,\n    _documentCallbackNodes: null,\n    _documentCallbackControlEvents: null,\n    _documentControllerName: \"\",\n    _lastCompletedSequenceName: \"\",\n    _keyframeCallbacks: null,\n    _keyframeCallFuncs: null,\n\n    _animationCompleteCallbackFunc: null,\n    _target: null,\n    _jsControlled: false,\n\n    ctor: function () {\n        this._rootContainerSize = cc.size(0, 0);\n        this.init();\n    },\n\n    init: function () {\n        this._sequences = [];\n        this._nodeSequences = new cc._Dictionary();\n        this._baseValues = new cc._Dictionary();\n\n        this._documentOutletNames = [];\n        this._documentOutletNodes = [];\n        this._documentCallbackNames = [];\n        this._documentCallbackNodes = [];\n        this._documentCallbackControlEvents = [];\n\n        this._keyframeCallbacks = [];\n        this._keyframeCallFuncs = {};\n\n        return true;\n    },\n\n    getSequences: function () {\n        return this._sequences;\n    },\n\n    setSequences: function (seqs) {\n        this._sequences = seqs;\n    },\n\n    getAutoPlaySequenceId: function () {\n        return this._autoPlaySequenceId;\n    },\n    setAutoPlaySequenceId: function (autoPlaySequenceId) {\n        this._autoPlaySequenceId = autoPlaySequenceId;\n    },\n\n    getRootNode: function () {\n        return this._rootNode;\n    },\n    setRootNode: function (rootNode) {\n        this._rootNode = rootNode;\n    },\n\n    getOwner: function () {\n        return this._owner;\n    },\n    setOwner: function (owner) {\n        this._owner = owner;\n    },\n\n    addDocumentCallbackNode: function (node) {\n        this._documentCallbackNodes.push(node);\n    },\n\n    addDocumentCallbackName: function (name) {\n        this._documentCallbackNames.push(name);\n    },\n\n    addDocumentCallbackControlEvents: function (controlEvents) {\n        this._documentCallbackControlEvents.push(controlEvents);\n    },\n\n    addDocumentOutletNode: function (node) {\n        this._documentOutletNodes.push(node);\n    },\n\n    addDocumentOutletName: function (name) {\n        this._documentOutletNames.push(name);\n    },\n\n    setDocumentControllerName: function (name) {\n        this._documentControllerName = name;\n    },\n\n    getDocumentControllerName: function () {\n        return this._documentControllerName;\n    },\n\n    getDocumentCallbackNames: function () {\n        return this._documentCallbackNames;\n    },\n\n    getDocumentCallbackNodes: function () {\n        return this._documentCallbackNodes;\n    },\n\n    getDocumentCallbackControlEvents: function () {\n        return this._documentCallbackControlEvents;\n    },\n\n    getDocumentOutletNames: function () {\n        return this._documentOutletNames;\n    },\n\n    getDocumentOutletNodes: function () {\n        return this._documentOutletNodes;\n    },\n\n    getLastCompletedSequenceName: function () {\n        return this._lastCompletedSequenceName;\n    },\n\n    getKeyframeCallbacks: function () {\n        return this._keyframeCallbacks;\n    },\n\n    getRootContainerSize: function () {\n        return this._rootContainerSize;\n    },\n    setRootContainerSize: function (rootContainerSize) {\n        this._rootContainerSize = cc.size(rootContainerSize.width, rootContainerSize.height);\n    },\n\n    getDelegate: function () {\n        return this._delegate;\n    },\n    setDelegate: function (delegate) {\n        this._delegate = delegate;\n    },\n\n    getRunningSequenceName: function () {\n        if (this._runningSequence)\n            return this._runningSequence.getName();\n        return null;\n    },\n\n    getContainerSize: function (node) {\n        if (node)\n            return node.getContentSize();\n        else\n            return this._rootContainerSize;\n    },\n\n    addNode: function (node, seq) {\n        this._nodeSequences.setObject(seq, node);\n    },\n    setBaseValue: function (value, node, propName) {\n        var props = this._baseValues.objectForKey(node);\n        if (!props) {\n            props = new cc._Dictionary();\n            this._baseValues.setObject(props, node);\n        }\n        props.setObject(value, propName);\n    },\n\n    moveAnimationsFromNode: function (fromNode, toNode) {\n        // Move base values\n        var locBaseValues = this._baseValues;\n        var baseValue = locBaseValues.objectForKey(fromNode);\n        if (baseValue !== null) {\n            locBaseValues.setObject(baseValue, toNode);\n            locBaseValues.removeObjectForKey(fromNode);\n        }\n\n        // Move seqs\n        var locNodeSequences = this._nodeSequences;\n        var seqs = locNodeSequences.objectForKey(fromNode);\n        if (seqs != null) {\n            locNodeSequences.setObject(seqs, toNode);\n            locNodeSequences.removeObjectForKey(fromNode);\n        }\n    },\n\n    getActionForCallbackChannel: function (channel) {\n        var lastKeyframeTime = 0;\n\n        var actions = [];\n        var keyframes = channel.getKeyframes();\n        var numKeyframes = keyframes.length;\n\n        for (var i = 0; i < numKeyframes; ++i) {\n            var keyframe = keyframes[i];\n            var timeSinceLastKeyframe = keyframe.getTime() - lastKeyframeTime;\n            lastKeyframeTime = keyframe.getTime();\n            if (timeSinceLastKeyframe > 0) {\n                actions.push(cc.delayTime(timeSinceLastKeyframe));\n            }\n\n            var keyVal = keyframe.getValue();\n            var selectorName = keyVal[0];\n            var selectorTarget = keyVal[1];\n\n            if (this._jsControlled) {\n                var callbackName = selectorTarget + \":\" + selectorName;    //add number to the stream\n                var callback = this._keyframeCallFuncs[callbackName];\n\n                if (callback != null)\n                    actions.push(callback);\n            } else {\n                var target;\n                if (selectorTarget === CCB_TARGETTYPE_DOCUMENTROOT)\n                    target = this._rootNode;\n                else if (selectorTarget === CCB_TARGETTYPE_OWNER)\n                    target = this._owner;\n\n                if (target != null) {\n                    if (selectorName.length > 0) {\n                        var selCallFunc = 0;\n\n                        if (target.onResolveCCBCCCallFuncSelector != null)\n                            selCallFunc = target.onResolveCCBCCCallFuncSelector(target, selectorName);\n                        if (selCallFunc === 0)\n                            cc.log(\"Skipping selector '\" + selectorName + \"' since no CCBSelectorResolver is present.\");\n                        else\n                            actions.push(cc.callFunc(selCallFunc, target));\n                    } else {\n                        cc.log(\"Unexpected empty selector.\");\n                    }\n                }\n            }\n        }\n        if (actions.length < 1)\n            return null;\n\n        return cc.sequence(actions);\n    },\n    getActionForSoundChannel: function (channel) {\n        var lastKeyframeTime = 0;\n\n        var actions = [];\n        var keyframes = channel.getKeyframes();\n        var numKeyframes = keyframes.length;\n\n        for (var i = 0; i < numKeyframes; ++i) {\n            var keyframe = keyframes[i];\n            var timeSinceLastKeyframe = keyframe.getTime() - lastKeyframeTime;\n            lastKeyframeTime = keyframe.getTime();\n            if (timeSinceLastKeyframe > 0) {\n                actions.push(cc.delayTime(timeSinceLastKeyframe));\n            }\n\n            var keyVal = keyframe.getValue();\n            var soundFile = cc.BuilderReader.getResourcePath() + keyVal[0];\n            var pitch = parseFloat(keyVal[1]), pan = parseFloat(keyVal[2]), gain = parseFloat(keyVal[3]);\n            actions.push(cc.BuilderSoundEffect.create(soundFile, pitch, pan, gain));\n        }\n\n        if (actions.length < 1)\n            return null;\n\n        return cc.sequence(actions);\n    },\n\n    runAnimationsForSequenceNamed: function (name) {\n        this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(name), 0);\n    },\n\n    runAnimationsForSequenceNamedTweenDuration: function (name, tweenDuration) {\n        this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(name), tweenDuration);\n    },\n\n    runAnimationsForSequenceIdTweenDuration: function (nSeqId, tweenDuration) {\n        if (nSeqId === -1)\n            throw new Error(\"cc.BuilderAnimationManager.runAnimationsForSequenceIdTweenDuration(): Sequence id should not be -1\");\n        tweenDuration = tweenDuration || 0;\n\n        this._rootNode.stopAllActions();\n\n        var allKeys = this._nodeSequences.allKeys();\n        for (var i = 0, len = allKeys.length; i < len; i++) {\n            var node = allKeys[i];\n            node.stopAllActions();\n\n            var seqs = this._nodeSequences.objectForKey(node);\n            var seqNodeProps = seqs.objectForKey(nSeqId);\n            var j;\n            var seqNodePropNames = [];\n            if (seqNodeProps) {\n                var propKeys = seqNodeProps.allKeys();\n                for (j = 0; j < propKeys.length; j++) {\n                    var propName = propKeys[j];\n                    var seqProp = seqNodeProps.objectForKey(propName);\n                    seqNodePropNames.push(propName);\n\n                    this._setFirstFrame(node, seqProp, tweenDuration);\n                    this._runAction(node, seqProp, tweenDuration);\n                }\n            }\n\n            var nodeBaseValues = this._baseValues.objectForKey(node);\n            if (nodeBaseValues) {\n                var baseKeys = nodeBaseValues.allKeys();\n                for (j = 0; j < baseKeys.length; j++) {\n                    var selBaseKey = baseKeys[j];\n                    if (seqNodePropNames.indexOf(selBaseKey) === -1) {\n                        var value = nodeBaseValues.objectForKey(selBaseKey);\n                        if (value != null)\n                            this._setAnimatedProperty(selBaseKey, node, value, tweenDuration);\n                    }\n                }\n            }\n        }\n\n        // Make callback at end of sequence\n        var seq = this._getSequence(nSeqId);\n        var completeAction = cc.sequence(cc.delayTime(seq.getDuration() + tweenDuration),\n            cc.callFunc(this._sequenceCompleted, this));\n        this._rootNode.runAction(completeAction);\n\n        // Playback callbacks and sounds\n        var action;\n        if (seq.getCallbackChannel()) {\n            // Build sound actions for channel\n            action = this.getActionForCallbackChannel(seq.getCallbackChannel());\n            if (action) {\n                this._rootNode.runAction(action);\n            }\n        }\n\n        if (seq.getSoundChannel()) {\n            // Build sound actions for channel\n            action = this.getActionForSoundChannel(seq.getSoundChannel());\n            if (action) {\n                this._rootNode.runAction(action);\n            }\n        }\n        // Set the running scene\n        this._runningSequence = this._getSequence(nSeqId);\n    },\n\n    runAnimations: function (name, tweenDuration) {\n        tweenDuration = tweenDuration || 0;\n        var nSeqId;\n        if (cc.isString(name))\n            nSeqId = this._getSequenceId(name);\n        else\n            nSeqId = name;\n\n        this.runAnimationsForSequenceIdTweenDuration(nSeqId, tweenDuration);\n    },\n\n    setAnimationCompletedCallback: function (target, callbackFunc) {\n        this._target = target;\n        this._animationCompleteCallbackFunc = callbackFunc;\n    },\n\n    setCompletedAnimationCallback: function (target, callbackFunc) {\n        this.setAnimationCompletedCallback(target, callbackFunc);\n    },\n    setCallFunc: function (callFunc, callbackNamed) {\n        this._keyframeCallFuncs[callbackNamed] = callFunc;\n    },\n\n    debug: function () {\n    },\n\n    _getBaseValue: function (node, propName) {\n        var props = this._baseValues.objectForKey(node);\n        if (props)\n            return props.objectForKey(propName);\n        return null;\n    },\n\n    _getSequenceId: function (sequenceName) {\n        var element = null;\n        var locSequences = this._sequences;\n        for (var i = 0, len = locSequences.length; i < len; i++) {\n            element = locSequences[i];\n            if (element && element.getName() === sequenceName)\n                return element.getSequenceId();\n        }\n        return -1;\n    },\n\n    _getSequence: function (sequenceId) {\n        var element = null;\n        var locSequences = this._sequences;\n        for (var i = 0, len = locSequences.length; i < len; i++) {\n            element = locSequences[i];\n            if (element && element.getSequenceId() === sequenceId)\n                return element;\n        }\n        return null;\n    },\n\n    _getAction: function (keyframe0, keyframe1, propName, node) {\n        var duration = keyframe1.getTime() - (keyframe0 ? keyframe0.getTime() : 0);\n        var getArr, type, getValueArr, x, y;\n\n        if (propName === \"rotation\") {\n            return cc.BuilderRotateTo.create(duration, keyframe1.getValue());\n        } else if (propName === \"rotationX\") {\n            return cc.BuilderRotateXTo.create(duration, keyframe1.getValue());\n        } else if (propName === \"rotationY\") {\n            return cc.BuilderRotateYTo.create(duration, keyframe1.getValue());\n        } else if (propName === \"opacity\") {\n            return cc.fadeTo(duration, keyframe1.getValue());\n        } else if (propName === \"color\") {\n            var selColor = keyframe1.getValue();\n            return cc.tintTo(duration, selColor.r, selColor.g, selColor.b);\n        } else if (propName === \"visible\") {\n            var isVisible = keyframe1.getValue();\n            if (isVisible) {\n                return cc.sequence(cc.delayTime(duration), cc.show());\n            } else {\n                return cc.sequence(cc.delayTime(duration), cc.hide());\n            }\n        } else if (propName === \"displayFrame\") {\n            return cc.sequence(cc.delayTime(duration), cc.BuilderSetSpriteFrame.create(keyframe1.getValue()));\n        } else if (propName === \"position\") {\n            getArr = this._getBaseValue(node, propName);\n            type = getArr[2];\n\n            //get relative position\n            getValueArr = keyframe1.getValue();\n            x = getValueArr[0];\n            y = getValueArr[1];\n\n            var containerSize = this.getContainerSize(node.getParent());\n\n            var absPos = cc.getAbsolutePosition(x, y, type, containerSize, propName);\n\n            return cc.moveTo(duration, absPos);\n        } else if (propName === \"scale\") {\n            getArr = this._getBaseValue(node, propName);\n            type = getArr[2];\n\n            //get relative position\n            getValueArr = keyframe1.getValue();\n            x = getValueArr[0];\n            y = getValueArr[1];\n\n            if (type === CCB_SCALETYPE_MULTIPLY_RESOLUTION) {\n                //TODO need to test\n                var resolutionScale = cc.BuilderReader.getResolutionScale();\n                x *= resolutionScale;\n                y *= resolutionScale;\n            }\n\n            return cc.scaleTo(duration, x, y);\n        } else if (propName === \"skew\") {\n            //get relative position\n            getValueArr = keyframe1.getValue();\n            x = getValueArr[0];\n            y = getValueArr[1];\n            return cc.skewTo(duration, x, y);\n        } else {\n            cc.log(\"BuilderReader: Failed to create animation for property: \" + propName);\n        }\n        return null;\n    },\n\n    _setAnimatedProperty: function (propName, node, value, tweenDuration) {\n        if (tweenDuration > 0) {\n            // Create a fake keyframe to generate the action from\n            var kf1 = new cc.BuilderKeyframe();\n            kf1.setValue(value);\n            kf1.setTime(tweenDuration);\n            kf1.setEasingType(CCB_KEYFRAME_EASING_LINEAR);\n\n            // Animate\n            var tweenAction = this._getAction(null, kf1, propName, node);\n            node.runAction(tweenAction);\n        } else {\n            // Just set the value\n            var getArr, nType, x, y;\n            if (propName === \"position\") {\n                getArr = this._getBaseValue(node, propName);\n                nType = getArr[2];\n\n                x = value[0];\n                y = value[1];\n                cc.getAbsolutePosition(x, y, nType, this.getContainerSize(node.getParent()), propName, _pos);\n                node._position.x = _pos.x;\n                node._position.y = _pos.y;\n            } else if (propName === \"scale\") {\n                getArr = this._getBaseValue(node, propName);\n                nType = getArr[2];\n\n                x = value[0];\n                y = value[1];\n\n                cc.setRelativeScale(node, x, y, nType, propName);\n            } else if (propName === \"skew\") {\n                x = value[0];\n                y = value[1];\n                node._skewX = x;\n                node._skewY = y;\n            } else {\n                // [node setValue:value forKey:name];\n                // TODO only handle rotation, opacity, displayFrame, color\n                if (propName === \"rotation\") {\n                    node.setRotation(value);\n                } else if (propName === \"rotationX\") {\n                    node._rotationX = value;\n                } else if (propName === \"rotationY\") {\n                    node._rotationY = value;\n                } else if (propName === \"opacity\") {\n                    node._realOpacity = value;\n                } else if (propName === \"displayFrame\") {\n                    node.setSpriteFrame(value);\n                } else if (propName === \"color\") {\n                    if (value.r !== 255 || value.g !== 255 || value.b !== 255) {\n                        node.setColor(value);\n                    }\n                } else if (propName === \"visible\") {\n                    value = value || false;\n                    node.setVisible(value);\n                } else {\n                    cc.log(\"unsupported property name is \" + propName);\n                    return;\n                }\n            }\n            node.setNodeDirty();\n        }\n    },\n\n    _setFirstFrame: function (node, seqProp, tweenDuration) {\n        var keyframes = seqProp.getKeyframes();\n\n        if (keyframes.length === 0) {\n            // Use base value (no animation)\n            var baseValue = this._getBaseValue(node, seqProp.getName());\n            if (!baseValue)\n                cc.log(\"cc.BuilderAnimationManager._setFirstFrame(): No baseValue found for property\");\n            this._setAnimatedProperty(seqProp.getName(), node, baseValue, tweenDuration);\n        } else {\n            // Use first keyframe\n            var keyframe = keyframes[0];\n            this._setAnimatedProperty(seqProp.getName(), node, keyframe.getValue(), tweenDuration);\n        }\n    },\n\n    _getEaseAction: function (action, easingType, easingOpt) {\n        if (easingType === CCB_KEYFRAME_EASING_LINEAR || easingType === CCB_KEYFRAME_EASING_INSTANT) {\n            return action;\n        } else if (easingType === CCB_KEYFRAME_EASING_CUBIC_IN) {\n            return action.easing(cc.easeIn(easingOpt));\n        } else if (easingType === CCB_KEYFRAME_EASING_CUBIC_OUT) {\n            return action.easing(cc.easeOut(easingOpt));\n        } else if (easingType === CCB_KEYFRAME_EASING_CUBIC_INOUT) {\n            return action.easing(cc.easeInOut(easingOpt));\n        } else if (easingType === CCB_KEYFRAME_EASING_BACK_IN) {\n            return action.easing(cc.easeBackIn());\n        } else if (easingType === CCB_KEYFRAME_EASING_BACK_OUT) {\n            return action.easing(cc.easeBackOut());\n        } else if (easingType === CCB_KEYFRAME_EASING_BACK_INOUT) {\n            return action.easing(cc.easeBackInOut());\n        } else if (easingType === CCB_KEYFRAME_EASING_BOUNCE_IN) {\n            return action.easing(cc.easeBounceIn());\n        } else if (easingType === CCB_KEYFRAME_EASING_BOUNCE_OUT) {\n            return action.easing(cc.easeBounceOut());\n        } else if (easingType === CCB_KEYFRAME_EASING_BOUNCE_INOUT) {\n            return action.easing(cc.easeBounceInOut());\n        } else if (easingType === CCB_KEYFRAME_EASING_ELASTIC_IN) {\n            return action.easing(cc.easeElasticIn(easingOpt));\n        } else if (easingType === CCB_KEYFRAME_EASING_ELASTIC_OUT) {\n            return action.easing(cc.easeElasticOut(easingOpt));\n        } else if (easingType === CCB_KEYFRAME_EASING_ELASTIC_INOUT) {\n            return action.easing(cc.easeElasticInOut(easingOpt));\n        } else {\n            cc.log(\"BuilderReader: Unknown easing type \" + easingType);\n            return action;\n        }\n    },\n\n    _runAction: function (node, seqProp, tweenDuration) {\n        var keyframes = seqProp.getKeyframes();\n        var numKeyframes = keyframes.length;\n\n        if (numKeyframes > 1) {\n            // Make an animation!\n            var actions = [];\n\n            var keyframeFirst = keyframes[0];\n            var timeFirst = keyframeFirst.getTime() + tweenDuration;\n\n            if (timeFirst > 0) {\n                actions.push(cc.delayTime(timeFirst));\n            }\n\n            for (var i = 0; i < numKeyframes - 1; ++i) {\n                var kf0 = keyframes[i];\n                var kf1 = keyframes[(i + 1)];\n\n                var action = this._getAction(kf0, kf1, seqProp.getName(), node);\n                if (action) {\n                    // Apply easing\n                    action = this._getEaseAction(action, kf0.getEasingType(), kf0.getEasingOpt());\n                    actions.push(action);\n                }\n            }\n\n            node.runAction(cc.sequence(actions));\n        }\n    },\n\n    _sequenceCompleted: function () {\n        var locRunningSequence = this._runningSequence;\n\n        var locRunningName = locRunningSequence.getName();\n\n        if (this._lastCompletedSequenceName != locRunningSequence.getName()) {\n            this._lastCompletedSequenceName = locRunningSequence.getName();\n        }\n\n        var nextSeqId = locRunningSequence.getChainedSequenceId();\n        this._runningSequence = null;\n\n        if (nextSeqId !== -1)\n            this.runAnimations(nextSeqId, 0);\n\n        if (this._delegate)\n            this._delegate.completedAnimationSequenceNamed(locRunningName);\n\n        if (this._target && this._animationCompleteCallbackFunc) {\n            this._animationCompleteCallbackFunc.call(this._target);\n        }\n    }\n});\n\n\ncc.BuilderSetSpriteFrame = cc.ActionInstant.extend({\n    _spriteFrame: null,\n\n    initWithSpriteFrame: function (spriteFrame) {\n        this._spriteFrame = spriteFrame;\n        return true;\n    },\n    update: function (time) {\n        this.target.setSpriteFrame(this._spriteFrame);\n    }\n});\n\ncc.BuilderSetSpriteFrame.create = function (spriteFrame) {\n    var ret = new cc.BuilderSetSpriteFrame();\n    if (ret) {\n        if (ret.initWithSpriteFrame(spriteFrame))\n            return ret;\n    }\n    return null;\n};\n\n//\n// cc.BuilderRotateTo\n//\ncc.BuilderRotateTo = cc.ActionInterval.extend({\n    _startAngle: 0,\n    _dstAngle: 0,\n    _diffAngle: 0,\n\n    initWithDuration: function (duration, angle) {\n        if (cc.ActionInterval.prototype.initWithDuration.call(this, duration)) {\n            this._dstAngle = angle;\n            return true;\n        } else {\n            return false;\n        }\n    },\n    update: function (time) {\n        this.target.setRotation(this._startAngle + (this._diffAngle * time));\n    },\n\n    startWithTarget: function (node) {\n        cc.ActionInterval.prototype.startWithTarget.call(this, node);\n        this._startAngle = this.target.getRotation();\n        this._diffAngle = this._dstAngle - this._startAngle;\n    }\n});\n\ncc.BuilderRotateTo.create = function (duration, angle) {\n    var ret = new cc.BuilderRotateTo();\n    if (ret) {\n        if (ret.initWithDuration(duration, angle))\n            return ret;\n    }\n    return null;\n};\n\n//\n// cc.BuilderRotateXTo\n//\ncc.BuilderRotateXTo = cc.ActionInterval.extend({\n    // TODO: rotationX is not implemented in HTML5\n});\n\ncc.BuilderRotateXTo.create = function (duration, angle) {\n    throw new Error(\"rotationX has not been implemented in cocos2d-html5\");\n};\n\n//\n// cc.BuilderRotateYTo\n//\ncc.BuilderRotateYTo = cc.ActionInterval.extend({\n    // TODO: rotationX is not implemented in HTML5\n});\n\ncc.BuilderRotateYTo.create = function (duration, angle) {\n    throw new Error(\"rotationY has not been implemented in cocos2d-html5\");\n};\n\n//\n// cc.BuilderSoundEffect\n//\ncc.BuilderSoundEffect = cc.ActionInstant.extend({\n    init: function (file) {\n        this._file = file;\n        return true;\n    },\n    update: function (dt) {\n        cc.audioEngine.playEffect(this._file);\n    }\n});\ncc.BuilderSoundEffect.create = function (file, pitch, pan, gain) {\n    var ret = new cc.BuilderSoundEffect();\n    if (ret && ret.init(file)) {\n        return ret;\n    }\n    return null;\n};\n})();\n"]}