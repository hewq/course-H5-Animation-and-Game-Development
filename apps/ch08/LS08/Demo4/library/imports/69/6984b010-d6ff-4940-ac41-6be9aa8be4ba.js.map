{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/uiwidgets/assets/frameworks/cocos2d-html5/extensions/ccui/uiwidgets/UIRichText.js"],"names":["ccui","RichElement","Class","extend","_type","_tag","_color","_opacity","ctor","tag","color","opacity","cc","r","g","b","undefined","a","RichElementText","_text","_fontName","_fontSize","_fontDefinition","colorOrFontDef","text","fontName","fontSize","FontDefinition","fillStyle","prototype","call","TEXT","create","RichElementImage","_filePath","_textureRect","_textureType","filePath","IMAGE","rect","RichElementCustomNode","_customNode","customNode","CUSTOM","RichText","Widget","_formatTextDirty","_richElements","_elementRenders","_leftSpaceWidth","_verticalSpace","_elementRenderersContainer","_lineBreakOnSpace","_textHorizontalAlignment","_textVerticalAlignment","TEXT_ALIGNMENT_LEFT","VERTICAL_TEXT_ALIGNMENT_TOP","_initRenderer","Node","setAnchorPoint","addProtectedChild","insertElement","element","index","splice","pushBackElement","push","removeElement","isNumber","arrayRemoveObject","formatText","removeAllChildren","length","i","locRichElements","_ignoreSize","_addNewLine","elementRenderer","LabelTTF","Sprite","setColor","setOpacity","_pushToContainer","_handleTextRenderer","_handleImageRenderer","_handleCustomRenderer","formatRenderers","fontNameOrFontDef","textRenderer","textRendererWidth","getContentSize","width","overstepPercent","curText","stringLength","leftLength","leftWords","substr","cutWords","validLeftLength","lastSpaceIndex","lastIndexOf","leftRenderer","imageRenderer","renderer","imgSize","_customSize","newContentSizeHeight","locRenderersContainer","locElementRenders","j","row","nextPosX","l","lineHeight","offsetX","newContentSizeWidth","p","setPosition","addChild","getLineHeight","iSize","Math","max","min","height","TEXT_ALIGNMENT_RIGHT","_contentSize","TEXT_ALIGNMENT_CENTER","x","setContentSize","maxHeights","maxHeight","nextPosY","offsetY","VERTICAL_TEXT_ALIGNMENT_BOTTOM","VERTICAL_TEXT_ALIGNMENT_CENTER","y","getVirtualRendererSize","_updateContentSizeWithTextureSize","_adaptRenderers","setVerticalSpace","space","pt","_setAnchorX","_setAnchorY","ignoreContentAdaptWithSize","ignore","_getWidth","_getHeight","contentSize","locWidth","locHeight","getDescription","setCascadeOpacityEnabled","value","setLineBreakOnSpace","setTextHorizontalAlignment","setTextVerticalAlignment"],"mappings":"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","file":"UIRichText.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/uiwidgets","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * ccui.RichElement is the base class of RichElementText, RichElementImage etc. It has type, tag, color and opacity attributes.\n * @class\n * @extends ccui.Class\n */\nccui.RichElement = ccui.Class.extend(/** @lends ccui.RichElement# */{\n    _type: 0,\n    _tag: 0,\n    _color: null,\n    _opacity: 0,\n    /**\n     * Constructor of ccui.RichElement\n     */\n    ctor: function (tag, color, opacity) {\n        this._type = 0;\n        this._tag = tag || 0;\n        this._color = cc.color(255, 255, 255, 255);\n        if (color) {\n            this._color.r = color.r;\n            this._color.g = color.g;\n            this._color.b = color.b;\n        }\n        this._opacity = opacity || 0;\n        if (opacity === undefined) {\n            this._color.a = color.a;\n        }\n        else {\n            this._color.a = opacity;\n        }\n    }\n});\n\n/**\n * The text element for RichText, it has text, fontName, fontSize attributes.\n * @class\n * @extends ccui.RichElement\n */\nccui.RichElementText = ccui.RichElement.extend(/** @lends ccui.RichElementText# */{\n    _text: \"\",\n    _fontName: \"\",\n    _fontSize: 0,\n    /** @type cc.FontDefinition */\n    _fontDefinition: null,\n    /**\n     * Usage Example using FontDefinition:\n     *\n     * var rtEl  = new ccui.RichElementText(\"tag\", new cc.FontDefinition({\n     *                              fillStyle: cc.color.BLACK,\n     *                              fontName: \"Arial\",\n     *                              fontSize: 12,\n     *                              fontWeight: \"bold\",\n     *                              fontStyle: \"normal\",\n     *                              lineHeight: 14\n     *                          }), 255, \"Some Text\");\n     *\n     * Constructor of ccui.RichElementText\n     * @param {Number} tag\n     * @param {cc.Color|cc.FontDefinition} colorOrFontDef\n     * @param {Number} opacity\n     * @param {String} text\n     * @param {String} fontName\n     * @param {Number} fontSize\n     */\n    ctor: function (tag, colorOrFontDef, opacity, text, fontName, fontSize) {\n        var color = colorOrFontDef;\n        if (colorOrFontDef && colorOrFontDef instanceof cc.FontDefinition) {\n            color = colorOrFontDef.fillStyle;\n            fontName = colorOrFontDef.fontName;\n            fontSize = colorOrFontDef.fontSize;\n            this._fontDefinition = colorOrFontDef;\n        }\n        ccui.RichElement.prototype.ctor.call(this, tag, color, opacity);\n        this._type = ccui.RichElement.TEXT;\n        this._text = text;\n        this._fontName = fontName;\n        this._fontSize = fontSize;\n    }\n});\n\n/**\n * Create a richElementText\n * @deprecated since v3.0, please use new ccui.RichElementText() instead.\n * @param {Number} tag\n * @param {cc.Color} color\n * @param {Number} opacity\n * @param {String} text\n * @param {String} fontName\n * @param {Number} fontSize\n * @returns {ccui.RichElementText}\n */\nccui.RichElementText.create = function (tag, color, opacity, text, fontName, fontSize) {\n    return new ccui.RichElementText(tag, color, opacity, text, fontName, fontSize);\n};\n\n/**\n * The image element for RichText, it has filePath, textureRect, textureType attributes.\n * @class\n * @extends ccui.RichElement\n */\nccui.RichElementImage = ccui.RichElement.extend(/** @lends ccui.RichElementImage# */{\n    _filePath: \"\",\n    _textureRect: null,\n    _textureType: 0,\n\n    /**\n     * Constructor of ccui.RichElementImage\n     * @param {Number} tag\n     * @param {cc.Color} color\n     * @param {Number} opacity\n     * @param {String} filePath\n     */\n    ctor: function (tag, color, opacity, filePath) {\n        ccui.RichElement.prototype.ctor.call(this, tag, color, opacity);\n        this._type = ccui.RichElement.IMAGE;\n        this._filePath = filePath || \"\";\n        this._textureRect = cc.rect(0, 0, 0, 0);\n        this._textureType = 0;\n    }\n});\n\n/**\n * Create a richElementImage\n * @deprecated since v3.0, please use new ccui.RichElementImage() instead.\n * @param {Number} tag\n * @param {cc.Color} color\n * @param {Number} opacity\n * @param {String} filePath\n * @returns {ccui.RichElementImage}\n */\nccui.RichElementImage.create = function (tag, color, opacity, filePath) {\n    return new ccui.RichElementImage(tag, color, opacity, filePath);\n};\n\n/**\n * The custom node element for RichText.\n * @class\n * @extends ccui.RichElement\n */\nccui.RichElementCustomNode = ccui.RichElement.extend(/** @lends ccui.RichElementCustomNode# */{\n    _customNode: null,\n\n    /**\n     * Constructor of ccui.RichElementCustomNode\n     * @param {Number} tag\n     * @param {cc.Color} color\n     * @param {Number} opacity\n     * @param {cc.Node} customNode\n     */\n    ctor: function (tag, color, opacity, customNode) {\n        ccui.RichElement.prototype.ctor.call(this, tag, color, opacity);\n        this._type = ccui.RichElement.CUSTOM;\n        this._customNode = customNode || null;\n    }\n});\n\n/**\n * Create a richElementCustomNode\n * @deprecated since v3.0, please use new ccui.RichElementCustomNode() instead.\n * @param {Number} tag\n * @param {Number} color\n * @param {Number} opacity\n * @param {cc.Node} customNode\n * @returns {ccui.RichElementCustomNode}\n */\nccui.RichElementCustomNode.create = function (tag, color, opacity, customNode) {\n    return new ccui.RichElementCustomNode(tag, color, opacity, customNode);\n};\n\n/**\n * The rich text control of Cocos UI. It receives text, image, and custom node as its children to display.\n * @class\n * @extends ccui.Widget\n */\nccui.RichText = ccui.Widget.extend(/** @lends ccui.RichText# */{\n    _formatTextDirty: false,\n    _richElements: null,\n    _elementRenders: null,\n    _leftSpaceWidth: 0,\n    _verticalSpace: 0,\n    _elementRenderersContainer: null,\n    _lineBreakOnSpace: false,\n    _textHorizontalAlignment: null,\n    _textVerticalAlignment: null,\n\n    /**\n     * create a rich text\n     * Constructor of ccui.RichText. override it to extend the construction behavior, remember to call \"this._super()\" in the extended \"ctor\" function.\n     * @example\n     * var uiRichText = new ccui.RichTex();\n     */\n    ctor: function () {\n        ccui.Widget.prototype.ctor.call(this);\n        this._formatTextDirty = false;\n        this._richElements = [];\n        this._elementRenders = [];\n        this._leftSpaceWidth = 0;\n        this._verticalSpace = 0;\n        this._textHorizontalAlignment = cc.TEXT_ALIGNMENT_LEFT;\n        this._textVerticalAlignment = cc.VERTICAL_TEXT_ALIGNMENT_TOP;\n    },\n\n    _initRenderer: function () {\n        this._elementRenderersContainer = new cc.Node();\n        this._elementRenderersContainer.setAnchorPoint(0.5, 0.5);\n        this.addProtectedChild(this._elementRenderersContainer, 0, -1);\n    },\n\n    /**\n     * Insert a element\n     * @param {ccui.RichElement} element\n     * @param {Number} index\n     */\n    insertElement: function (element, index) {\n        this._richElements.splice(index, 0, element);\n        this._formatTextDirty = true;\n    },\n\n    /**\n     * Push a element\n     * @param {ccui.RichElement} element\n     */\n    pushBackElement: function (element) {\n        this._richElements.push(element);\n        this._formatTextDirty = true;\n    },\n\n    /**\n     * Remove element\n     * @param {ccui.RichElement} element\n     */\n    removeElement: function (element) {\n        if (cc.isNumber(element))\n            this._richElements.splice(element, 1);\n        else\n            cc.arrayRemoveObject(this._richElements, element);\n        this._formatTextDirty = true;\n    },\n\n    /**\n     * Formats the richText's content.\n     */\n    formatText: function () {\n        if (this._formatTextDirty) {\n            this._elementRenderersContainer.removeAllChildren();\n            this._elementRenders.length = 0;\n            var i, element, locRichElements = this._richElements;\n            if (this._ignoreSize) {\n                this._addNewLine();\n                for (i = 0; i < locRichElements.length; i++) {\n                    element = locRichElements[i];\n                    var elementRenderer = null;\n                    switch (element._type) {\n                        case ccui.RichElement.TEXT:\n                            if (element._fontDefinition)\n                                elementRenderer = new cc.LabelTTF(element._text, element._fontDefinition);\n                            else //todo: There may be ambiguous\n                                elementRenderer = new cc.LabelTTF(element._text, element._fontName, element._fontSize);\n                            break;\n                        case ccui.RichElement.IMAGE:\n                            elementRenderer = new cc.Sprite(element._filePath);\n                            break;\n                        case ccui.RichElement.CUSTOM:\n                            elementRenderer = element._customNode;\n                            break;\n                        default:\n                            break;\n                    }\n                    elementRenderer.setColor(element._color);\n                    elementRenderer.setOpacity(element._color.a);\n                    this._pushToContainer(elementRenderer);\n                }\n            } else {\n                this._addNewLine();\n                for (i = 0; i < locRichElements.length; i++) {\n                    element = locRichElements[i];\n                    switch (element._type) {\n                        case ccui.RichElement.TEXT:\n                            if (element._fontDefinition)\n                                this._handleTextRenderer(element._text, element._fontDefinition, element._fontDefinition.fontSize, element._fontDefinition.fillStyle);\n                            else\n                                this._handleTextRenderer(element._text, element._fontName, element._fontSize, element._color);\n                            break;\n                        case ccui.RichElement.IMAGE:\n                            this._handleImageRenderer(element._filePath, element._color, element._color.a);\n                            break;\n                        case ccui.RichElement.CUSTOM:\n                            this._handleCustomRenderer(element._customNode);\n                            break;\n                        default:\n                            break;\n                    }\n                }\n            }\n            this.formatRenderers();\n            this._formatTextDirty = false;\n        }\n    },\n    /**\n     * Prepare the child LabelTTF based on line breaking\n     * @param {String} text\n     * @param {String|cc.FontDefinition} fontNameOrFontDef\n     * @param {Number} fontSize\n     * @param {cc.Color} color\n     * @private\n     */\n    _handleTextRenderer: function (text, fontNameOrFontDef, fontSize, color) {\n        if (text === \"\")\n            return;\n\n        if (text === \"\\n\") { //Force Line Breaking\n            this._addNewLine();\n            return;\n        }\n\n        var textRenderer = fontNameOrFontDef instanceof cc.FontDefinition ? new cc.LabelTTF(text, fontNameOrFontDef) : new cc.LabelTTF(text, fontNameOrFontDef, fontSize);\n        var textRendererWidth = textRenderer.getContentSize().width;\n        this._leftSpaceWidth -= textRendererWidth;\n        if (this._leftSpaceWidth < 0) {\n            var overstepPercent = (-this._leftSpaceWidth) / textRendererWidth;\n            var curText = text;\n            var stringLength = curText.length;\n            var leftLength = stringLength * (1 - overstepPercent);\n            var leftWords = curText.substr(0, leftLength);\n            var cutWords = curText.substr(leftLength, curText.length - 1);\n            var validLeftLength = leftLength > 0;\n\n            if (this._lineBreakOnSpace) {\n                var lastSpaceIndex = leftWords.lastIndexOf(' ');\n                leftLength = lastSpaceIndex === -1 ? leftLength : lastSpaceIndex + 1;\n                cutWords = curText.substr(leftLength, curText.length - 1);\n                validLeftLength = leftLength > 0 && cutWords !== \" \";\n            }\n\n            if (validLeftLength) {\n                var leftRenderer = null;\n                if (fontNameOrFontDef instanceof cc.FontDefinition) {\n                    leftRenderer = new cc.LabelTTF(leftWords.substr(0, leftLength), fontNameOrFontDef);\n                    leftRenderer.setOpacity(fontNameOrFontDef.fillStyle.a); //TODO: Verify that might not be needed...\n                } else {\n                    leftRenderer = new cc.LabelTTF(leftWords.substr(0, leftLength), fontNameOrFontDef, fontSize);\n                    leftRenderer.setColor(color);\n                    leftRenderer.setOpacity(color.a);\n                }\n                this._pushToContainer(leftRenderer);\n            }\n\n            this._addNewLine();\n            this._handleTextRenderer(cutWords, fontNameOrFontDef, fontSize, color);\n        } else {\n            if (fontNameOrFontDef instanceof cc.FontDefinition) {\n                textRenderer.setOpacity(fontNameOrFontDef.fillStyle.a); //TODO: Verify that might not be needed...\n            } else {\n                textRenderer.setColor(color);\n                textRenderer.setOpacity(color.a);\n            }\n            this._pushToContainer(textRenderer);\n        }\n    },\n\n    _handleImageRenderer: function (filePath, color, opacity) {\n        var imageRenderer = new cc.Sprite(filePath);\n        this._handleCustomRenderer(imageRenderer);\n    },\n\n    _handleCustomRenderer: function (renderer) {\n        var imgSize = renderer.getContentSize();\n        this._leftSpaceWidth -= imgSize.width;\n        if (this._leftSpaceWidth < 0) {\n            this._addNewLine();\n            this._pushToContainer(renderer);\n            this._leftSpaceWidth -= imgSize.width;\n        } else\n            this._pushToContainer(renderer);\n    },\n\n    _addNewLine: function () {\n        this._leftSpaceWidth = this._customSize.width;\n        this._elementRenders.push([]);\n    },\n\n    /**\n     * Formats richText's renderer.\n     */\n    formatRenderers: function () {\n        var newContentSizeHeight = 0, locRenderersContainer = this._elementRenderersContainer;\n        var locElementRenders = this._elementRenders;\n        var i, j, row, nextPosX, l;\n        var lineHeight, offsetX;\n        if (this._ignoreSize) {\n            var newContentSizeWidth = 0;\n            row = locElementRenders[0];\n            nextPosX = 0;\n\n            for (j = 0; j < row.length; j++) {\n                l = row[j];\n                l.setAnchorPoint(cc.p(0, 0));\n                l.setPosition(nextPosX, 0);\n                locRenderersContainer.addChild(l, 1, j);\n\n                lineHeight = l.getLineHeight ? l.getLineHeight() : newContentSizeHeight;\n\n                var iSize = l.getContentSize();\n                newContentSizeWidth += iSize.width;\n                newContentSizeHeight = Math.max(Math.min(newContentSizeHeight, lineHeight), iSize.height);\n                nextPosX += iSize.width;\n            }\n\n            //Text flow horizontal alignment:\n            if (this._textHorizontalAlignment !== cc.TEXT_ALIGNMENT_LEFT) {\n                offsetX = 0;\n                if (this._textHorizontalAlignment === cc.TEXT_ALIGNMENT_RIGHT)\n                    offsetX = this._contentSize.width - nextPosX;\n                else if (this._textHorizontalAlignment === cc.TEXT_ALIGNMENT_CENTER)\n                    offsetX = (this._contentSize.width - nextPosX) / 2;\n\n                for (j = 0; j < row.length; j++)\n                    row[j].x += offsetX;\n            }\n\n            locRenderersContainer.setContentSize(newContentSizeWidth, newContentSizeHeight);\n        } else {\n            var maxHeights = [];\n            for (i = 0; i < locElementRenders.length; i++) {\n                row = locElementRenders[i];\n                var maxHeight = 0;\n                for (j = 0; j < row.length; j++) {\n                    l = row[j];\n                    lineHeight = l.getLineHeight ? l.getLineHeight() : l.getContentSize().height;\n                    maxHeight = Math.max(Math.min(l.getContentSize().height, lineHeight), maxHeight);\n                }\n                maxHeights[i] = maxHeight;\n                newContentSizeHeight += maxHeights[i];\n            }\n\n            var nextPosY = this._customSize.height;\n\n            for (i = 0; i < locElementRenders.length; i++) {\n                row = locElementRenders[i];\n                nextPosX = 0;\n                nextPosY -= (maxHeights[i] + this._verticalSpace);\n\n                for (j = 0; j < row.length; j++) {\n                    l = row[j];\n                    l.setAnchorPoint(cc.p(0, 0));\n                    l.setPosition(cc.p(nextPosX, nextPosY));\n                    locRenderersContainer.addChild(l, 1);\n                    nextPosX += l.getContentSize().width;\n                }\n                //Text flow alignment(s)\n                if (this._textHorizontalAlignment !== cc.TEXT_ALIGNMENT_LEFT || this._textVerticalAlignment !== cc.VERTICAL_TEXT_ALIGNMENT_TOP) {\n                    offsetX = 0;\n                    if (this._textHorizontalAlignment === cc.TEXT_ALIGNMENT_RIGHT)\n                        offsetX = this._contentSize.width - nextPosX;\n                    else if (this._textHorizontalAlignment === cc.TEXT_ALIGNMENT_CENTER)\n                        offsetX = (this._contentSize.width - nextPosX) / 2;\n\n                    var offsetY = 0;\n                    if (this._textVerticalAlignment === cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM)\n                        offsetY = this._customSize.height - newContentSizeHeight;\n                    else if (this._textVerticalAlignment === cc.VERTICAL_TEXT_ALIGNMENT_CENTER)\n                        offsetY = (this._customSize.height - newContentSizeHeight) / 2;\n\n                    for (j = 0; j < row.length; j++) {\n                        l = row[j];\n                        l.x += offsetX;\n                        l.y -= offsetY;\n                    }\n                }\n            }\n\n            locRenderersContainer.setContentSize(this._contentSize);\n        }\n\n        var length = locElementRenders.length;\n        for (i = 0; i < length; i++) {\n            locElementRenders[i].length = 0;\n        }\n        this._elementRenders.length = 0;\n\n        this.setContentSize(this._ignoreSize ? this.getVirtualRendererSize() : this._customSize);\n        this._updateContentSizeWithTextureSize(this._contentSize);\n\n        locRenderersContainer.setPosition(this._contentSize.width * 0.5, this._contentSize.height * 0.5);\n    },\n\n    _pushToContainer: function (renderer) {\n        if (this._elementRenders.length <= 0)\n            return;\n        this._elementRenders[this._elementRenders.length - 1].push(renderer);\n    },\n\n    _adaptRenderers: function () {\n        this.formatText();\n    },\n\n    /**\n     * Sets vertical space\n     * @param {Number} space\n     */\n    setVerticalSpace: function (space) {\n        this._verticalSpace = space;\n    },\n\n    /**\n     * Sets anchor point\n     * @override\n     * @param {cc.Point} pt\n     */\n    setAnchorPoint: function (pt) {\n        ccui.Widget.prototype.setAnchorPoint.call(this, pt);\n        this._elementRenderersContainer.setAnchorPoint(pt);\n    },\n    _setAnchorX: function (x) {\n        ccui.Widget.prototype._setAnchorX.call(this, x);\n        this._elementRenderersContainer._setAnchorX(x);\n    },\n    _setAnchorY: function (y) {\n        ccui.Widget.prototype._setAnchorY.call(this, y);\n        this._elementRenderersContainer._setAnchorY(y);\n    },\n\n    /**\n     * Returns the renderer container's content size.\n     * @override\n     * @returns {cc.Size}\n     */\n    getVirtualRendererSize: function () {\n        return this._elementRenderersContainer.getContentSize();\n    },\n\n    /**\n     * Ignore the richText's custom size, If ignore is true that richText will ignore it's custom size, use renderer's content size, false otherwise.\n     * @param {Boolean} ignore\n     * @override\n     */\n    ignoreContentAdaptWithSize: function (ignore) {\n        if (this._ignoreSize !== ignore) {\n            this._formatTextDirty = true;\n            ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this, ignore);\n        }\n    },\n\n    /**\n     * Gets the content size of ccui.RichText\n     * @override\n     * @return {cc.Size}\n     */\n    getContentSize: function () {\n        this.formatText();\n        return cc.Node.prototype.getContentSize.call(this);\n    },\n    _getWidth: function () {\n        this.formatText();\n        return cc.Node.prototype._getWidth.call(this);\n    },\n    _getHeight: function () {\n        this.formatText();\n        return cc.Node.prototype._getHeight.call(this);\n    },\n\n    setContentSize: function (contentSize, height) {\n        var locWidth = (height === undefined) ? contentSize.width : contentSize;\n        var locHeight = (height === undefined) ? contentSize.height : height;\n        ccui.Widget.prototype.setContentSize.call(this, locWidth, locHeight);\n        this._formatTextDirty = true;\n    },\n\n    /**\n     * Returns the class name of ccui.RichText.\n     * @returns {string}\n     */\n    getDescription: function () {\n        return \"RichText\";\n    },\n    /**\n     * Allow child renderer to be affected by ccui.RichText's opacity\n     * @param {boolean} value\n     */\n    setCascadeOpacityEnabled: function (value) {\n        ccui.Widget.prototype.setCascadeOpacityEnabled.call(this, value);\n        this._elementRenderersContainer.setCascadeOpacityEnabled(value);\n    },\n    /**\n     * This allow the RichText layout to break line on space only like in Latin text format\n     * by default the property is false, which break the line on characters\n     * @param value\n     */\n    setLineBreakOnSpace: function (value) {\n        this._lineBreakOnSpace = value;\n        this._formatTextDirty = true;\n        this.formatText();\n    },\n    /**\n     * Set the renderer horizontal flow alignment for the Control\n     * although it is named TextHorizontalAlignment, it should work with all type of renderer too.\n     * NOTE: we should rename this to setHorizontalAlignment directly\n     *\n     * @example\n     * var richText = new ccui.RichText();\n     * richText.setTextHorizontalAlignment(cc.Text_ALIGNMENT_RIGHT);\n     *\n     * @param {Number} value - example cc.TEXT_ALIGNMENT_RIGHT\n     */\n    setTextHorizontalAlignment: function (value) {\n        if (value !== this._textHorizontalAlignment) {\n            this._textHorizontalAlignment = value;\n            this.formatText();\n        }\n    },\n    /**\n     * Set the renderer vertical flow alignment for the Control\n     * although it is named TextVerticalAlignment, it should work with all type of renderer too.\n     *\n     * @example\n     * var richText = new ccui.RichText();\n     * richText.setTextVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);\n     *\n     * @param {Number} value - example cc.VERTICAL_TEXT_ALIGNMENT_CENTER\n     */\n    setTextVerticalAlignment: function (value) {\n        if (value !== this._textVerticalAlignment) {\n            this._textVerticalAlignment = value;\n            this.formatText();\n        }\n    }\n});\n\n/**\n * create a rich text\n * @deprecated since v3.0, please use new ccui.RichText() instead.\n * @returns {RichText}\n */\nccui.RichText.create = function () {\n    return new ccui.RichText();\n};\n\n// Constants\n//Rich element type\n/**\n * The text type of rich element.\n * @constant\n * @type {number}\n */\nccui.RichElement.TEXT = 0;\n/**\n * The image type of rich element.\n * @constant\n * @type {number}\n */\nccui.RichElement.IMAGE = 1;\n/**\n * The custom type of rich element.\n * @constant\n * @type {number}\n */\nccui.RichElement.CUSTOM = 2;\n"]}