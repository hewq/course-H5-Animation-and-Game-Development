{"version":3,"sources":["../../../../../../assets/frameworks/cocos2d-html5/tools/assets/frameworks/cocos2d-html5/tools/XmlCheck.js"],"names":["fs","require","path","modules","JSON","parse","readFileSync","contains","i","read","name","existsSync","stat","statSync","isDirectory","splice","fileList","readdirSync","n","length","test","map","file","join","concat","console","log","moduleFile","module","p","filter","xmlFile","xmlFile2","fileStr","toString","index","arr","replace","a","b","c","d","push","normalize","forEach","some","basename","substr","indexOf"],"mappings":"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","file":"XmlCheck.js","sourceRoot":"../../../../../../assets/frameworks/cocos2d-html5/tools","sourcesContent":["const fs = require(\"fs\");\nconst path = require(\"path\");\nconst modules = JSON.parse(fs.readFileSync(\"../moduleConfig.json\"));\n\nvar contains = [\n    \"../cocos2d\",\n    \"../extensions\",\n    \"../external\",\n    \"../Base64Images.js\",\n    \"../CCBoot.js\",\n    \"../CCDebugger.js\"\n];\n(function(){\n    var i = 0;\n    function read(name){\n        if(fs.existsSync(name)){\n            var stat = fs.statSync(name);\n            if(stat.isDirectory()){\n                contains.splice(i--, 1);\n                var fileList = fs.readdirSync(name);\n                for(var n=0; n<fileList.length; n++){\n                    if(/^\\./.test(fileList[n])){\n                        fileList.splice(n--, 1);\n                    }\n                }\n                fileList = fileList.map(function(file){\n                    return path.join(name, file);\n                });\n                contains = contains.concat(fileList);\n            }\n        }\n    }\n    for(; i<contains.length; i++){\n        read(contains[i]);\n    }\n\n})();\n\nconsole.log(\"  The number of files in the engine : %d\", contains.length);\n\nvar moduleFile = [];\n(function(){\n    var module = modules.module;\n    for(var p in module){\n        moduleFile = moduleFile.concat(\n            module[p].filter(function(file){\n                if(file && /\\./.test(file))\n                    return file;\n            })\n        );\n    }\n\n    moduleFile = moduleFile.map(function(file){\n        return \"../\" + file;\n    });\n})();\n\nconsole.log(\"  Number of module within the definition file : %s\", moduleFile.length);\n\n\nvar xmlFile = [];\nvar xmlFile2 = [];\n(function(){\n    var fileStr = fs.readFileSync(\"./build.xml\").toString();\n    var index = 0, arr = [xmlFile, xmlFile2];\n    fileStr.replace(/\\<sources dir\\=\\\"\\.\\/\\.\\.\\/\\\"\\>((.|\\r\\n|\\r|\\n)*?)\\<\\/sources/g, function(a, b){\n        a.replace(/file name\\=\\\"(.*)\\\"\\/\\>/g, function(c, d){\n            arr[index] && arr[index].push(\"../\" + d);\n        });\n        index++;\n    });\n})();\nconsole.log(\"  The number of files in the XML file : %s\", xmlFile.length);\n\ncontains = contains.map(function(a){\n    return path.normalize(a);\n});\nmoduleFile = moduleFile.map(function(a){\n    return path.normalize(a);\n});\nxmlFile = xmlFile.map(function(a){\n    return path.normalize(a);\n});\nxmlFile2 = xmlFile2.map(function(a){\n    return path.normalize(a);\n});\n\nconsole.log(\"\\x1B[0m\\x1B[33m\");\nconsole.log(\"  warn : moduleConfig missing...\");\ncontains.forEach(function(a){\n    if(!moduleFile.some(function(b){return b==a}))\n        console.log(\"     \" + a);\n});\n\n\nconsole.log(\"\\x1B[0m\\x1B[92m\");\nconsole.log(\"  warn : engine dir missing...\");\nmoduleFile.forEach(function(a){\n    if(!contains.some(function(b){return b==a}))\n        console.log(\"     \" + a);\n});\n\n\nconsole.log(\"\\x1B[0m\\x1B[96m\");\nconsole.log(\"  warn : xml(all) file missing...\");\ncontains.forEach(function(a){\n    if(!xmlFile.some(function(b){return b==a}))\n        console.log(\"     \" + a);\n});\n\n\nconsole.log(\"\\x1B[0m\\x1B[91m\");\nconsole.log(\"  warn : xml(all) redundant files...\");\nxmlFile.forEach(function(a){\n    if(!contains.some(function(b){return b==a}))\n        console.log(\"     \" + a);\n});\n\n\nconsole.log(\"\\x1B[0m\\x1B[94m\");\nconsole.log(\"  warn : xml(core) maybe missing files...\");\nxmlFile2.forEach(function(a){\n    var basename = path.basename(a);\n    basename = basename.substr(0, basename.indexOf(\".\"));\n    contains.forEach(function(b){\n        if(b.indexOf(basename) > -1 && a != b){\n            if(\n                b.indexOf(\"extensions\") == -1 &&\n                !xmlFile2.some(function(c){return b == c;})\n                )\n                console.log(\"     \" + b);\n        }\n    });\n});\n\n\nconsole.log(\"\\x1B[0m\\x1B[35m\");\nconsole.log(\"  warn : xml(core) redundant files...\");\nxmlFile2.forEach(function(a){\n    if(!contains.some(function(b){return b==a}))\n        console.log(\"     \" + a);\n});\nconsole.log(\"\\x1B[0m\");"]}