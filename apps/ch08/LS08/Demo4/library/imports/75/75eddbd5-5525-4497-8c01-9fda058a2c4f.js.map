{"version":3,"sources":["../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/jsb_cocosbuilder.js"],"names":["cc","BuilderReader","_resourcePath","_controllerClassCache","registerController","controllerName","controller","Class","extend","setResourcePath","rootPath","load","file","owner","parentSize","reader","_Reader","create","setCCBRootPath","node","ownerCallbackNames","getOwnerCallbackNames","ownerCallbackNodes","getOwnerCallbackNodes","i","length","callbackName","callbackNode","undefined","log","ControlButton","ownerCallbackControlEvents","getOwnerCallbackControlEvents","addTargetWithActionForControlEvents","setCallback","ownerOutletNames","getOwnerOutletNames","ownerOutletNodes","getOwnerOutletNodes","outletName","outletNode","nodesWithAnimationManagers","getNodesWithAnimationManagers","_nodesWithAnimationManagers","animationManagersForNodes","getAnimationManagersForNodes","controllerClassCache","innerNode","animationManager","getDocumentControllerName","controllerClass","rootNode","documentCallbackNames","getDocumentCallbackNames","documentCallbackNodes","getDocumentCallbackNodes","_documentCallbackNodes","j","documentCallbackControlEvents","getDocumentCallbackControlEvents","documentOutletNames","getDocumentOutletNames","documentOutletNodes","getDocumentOutletNodes","onDidLoadFromCCB","keyframeCallbacks","getKeyframeCallbacks","callbackSplit","split","callbackType","callfunc","CallFunc","setCallFunc","autoPlaySeqId","getAutoPlaySequenceId","runAnimationsForSequenceIdTweenDuration","loadAsScene","scene","Scene","addChild"],"mappings":"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","file":"jsb_cocosbuilder.js","sourceRoot":"../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script","sourcesContent":["/*\n * Copyright (c) 2013-2016 Chukong Technologies Inc.\n * Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n//\n// CocosBuilder definitions\n//\n\ncc.BuilderReader = cc.BuilderReader || {};\ncc.BuilderReader._resourcePath = \"\";\n\ncc.BuilderReader._controllerClassCache = {};\ncc.BuilderReader.registerController = function(controllerName, controller){\n    cc.BuilderReader._controllerClassCache[controllerName] = cc.Class.extend(controller);\n};\n\ncc.BuilderReader.setResourcePath = function (rootPath) {\n    cc.BuilderReader._resourcePath = rootPath;\n};\n\ncc.BuilderReader.load = function(file, owner, parentSize)\n{\n    // Load the node graph using the correct function\n    var reader = cc._Reader.create();\n    reader.setCCBRootPath(cc.BuilderReader._resourcePath);\n    \n    var node;\n\n    if (parentSize)\n    {\n        node = reader.load(file, null, parentSize);\n    }\n    else\n    {\n        node = reader.load(file);\n    }\n\n    // Assign owner callbacks & member variables\n    if (owner)\n    {\n        // Callbacks\n        var ownerCallbackNames = reader.getOwnerCallbackNames();\n        var ownerCallbackNodes = reader.getOwnerCallbackNodes();\n\n        for (var i = 0; i < ownerCallbackNames.length; i++)\n        {\n            var callbackName = ownerCallbackNames[i];\n            var callbackNode = ownerCallbackNodes[i];\n\n            if (owner[callbackName] === undefined)\n            {\n                cc.log(\"Warning: \" + \"owner.\" + callbackName + \" is undefined.\");\n            }\n            else\n            {\n                if(callbackNode instanceof cc.ControlButton)\n                {\n                    var ownerCallbackControlEvents = reader.getOwnerCallbackControlEvents();\n                    callbackNode.addTargetWithActionForControlEvents(owner, owner[callbackName], ownerCallbackControlEvents[i]);\n                }\n                else\n                {\n                    callbackNode.setCallback(owner[callbackName], owner);\n                }\n            }\n        }\n\n        // Variables\n        var ownerOutletNames = reader.getOwnerOutletNames();\n        var ownerOutletNodes = reader.getOwnerOutletNodes();\n\n        for (var i = 0; i < ownerOutletNames.length; i++)\n        {\n            var outletName = ownerOutletNames[i];\n            var outletNode = ownerOutletNodes[i];\n\n            owner[outletName] = outletNode;\n        }\n    }\n\n    var nodesWithAnimationManagers = reader.getNodesWithAnimationManagers();\n    node._nodesWithAnimationManagers = nodesWithAnimationManagers;\n    var animationManagersForNodes = reader.getAnimationManagersForNodes();\n\n    var controllerClassCache = cc.BuilderReader._controllerClassCache;\n    // Attach animation managers to nodes and assign root node callbacks and member variables\n    for (var i = 0; i < nodesWithAnimationManagers.length; i++)\n    {\n        var innerNode = nodesWithAnimationManagers[i];\n        var animationManager = animationManagersForNodes[i];\n\n        innerNode.animationManager = animationManager;\n\n        var controllerName = animationManager.getDocumentControllerName();\n        if (!controllerName) continue;\n\n        // Create a controller\n        var controllerClass = controllerClassCache[controllerName];\n        if(!controllerClass) throw \"Can not find controller : \" + controllerName;\n        var controller = new controllerClass();\n        controller.controllerName = controllerName;\n\n        innerNode.controller = controller;\n        controller.rootNode = innerNode;\n\n        // Callbacks\n        var documentCallbackNames = animationManager.getDocumentCallbackNames();\n        var documentCallbackNodes = animationManager.getDocumentCallbackNodes();\n        innerNode._documentCallbackNodes = documentCallbackNodes;\n\n        for (var j = 0; j < documentCallbackNames.length; j++)\n        {\n            var callbackName = documentCallbackNames[j];\n            var callbackNode = documentCallbackNodes[j];\n\n            if (controller[callbackName] === undefined)\n            {\n                cc.log(\"Warning: \" + controllerName + \".\" + callbackName + \" is undefined.\");\n            }\n            else\n            {\n                if(callbackNode instanceof cc.ControlButton)\n                {\n                    var documentCallbackControlEvents = animationManager.getDocumentCallbackControlEvents();\n                    callbackNode.addTargetWithActionForControlEvents(controller, controller[callbackName], documentCallbackControlEvents[j]); \n                }\n                else\n                {\n                    callbackNode.setCallback(controller[callbackName], controller);\n                }\n            }\n        }\n\n\n        // Variables\n        var documentOutletNames = animationManager.getDocumentOutletNames();\n        var documentOutletNodes = animationManager.getDocumentOutletNodes();\n\n        for (var j = 0; j < documentOutletNames.length; j++)\n        {\n            var outletName = documentOutletNames[j];\n            var outletNode = documentOutletNodes[j];\n\n            controller[outletName] = outletNode;\n        }\n\n        if (typeof(controller.onDidLoadFromCCB) == \"function\")\n        {\n            controller.onDidLoadFromCCB();\n        }\n\n        // Setup timeline callbacks\n        var keyframeCallbacks = animationManager.getKeyframeCallbacks();\n        for (var j = 0; j < keyframeCallbacks.length; j++)\n        {\n            var callbackSplit = keyframeCallbacks[j].split(\":\");\n            var callbackType = callbackSplit[0];\n            var callbackName = callbackSplit[1];\n            \n            if (callbackType == 1) // Document callback\n            {\n                var callfunc = cc.CallFunc.create(controller[callbackName], controller);\n                animationManager.setCallFunc(callfunc, keyframeCallbacks[j]);\n            }\n            else if (callbackType == 2 && owner) // Owner callback\n            {\n                var callfunc = cc.CallFunc.create(owner[callbackName], owner);\n                animationManager.setCallFunc(callfunc, keyframeCallbacks[j]);\n            }\n        }\n        \n        // Start animation\n        var autoPlaySeqId = animationManager.getAutoPlaySequenceId();\n        if (autoPlaySeqId != -1)\n        {\n            animationManager.runAnimationsForSequenceIdTweenDuration(autoPlaySeqId, 0);\n        }\n    }\n\n    return node;\n};\n\ncc.BuilderReader.loadAsScene = function(file, owner, parentSize)\n{\n    var node = cc.BuilderReader.load(file, owner, parentSize);\n    var scene = cc.Scene.create();\n    scene.addChild( node );\n\n    return scene;\n};\n"]}