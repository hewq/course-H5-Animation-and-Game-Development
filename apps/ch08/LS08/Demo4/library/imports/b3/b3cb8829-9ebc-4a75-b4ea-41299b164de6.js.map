{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/labelttf/assets/frameworks/cocos2d-html5/cocos2d/core/labelttf/CCLabelTTFCanvasRenderCmd.js"],"names":["cc","LabelTTF","_textAlign","_textBaseline","wrapInspection","_wordRex","_symbolRex","_lastWordRex","_lastEnglish","_firsrEnglish","RenderCmd","_fontClientHeight","_fontStyleStr","_shadowColorStr","_strokeColorStr","_fillColorStr","_labelCanvas","_labelContext","_lineWidths","_strings","_isMultiLine","_status","_renderingIndex","_canUseDirtyRegion","proto","prototype","constructor","_labelCmdCtor","_setFontStyle","fontNameOrFontDef","fontSize","fontStyle","fontWeight","FontDefinition","_getCanvasFontStr","__getFontHeightByDiv","deviceFontSize","view","getDevicePixelRatio","_getFontStyle","_getFontClientHeight","_updateColor","_setColorsString","_updateTexture","locDisplayColor","_displayedColor","node","_node","locShadowColor","_shadowColor","locStrokeColor","_strokeColor","locFontFillColor","_textFillColor","dr","r","dg","g","db","b","_shadowOpacity","localBB","Rect","getLocalBB","x","y","pixelRatio","width","_getWidth","height","_getHeight","_updateTTF","locDimensionsWidth","_dimensions","i","strLength","locLineWidth","length","_measureConfig","textWidthCache","_string","split","_checkWarp","measuredWidth","_measure","push","locSize","locStrokeShadowOffsetX","locStrokeShadowOffsetY","_strokeEnabled","_strokeSize","_shadowEnabled","locOffsetSize","_shadowOffset","Math","abs","size","ceil","max","apply","getLineHeight","_fontSize","setContentSize","_strokeShadowOffsetX","_strokeShadowOffsetY","locAP","_anchorPoint","_anchorPointInPoints","_saveStatus","scale","locContentSizeHeight","_contentSize","locVAlignment","_vAlignment","locHAlignment","_hAlignment","dx","dy","xOffset","yOffset","OffsetYArray","locContentWidth","lineHeight","transformTop","TEXT_ALIGNMENT_RIGHT","TEXT_ALIGNMENT_CENTER","locStrLen","VERTICAL_TEXT_ALIGNMENT_BOTTOM","VERTICAL_TEXT_ALIGNMENT_CENTER","tmpOffsetY","VERTICAL_TEXT_ALIGNMENT_TOP","tmpStatus","contextTransform","p","_drawTTFInCanvas","context","locStatus","pop","setTransform","yOffsetArray","drawLabels","strArr","maxWidth","text","allWidth","fuzzyLen","tmpText","substr","sLine","pushNum","checkWhile","exec","sText","result","test","splice","updateStatus","flags","Node","_dirtyFlags","locFlag","_dirtyFlag","textDirty","originUpdateStatus","_syncStatus","parentCmd","_originSyncStatus","_renderType","game","RENDER_TYPE_WEBGL","transformDirty","transform","locShadowOffset","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","_shadowBlur","locStrokeSize","font","fillStyle","locStrokeEnabled","lineWidth","strokeStyle","textBaseline","textAlign","line","lineJoin","strokeText","fillText","g_NumberOfDraws","CacheRenderCmd","locCanvas","document","createElement","getContext","Object","create","inject","_cacheCmdCtor","_needUpdateTexture","locContentSize","locContext","locLabelCanvas","_texture","labelTexture","Texture2D","initWithElement","setTexture","_htmlElementObj","handleLoadedTexture","setTextureRect","rect","flag","clearRect","measureText","CacheCanvasRenderCmd","renderable","_spriteCmdCtor","Sprite","CanvasRenderCmd","_renderContext","rendering","ctx","scaleX","getScaleX","scaleY","getScaleY","wrapper","computeRealOffsetY","locIndex","status","locHeight","_rect","locX","_offsetPosition","locY","alpha","_displayedOpacity","_worldTransform","setCompositeOperation","_blendFuncStr","setGlobalAlpha","save","_flippedX","_flippedY","restore"],"mappings":"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","file":"CCLabelTTFCanvasRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/labelttf","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n http://www.cocos2d-x.org\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\ncc.LabelTTF._textAlign = [\"left\", \"center\", \"right\"];\ncc.LabelTTF._textBaseline = [\"top\", \"middle\", \"bottom\"];\n\n//check the first character\ncc.LabelTTF.wrapInspection = true;\n\n// These regular expressions consider a word any sequence of characters\n// from these Unicode (sub)blocks:\n// - Basic Latin (letters and numbers, plus the hypen-minus '-')\n// - Latin-1 Supplement (accentuated letters and ¿¡ only)\n// - Latin Extended-A (complete)\n// - Latin Extended-B (complete)\n// - IPA Extensions (complete)\n// - Spacing Modifier Letters (complete)\n// - Combining Diacritical Marks (Combining Grapheme Joiner excluded)\n// - Greek and Coptic (complete, including reserved code points)\n// - Cyrillic (complete)\n// - Cyrillic Supplement (complete)\n// - General Punctuation (Non-Breaking Hyphen* [U+2011] and quotation marks)\n// * Note that Hyphen [U+2010] is considered a word boundary.\ncc.LabelTTF._wordRex = /([a-zA-Z0-9\\-¿¡«À-ÖØ-öø-ʯ\\u0300-\\u034e\\u0350-\\u036FͰ-ԯ\\u2011‵-‷‹⁅]+|\\S)/;\ncc.LabelTTF._symbolRex = /^[!,.:;}\\]%\\?>、‘“》»？。，！\\u2010′-‴›‼⁆⁇-⁉]/;\ncc.LabelTTF._lastWordRex = /([a-zA-Z0-9\\-¿¡«À-ÖØ-öø-ʯ\\u0300-\\u034e\\u0350-\\u036FͰ-ԯ\\u2011‵-‷‹⁅]+|\\S)$/;\ncc.LabelTTF._lastEnglish = /[a-zA-Z0-9\\-¿¡«À-ÖØ-öø-ʯ\\u0300-\\u034e\\u0350-\\u036FͰ-ԯ\\u2011‵-‷‹⁅]+$/;\ncc.LabelTTF._firsrEnglish = /^[a-zA-Z0-9\\-¿¡«À-ÖØ-öø-ʯ\\u0300-\\u034e\\u0350-\\u036FͰ-ԯ\\u2011‵-‷‹⁅]/;\n\n(function () {\n    cc.LabelTTF.RenderCmd = function () {\n        this._fontClientHeight = 18;\n        this._fontStyleStr = \"\";\n        this._shadowColorStr = \"rgba(128, 128, 128, 0.5)\";\n        this._strokeColorStr = \"\";\n        this._fillColorStr = \"rgba(255,255,255,1)\";\n\n        this._labelCanvas = null;\n        this._labelContext = null;\n        this._lineWidths = [];\n        this._strings = [];\n        this._isMultiLine = false;\n        this._status = [];\n        this._renderingIndex = 0;\n\n        this._canUseDirtyRegion = true;\n    };\n    var proto = cc.LabelTTF.RenderCmd.prototype;\n    proto.constructor = cc.LabelTTF.RenderCmd;\n    proto._labelCmdCtor = cc.LabelTTF.RenderCmd;\n\n    proto._setFontStyle = function (fontNameOrFontDef, fontSize, fontStyle, fontWeight) {\n        if (fontNameOrFontDef instanceof cc.FontDefinition) {\n            this._fontStyleStr = fontNameOrFontDef._getCanvasFontStr();\n            this._fontClientHeight = cc.LabelTTF.__getFontHeightByDiv(fontNameOrFontDef);\n        } else {\n            var deviceFontSize = fontSize * cc.view.getDevicePixelRatio();\n            this._fontStyleStr = fontStyle + \" \" + fontWeight + \" \" + deviceFontSize + \"px '\" + fontNameOrFontDef + \"'\";\n            this._fontClientHeight = cc.LabelTTF.__getFontHeightByDiv(fontNameOrFontDef, fontSize);\n        }\n    };\n\n    proto._getFontStyle = function () {\n        return this._fontStyleStr;\n    };\n\n    proto._getFontClientHeight = function () {\n        return this._fontClientHeight;\n    };\n\n    proto._updateColor = function () {\n        this._setColorsString();\n        this._updateTexture();\n    };\n\n    proto._setColorsString = function () {\n        var locDisplayColor = this._displayedColor, node = this._node,\n            locShadowColor = node._shadowColor || this._displayedColor;\n        var locStrokeColor = node._strokeColor, locFontFillColor = node._textFillColor;\n        var dr = locDisplayColor.r / 255, dg = locDisplayColor.g / 255, db = locDisplayColor.b / 255;\n\n        this._shadowColorStr = \"rgba(\" + (0 | (dr * locShadowColor.r)) + \",\" + (0 | ( dg * locShadowColor.g)) + \",\"\n            + (0 | (db * locShadowColor.b)) + \",\" + node._shadowOpacity + \")\";\n        this._fillColorStr = \"rgba(\" + (0 | (dr * locFontFillColor.r)) + \",\" + (0 | (dg * locFontFillColor.g)) + \",\"\n            + (0 | (db * locFontFillColor.b)) + \", 1)\";\n        this._strokeColorStr = \"rgba(\" + (0 | (dr * locStrokeColor.r)) + \",\" + (0 | (dg * locStrokeColor.g)) + \",\"\n            + (0 | (db * locStrokeColor.b)) + \", 1)\";\n    };\n\n    var localBB = new cc.Rect();\n    proto.getLocalBB = function () {\n        var node = this._node;\n        localBB.x = localBB.y = 0;\n        var pixelRatio = cc.view.getDevicePixelRatio();\n        localBB.width = node._getWidth() * pixelRatio;\n        localBB.height = node._getHeight() * pixelRatio;\n        return localBB;\n    };\n\n    proto._updateTTF = function () {\n        var node = this._node;\n        var pixelRatio = cc.view.getDevicePixelRatio();\n        var locDimensionsWidth = node._dimensions.width * pixelRatio, i, strLength;\n        var locLineWidth = this._lineWidths;\n        locLineWidth.length = 0;\n\n        this._isMultiLine = false;\n        this._measureConfig();\n        var textWidthCache = {};\n        if (locDimensionsWidth !== 0) {\n            // Content processing\n            this._strings = node._string.split('\\n');\n\n            for (i = 0; i < this._strings.length; i++) {\n                this._checkWarp(this._strings, i, locDimensionsWidth);\n            }\n        } else {\n            this._strings = node._string.split('\\n');\n            for (i = 0, strLength = this._strings.length; i < strLength; i++) {\n                if(this._strings[i]) {\n                    var measuredWidth = this._measure(this._strings[i]);\n                    locLineWidth.push(measuredWidth);\n                    textWidthCache[this._strings[i]] = measuredWidth;\n                } else {\n                    locLineWidth.push(0);\n                }\n            }\n        }\n\n        if (this._strings.length > 1)\n            this._isMultiLine = true;\n\n        var locSize, locStrokeShadowOffsetX = 0, locStrokeShadowOffsetY = 0;\n        if (node._strokeEnabled)\n            locStrokeShadowOffsetX = locStrokeShadowOffsetY = node._strokeSize * 2;\n        if (node._shadowEnabled) {\n            var locOffsetSize = node._shadowOffset;\n            locStrokeShadowOffsetX += Math.abs(locOffsetSize.x) * 2;\n            locStrokeShadowOffsetY += Math.abs(locOffsetSize.y) * 2;\n        }\n\n        //get offset for stroke and shadow\n        if (locDimensionsWidth === 0) {\n            if (this._isMultiLine) {\n                locSize = cc.size(Math.ceil(Math.max.apply(Math, locLineWidth) + locStrokeShadowOffsetX),\n                                  Math.ceil((this._fontClientHeight * pixelRatio * this._strings.length) + locStrokeShadowOffsetY));\n            }\n            else {\n                var measuredWidth = textWidthCache[node._string];\n                if(!measuredWidth && node._string) {\n                    measuredWidth = this._measure(node._string);\n                }\n                locSize = cc.size(Math.ceil((measuredWidth ? measuredWidth : 0) + locStrokeShadowOffsetX),\n                                  Math.ceil(this._fontClientHeight * pixelRatio + locStrokeShadowOffsetY));\n            }\n        } else {\n            if (node._dimensions.height === 0) {\n                if (this._isMultiLine)\n                    locSize = cc.size(\n                        Math.ceil(locDimensionsWidth + locStrokeShadowOffsetX),\n                        Math.ceil((node.getLineHeight() * pixelRatio * this._strings.length) + locStrokeShadowOffsetY));\n                else\n                    locSize = cc.size(\n                        Math.ceil(locDimensionsWidth + locStrokeShadowOffsetX),\n                        Math.ceil(node.getLineHeight() * pixelRatio + locStrokeShadowOffsetY));\n            } else {\n                //dimension is already set, contentSize must be same as dimension\n                locSize = cc.size(\n                    Math.ceil(locDimensionsWidth + locStrokeShadowOffsetX),\n                    Math.ceil(node._dimensions.height * pixelRatio + locStrokeShadowOffsetY));\n            }\n        }\n        if (node._getFontStyle() !== \"normal\") {    //add width for 'italic' and 'oblique'\n            locSize.width = Math.ceil(locSize.width + node._fontSize * 0.3);\n        }\n        node.setContentSize(locSize);\n        node._strokeShadowOffsetX = locStrokeShadowOffsetX;\n        node._strokeShadowOffsetY = locStrokeShadowOffsetY;\n\n        // need computing _anchorPointInPoints\n        var locAP = node._anchorPoint;\n        this._anchorPointInPoints.x = (locStrokeShadowOffsetX * 0.5) + ((locSize.width - locStrokeShadowOffsetX) * locAP.x);\n        this._anchorPointInPoints.y = (locStrokeShadowOffsetY * 0.5) + ((locSize.height - locStrokeShadowOffsetY) * locAP.y);\n    };\n\n    proto._saveStatus = function () {\n        var node = this._node;\n        var scale = cc.view.getDevicePixelRatio();\n        var locStrokeShadowOffsetX = node._strokeShadowOffsetX, locStrokeShadowOffsetY = node._strokeShadowOffsetY;\n        var locContentSizeHeight = node._contentSize.height - locStrokeShadowOffsetY, locVAlignment = node._vAlignment,\n            locHAlignment = node._hAlignment;\n        var dx = locStrokeShadowOffsetX * 0.5,\n            dy = locContentSizeHeight + locStrokeShadowOffsetY * 0.5;\n        var xOffset = 0, yOffset = 0, OffsetYArray = [];\n        var locContentWidth = node._contentSize.width - locStrokeShadowOffsetX;\n\n        //lineHeight\n        var lineHeight = node.getLineHeight() * scale;\n        var transformTop = (lineHeight - this._fontClientHeight * scale) / 2;\n\n        if (locHAlignment === cc.TEXT_ALIGNMENT_RIGHT)\n            xOffset += locContentWidth;\n        else if (locHAlignment === cc.TEXT_ALIGNMENT_CENTER)\n            xOffset += locContentWidth / 2;\n        else\n            xOffset += 0;\n\n        if (this._isMultiLine) {\n            var locStrLen = this._strings.length;\n            if (locVAlignment === cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM)\n                yOffset = lineHeight - transformTop * 2 + locContentSizeHeight - lineHeight * locStrLen;\n            else if (locVAlignment === cc.VERTICAL_TEXT_ALIGNMENT_CENTER)\n                yOffset = (lineHeight - transformTop * 2) / 2 + (locContentSizeHeight - lineHeight * locStrLen) / 2;\n\n            for (var i = 0; i < locStrLen; i++) {\n                var tmpOffsetY = -locContentSizeHeight + (lineHeight * i + transformTop) + yOffset;\n                OffsetYArray.push(tmpOffsetY);\n            }\n        } else {\n            if (locVAlignment === cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM) {\n                //do nothing\n            } else if (locVAlignment === cc.VERTICAL_TEXT_ALIGNMENT_TOP) {\n                yOffset -= locContentSizeHeight;\n            } else {\n                yOffset -= locContentSizeHeight * 0.5;\n            }\n            OffsetYArray.push(yOffset);\n        }\n        var tmpStatus = {\n            contextTransform: cc.p(dx, dy),\n            xOffset: xOffset,\n            OffsetYArray: OffsetYArray\n        };\n        this._status.push(tmpStatus);\n    };\n\n    proto._drawTTFInCanvas = function (context) {\n        if (!context)\n            return;\n        var locStatus = this._status.pop();\n        context.setTransform(1, 0, 0, 1, locStatus.contextTransform.x, locStatus.contextTransform.y);\n        var xOffset = locStatus.xOffset;\n        var yOffsetArray = locStatus.OffsetYArray;\n        this.drawLabels(context, xOffset, yOffsetArray);\n    };\n\n    proto._checkWarp = function (strArr, i, maxWidth) {\n        var text = strArr[i];\n        var allWidth = this._measure(text);\n        if (allWidth > maxWidth && text.length > 1) {\n\n            var fuzzyLen = text.length * ( maxWidth / allWidth ) | 0;\n            var tmpText = text.substr(fuzzyLen);\n            var width = allWidth - this._measure(tmpText);\n            var sLine;\n            var pushNum = 0;\n\n            //Increased while cycle maximum ceiling. default 100 time\n            var checkWhile = 0;\n\n            //Exceeded the size\n            while (width > maxWidth && checkWhile++ < 100) {\n                fuzzyLen *= maxWidth / width;\n                fuzzyLen = fuzzyLen | 0;\n                tmpText = text.substr(fuzzyLen);\n                width = allWidth - this._measure(tmpText);\n            }\n\n            checkWhile = 0;\n\n            //Find the truncation point\n            while (width < maxWidth && checkWhile++ < 100) {\n                if (tmpText) {\n                    var exec = cc.LabelTTF._wordRex.exec(tmpText);\n                    pushNum = exec ? exec[0].length : 1;\n                    sLine = tmpText;\n                }\n\n                fuzzyLen = fuzzyLen + pushNum;\n                tmpText = text.substr(fuzzyLen);\n                width = allWidth - this._measure(tmpText);\n            }\n\n            fuzzyLen -= pushNum;\n            if (fuzzyLen === 0) {\n                fuzzyLen = 1;\n                sLine = sLine.substr(1);\n            }\n\n            var sText = text.substr(0, fuzzyLen), result;\n\n            //symbol in the first\n            if (cc.LabelTTF.wrapInspection) {\n                if (cc.LabelTTF._symbolRex.test(sLine || tmpText)) {\n                    result = cc.LabelTTF._lastWordRex.exec(sText);\n                    fuzzyLen -= result ? result[0].length : 0;\n                    if (fuzzyLen === 0) fuzzyLen = 1;\n\n                    sLine = text.substr(fuzzyLen);\n                    sText = text.substr(0, fuzzyLen);\n                }\n            }\n\n            //To judge whether a English words are truncated\n            if (cc.LabelTTF._firsrEnglish.test(sLine)) {\n                result = cc.LabelTTF._lastEnglish.exec(sText);\n                if (result && sText !== result[0]) {\n                    fuzzyLen -= result[0].length;\n                    sLine = text.substr(fuzzyLen);\n                    sText = text.substr(0, fuzzyLen);\n                }\n            }\n\n            strArr[i] = sLine || tmpText;\n            strArr.splice(i, 0, sText);\n        }\n    };\n\n    proto.updateStatus = function () {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        \n        if (locFlag & flags.textDirty)\n            this._updateTexture();\n\n        this.originUpdateStatus();\n    };\n\n    proto._syncStatus = function (parentCmd) {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n\n        if (locFlag & flags.textDirty)\n            this._updateTexture();\n\n        this._originSyncStatus(parentCmd);\n\n        if (cc._renderType === cc.game.RENDER_TYPE_WEBGL || locFlag & flags.transformDirty)\n            this.transform(parentCmd);\n    };\n\n    proto.drawLabels = function (context, xOffset, yOffsetArray) {\n        var node = this._node;\n        //shadow style setup\n        if (node._shadowEnabled) {\n            var locShadowOffset = node._shadowOffset;\n            context.shadowColor = this._shadowColorStr;\n            context.shadowOffsetX = locShadowOffset.x;\n            context.shadowOffsetY = -locShadowOffset.y;\n            context.shadowBlur = node._shadowBlur;\n        }\n\n        var locHAlignment = node._hAlignment,\n            locVAlignment = node._vAlignment,\n            locStrokeSize = node._strokeSize;\n\n        //this is fillText for canvas\n        if (context.font !== this._fontStyleStr)\n            context.font = this._fontStyleStr;\n        context.fillStyle = this._fillColorStr;\n\n        //stroke style setup\n        var locStrokeEnabled = node._strokeEnabled;\n        if (locStrokeEnabled) {\n            context.lineWidth = locStrokeSize * 2;\n            context.strokeStyle = this._strokeColorStr;\n        }\n\n        context.textBaseline = cc.LabelTTF._textBaseline[locVAlignment];\n        context.textAlign = cc.LabelTTF._textAlign[locHAlignment];\n\n        var locStrLen = this._strings.length;\n        for (var i = 0; i < locStrLen; i++) {\n            var line = this._strings[i];\n            if (locStrokeEnabled) {\n                context.lineJoin = 'round';\n                context.strokeText(line, xOffset, yOffsetArray[i]);\n            }\n            context.fillText(line, xOffset, yOffsetArray[i]);\n        }\n        cc.g_NumberOfDraws++;\n    };\n})();\n\n(function () {\n    cc.LabelTTF.CacheRenderCmd = function () {\n        this._labelCmdCtor();\n        var locCanvas = this._labelCanvas = document.createElement(\"canvas\");\n        locCanvas.width = 1;\n        locCanvas.height = 1;\n        this._labelContext = locCanvas.getContext(\"2d\");\n    };\n\n    cc.LabelTTF.CacheRenderCmd.prototype = Object.create(cc.LabelTTF.RenderCmd.prototype);\n    cc.inject(cc.LabelTTF.RenderCmd.prototype, cc.LabelTTF.CacheRenderCmd.prototype);\n\n    var proto = cc.LabelTTF.CacheRenderCmd.prototype;\n    proto.constructor = cc.LabelTTF.CacheRenderCmd;\n    proto._cacheCmdCtor = cc.LabelTTF.CacheRenderCmd;\n\n    proto._updateTexture = function () {\n        this._dirtyFlag = this._dirtyFlag & cc.Node._dirtyFlags.textDirty ^ this._dirtyFlag;\n        var node = this._node;\n        node._needUpdateTexture = false;\n        var locContentSize = node._contentSize;\n        this._updateTTF();\n        var width = locContentSize.width, height = locContentSize.height;\n\n        var locContext = this._labelContext, locLabelCanvas = this._labelCanvas;\n\n        if (!node._texture) {\n            var labelTexture = new cc.Texture2D();\n            labelTexture.initWithElement(this._labelCanvas);\n            node.setTexture(labelTexture);\n        }\n\n        if (node._string.length === 0) {\n            locLabelCanvas.width = 1;\n            locLabelCanvas.height = locContentSize.height || 1;\n            if (node._texture) {\n                node._texture._htmlElementObj = this._labelCanvas;\n                node._texture.handleLoadedTexture();\n            }\n            node.setTextureRect(cc.rect(0, 0, 1, locContentSize.height));\n            return true;\n        }\n\n        //set size for labelCanvas\n        locContext.font = this._fontStyleStr;\n\n        var flag = locLabelCanvas.width === width && locLabelCanvas.height === height;\n        locLabelCanvas.width = width;\n        locLabelCanvas.height = height;\n        if (flag) locContext.clearRect(0, 0, width, height);\n        this._saveStatus();\n        this._drawTTFInCanvas(locContext);\n        if (node._texture) {\n            node._texture._htmlElementObj = this._labelCanvas;\n            node._texture.handleLoadedTexture();\n        }\n        node.setTextureRect(cc.rect(0, 0, width, height));\n        return true;\n    };\n\n    proto._measureConfig = function () {\n        this._labelContext.font = this._fontStyleStr;\n    };\n\n    proto._measure = function (text) {\n        if (text) {\n            return this._labelContext.measureText(text).width;\n        } else {\n            return 0;\n        }\n    };\n\n})();\n\n(function () {\n    cc.LabelTTF.CacheCanvasRenderCmd = function (renderable) {\n        this._spriteCmdCtor(renderable);\n        this._cacheCmdCtor();\n    };\n\n    var proto = cc.LabelTTF.CacheCanvasRenderCmd.prototype = Object.create(cc.Sprite.CanvasRenderCmd.prototype);\n    cc.inject(cc.LabelTTF.CacheRenderCmd.prototype, proto);\n    proto.constructor = cc.LabelTTF.CacheCanvasRenderCmd;\n})();\n\n(function () {\n    cc.LabelTTF.CanvasRenderCmd = function (renderable) {\n        this._spriteCmdCtor(renderable);\n        this._labelCmdCtor();\n    };\n\n    cc.LabelTTF.CanvasRenderCmd.prototype = Object.create(cc.Sprite.CanvasRenderCmd.prototype);\n    cc.inject(cc.LabelTTF.RenderCmd.prototype, cc.LabelTTF.CanvasRenderCmd.prototype);\n\n    var proto = cc.LabelTTF.CanvasRenderCmd.prototype;\n    proto.constructor = cc.LabelTTF.CanvasRenderCmd;\n\n    proto._measureConfig = function () {\n    };\n\n    proto._measure = function (text) {\n        if(text) {\n            var context = cc._renderContext.getContext();\n            context.font = this._fontStyleStr;\n            return context.measureText(text).width;\n        } else {\n            return 0;\n        }\n    };\n\n    proto._updateTexture = function () {\n        this._dirtyFlag = this._dirtyFlag & cc.Node._dirtyFlags.textDirty ^ this._dirtyFlag;\n        var node = this._node;\n        var locContentSize = node._contentSize;\n        this._updateTTF();\n        var width = locContentSize.width, height = locContentSize.height;\n        if (node._string.length === 0) {\n            node.setTextureRect(cc.rect(0, 0, 1, locContentSize.height));\n            return true;\n        }\n        this._saveStatus();\n        node.setTextureRect(cc.rect(0, 0, width, height));\n        return true;\n    };\n\n    proto.rendering = function (ctx) {\n        var scaleX = cc.view.getScaleX(),\n            scaleY = cc.view.getScaleY();\n        var wrapper = ctx || cc._renderContext, context = wrapper.getContext();\n        if (!context)\n            return;\n        var node = this._node;\n        wrapper.computeRealOffsetY();\n        if (this._status.length <= 0)\n            return;\n        var locIndex = (this._renderingIndex >= this._status.length) ? this._renderingIndex - this._status.length : this._renderingIndex;\n        var status = this._status[locIndex];\n        this._renderingIndex = locIndex + 1;\n\n        var locHeight = node._rect.height,\n            locX = node._offsetPosition.x,\n            locY = -node._offsetPosition.y - locHeight;\n\n        var alpha = (this._displayedOpacity / 255);\n\n        wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n        wrapper.setCompositeOperation(this._blendFuncStr);\n        wrapper.setGlobalAlpha(alpha);\n\n        wrapper.save();\n\n        if (node._flippedX) {\n            locX = -locX - node._rect.width;\n            context.scale(-1, 1);\n        }\n        if (node._flippedY) {\n            locY = node._offsetPosition.y;\n            context.scale(1, -1);\n        }\n\n        var xOffset = status.xOffset + status.contextTransform.x + locX * scaleX;\n        var yOffsetArray = [];\n\n        var locStrLen = this._strings.length;\n        for (var i = 0; i < locStrLen; i++)\n            yOffsetArray.push(status.OffsetYArray[i] + status.contextTransform.y + locY * scaleY);\n\n        this.drawLabels(context, xOffset, yOffsetArray);\n        wrapper.restore();\n    };\n})();\n"]}