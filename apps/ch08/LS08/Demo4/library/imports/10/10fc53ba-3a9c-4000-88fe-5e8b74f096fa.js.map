{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath/assets/frameworks/cocos2d-html5/cocos2d/kazmath/quaternion.js"],"names":["cc","math","Quaternion","x","y","z","w","undefined","kmQuaternion","proto","prototype","conjugate","quaternion","dot","exponential","identity","inverse","len","length","Math","abs","EPSILON","scale","isIdentity","sqrt","lengthSq","multiply","normalize","Error","rotationAxis","axis","angle","rad","sin","cos","rotationMatrix","mat3","m4x4","mat","pMatrix","diagonal","rotationYawPitchRoll","yaw","pitch","roll","ex","ey","ez","cr","cp","cy","sr","sp","sy","cpcy","spsy","degreesToRadians","ret","slerp","t","ct","theta","acos","st","square","stt","somt","temp2","add","toAxisAndAngle","tempAngle","retAngle","retAxis","Vec3","PI","assignFrom","rotationBetweenVec3","vec1","vec2","fallback","v1","v2","a","cross","fill","s","invs","multiplyVec3","vec","retVec","uv","uuv","q"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA,CAAC,UAASA,EAAT,EAAa;AACV;;;;;;;;AAQAA,OAAGC,IAAH,CAAQC,UAAR,GAAqB,UAAUC,CAAV,EAAaC,CAAb,EAAgBC,CAAhB,EAAmBC,CAAnB,EAAsB;AACvC,YAAIH,KAAKC,MAAMG,SAAf,EAA0B;AACtB,iBAAKJ,CAAL,GAASA,EAAEA,CAAX;AACA,iBAAKC,CAAL,GAASD,EAAEC,CAAX;AACA,iBAAKC,CAAL,GAASF,EAAEE,CAAX;AACA,iBAAKC,CAAL,GAASH,EAAEG,CAAX;AACH,SALD,MAKO;AACH,iBAAKH,CAAL,GAASA,KAAK,CAAd;AACA,iBAAKC,CAAL,GAASA,KAAK,CAAd;AACA,iBAAKC,CAAL,GAASA,KAAK,CAAd;AACA,iBAAKC,CAAL,GAASA,KAAK,CAAd;AACH;AACJ,KAZD;AAaAN,OAAGQ,YAAH,GAAkBR,GAAGC,IAAH,CAAQC,UAA1B;AACA,QAAIO,QAAQT,GAAGC,IAAH,CAAQC,UAAR,CAAmBQ,SAA/B;;AAEA;;;;AAIAD,UAAME,SAAN,GAAkB,UAAUC,UAAV,EAAsB;AAAI;AACxC,aAAKT,CAAL,GAAS,CAACS,WAAWT,CAArB;AACA,aAAKC,CAAL,GAAS,CAACQ,WAAWR,CAArB;AACA,aAAKC,CAAL,GAAS,CAACO,WAAWP,CAArB;AACA,aAAKC,CAAL,GAASM,WAAWN,CAApB;AACA,eAAO,IAAP;AACH,KAND;;AAQA;;;;;AAKAG,UAAMI,GAAN,GAAY,UAASD,UAAT,EAAqB;AAAK;AAClC;AACA,eAAQ,KAAKN,CAAL,GAASM,WAAWN,CAApB,GAAwB,KAAKH,CAAL,GAASS,WAAWT,CAA5C,GAAgD,KAAKC,CAAL,GAASQ,WAAWR,CAApE,GAAwE,KAAKC,CAAL,GAASO,WAAWP,CAApG;AACH,KAHD;;AAKA;;;;AAIAI,UAAMK,WAAN,GAAoB,YAAU;AAAI;AAC9B,eAAO,IAAP;AACH,KAFD;;AAIA;;;AAGAL,UAAMM,QAAN,GAAiB,YAAU;AAAI;AAC3B,aAAKZ,CAAL,GAAS,GAAT;AACA,aAAKC,CAAL,GAAS,GAAT;AACA,aAAKC,CAAL,GAAS,GAAT;AACA,aAAKC,CAAL,GAAS,GAAT;AACA,eAAO,IAAP;AACH,KAND;;AAQA;;;AAGAG,UAAMO,OAAN,GAAgB,YAAU;AAAY;AAClC,YAAIC,MAAM,KAAKC,MAAL,EAAV;AACA,YAAIC,KAAKC,GAAL,CAASH,GAAT,IAAgBjB,GAAGC,IAAH,CAAQoB,OAA5B,EAAqC;AACjC,iBAAKlB,CAAL,GAAS,GAAT;AACA,iBAAKC,CAAL,GAAS,GAAT;AACA,iBAAKC,CAAL,GAAS,GAAT;AACA,iBAAKC,CAAL,GAAS,GAAT;AACA,mBAAO,IAAP;AACH;;AAED;AACA,aAAKK,SAAL,CAAe,IAAf,EAAqBW,KAArB,CAA2B,MAAML,GAAjC;AACA,eAAO,IAAP;AACH,KAbD;;AAeA;;;;AAIAR,UAAMc,UAAN,GAAmB,YAAU;AAAM;AAC/B,eAAQ,KAAKpB,CAAL,KAAW,GAAX,IAAkB,KAAKC,CAAL,KAAW,GAA7B,IAAoC,KAAKC,CAAL,KAAW,GAA/C,IAAsD,KAAKC,CAAL,KAAW,GAAzE;AACH,KAFD;;AAIA;;;;AAIAG,UAAMS,MAAN,GAAe,YAAW;AAAQ;AAC9B,eAAOC,KAAKK,IAAL,CAAU,KAAKC,QAAL,EAAV,CAAP;AACH,KAFD;;AAIA;;;;AAIAhB,UAAMgB,QAAN,GAAiB,YAAW;AAAI;AAC5B,eAAO,KAAKtB,CAAL,GAAS,KAAKA,CAAd,GAAkB,KAAKC,CAAL,GAAS,KAAKA,CAAhC,GAAoC,KAAKC,CAAL,GAAS,KAAKA,CAAlD,GAAsD,KAAKC,CAAL,GAAS,KAAKA,CAA3E;AACH,KAFD;;AAIA;;;;;AAKAG,UAAMiB,QAAN,GAAiB,UAASd,UAAT,EAAqB;AAAM;AACxC,YAAIT,IAAI,KAAKA,CAAb;AAAA,YAAgBC,IAAI,KAAKA,CAAzB;AAAA,YAA4BC,IAAI,KAAKA,CAArC;AAAA,YAAwCC,IAAI,KAAKA,CAAjD;AACA,aAAKA,CAAL,GAASA,IAAIM,WAAWN,CAAf,GAAmBH,IAAIS,WAAWT,CAAlC,GAAsCC,IAAIQ,WAAWR,CAArD,GAAyDC,IAAIO,WAAWP,CAAjF;AACA,aAAKF,CAAL,GAASG,IAAIM,WAAWT,CAAf,GAAmBA,IAAIS,WAAWN,CAAlC,GAAsCF,IAAIQ,WAAWP,CAArD,GAAyDA,IAAIO,WAAWR,CAAjF;AACA,aAAKA,CAAL,GAASE,IAAIM,WAAWR,CAAf,GAAmBA,IAAIQ,WAAWN,CAAlC,GAAsCD,IAAIO,WAAWT,CAArD,GAAyDA,IAAIS,WAAWP,CAAjF;AACA,aAAKA,CAAL,GAASC,IAAIM,WAAWP,CAAf,GAAmBA,IAAIO,WAAWN,CAAlC,GAAsCH,IAAIS,WAAWR,CAArD,GAAyDA,IAAIQ,WAAWT,CAAjF;AACA,eAAO,IAAP;AACH,KAPD;;AASA;;;;AAIAM,UAAMkB,SAAN,GAAkB,YAAU;AAAM;AAC9B,YAAIT,SAAS,KAAKA,MAAL,EAAb;AACA,YAAIC,KAAKC,GAAL,CAASF,MAAT,KAAoBlB,GAAGC,IAAH,CAAQoB,OAAhC,EACI,MAAM,IAAIO,KAAJ,CAAU,wCAAV,CAAN;AACJ,aAAKN,KAAL,CAAW,MAAMJ,MAAjB;AACA,eAAO,IAAP;AACH,KAND;;AAQA;;;;;AAKAT,UAAMoB,YAAN,GAAqB,UAASC,IAAT,EAAeC,KAAf,EAAqB;AAAS;AAC/C,YAAIC,MAAMD,QAAQ,GAAlB;AAAA,YAAuBT,QAAQH,KAAKc,GAAL,CAASD,GAAT,CAA/B;AACA,aAAK1B,CAAL,GAASa,KAAKe,GAAL,CAASF,GAAT,CAAT;AACA,aAAK7B,CAAL,GAAS2B,KAAK3B,CAAL,GAASmB,KAAlB;AACA,aAAKlB,CAAL,GAAS0B,KAAK1B,CAAL,GAASkB,KAAlB;AACA,aAAKjB,CAAL,GAASyB,KAAKzB,CAAL,GAASiB,KAAlB;AACA,eAAO,IAAP;AACH,KAPD;;AASA;;;;;AAKAtB,OAAGC,IAAH,CAAQC,UAAR,CAAmBiC,cAAnB,GAAoC,UAAUC,IAAV,EAAgB;AAAS;AACzD,YAAI,CAACA,IAAL,EACI,OAAO,IAAP;;AAEJ,YAAIjC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAaC,CAAb;AACA,YAAI+B,OAAO,EAAX;AAAA,YAAeC,MAAMF,KAAKE,GAA1B;AAAA,YAA+BhB,QAAQ,GAAvC;;AAEA;;;;;;;AAQAe,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,CAAL,IAAUC,IAAI,CAAJ,CAAV;AACAD,aAAK,EAAL,IAAWC,IAAI,CAAJ,CAAX;AACAD,aAAK,EAAL,IAAW,CAAX;AACA,YAAIE,UAAUF,KAAK,CAAL,CAAd;;AAEA,YAAIG,WAAWD,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAb,GAA0BA,QAAQ,EAAR,CAA1B,GAAwC,CAAvD;AACA,YAAIC,WAAWxC,GAAGC,IAAH,CAAQoB,OAAvB,EAAgC;AAC5B;AACAC,oBAAQH,KAAKK,IAAL,CAAUgB,QAAV,IAAsB,CAA9B;;AAEA;AACArC,gBAAI,CAAEoC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAf,IAA8BjB,KAAlC;AACAlB,gBAAI,CAAEmC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAf,IAA8BjB,KAAlC;AACAjB,gBAAI,CAAEkC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAf,IAA8BjB,KAAlC;AACAhB,gBAAI,OAAOgB,KAAX;AACH,SATD,MASO;AACH;AACA,gBAAIiB,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAb,IAA2BA,QAAQ,CAAR,IAAaA,QAAQ,EAAR,CAA5C,EAAyD;AACrD;AACAjB,wBAAQH,KAAKK,IAAL,CAAU,MAAMe,QAAQ,CAAR,CAAN,GAAmBA,QAAQ,CAAR,CAAnB,GAAgCA,QAAQ,EAAR,CAA1C,IAAyD,GAAjE;;AAEA;AACApC,oBAAI,OAAOmB,KAAX;AACAlB,oBAAI,CAACmC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACAjB,oBAAI,CAACkC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACAhB,oBAAI,CAACiC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACH;AACD;AAVA,iBAWK,IAAIiB,QAAQ,CAAR,IAAaA,QAAQ,EAAR,CAAjB,EAA8B;AAC/B;AACAjB,4BAAQH,KAAKK,IAAL,CAAU,MAAMe,QAAQ,CAAR,CAAN,GAAmBA,QAAQ,CAAR,CAAnB,GAAgCA,QAAQ,EAAR,CAA1C,IAAyD,GAAjE;;AAEA;AACApC,wBAAI,CAACoC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACAlB,wBAAI,OAAOkB,KAAX;AACAjB,wBAAI,CAACkC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACAhB,wBAAI,CAACiC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACH,iBATI,MASE;AACH;;AAEA;AACAA,4BAAQH,KAAKK,IAAL,CAAU,MAAMe,QAAQ,EAAR,CAAN,GAAoBA,QAAQ,CAAR,CAApB,GAAiCA,QAAQ,CAAR,CAA3C,IAAyD,GAAjE;;AAEA;AACApC,wBAAI,CAACoC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACAlB,wBAAI,CAACmC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACAjB,wBAAI,OAAOiB,KAAX;AACAhB,wBAAI,CAACiC,QAAQ,CAAR,IAAaA,QAAQ,CAAR,CAAd,IAA6BjB,KAAjC;AACH;AACJ;AACD,eAAO,IAAItB,GAAGC,IAAH,CAAQC,UAAZ,CAAuBC,CAAvB,EAA0BC,CAA1B,EAA6BC,CAA7B,EAAgCC,CAAhC,CAAP;AACH,KAzED;;AA2EA;;;;;;;AAOAN,OAAGC,IAAH,CAAQC,UAAR,CAAmBuC,oBAAnB,GAA0C,UAAUC,GAAV,EAAeC,KAAf,EAAsBC,IAAtB,EAA4B;AAAM;AACxE,YAAIC,EAAJ,EAAQC,EAAR,EAAYC,EAAZ,CADkE,CAC3C;AACvB,YAAIC,EAAJ,EAAQC,EAAR,EAAYC,EAAZ,EAAgBC,EAAhB,EAAoBC,EAApB,EAAwBC,EAAxB,EAA4BC,IAA5B,EAAkCC,IAAlC,CAFkE,CAEnB;;AAE/CV,aAAK7C,GAAGwD,gBAAH,CAAoBb,KAApB,IAA6B,GAAlC,CAJkE,CAIxB;AAC1CG,aAAK9C,GAAGwD,gBAAH,CAAoBd,GAApB,IAA2B,GAAhC;AACAK,aAAK/C,GAAGwD,gBAAH,CAAoBZ,IAApB,IAA4B,GAAjC;;AAEAI,aAAK7B,KAAKe,GAAL,CAASW,EAAT,CAAL;AACAI,aAAK9B,KAAKe,GAAL,CAASY,EAAT,CAAL;AACAI,aAAK/B,KAAKe,GAAL,CAASa,EAAT,CAAL;;AAEAI,aAAKhC,KAAKc,GAAL,CAASY,EAAT,CAAL;AACAO,aAAKjC,KAAKc,GAAL,CAASa,EAAT,CAAL;AACAO,aAAKlC,KAAKc,GAAL,CAASc,EAAT,CAAL;;AAEAO,eAAOL,KAAKC,EAAZ;AACAK,eAAOH,KAAKC,EAAZ;;AAEA,YAAII,MAAM,IAAIzD,GAAGC,IAAH,CAAQC,UAAZ,EAAV;AACAuD,YAAInD,CAAJ,GAAQ0C,KAAKM,IAAL,GAAYH,KAAKI,IAAzB;AACAE,YAAItD,CAAJ,GAAQgD,KAAKG,IAAL,GAAYN,KAAKO,IAAzB;AACAE,YAAIrD,CAAJ,GAAQ4C,KAAKI,EAAL,GAAUF,EAAV,GAAeC,KAAKF,EAAL,GAAUI,EAAjC;AACAI,YAAIpD,CAAJ,GAAQ2C,KAAKC,EAAL,GAAUI,EAAV,GAAeF,KAAKC,EAAL,GAAUF,EAAjC;AACAO,YAAI9B,SAAJ;AACA,eAAO8B,GAAP;AACH,KA1BD;;AA4BA;;;;;;AAMAhD,UAAMiD,KAAN,GAAc,UAAS9C,UAAT,EAAqB+C,CAArB,EAAwB;AAAa;AAC/C,YAAI,KAAKxD,CAAL,KAAWS,WAAWT,CAAtB,IAA2B,KAAKC,CAAL,KAAWQ,WAAWR,CAAjD,IAAsD,KAAKC,CAAL,KAAWO,WAAWP,CAA5E,IAAiF,KAAKC,CAAL,KAAWM,WAAWN,CAA3G,EAA8G;AAC1G,mBAAO,IAAP;AACH;AACD,YAAIsD,KAAK,KAAK/C,GAAL,CAASD,UAAT,CAAT;AAAA,YAA+BiD,QAAQ1C,KAAK2C,IAAL,CAAUF,EAAV,CAAvC;AAAA,YAAsDG,KAAK5C,KAAKK,IAAL,CAAU,MAAMxB,GAAGC,IAAH,CAAQ+D,MAAR,CAAeJ,EAAf,CAAhB,CAA3D;AACA,YAAIK,MAAM9C,KAAKc,GAAL,CAAS0B,IAAIE,KAAb,IAAsBE,EAAhC;AAAA,YAAoCG,OAAO/C,KAAKc,GAAL,CAAS,CAAC,MAAM0B,CAAP,IAAYE,KAArB,IAA8BE,EAAzE;AACA,YAAII,QAAQ,IAAInE,GAAGC,IAAH,CAAQC,UAAZ,CAAuBU,UAAvB,CAAZ;AACA,aAAKU,KAAL,CAAW4C,IAAX;AACAC,cAAM7C,KAAN,CAAY2C,GAAZ;AACA,aAAKG,GAAL,CAASD,KAAT;AACA,eAAO,IAAP;AACH,KAXD;;AAaA;;;;AAIA1D,UAAM4D,cAAN,GAAuB,YAAU;AAAK;AAClC,YAAIC,SAAJ,CAD6B,CACP;AACtB,YAAIhD,KAAJ,CAF6B,CAEP;AACtB,YAAIiD,QAAJ;AAAA,YAAcC,UAAU,IAAIxE,GAAGC,IAAH,CAAQwE,IAAZ,EAAxB;;AAEAH,oBAAYnD,KAAK2C,IAAL,CAAU,KAAKxD,CAAf,CAAZ;AACAgB,gBAAQH,KAAKK,IAAL,CAAUxB,GAAGC,IAAH,CAAQ+D,MAAR,CAAe,KAAK7D,CAApB,IAAyBH,GAAGC,IAAH,CAAQ+D,MAAR,CAAe,KAAK5D,CAApB,CAAzB,GAAkDJ,GAAGC,IAAH,CAAQ+D,MAAR,CAAe,KAAK3D,CAApB,CAA5D,CAAR;;AAEA,YAAMiB,QAAQ,CAACtB,GAAGC,IAAH,CAAQoB,OAAlB,IAA8BC,QAAQtB,GAAGC,IAAH,CAAQoB,OAA/C,IACIC,QAAQ,IAAIH,KAAKuD,EAAT,GAAc1E,GAAGC,IAAH,CAAQoB,OAA9B,IAAyCC,QAAQ,IAAIH,KAAKuD,EAAT,GAAc1E,GAAGC,IAAH,CAAQoB,OAD/E,EACyF;AAAQ;AAC7FkD,uBAAW,GAAX;AACAC,oBAAQrE,CAAR,GAAY,GAAZ;AACAqE,oBAAQpE,CAAR,GAAY,GAAZ;AACAoE,oBAAQnE,CAAR,GAAY,GAAZ;AACH,SAND,MAMO;AACHkE,uBAAWD,YAAY,GAAvB,CADG,CACgC;AACnCE,oBAAQrE,CAAR,GAAY,KAAKA,CAAL,GAASmB,KAArB;AACAkD,oBAAQpE,CAAR,GAAY,KAAKA,CAAL,GAASkB,KAArB;AACAkD,oBAAQnE,CAAR,GAAY,KAAKA,CAAL,GAASiB,KAArB;AACAkD,oBAAQ7C,SAAR;AACH;AACA,eAAO,EAACG,MAAM0C,OAAP,EAAgBzC,OAAOwC,QAAvB,EAAP;AACJ,KAtBD;;AAwBA;;;;AAIA9D,UAAMa,KAAN,GAAc,UAASA,KAAT,EAAgB;AAAI;AAC9B,aAAKnB,CAAL,IAAUmB,KAAV;AACA,aAAKlB,CAAL,IAAUkB,KAAV;AACA,aAAKjB,CAAL,IAAUiB,KAAV;AACA,aAAKhB,CAAL,IAAUgB,KAAV;AACA,eAAO,IAAP;AACH,KAND;;AAQA;;;;;AAKAb,UAAMkE,UAAN,GAAmB,UAAS/D,UAAT,EAAoB;AAAM;AACzC,aAAKT,CAAL,GAASS,WAAWT,CAApB;AACA,aAAKC,CAAL,GAASQ,WAAWR,CAApB;AACA,aAAKC,CAAL,GAASO,WAAWP,CAApB;AACA,aAAKC,CAAL,GAASM,WAAWN,CAApB;AACA,eAAO,IAAP;AACH,KAND;;AAQA;;;;;AAKAG,UAAM2D,GAAN,GAAY,UAASxD,UAAT,EAAqB;AAAe;AAC5C,aAAKT,CAAL,IAAUS,WAAWT,CAArB;AACA,aAAKC,CAAL,IAAUQ,WAAWR,CAArB;AACA,aAAKC,CAAL,IAAUO,WAAWP,CAArB;AACA,aAAKC,CAAL,IAAUM,WAAWN,CAArB;AACA,eAAO,IAAP;AACH,KAND;;AAQA;;;;;;;;;;;;;;AAcAN,OAAGC,IAAH,CAAQC,UAAR,CAAmB0E,mBAAnB,GAAyC,UAASC,IAAT,EAAeC,IAAf,EAAqBC,QAArB,EAA+B;AAAa;AACjF,YAAIC,KAAK,IAAIhF,GAAGC,IAAH,CAAQwE,IAAZ,CAAiBI,IAAjB,CAAT;AAAA,YAAiCI,KAAK,IAAIjF,GAAGC,IAAH,CAAQwE,IAAZ,CAAiBK,IAAjB,CAAtC;AACAE,WAAGrD,SAAH;AACAsD,WAAGtD,SAAH;AACA,YAAIuD,IAAIF,GAAGnE,GAAH,CAAOoE,EAAP,CAAR;AAAA,YAAoBrE,aAAa,IAAIZ,GAAGC,IAAH,CAAQC,UAAZ,EAAjC;;AAEA,YAAIgF,KAAK,GAAT,EAAc;AACVtE,uBAAWG,QAAX;AACA,mBAAOH,UAAP;AACH;;AAED,YAAIsE,IAAK,OAAO,GAAhB,EAAsB;AAClB,gBAAI/D,KAAKC,GAAL,CAAS2D,SAAStD,QAAT,EAAT,IAAgCzB,GAAGC,IAAH,CAAQoB,OAA5C,EAAqD;AACjDT,2BAAWiB,YAAX,CAAwBkD,QAAxB,EAAkC5D,KAAKuD,EAAvC;AACH,aAFD,MAEO;AACH,oBAAI5C,OAAO,IAAI9B,GAAGC,IAAH,CAAQwE,IAAZ,CAAiB,GAAjB,EAAsB,GAAtB,EAA2B,GAA3B,CAAX;AACA3C,qBAAKqD,KAAL,CAAWN,IAAX;;AAEA;AACA,oBAAI1D,KAAKC,GAAL,CAASU,KAAKL,QAAL,EAAT,IAA4BzB,GAAGC,IAAH,CAAQoB,OAAxC,EAAiD;AAC7CS,yBAAKsD,IAAL,CAAU,GAAV,EAAe,GAAf,EAAoB,GAApB;AACAtD,yBAAKqD,KAAL,CAAWN,IAAX;AACH;AACD/C,qBAAKH,SAAL;AACAf,2BAAWiB,YAAX,CAAwBC,IAAxB,EAA8BX,KAAKuD,EAAnC;AACH;AACJ,SAfD,MAeO;AACH,gBAAIW,IAAIlE,KAAKK,IAAL,CAAU,CAAC,IAAI0D,CAAL,IAAU,CAApB,CAAR;AAAA,gBAAgCI,OAAO,IAAID,CAA3C;AACAL,eAAGG,KAAH,CAASF,EAAT;AACArE,uBAAWT,CAAX,GAAe6E,GAAG7E,CAAH,GAAOmF,IAAtB;AACA1E,uBAAWR,CAAX,GAAe4E,GAAG5E,CAAH,GAAOkF,IAAtB;AACA1E,uBAAWP,CAAX,GAAe2E,GAAG3E,CAAH,GAAOiF,IAAtB;AACA1E,uBAAWN,CAAX,GAAe+E,IAAI,GAAnB;AACAzE,uBAAWe,SAAX;AACH;AACD,eAAOf,UAAP;AACH,KApCD;;AAsCA;;;;;AAKAH,UAAM8E,YAAN,GAAqB,UAASC,GAAT,EAAa;AAAS;AACvC,YAAIrF,IAAI,KAAKA,CAAb;AAAA,YAAgBC,IAAI,KAAKA,CAAzB;AAAA,YAA4BC,IAAI,KAAKA,CAArC;AAAA,YAAwCoF,SAAS,IAAIzF,GAAGC,IAAH,CAAQwE,IAAZ,CAAiBe,GAAjB,CAAjD;AACA,YAAIE,KAAK,IAAI1F,GAAGC,IAAH,CAAQwE,IAAZ,CAAiBtE,CAAjB,EAAoBC,CAApB,EAAuBC,CAAvB,CAAT;AAAA,YAAoCsF,MAAM,IAAI3F,GAAGC,IAAH,CAAQwE,IAAZ,CAAiBtE,CAAjB,EAAoBC,CAApB,EAAuBC,CAAvB,CAA1C;AACAqF,WAAGP,KAAH,CAASK,GAAT;AACAG,YAAIR,KAAJ,CAAUO,EAAV;AACAA,WAAGpE,KAAH,CAAU,MAAMsE,EAAEtF,CAAlB;AACAqF,YAAIrE,KAAJ,CAAU,GAAV;;AAEAmE,eAAOrB,GAAP,CAAWsB,EAAX;AACAD,eAAOrB,GAAP,CAAWuB,GAAX;AACA,eAAOF,MAAP;AACH,KAXD;AAYH,CAjaD,EAiaGzF,EAjaH","file":"quaternion.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath","sourcesContent":["/**\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n Copyright (c) 2008, Luke Benstead.\n All rights reserved.\n\n Redistribution and use in source and binary forms, with or without modification,\n are permitted provided that the following conditions are met:\n\n Redistributions of source code must retain the above copyright notice,\n this list of conditions and the following disclaimer.\n Redistributions in binary form must reproduce the above copyright notice,\n this list of conditions and the following disclaimer in the documentation\n and/or other materials provided with the distribution.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n(function(cc) {\n    /**\n     * The Quaternion class\n     * @param {Number|cc.math.Quaternion} [x=0]\n     * @param {Number} [y=0]\n     * @param {Number} [z=0]\n     * @param {Number} [w=0]\n     * @constructor\n     */\n    cc.math.Quaternion = function (x, y, z, w) {\n        if (x && y === undefined) {\n            this.x = x.x;\n            this.y = x.y;\n            this.z = x.z;\n            this.w = x.w;\n        } else {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.z = z || 0;\n            this.w = w || 0;\n        }\n    };\n    cc.kmQuaternion = cc.math.Quaternion;\n    var proto = cc.math.Quaternion.prototype;\n\n    /**\n     * Sets the conjugate of quaternion to self\n     * @param {cc.math.Quaternion} quaternion\n     */\n    proto.conjugate = function (quaternion) {   //= cc.kmQuaternionConjugate\n        this.x = -quaternion.x;\n        this.y = -quaternion.y;\n        this.z = -quaternion.z;\n        this.w = quaternion.w;\n        return this;\n    };\n\n    /**\n     * Returns the dot product of the current quaternion and parameter quaternion\n     * @param quaternion\n     * @returns {number}\n     */\n    proto.dot = function(quaternion) {    // = cc.kmQuaternionDot\n        // A dot B = B dot A = AtBt + AxBx + AyBy + AzBz\n        return (this.w * quaternion.w + this.x * quaternion.x + this.y * quaternion.y + this.z * quaternion.z);\n    };\n\n    /**\n     * Returns the exponential of the quaternion, this function doesn't implemented.\n     * @returns {cc.math.Quaternion}\n     */\n    proto.exponential = function(){   //=cc.kmQuaternionExp\n        return this;\n    };\n\n    /**\n     * Makes the current quaternion an identity quaternion\n     */\n    proto.identity = function(){   //=cc.kmQuaternionIdentity\n        this.x = 0.0;\n        this.y = 0.0;\n        this.z = 0.0;\n        this.w = 1.0;\n        return this;\n    };\n\n    /**\n     * Inverses the value of current Quaternion\n     */\n    proto.inverse = function(){           //=cc.kmQuaternionInverse\n        var len = this.length();\n        if (Math.abs(len) > cc.math.EPSILON) {\n            this.x = 0.0;\n            this.y = 0.0;\n            this.z = 0.0;\n            this.w = 0.0;\n            return this;\n        }\n\n        ///Get the conjugute and divide by the length\n        this.conjugate(this).scale(1.0 / len);\n        return this;\n    };\n\n    /**\n     * Returns true if the quaternion is an identity quaternion\n     * @returns {boolean}\n     */\n    proto.isIdentity = function(){     //=cc.kmQuaternionIsIdentity\n        return (this.x === 0.0 && this.y === 0.0 && this.z === 0.0 && this.w === 1.0);\n    };\n\n    /**\n     * Returns the length of the quaternion\n     * @returns {number}\n     */\n    proto.length = function() {       //=cc.kmQuaternionLength\n        return Math.sqrt(this.lengthSq());\n    };\n\n    /**\n     * Returns the length of the quaternion squared (prevents a sqrt)\n     * @returns {number}\n     */\n    proto.lengthSq = function() {   //=cc.kmQuaternionLengthSq\n        return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\n    };\n\n    /**\n     * Uses current quaternion multiplies other quaternion.\n     * @param {cc.math.Quaternion} quaternion\n     * @returns {cc.math.Quaternion}\n     */\n    proto.multiply = function(quaternion) {     //cc.kmQuaternionMultiply\n        var x = this.x, y = this.y, z = this.z, w = this.w;\n        this.w = w * quaternion.w - x * quaternion.x - y * quaternion.y - z * quaternion.z;\n        this.x = w * quaternion.x + x * quaternion.w + y * quaternion.z - z * quaternion.y;\n        this.y = w * quaternion.y + y * quaternion.w + z * quaternion.x - x * quaternion.z;\n        this.z = w * quaternion.z + z * quaternion.w + x * quaternion.y - y * quaternion.x;\n        return this;\n    };\n\n    /**\n     * Normalizes a quaternion\n     * @returns {cc.math.Quaternion}\n     */\n    proto.normalize = function(){     //=cc.kmQuaternionNormalize\n        var length = this.length();\n        if (Math.abs(length) <= cc.math.EPSILON)\n            throw new Error(\"current quaternion is an invalid value\");\n        this.scale(1.0 / length);\n        return this;\n    };\n\n    /**\n     * Rotates a quaternion around an axis and an angle\n     * @param {cc.math.Vec3} axis\n     * @param {Number} angle\n     */\n    proto.rotationAxis = function(axis, angle){        //cc.kmQuaternionRotationAxis\n        var rad = angle * 0.5, scale = Math.sin(rad);\n        this.w = Math.cos(rad);\n        this.x = axis.x * scale;\n        this.y = axis.y * scale;\n        this.z = axis.z * scale;\n        return this;\n    };\n\n    /**\n     *  Creates a quaternion from a rotation matrix\n     * @param mat3\n     * @returns {*}\n     */\n    cc.math.Quaternion.rotationMatrix = function (mat3) {        //cc.kmQuaternionRotationMatrix\n        if (!mat3)\n            return null;\n\n        var x, y, z, w;\n        var m4x4 = [], mat = mat3.mat, scale = 0.0;\n\n        /*    0 3 6\n         1 4 7\n         2 5 8\n\n         0 1 2 3\n         4 5 6 7\n         8 9 10 11\n         12 13 14 15*/\n        m4x4[0] = mat[0];\n        m4x4[1] = mat[3];\n        m4x4[2] = mat[6];\n        m4x4[4] = mat[1];\n        m4x4[5] = mat[4];\n        m4x4[6] = mat[7];\n        m4x4[8] = mat[2];\n        m4x4[9] = mat[5];\n        m4x4[10] = mat[8];\n        m4x4[15] = 1;\n        var pMatrix = m4x4[0];\n\n        var diagonal = pMatrix[0] + pMatrix[5] + pMatrix[10] + 1;\n        if (diagonal > cc.math.EPSILON) {\n            // Calculate the scale of the diagonal\n            scale = Math.sqrt(diagonal) * 2;\n\n            // Calculate the x, y, x and w of the quaternion through the respective equation\n            x = ( pMatrix[9] - pMatrix[6] ) / scale;\n            y = ( pMatrix[2] - pMatrix[8] ) / scale;\n            z = ( pMatrix[4] - pMatrix[1] ) / scale;\n            w = 0.25 * scale;\n        } else {\n            // If the first element of the diagonal is the greatest value\n            if (pMatrix[0] > pMatrix[5] && pMatrix[0] > pMatrix[10]) {\n                // Find the scale according to the first element, and double that value\n                scale = Math.sqrt(1.0 + pMatrix[0] - pMatrix[5] - pMatrix[10]) * 2.0;\n\n                // Calculate the x, y, x and w of the quaternion through the respective equation\n                x = 0.25 * scale;\n                y = (pMatrix[4] + pMatrix[1] ) / scale;\n                z = (pMatrix[2] + pMatrix[8] ) / scale;\n                w = (pMatrix[9] - pMatrix[6] ) / scale;\n            }\n            // Else if the second element of the diagonal is the greatest value\n            else if (pMatrix[5] > pMatrix[10]) {\n                // Find the scale according to the second element, and double that value\n                scale = Math.sqrt(1.0 + pMatrix[5] - pMatrix[0] - pMatrix[10]) * 2.0;\n\n                // Calculate the x, y, x and w of the quaternion through the respective equation\n                x = (pMatrix[4] + pMatrix[1] ) / scale;\n                y = 0.25 * scale;\n                z = (pMatrix[9] + pMatrix[6] ) / scale;\n                w = (pMatrix[2] - pMatrix[8] ) / scale;\n            } else {\n                // Else the third element of the diagonal is the greatest value\n\n                // Find the scale according to the third element, and double that value\n                scale = Math.sqrt(1.0 + pMatrix[10] - pMatrix[0] - pMatrix[5]) * 2.0;\n\n                // Calculate the x, y, x and w of the quaternion through the respective equation\n                x = (pMatrix[2] + pMatrix[8] ) / scale;\n                y = (pMatrix[9] + pMatrix[6] ) / scale;\n                z = 0.25 * scale;\n                w = (pMatrix[4] - pMatrix[1] ) / scale;\n            }\n        }\n        return new cc.math.Quaternion(x, y, z, w);\n    };\n\n    /**\n     * Create a quaternion from yaw, pitch and roll\n     * @param yaw\n     * @param pitch\n     * @param roll\n     * @returns {cc.math.Quaternion}\n     */\n    cc.math.Quaternion.rotationYawPitchRoll = function (yaw, pitch, roll) {     //cc.kmQuaternionRotationYawPitchRoll\n        var ex, ey, ez;        // temp half euler angles\n        var cr, cp, cy, sr, sp, sy, cpcy, spsy;        // temp vars in roll,pitch yaw\n\n        ex = cc.degreesToRadians(pitch) / 2.0;    // convert to rads and half them\n        ey = cc.degreesToRadians(yaw) / 2.0;\n        ez = cc.degreesToRadians(roll) / 2.0;\n\n        cr = Math.cos(ex);\n        cp = Math.cos(ey);\n        cy = Math.cos(ez);\n\n        sr = Math.sin(ex);\n        sp = Math.sin(ey);\n        sy = Math.sin(ez);\n\n        cpcy = cp * cy;\n        spsy = sp * sy;\n\n        var ret = new cc.math.Quaternion();\n        ret.w = cr * cpcy + sr * spsy;\n        ret.x = sr * cpcy - cr * spsy;\n        ret.y = cr * sp * cy + sr * cp * sy;\n        ret.z = cr * cp * sy - sr * sp * cy;\n        ret.normalize();\n        return ret;\n    };\n\n    /**\n     * Interpolate with other quaternions\n     * @param {cc.math.Quaternion} quaternion\n     * @param {Number} t\n     * @returns {cc.math.Quaternion}\n     */\n    proto.slerp = function(quaternion, t) {            //=cc.kmQuaternionSlerp\n        if (this.x === quaternion.x && this.y === quaternion.y && this.z === quaternion.z && this.w === quaternion.w) {\n            return this;\n        }\n        var ct = this.dot(quaternion), theta = Math.acos(ct), st = Math.sqrt(1.0 - cc.math.square(ct));\n        var stt = Math.sin(t * theta) / st, somt = Math.sin((1.0 - t) * theta) / st;\n        var temp2 = new cc.math.Quaternion(quaternion);\n        this.scale(somt);\n        temp2.scale(stt);\n        this.add(temp2);\n        return this;\n    };\n\n    /**\n     * Get the axis and angle of rotation from a quaternion\n     * @returns {{axis: cc.math.Vec3, angle: number}}\n     */\n    proto.toAxisAndAngle = function(){    //=cc.kmQuaternionToAxisAngle\n        var tempAngle;        // temp angle\n        var scale;            // temp vars\n        var retAngle, retAxis = new cc.math.Vec3();\n\n        tempAngle = Math.acos(this.w);\n        scale = Math.sqrt(cc.math.square(this.x) + cc.math.square(this.y) + cc.math.square(this.z));\n\n        if (((scale > -cc.math.EPSILON) && scale < cc.math.EPSILON)\n            || (scale < 2 * Math.PI + cc.math.EPSILON && scale > 2 * Math.PI - cc.math.EPSILON)) {       // angle is 0 or 360 so just simply set axis to 0,0,1 with angle 0\n            retAngle = 0.0;\n            retAxis.x = 0.0;\n            retAxis.y = 0.0;\n            retAxis.z = 1.0;\n        } else {\n            retAngle = tempAngle * 2.0;        // angle in radians\n            retAxis.x = this.x / scale;\n            retAxis.y = this.y / scale;\n            retAxis.z = this.z / scale;\n            retAxis.normalize();\n        }\n         return {axis: retAxis, angle: retAngle};\n    };\n\n    /**\n     * Scale a quaternion\n     * @param {Number} scale\n     */\n    proto.scale = function(scale) {   //cc.kmQuaternionScale\n        this.x *= scale;\n        this.y *= scale;\n        this.z *= scale;\n        this.w *= scale;\n        return this;\n    };\n\n    /**\n     * Assign current quaternion value from a quaternion.\n     * @param {cc.math.Quaternion} quaternion\n     * @returns {cc.math.Quaternion}  current quaternion\n     */\n    proto.assignFrom = function(quaternion){     //=cc.kmQuaternionAssign\n        this.x = quaternion.x;\n        this.y = quaternion.y;\n        this.z = quaternion.z;\n        this.w = quaternion.w;\n        return this;\n    };\n\n    /**\n     * Adds other quaternion\n     * @param {cc.math.Quaternion} quaternion\n     * @returns {cc.math.Quaternion}\n     */\n    proto.add = function(quaternion) {              //cc.kmQuaternionAdd\n        this.x += quaternion.x;\n        this.y += quaternion.y;\n        this.z += quaternion.z;\n        this.w += quaternion.w;\n        return this;\n    };\n\n    /**\n     * <p>\n     *     Adapted from the OGRE engine!                                                            <br/>\n     *     Gets the shortest arc quaternion to rotate this vector to the destination vector.        <br/>\n     *     @remarks                                                                                <br/>\n     *     If you call this with a destination vector that is close to the inverse                  <br/>\n     *     of this vector, we will rotate 180 degrees around the 'fallbackAxis'                     <br/>\n     *     (if specified, or a generated axis if not) since in this case ANY axis of rotation is valid.\n     * </p>\n     * @param {cc.math.Vec3} vec1\n     * @param {cc.math.Vec3} vec2\n     * @param {cc.math.Vec3} fallback\n     * @returns {cc.math.Quaternion}\n     */\n    cc.math.Quaternion.rotationBetweenVec3 = function(vec1, vec2, fallback) {            //cc.kmQuaternionRotationBetweenVec3\n        var v1 = new cc.math.Vec3(vec1), v2 = new cc.math.Vec3(vec2);\n        v1.normalize();\n        v2.normalize();\n        var a = v1.dot(v2), quaternion = new cc.math.Quaternion();\n\n        if (a >= 1.0) {\n            quaternion.identity();\n            return quaternion;\n        }\n\n        if (a < (1e-6 - 1.0)) {\n            if (Math.abs(fallback.lengthSq()) < cc.math.EPSILON) {\n                quaternion.rotationAxis(fallback, Math.PI);\n            } else {\n                var axis = new cc.math.Vec3(1.0, 0.0, 0.0);\n                axis.cross(vec1);\n\n                //If axis is zero\n                if (Math.abs(axis.lengthSq()) < cc.math.EPSILON) {\n                    axis.fill(0.0, 1.0, 0.0);\n                    axis.cross(vec1);\n                }\n                axis.normalize();\n                quaternion.rotationAxis(axis, Math.PI);\n            }\n        } else {\n            var s = Math.sqrt((1 + a) * 2), invs = 1 / s;\n            v1.cross(v2);\n            quaternion.x = v1.x * invs;\n            quaternion.y = v1.y * invs;\n            quaternion.z = v1.z * invs;\n            quaternion.w = s * 0.5;\n            quaternion.normalize();\n        }\n        return quaternion;\n    };\n\n    /**\n     * Current quaternion multiplies a vec3\n     * @param {cc.math.Vec3} vec\n     * @returns {cc.math.Vec3}\n     */\n    proto.multiplyVec3 = function(vec){        //=cc.kmQuaternionMultiplyVec3\n        var x = this.x, y = this.y, z = this.z, retVec = new cc.math.Vec3(vec);\n        var uv = new cc.math.Vec3(x, y, z), uuv = new cc.math.Vec3(x, y, z);\n        uv.cross(vec);\n        uuv.cross(uv);\n        uv.scale((2.0 * q.w));\n        uuv.scale(2.0);\n\n        retVec.add(uv);\n        retVec.add(uuv);\n        return retVec;\n    };\n})(cc);\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}