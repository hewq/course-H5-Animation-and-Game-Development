{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath/simd_benchmark/assets/frameworks/cocos2d-html5/cocos2d/kazmath/simd_benchmark/base.js"],"names":["Benchmark","config","initOk","cleanupOk","useAutoIterations","autoIterations","actualIterations","simdTime","nonSimdTime","Benchmarks","benchmarks","prototype","add","benchmark","push","length","runOne","timeKernel","kernel","iterations","start","stop","Date","now","computeIterations","desiredRuntime","testIterations","kernelSimd","kernelNonSimd","maxTime","Math","ceil","kernelInit","kernelIterations","kernelCleanup","report","outputFunctions","fillRight","str","width","fillLeft","notifyError","kernelName","ratio","toFixed","notifyResult","timeData","labels","datasets","data","speedupData","runAll","i","n"],"mappings":"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","file":"base.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath/simd_benchmark","sourcesContent":["// SIMD Kernel Benchmark Harness\n// Author: Peter Jensen\n\nfunction Benchmark (config) {\n  this.config            = config;\n  this.initOk            = true;    // Initialize all properties used on a Benchmark object\n  this.cleanupOk         = true;\n  this.useAutoIterations = true;\n  this.autoIterations    = 0;\n  this.actualIterations  = 0;\n  this.simdTime          = 0;\n  this.nonSimdTime       = 0;\n}\n\nfunction Benchmarks () {\n  this.benchmarks = [];\n}\n\nBenchmarks.prototype.add = function (benchmark) {\n  this.benchmarks.push (benchmark);\n  return this.benchmarks.length - 1;\n}\n\nBenchmarks.prototype.runOne = function (benchmark) {\n\n  function timeKernel(kernel, iterations) {\n    var start, stop;\n    start = Date.now();\n    kernel(iterations);\n    stop = Date.now();\n    return stop - start;\n  }\n\n  function computeIterations() {\n    var desiredRuntime = 1000;  // milliseconds for longest running kernel\n    var testIterations = 10;    // iterations used to determine time for desiredRuntime\n\n    // Make the slowest kernel run for at least 500ms\n    var simdTime = timeKernel(benchmark.config.kernelSimd, testIterations);\n    var nonSimdTime = timeKernel(benchmark.config.kernelNonSimd, testIterations);\n    var maxTime = simdTime > nonSimdTime ? simdTime : nonSimdTime;\n    while (maxTime < 500) {\n      testIterations *= 2;\n      simdTime = timeKernel(benchmark.config.kernelSimd, testIterations);\n      nonSimdTime = timeKernel(benchmark.config.kernelNonSimd, testIterations);\n      maxTime = simdTime > nonSimdTime ? simdTime : nonSimdTime;\n    }\n    maxTime = simdTime > nonSimdTime ? simdTime : nonSimdTime;\n\n    // Compute iteration count for 1 second run of slowest kernel\n    var iterations = Math.ceil(desiredRuntime * testIterations / maxTime);\n    return iterations;\n  }\n\n  // Initialize the kernels and check the correctness status\n  if (!benchmark.config.kernelInit()) {\n    benchmark.initOk = false;\n    return false;\n  }\n\n  // Determine how many iterations to use.\n  if (benchmark.useAutoIterations) {\n    benchmark.autoIterations = computeIterations();\n    benchmark.actualIterations = benchmark.autoIterations;\n  }\n  else {\n    benchmark.actualIterations = benchmark.config.kernelIterations;\n  }\n\n  // Run the SIMD kernel\n  benchmark.simdTime = timeKernel(benchmark.config.kernelSimd, benchmark.actualIterations);\n\n  // Run the non-SIMD kernel\n  benchmark.nonSimdTime = timeKernel(benchmark.config.kernelNonSimd, benchmark.actualIterations);\n\n  // Do the final sanity check\n  if (!benchmark.config.kernelCleanup()) {\n    benchmark.cleanupOk = false;\n    return false;\n  }\n\n  return true;\n}\n\nBenchmarks.prototype.report = function (benchmark, outputFunctions) {\n\n  function fillRight(str, width) {\n    str += \"\"; // make sure it's a string\n    while (str.length < width) {\n      str += \" \";\n    }\n    return str;\n  }\n\n  function fillLeft(str, width) {\n    str += \"\"; // make sure it's a string\n    while (str.length < width) {\n      str = \" \" + str;\n    }\n    return str;\n  }\n\n  if (!benchmark.initOk) {\n    outputFunctions.notifyError(fillRight(benchmark.config.kernelName + \": \", 23) + \"FAILED INIT\");\n    return;\n  }\n  if (!benchmark.cleanupOk) {\n    outputFunctions.notifyError(fillRight(benchmark.config.kernelName + \": \", 23) + \"FAILED CLEANUP\");\n    return;\n  }\n\n  var ratio = benchmark.nonSimdTime / benchmark.simdTime;\n  ratio = ratio.toFixed(2);\n  outputFunctions.notifyResult(\n    fillRight(benchmark.config.kernelName + \": \", 23) +\n    \"Iterations(\" + fillLeft(benchmark.actualIterations, 10) + \")\" +\n    \", SIMD(\" + fillLeft(benchmark.simdTime + \"ms)\", 8) +\n    \", Non-SIMD(\" + fillLeft(benchmark.nonSimdTime + \"ms)\", 8) +\n    \", Speedup(\" + ratio + \")\");\n  outputFunctions.timeData.labels.push(benchmark.config.kernelName);\n  outputFunctions.timeData.datasets[0].data.push(benchmark.simdTime);\n  outputFunctions.timeData.datasets[1].data.push(benchmark.nonSimdTime);\n  outputFunctions.speedupData.labels.push(benchmark.config.kernelName);\n  outputFunctions.speedupData.datasets[0].data.push(ratio);\n}\n\nBenchmarks.prototype.runAll = function (outputFunctions, useAutoIterations) {\n  if (typeof useAutoIterations === \"undefined\") {\n    useAutoIterations = false;\n  }\n  for (var i = 0, n = this.benchmarks.length; i < n; ++i) {\n    var benchmark = this.benchmarks[i];\n    benchmark.useAutoIterations = useAutoIterations;\n    this.runOne(benchmark);\n    this.report(benchmark, outputFunctions);\n  }\n}\n\nvar benchmarks = new Benchmarks ();\n"]}