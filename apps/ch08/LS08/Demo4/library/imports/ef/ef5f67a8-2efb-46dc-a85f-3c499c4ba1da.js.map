{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/platform/assets/frameworks/cocos2d-html5/cocos2d/core/platform/CCInputManager.js"],"names":["cc","UIInterfaceOrientationLandscapeLeft","UIInterfaceOrientationLandscapeRight","UIInterfaceOrientationPortraitUpsideDown","UIInterfaceOrientationPortrait","inputManager","TOUCH_TIMEOUT","_mousePressed","_isRegisterEvent","_preTouchPoint","p","_prevMousePoint","_preTouchPool","_preTouchPoolPointer","_touches","_touchesIntegerDict","_indexBitsUsed","_maxTouches","_accelEnabled","_accelInterval","_accelMinus","_accelCurTime","_acceleration","_accelDeviceEvent","_getUnUsedIndex","temp","now","sys","i","touch","_lastModified","_removeUsedIndexBit","getID","index","_glView","handleTouchesBegin","touches","selTouch","curTouch","touchID","handleTouches","locTouchIntDict","len","length","unusedIndex","log","_LogInfos","inputManager_handleTouchesBegin","Touch","_point","x","y","_setPrevPoint","_prevPoint","push","_convertTouchesWithScale","touchEvent","EventTouch","_eventCode","EventCode","BEGAN","eventManager","dispatchEvent","handleTouchesMove","locTouches","_setPoint","MOVED","handleTouchesEnd","getSetOfTouchesEndOrCancel","ENDED","handleTouchesCancel","CANCELLED","locTouchesIntDict","getHTMLElementPosition","element","docElem","document","documentElement","win","window","box","isFunction","getBoundingClientRect","left","top","width","parseInt","style","height","pageXOffset","clientLeft","pageYOffset","clientTop","getPreTouch","preTouch","locPreTouchPool","id","setPreTouch","find","getTouchByXY","tx","ty","pos","locPreTouch","location","convertToLocationInView","getMouseEvent","eventType","locPreMouse","_convertMouseToLocationInView","mouseEvent","EventMouse","setLocation","_setPrevCursor","getPointByEvent","event","pageX","pageY","body","scrollLeft","scrollTop","clientX","clientY","getTouchesByEvent","touchArr","locView","touch_event","preLocation","changedTouches","BROWSER_TYPE_FIREFOX","browserType","identifier","getLocation","registerSystemEvent","view","selfPointer","supportMouse","capabilities","supportTouches","prohibition","isMobile","addEventListener","savePressed","rectContainsPoint","Rect","UP","setButton","button","DOWN","stopPropagation","preventDefault","focus","MOVE","SCROLL","setScrollData","wheelDelta","detail","navigator","msPointerEnabled","_pointerEventsMap","eventName","_pointerEvent","_touchEvent","call","_registerKeyboardEvent","_registerAccelerometerEvent","update","dt","EventAcceleration"],"mappings":"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","file":"CCInputManager.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/platform","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * ignore\n */\n\n/**\n * @constant\n * @type {number}\n */\ncc.UIInterfaceOrientationLandscapeLeft = -90;\n/**\n * @constant\n * @type {number}\n */\ncc.UIInterfaceOrientationLandscapeRight = 90;\n/**\n * @constant\n * @type {number}\n */\ncc.UIInterfaceOrientationPortraitUpsideDown = 180;\n/**\n * @constant\n * @type {number}\n */\ncc.UIInterfaceOrientationPortrait = 0;\n\n/**\n * <p>\n *  This class manages all events of input. include: touch, mouse, accelerometer, keyboard                                       <br/>\n * </p>\n * @class\n * @name cc.inputManager\n */\ncc.inputManager = /** @lends cc.inputManager# */{\n    TOUCH_TIMEOUT: 5000,\n\n    _mousePressed: false,\n\n    _isRegisterEvent: false,\n\n    _preTouchPoint: cc.p(0, 0),\n    _prevMousePoint: cc.p(0, 0),\n\n    _preTouchPool: [],\n    _preTouchPoolPointer: 0,\n\n    _touches: [],\n    _touchesIntegerDict: {},\n\n    _indexBitsUsed: 0,\n    _maxTouches: 5,\n\n    _accelEnabled: false,\n    _accelInterval: 1 / 30,\n    _accelMinus: 1,\n    _accelCurTime: 0,\n    _acceleration: null,\n    _accelDeviceEvent: null,\n\n    _getUnUsedIndex: function () {\n        var temp = this._indexBitsUsed;\n        var now = cc.sys.now();\n\n        for (var i = 0; i < this._maxTouches; i++) {\n            if (!(temp & 0x00000001)) {\n                this._indexBitsUsed |= (1 << i);\n                return i;\n            }\n            else {\n                var touch = this._touches[i];\n                if (now - touch._lastModified > this.TOUCH_TIMEOUT) {\n                    this._removeUsedIndexBit(i);\n                    delete this._touchesIntegerDict[touch.getID()];\n                    return i;\n                }\n            }\n            temp >>= 1;\n        }\n\n        // all bits are used\n        return -1;\n    },\n\n    _removeUsedIndexBit: function (index) {\n        if (index < 0 || index >= this._maxTouches)\n            return;\n\n        var temp = 1 << index;\n        temp = ~temp;\n        this._indexBitsUsed &= temp;\n    },\n\n    _glView: null,\n\n    /**\n     * @function\n     * @param {Array} touches\n     */\n    handleTouchesBegin: function (touches) {\n        var selTouch, index, curTouch, touchID,\n            handleTouches = [], locTouchIntDict = this._touchesIntegerDict,\n            now = cc.sys.now();\n        for (var i = 0, len = touches.length; i < len; i++) {\n            selTouch = touches[i];\n            touchID = selTouch.getID();\n            index = locTouchIntDict[touchID];\n\n            if (index == null) {\n                var unusedIndex = this._getUnUsedIndex();\n                if (unusedIndex === -1) {\n                    cc.log(cc._LogInfos.inputManager_handleTouchesBegin, unusedIndex);\n                    continue;\n                }\n                //curTouch = this._touches[unusedIndex] = selTouch;\n                curTouch = this._touches[unusedIndex] = new cc.Touch(selTouch._point.x, selTouch._point.y, selTouch.getID());\n                curTouch._lastModified = now;\n                curTouch._setPrevPoint(selTouch._prevPoint);\n                locTouchIntDict[touchID] = unusedIndex;\n                handleTouches.push(curTouch);\n            }\n        }\n        if (handleTouches.length > 0) {\n            this._glView._convertTouchesWithScale(handleTouches);\n            var touchEvent = new cc.EventTouch(handleTouches);\n            touchEvent._eventCode = cc.EventTouch.EventCode.BEGAN;\n            cc.eventManager.dispatchEvent(touchEvent);\n        }\n    },\n\n    /**\n     * @function\n     * @param {Array} touches\n     */\n    handleTouchesMove: function (touches) {\n        var selTouch, index, touchID,\n            handleTouches = [], locTouches = this._touches,\n            now = cc.sys.now();\n        for (var i = 0, len = touches.length; i < len; i++) {\n            selTouch = touches[i];\n            touchID = selTouch.getID();\n            index = this._touchesIntegerDict[touchID];\n\n            if (index == null) {\n                //cc.log(\"if the index doesn't exist, it is an error\");\n                continue;\n            }\n            if (locTouches[index]) {\n                locTouches[index]._setPoint(selTouch._point);\n                locTouches[index]._setPrevPoint(selTouch._prevPoint);\n                locTouches[index]._lastModified = now;\n                handleTouches.push(locTouches[index]);\n            }\n        }\n        if (handleTouches.length > 0) {\n            this._glView._convertTouchesWithScale(handleTouches);\n            var touchEvent = new cc.EventTouch(handleTouches);\n            touchEvent._eventCode = cc.EventTouch.EventCode.MOVED;\n            cc.eventManager.dispatchEvent(touchEvent);\n        }\n    },\n\n    /**\n     * @function\n     * @param {Array} touches\n     */\n    handleTouchesEnd: function (touches) {\n        var handleTouches = this.getSetOfTouchesEndOrCancel(touches);\n        if (handleTouches.length > 0) {\n            this._glView._convertTouchesWithScale(handleTouches);\n            var touchEvent = new cc.EventTouch(handleTouches);\n            touchEvent._eventCode = cc.EventTouch.EventCode.ENDED;\n            cc.eventManager.dispatchEvent(touchEvent);\n        }\n    },\n\n    /**\n     * @function\n     * @param {Array} touches\n     */\n    handleTouchesCancel: function (touches) {\n        var handleTouches = this.getSetOfTouchesEndOrCancel(touches);\n        if (handleTouches.length > 0) {\n            this._glView._convertTouchesWithScale(handleTouches);\n            var touchEvent = new cc.EventTouch(handleTouches);\n            touchEvent._eventCode = cc.EventTouch.EventCode.CANCELLED;\n            cc.eventManager.dispatchEvent(touchEvent);\n        }\n    },\n\n    /**\n     * @function\n     * @param {Array} touches\n     * @returns {Array}\n     */\n    getSetOfTouchesEndOrCancel: function (touches) {\n        var selTouch, index, touchID, handleTouches = [], locTouches = this._touches, locTouchesIntDict = this._touchesIntegerDict;\n        for (var i = 0, len = touches.length; i < len; i++) {\n            selTouch = touches[i];\n            touchID = selTouch.getID();\n            index = locTouchesIntDict[touchID];\n\n            if (index == null) {\n                continue;  //cc.log(\"if the index doesn't exist, it is an error\");\n            }\n            if (locTouches[index]) {\n                locTouches[index]._setPoint(selTouch._point);\n                locTouches[index]._setPrevPoint(selTouch._prevPoint);\n                handleTouches.push(locTouches[index]);\n                this._removeUsedIndexBit(index);\n                delete locTouchesIntDict[touchID];\n            }\n        }\n        return handleTouches;\n    },\n\n    /**\n     * @function\n     * @param {HTMLElement} element\n     * @return {Object}\n     */\n    getHTMLElementPosition: function (element) {\n        var docElem = document.documentElement;\n        var win = window;\n        var box = null;\n        if (cc.isFunction(element.getBoundingClientRect)) {\n            box = element.getBoundingClientRect();\n        } else {\n            box = {\n                left: 0,\n                top: 0,\n                width: parseInt(element.style.width),\n                height: parseInt(element.style.height)\n            };\n        }\n        return {\n            left: box.left + win.pageXOffset - docElem.clientLeft,\n            top: box.top + win.pageYOffset - docElem.clientTop,\n            width: box.width,\n            height: box.height\n        };\n    },\n\n    /**\n     * @function\n     * @param {cc.Touch} touch\n     * @return {cc.Touch}\n     */\n    getPreTouch: function (touch) {\n        var preTouch = null;\n        var locPreTouchPool = this._preTouchPool;\n        var id = touch.getID();\n        for (var i = locPreTouchPool.length - 1; i >= 0; i--) {\n            if (locPreTouchPool[i].getID() === id) {\n                preTouch = locPreTouchPool[i];\n                break;\n            }\n        }\n        if (!preTouch)\n            preTouch = touch;\n        return preTouch;\n    },\n\n    /**\n     * @function\n     * @param {cc.Touch} touch\n     */\n    setPreTouch: function (touch) {\n        var find = false;\n        var locPreTouchPool = this._preTouchPool;\n        var id = touch.getID();\n        for (var i = locPreTouchPool.length - 1; i >= 0; i--) {\n            if (locPreTouchPool[i].getID() === id) {\n                locPreTouchPool[i] = touch;\n                find = true;\n                break;\n            }\n        }\n        if (!find) {\n            if (locPreTouchPool.length <= 50) {\n                locPreTouchPool.push(touch);\n            } else {\n                locPreTouchPool[this._preTouchPoolPointer] = touch;\n                this._preTouchPoolPointer = (this._preTouchPoolPointer + 1) % 50;\n            }\n        }\n    },\n\n    /**\n     * @function\n     * @param {Number} tx\n     * @param {Number} ty\n     * @param {cc.Point} pos\n     * @return {cc.Touch}\n     */\n    getTouchByXY: function (tx, ty, pos) {\n        var locPreTouch = this._preTouchPoint;\n        var location = this._glView.convertToLocationInView(tx, ty, pos);\n        var touch = new cc.Touch(location.x, location.y);\n        touch._setPrevPoint(locPreTouch.x, locPreTouch.y);\n        locPreTouch.x = location.x;\n        locPreTouch.y = location.y;\n        return touch;\n    },\n\n    /**\n     * @function\n     * @param {cc.Point} location\n     * @param {cc.Point} pos\n     * @param {Number} eventType\n     * @returns {cc.EventMouse}\n     */\n    getMouseEvent: function (location, pos, eventType) {\n        var locPreMouse = this._prevMousePoint;\n        this._glView._convertMouseToLocationInView(location, pos);\n        var mouseEvent = new cc.EventMouse(eventType);\n        mouseEvent.setLocation(location.x, location.y);\n        mouseEvent._setPrevCursor(locPreMouse.x, locPreMouse.y);\n        locPreMouse.x = location.x;\n        locPreMouse.y = location.y;\n        return mouseEvent;\n    },\n\n    /**\n     * @function\n     * @param {Touch} event\n     * @param {cc.Point} pos\n     * @return {cc.Point}\n     */\n    getPointByEvent: function (event, pos) {\n        if (event.pageX != null)  //not available in <= IE8\n            return {x: event.pageX, y: event.pageY};\n\n        pos.left -= document.body.scrollLeft;\n        pos.top -= document.body.scrollTop;\n        return {x: event.clientX, y: event.clientY};\n    },\n\n    /**\n     * @function\n     * @param {Touch} event\n     * @param {cc.Point} pos\n     * @returns {Array}\n     */\n    getTouchesByEvent: function (event, pos) {\n        var touchArr = [], locView = this._glView;\n        var touch_event, touch, preLocation;\n        var locPreTouch = this._preTouchPoint;\n\n        var length = event.changedTouches.length;\n        for (var i = 0; i < length; i++) {\n            touch_event = event.changedTouches[i];\n            if (touch_event) {\n                var location;\n                if (cc.sys.BROWSER_TYPE_FIREFOX === cc.sys.browserType)\n                    location = locView.convertToLocationInView(touch_event.pageX, touch_event.pageY, pos);\n                else\n                    location = locView.convertToLocationInView(touch_event.clientX, touch_event.clientY, pos);\n                if (touch_event.identifier != null) {\n                    touch = new cc.Touch(location.x, location.y, touch_event.identifier);\n                    //use Touch Pool\n                    preLocation = this.getPreTouch(touch).getLocation();\n                    touch._setPrevPoint(preLocation.x, preLocation.y);\n                    this.setPreTouch(touch);\n                } else {\n                    touch = new cc.Touch(location.x, location.y);\n                    touch._setPrevPoint(locPreTouch.x, locPreTouch.y);\n                }\n                locPreTouch.x = location.x;\n                locPreTouch.y = location.y;\n                touchArr.push(touch);\n            }\n        }\n        return touchArr;\n    },\n\n    /**\n     * @function\n     * @param {HTMLElement} element\n     */\n    registerSystemEvent: function (element) {\n        if (this._isRegisterEvent) return;\n\n        var locView = this._glView = cc.view;\n        var selfPointer = this;\n        var supportMouse = ('mouse' in cc.sys.capabilities), supportTouches = ('touches' in cc.sys.capabilities);\n\n        //HACK\n        //  - At the same time to trigger the ontouch event and onmouse event\n        //  - The function will execute 2 times\n        //The known browser:\n        //  liebiao\n        //  miui\n        //  WECHAT\n        var prohibition = false;\n        if (cc.sys.isMobile)\n            prohibition = true;\n\n        //register touch event\n        if (supportMouse) {\n            window.addEventListener('mousedown', function () {\n                selfPointer._mousePressed = true;\n            }, false);\n\n            window.addEventListener('mouseup', function (event) {\n                if (prohibition) return;\n                var savePressed = selfPointer._mousePressed;\n                selfPointer._mousePressed = false;\n\n                if (!savePressed)\n                    return;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                var location = selfPointer.getPointByEvent(event, pos);\n                if (!cc.rectContainsPoint(new cc.Rect(pos.left, pos.top, pos.width, pos.height), location)) {\n                    selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x, location.y, pos)]);\n\n                    var mouseEvent = selfPointer.getMouseEvent(location, pos, cc.EventMouse.UP);\n                    mouseEvent.setButton(event.button);\n                    cc.eventManager.dispatchEvent(mouseEvent);\n                }\n            }, false);\n\n            //register canvas mouse event\n            element.addEventListener(\"mousedown\", function (event) {\n                if (prohibition) return;\n                selfPointer._mousePressed = true;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                var location = selfPointer.getPointByEvent(event, pos);\n\n                selfPointer.handleTouchesBegin([selfPointer.getTouchByXY(location.x, location.y, pos)]);\n\n                var mouseEvent = selfPointer.getMouseEvent(location, pos, cc.EventMouse.DOWN);\n                mouseEvent.setButton(event.button);\n                cc.eventManager.dispatchEvent(mouseEvent);\n\n                event.stopPropagation();\n                event.preventDefault();\n                element.focus();\n            }, false);\n\n            element.addEventListener(\"mouseup\", function (event) {\n                if (prohibition) return;\n                selfPointer._mousePressed = false;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                var location = selfPointer.getPointByEvent(event, pos);\n\n                selfPointer.handleTouchesEnd([selfPointer.getTouchByXY(location.x, location.y, pos)]);\n\n                var mouseEvent = selfPointer.getMouseEvent(location, pos, cc.EventMouse.UP);\n                mouseEvent.setButton(event.button);\n                cc.eventManager.dispatchEvent(mouseEvent);\n\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n\n            element.addEventListener(\"mousemove\", function (event) {\n                if (prohibition) return;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                var location = selfPointer.getPointByEvent(event, pos);\n\n                selfPointer.handleTouchesMove([selfPointer.getTouchByXY(location.x, location.y, pos)]);\n\n                var mouseEvent = selfPointer.getMouseEvent(location, pos, cc.EventMouse.MOVE);\n                if (selfPointer._mousePressed)\n                    mouseEvent.setButton(event.button);\n                else\n                    mouseEvent.setButton(null);\n                cc.eventManager.dispatchEvent(mouseEvent);\n\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n\n            element.addEventListener(\"mousewheel\", function (event) {\n                var pos = selfPointer.getHTMLElementPosition(element);\n                var location = selfPointer.getPointByEvent(event, pos);\n\n                var mouseEvent = selfPointer.getMouseEvent(location, pos, cc.EventMouse.SCROLL);\n                mouseEvent.setButton(event.button);\n                mouseEvent.setScrollData(0, event.wheelDelta);\n                cc.eventManager.dispatchEvent(mouseEvent);\n\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n\n            /* firefox fix */\n            element.addEventListener(\"DOMMouseScroll\", function (event) {\n                var pos = selfPointer.getHTMLElementPosition(element);\n                var location = selfPointer.getPointByEvent(event, pos);\n\n                var mouseEvent = selfPointer.getMouseEvent(location, pos, cc.EventMouse.SCROLL);\n                mouseEvent.setButton(event.button);\n                mouseEvent.setScrollData(0, event.detail * -120);\n                cc.eventManager.dispatchEvent(mouseEvent);\n\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n        }\n\n        if (window.navigator.msPointerEnabled) {\n            var _pointerEventsMap = {\n                \"MSPointerDown\": selfPointer.handleTouchesBegin,\n                \"MSPointerMove\": selfPointer.handleTouchesMove,\n                \"MSPointerUp\": selfPointer.handleTouchesEnd,\n                \"MSPointerCancel\": selfPointer.handleTouchesCancel\n            };\n\n            for (var eventName in _pointerEventsMap) {\n                (function (_pointerEvent, _touchEvent) {\n                    element.addEventListener(_pointerEvent, function (event) {\n                        var pos = selfPointer.getHTMLElementPosition(element);\n                        pos.left -= document.documentElement.scrollLeft;\n                        pos.top -= document.documentElement.scrollTop;\n\n                        _touchEvent.call(selfPointer, [selfPointer.getTouchByXY(event.clientX, event.clientY, pos)]);\n                        event.stopPropagation();\n                    }, false);\n                })(eventName, _pointerEventsMap[eventName]);\n            }\n        }\n\n        if (supportTouches) {\n            //register canvas touch event\n            element.addEventListener(\"touchstart\", function (event) {\n                if (!event.changedTouches) return;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                pos.left -= document.body.scrollLeft;\n                pos.top -= document.body.scrollTop;\n                selfPointer.handleTouchesBegin(selfPointer.getTouchesByEvent(event, pos));\n                event.stopPropagation();\n                event.preventDefault();\n                element.focus();\n            }, false);\n\n            element.addEventListener(\"touchmove\", function (event) {\n                if (!event.changedTouches) return;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                pos.left -= document.body.scrollLeft;\n                pos.top -= document.body.scrollTop;\n                selfPointer.handleTouchesMove(selfPointer.getTouchesByEvent(event, pos));\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n\n            element.addEventListener(\"touchend\", function (event) {\n                if (!event.changedTouches) return;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                pos.left -= document.body.scrollLeft;\n                pos.top -= document.body.scrollTop;\n                selfPointer.handleTouchesEnd(selfPointer.getTouchesByEvent(event, pos));\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n\n            element.addEventListener(\"touchcancel\", function (event) {\n                if (!event.changedTouches) return;\n\n                var pos = selfPointer.getHTMLElementPosition(element);\n                pos.left -= document.body.scrollLeft;\n                pos.top -= document.body.scrollTop;\n                selfPointer.handleTouchesCancel(selfPointer.getTouchesByEvent(event, pos));\n                event.stopPropagation();\n                event.preventDefault();\n            }, false);\n        }\n\n        //register keyboard event\n        this._registerKeyboardEvent();\n\n        //register Accelerometer event\n        // this._registerAccelerometerEvent();\n\n        this._isRegisterEvent = true;\n    },\n\n    _registerKeyboardEvent: function () {\n    },\n\n    /**\n     * Register Accelerometer event\n     * @function\n     */\n    _registerAccelerometerEvent: function () {\n    },\n\n    /**\n     * @function\n     * @param {Number} dt\n     */\n    update: function (dt) {\n        if (this._accelCurTime > this._accelInterval) {\n            this._accelCurTime -= this._accelInterval;\n            cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration));\n        }\n        this._accelCurTime += dt;\n    }\n};\n"]}