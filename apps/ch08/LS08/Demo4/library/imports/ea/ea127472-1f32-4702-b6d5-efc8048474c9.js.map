{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/gui/scrollview/assets/frameworks/cocos2d-html5/extensions/gui/scrollview/CCScrollView.js"],"names":["cc","SCROLLVIEW_DIRECTION_NONE","SCROLLVIEW_DIRECTION_HORIZONTAL","SCROLLVIEW_DIRECTION_VERTICAL","SCROLLVIEW_DIRECTION_BOTH","SCROLL_DEACCEL_RATE","SCROLL_DEACCEL_DIST","BOUNCE_DURATION","INSET_RATIO","MOVE_INCH","BOUNCE_BACK_FACTOR","convertDistanceFromPointToInch","pointDis","eglViewer","view","factor","getScaleX","getScaleY","ScrollViewDelegate","Class","extend","scrollViewDidScroll","scrollViewDidZoom","ScrollView","Layer","_zoomScale","_minZoomScale","_maxZoomScale","_delegate","_direction","_dragging","_contentOffset","_container","_touchMoved","_maxInset","_minInset","_bounceable","_clippingToBounds","_scrollDistance","_touchPoint","_touchLength","_touches","_viewSize","_minScale","_maxScale","_parentScissorRect","_scissorRestored","_tmpViewRect","_touchListener","_className","ctor","size","container","prototype","call","p","Rect","undefined","initWithViewSize","init","pZero","setContainer","setViewSize","setTouchEnabled","length","setPosition","visit","parent","cmd","_renderCmd","parentCmd","_visible","_propagateFlagsDown","renderer","pushRenderCommand","startCmd","i","children","_children","len","_reorderChildDirty","sortAllChildren","endCmd","_dirtyFlag","setContentOffset","offset","animated","setContentOffsetInDuration","minOffset","minContainerOffset","maxOffset","maxContainerOffset","x","Math","max","min","y","locDelegate","getContentOffset","locPos","getPosition","dt","scroll","moveTo","expire","callFunc","_stoppedAnimatedScroll","runAction","sequence","schedule","_performedAnimatedScroll","setZoomScale","scale","setZoomScaleInDuration","locContainer","getScale","oldCenter","newCenter","center","locViewSize","width","height","convertToWorldSpace","convertToNodeSpace","setScale","pSub","pAdd","getZoomScale","s","locScale","scaleAction","actionTween","locContentSize","getContentSize","isNodeVisible","node","getViewSize","viewRect","rect","rectIntersectsRect","getBoundingBox","pause","sender","selChildren","getChildren","_super","resume","isDragging","isTouchMoved","isBounceable","setBounceable","bounceable","Node","setContentSize","getContainer","removeAllChildren","ignoreAnchorPointForPosition","setAnchorPoint","addChild","getDirection","setDirection","direction","getDelegate","setDelegate","delegate","onTouchBegan","touch","event","c","isVisible","frame","_getViewRect","locPoint","convertTouchToNodeSpace","locTouches","rectContainsPoint","push","pMidpoint","pDistance","onTouchMoved","setNodeDirty","newPoint","moveDistance","dis","locDirection","pos","getPositionY","getPositionX","sqrt","_minOffset","_maxOffset","abs","locPosition","newX","newY","onTouchEnded","_deaccelerateScrolling","onTouchCancelled","updateInset","_setWidth","value","_setHeight","tempOffset","isClippingToBounds","setClippingToBounds","clippingToBounds","child","zOrder","tag","Error","getLocalZOrder","getTag","isTouchEnabled","e","eventManager","removeListener","listener","EventListener","create","TOUCH_ONE_BY_ONE","bind","addListener","_initWithViewSize","_relocateContainer","oldPoint","unschedule","maxInset","minInset","oldPosition","locScrollDistance","_handleZoom","screenPos","scaleX","scaleY","_parent","getParent","locViewRect","_createRenderCmd","_renderType","game","RENDER_TYPE_CANVAS","CanvasRenderCmd","WebGLRenderCmd","_p","defineGetterSetter","viewSize"],"mappings":"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","file":"CCScrollView.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/gui/scrollview","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n Copyright (c) 2010 Sangwoo Im\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * @ignore\n */\ncc.SCROLLVIEW_DIRECTION_NONE = -1;\n\ncc.SCROLLVIEW_DIRECTION_HORIZONTAL = 0;\n\ncc.SCROLLVIEW_DIRECTION_VERTICAL = 1;\n\ncc.SCROLLVIEW_DIRECTION_BOTH = 2;\n\nvar SCROLL_DEACCEL_RATE = 0.95;\nvar SCROLL_DEACCEL_DIST = 1.0;\nvar BOUNCE_DURATION = 0.15;\nvar INSET_RATIO = 0.2;\nvar MOVE_INCH = 7.0 / 160.0;\nvar BOUNCE_BACK_FACTOR = 0.35;\n\ncc.convertDistanceFromPointToInch = function (pointDis) {\n    var eglViewer = cc.view;\n    var factor = (eglViewer.getScaleX() + eglViewer.getScaleY()) / 2;\n    return (pointDis * factor) / 160;               // CCDevice::getDPI() default value\n};\n\ncc.ScrollViewDelegate = cc.Class.extend({\n    scrollViewDidScroll: function (view) {\n    },\n    scrollViewDidZoom: function (view) {\n    }\n});\n\n/**\n * ScrollView support for cocos2d -x.\n * It provides scroll view functionalities to cocos2d projects natively.\n * @class\n * @extends cc.Layer\n *\n * @property {cc.Point}                 minOffset   - <@readonly> The current container's minimum offset\n * @property {cc.Point}                 maxOffset   - <@readonly> The current container's maximum offset\n * @property {Boolean}                  bounceable  - Indicate whether the scroll view is bounceable\n * @property {cc.Size}                  viewSize    - The size of the scroll view\n * @property {cc.Layer}                 container   - The inside container of the scroll view\n * @property {Number}                   direction   - The direction allowed to scroll: cc.SCROLLVIEW_DIRECTION_BOTH by default, or cc.SCROLLVIEW_DIRECTION_NONE | cc.SCROLLVIEW_DIRECTION_HORIZONTAL | cc.SCROLLVIEW_DIRECTION_VERTICAL\n * @property {cc.ScrollViewDelegate}    delegate    - The inside container of the scroll view\n * @property {Boolean}           clippingToBounds   - Indicate whether the scroll view clips its children\n */\ncc.ScrollView = cc.Layer.extend(/** @lends cc.ScrollView# */{\n    _zoomScale: 0,\n    _minZoomScale: 0,\n    _maxZoomScale: 0,\n    _delegate: null,\n    _direction: cc.SCROLLVIEW_DIRECTION_BOTH,\n    _dragging: false,\n    _contentOffset: null,\n    _container: null,\n    _touchMoved: false,\n    _maxInset: null,\n    _minInset: null,\n    _bounceable: false,\n    _clippingToBounds: false,\n    _scrollDistance: null,\n    _touchPoint: null,\n    _touchLength: 0,\n    _touches: null,\n    _viewSize: null,\n    _minScale: 0,\n    _maxScale: 0,\n\n    //scissor rect for parent, just for restoring GL_SCISSOR_BOX\n    _parentScissorRect: null,\n    _scissorRestored: false,\n\n    // cache object\n    _tmpViewRect: null,\n    _touchListener: null,\n    _className: \"ScrollView\",\n\n    /**\n     * @contructor\n     * @param size\n     * @param container\n     * @returns {ScrollView}\n     */\n    ctor: function (size, container) {\n        cc.Layer.prototype.ctor.call(this);\n        this._contentOffset = cc.p(0, 0);\n        this._maxInset = cc.p(0, 0);\n        this._minInset = cc.p(0, 0);\n        this._scrollDistance = cc.p(0, 0);\n        this._touchPoint = cc.p(0, 0);\n        this._touches = [];\n        this._viewSize = cc.size(0, 0);\n        this._parentScissorRect = new cc.Rect(0, 0, 0, 0);\n        this._tmpViewRect = new cc.Rect(0, 0, 0, 0);\n\n        if (container != undefined)\n            this.initWithViewSize(size, container);\n        else\n            this.initWithViewSize(cc.size(200, 200), null);\n\n    },\n\n    init: function () {\n        return this.initWithViewSize(cc.size(200, 200), null);\n    },\n\n    /**\n     * initialized whether success or fail\n     * @param {cc.Size} size\n     * @param {cc.Node} container\n     * @return {Boolean}\n     */\n    initWithViewSize: function (size, container) {\n        var pZero = cc.p(0, 0);\n        if (cc.Layer.prototype.init.call(this)) {\n            if (!container && !this._container) {\n                container = new cc.Layer();\n            }\n            if (container) {\n                this.setContainer(container);\n            }\n            this.setViewSize(size);\n\n            this.setTouchEnabled(true);\n            this._touches.length = 0;\n            this._delegate = null;\n            this._bounceable = true;\n            this._clippingToBounds = true;\n\n            //this._container.setContentSize(CCSizeZero);\n            this._direction = cc.SCROLLVIEW_DIRECTION_BOTH;\n            this._container.setPosition(pZero);\n            this._touchLength = 0.0;\n\n            this._minScale = this._maxScale = 1.0;\n            return true;\n        }\n        return false;\n    },\n\n    visit: function (parent) {\n        var cmd = this._renderCmd, parentCmd = parent ? parent._renderCmd : null;\n\n        // quick return if not visible\n        if (!this._visible) {\n            cmd._propagateFlagsDown(parentCmd);\n            return;\n        }\n\n        var renderer = cc.renderer;\n        cmd.visit(parentCmd);\n\n        if (this._clippingToBounds) {\n            renderer.pushRenderCommand(cmd.startCmd);\n        }\n\n        var i, children = this._children, len = children.length;\n        if (len > 0) {\n            if (this._reorderChildDirty) {\n                this.sortAllChildren();\n            }\n            for (i = 0; i < len; i++) {\n                children[i].visit(this);\n            }\n        }\n\n        if (this._clippingToBounds) {\n            renderer.pushRenderCommand(cmd.endCmd);\n        }\n        cmd._dirtyFlag = 0;\n    },\n\n    /**\n     * Sets a new content offset. It ignores max/min offset. It just sets what's given. (just like UIKit's UIScrollView)\n     *\n     * @param {cc.Point} offset new offset\n     * @param {Number} [animated=] If true, the view will scroll to the new offset\n     */\n    setContentOffset: function (offset, animated) {\n        if (animated) { //animate scrolling\n            this.setContentOffsetInDuration(offset, BOUNCE_DURATION);\n            return;\n        }\n        if (!this._bounceable) {\n            var minOffset = this.minContainerOffset();\n            var maxOffset = this.maxContainerOffset();\n\n            offset.x = Math.max(minOffset.x, Math.min(maxOffset.x, offset.x));\n            offset.y = Math.max(minOffset.y, Math.min(maxOffset.y, offset.y));\n        }\n\n        this._container.setPosition(offset);\n        var locDelegate = this._delegate;\n        if (locDelegate != null && locDelegate.scrollViewDidScroll) {\n            locDelegate.scrollViewDidScroll(this);\n        }\n\n    },\n\n    getContentOffset: function () {\n        var locPos = this._container.getPosition();\n        return cc.p(locPos.x, locPos.y);\n    },\n\n    /**\n     * <p>Sets a new content offset. It ignores max/min offset. It just sets what's given. (just like UIKit's UIScrollView) <br/>\n     * You can override the animation duration with this method.\n     * </p>\n     * @param {cc.Point} offset new offset\n     * @param {Number} dt animation duration\n     */\n    setContentOffsetInDuration: function (offset, dt) {\n        var scroll = cc.moveTo(dt, offset);\n        var expire = cc.callFunc(this._stoppedAnimatedScroll, this);\n        this._container.runAction(cc.sequence(scroll, expire));\n        this.schedule(this._performedAnimatedScroll);\n    },\n\n    /**\n     * Sets a new scale and does that for a predefined duration.\n     *\n     * @param {Number} scale a new scale vale\n     * @param {Boolean} [animated=null] if YES, scaling is animated\n     */\n    setZoomScale: function (scale, animated) {\n        if (animated) {\n            this.setZoomScaleInDuration(scale, BOUNCE_DURATION);\n            return;\n        }\n\n        var locContainer = this._container;\n        if (locContainer.getScale() !== scale) {\n            var oldCenter, newCenter;\n            var center;\n\n            if (this._touchLength === 0.0) {\n                var locViewSize = this._viewSize;\n                center = cc.p(locViewSize.width * 0.5, locViewSize.height * 0.5);\n                center = this.convertToWorldSpace(center);\n            } else\n                center = this._touchPoint;\n\n            oldCenter = locContainer.convertToNodeSpace(center);\n            locContainer.setScale(Math.max(this._minScale, Math.min(this._maxScale, scale)));\n            newCenter = locContainer.convertToWorldSpace(oldCenter);\n\n            var offset = cc.pSub(center, newCenter);\n            if (this._delegate && this._delegate.scrollViewDidZoom)\n                this._delegate.scrollViewDidZoom(this);\n            this.setContentOffset(cc.pAdd(locContainer.getPosition(), offset));\n        }\n    },\n\n    getZoomScale: function () {\n        return this._container.getScale();\n    },\n\n    /**\n     * Sets a new scale for container in a given duration.\n     *\n     * @param {Number} s a new scale value\n     * @param {Number} dt animation duration\n     */\n    setZoomScaleInDuration: function (s, dt) {\n        if (dt > 0) {\n            var locScale = this._container.getScale();\n            if (locScale !== s) {\n                var scaleAction = cc.actionTween(dt, \"zoomScale\", locScale, s);\n                this.runAction(scaleAction);\n            }\n        } else {\n            this.setZoomScale(s);\n        }\n    },\n\n    /**\n     * Returns the current container's minimum offset. You may want this while you animate scrolling by yourself\n     * @return {cc.Point} Returns the current container's minimum offset.\n     */\n    minContainerOffset: function () {\n        var locContainer = this._container;\n        var locContentSize = locContainer.getContentSize(), locViewSize = this._viewSize;\n        return cc.p(locViewSize.width - locContentSize.width * locContainer.getScaleX(),\n            locViewSize.height - locContentSize.height * locContainer.getScaleY());\n    },\n\n    /**\n     * Returns the current container's maximum offset. You may want this while you animate scrolling by yourself\n     * @return {cc.Point} Returns the current container's maximum offset.\n     */\n    maxContainerOffset: function () {\n        return cc.p(0.0, 0.0);\n    },\n\n    /**\n     * Determines if a given node's bounding box is in visible bounds\n     * @param {cc.Node} node\n     * @return {Boolean} YES if it is in visible bounds\n     */\n    isNodeVisible: function (node) {\n        var offset = this.getContentOffset();\n        var size = this.getViewSize();\n        var scale = this.getZoomScale();\n\n        var viewRect = cc.rect(-offset.x / scale, -offset.y / scale, size.width / scale, size.height / scale);\n\n        return cc.rectIntersectsRect(viewRect, node.getBoundingBox());\n    },\n\n    /**\n     * Provided to make scroll view compatible with SWLayer's pause method\n     */\n    pause: function (sender) {\n        this._container.pause();\n        var selChildren = this._container.getChildren();\n        for (var i = 0; i < selChildren.length; i++) {\n            selChildren[i].pause();\n        }\n        this._super();\n    },\n\n    /**\n     * Provided to make scroll view compatible with SWLayer's resume method\n     */\n    resume: function (sender) {\n        var selChildren = this._container.getChildren();\n        for (var i = 0, len = selChildren.length; i < len; i++) {\n            selChildren[i].resume();\n        }\n        this._container.resume();\n        this._super();\n    },\n\n    isDragging: function () {\n        return this._dragging;\n    },\n    isTouchMoved: function () {\n        return this._touchMoved;\n    },\n    isBounceable: function () {\n        return this._bounceable;\n    },\n    setBounceable: function (bounceable) {\n        this._bounceable = bounceable;\n    },\n\n    /**\n     * <p>\n     * size to clip. CCNode boundingBox uses contentSize directly.                   <br/>\n     * It's semantically different what it actually means to common scroll views.    <br/>\n     * Hence, this scroll view will use a separate size property.\n     * </p>\n     */\n    getViewSize: function () {\n        return this._viewSize;\n    },\n\n    setViewSize: function (size) {\n        this._viewSize = size;\n        cc.Node.prototype.setContentSize.call(this, size);\n    },\n\n    getContainer: function () {\n        return this._container;\n    },\n\n    setContainer: function (container) {\n        // Make sure that 'm_pContainer' has a non-NULL value since there are\n        // lots of logic that use 'm_pContainer'.\n        if (!container)\n            return;\n\n        this.removeAllChildren(true);\n\n        this._container = container;\n        container.ignoreAnchorPointForPosition(false);\n        container.setAnchorPoint(0, 0);\n\n        this.addChild(container);\n        this.setViewSize(this._viewSize);\n    },\n\n    /**\n     * direction allowed to scroll. CCScrollViewDirectionBoth by default.\n     */\n    getDirection: function () {\n        return this._direction;\n    },\n    setDirection: function (direction) {\n        this._direction = direction;\n    },\n\n    getDelegate: function () {\n        return this._delegate;\n    },\n    setDelegate: function (delegate) {\n        this._delegate = delegate;\n    },\n\n    /** override functions */\n    // optional\n    onTouchBegan: function (touch, event) {\n        for (var c = this; c != null; c = c.parent) {\n            if (!c.isVisible())\n                return false;\n        }\n        //var frameOriginal = this.getParent().convertToWorldSpace(this.getPosition());\n        //var frame = cc.rect(frameOriginal.x, frameOriginal.y, this._viewSize.width, this._viewSize.height);\n        var frame = this._getViewRect();\n\n        //dispatcher does not know about clipping. reject touches outside visible bounds.\n        var locContainer = this._container;\n        var locPoint = locContainer.convertToWorldSpace(locContainer.convertTouchToNodeSpace(touch));\n        var locTouches = this._touches;\n        if (locTouches.length > 2 || this._touchMoved || !cc.rectContainsPoint(frame, locPoint))\n            return false;\n\n        locTouches.push(touch);\n        //}\n\n        if (locTouches.length === 1) { // scrolling\n            this._touchPoint = this.convertTouchToNodeSpace(touch);\n            this._touchMoved = false;\n            this._dragging = true; //dragging started\n            this._scrollDistance.x = 0;\n            this._scrollDistance.y = 0;\n            this._touchLength = 0.0;\n        } else if (locTouches.length === 2) {\n            this._touchPoint = cc.pMidpoint(this.convertTouchToNodeSpace(locTouches[0]),\n                this.convertTouchToNodeSpace(locTouches[1]));\n            this._touchLength = cc.pDistance(locContainer.convertTouchToNodeSpace(locTouches[0]),\n                locContainer.convertTouchToNodeSpace(locTouches[1]));\n            this._dragging = false;\n        }\n        return true;\n    },\n\n    onTouchMoved: function (touch, event) {\n        if (!this.isVisible())\n            return;\n\n        this.setNodeDirty();\n\n        if (this._touches.length === 1 && this._dragging) { // scrolling\n            this._touchMoved = true;\n            //var frameOriginal = this.getParent().convertToWorldSpace(this.getPosition());\n            //var frame = cc.rect(frameOriginal.x, frameOriginal.y, this._viewSize.width, this._viewSize.height);\n            var frame = this._getViewRect();\n\n            //var newPoint = this.convertTouchToNodeSpace(this._touches[0]);\n            var newPoint = this.convertTouchToNodeSpace(touch);\n            var moveDistance = cc.pSub(newPoint, this._touchPoint);\n\n            var dis = 0.0, locDirection = this._direction, pos;\n            if (locDirection === cc.SCROLLVIEW_DIRECTION_VERTICAL) {\n                dis = moveDistance.y;\n                pos = this._container.getPositionY();\n                if (!(this.minContainerOffset().y <= pos && pos <= this.maxContainerOffset().y))\n                    moveDistance.y *= BOUNCE_BACK_FACTOR;\n            } else if (locDirection === cc.SCROLLVIEW_DIRECTION_HORIZONTAL) {\n                dis = moveDistance.x;\n                pos = this._container.getPositionX();\n                if (!(this.minContainerOffset().x <= pos && pos <= this.maxContainerOffset().x))\n                    moveDistance.x *= BOUNCE_BACK_FACTOR;\n            } else {\n                dis = Math.sqrt(moveDistance.x * moveDistance.x + moveDistance.y * moveDistance.y);\n\n                pos = this._container.getPositionY();\n                var _minOffset = this.minContainerOffset(), _maxOffset = this.maxContainerOffset();\n                if (!(_minOffset.y <= pos && pos <= _maxOffset.y))\n                    moveDistance.y *= BOUNCE_BACK_FACTOR;\n\n                pos = this._container.getPositionX();\n                if (!(_minOffset.x <= pos && pos <= _maxOffset.x))\n                    moveDistance.x *= BOUNCE_BACK_FACTOR;\n            }\n\n            if (!this._touchMoved && Math.abs(cc.convertDistanceFromPointToInch(dis)) < MOVE_INCH) {\n                //CCLOG(\"Invalid movement, distance = [%f, %f], disInch = %f\", moveDistance.x, moveDistance.y);\n                return;\n            }\n\n            if (!this._touchMoved) {\n                moveDistance.x = 0;\n                moveDistance.y = 0;\n            }\n\n            this._touchPoint = newPoint;\n            this._touchMoved = true;\n\n            if (this._dragging) {\n                switch (locDirection) {\n                    case cc.SCROLLVIEW_DIRECTION_VERTICAL:\n                        moveDistance.x = 0.0;\n                        break;\n                    case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:\n                        moveDistance.y = 0.0;\n                        break;\n                    default:\n                        break;\n                }\n\n                var locPosition = this._container.getPosition();\n                var newX = locPosition.x + moveDistance.x;\n                var newY = locPosition.y + moveDistance.y;\n\n                this._scrollDistance = moveDistance;\n                this.setContentOffset(cc.p(newX, newY));\n            }\n        } else if (this._touches.length === 2 && !this._dragging) {\n            var len = cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),\n                this._container.convertTouchToNodeSpace(this._touches[1]));\n            this.setZoomScale(this.getZoomScale() * len / this._touchLength);\n        }\n    },\n\n    onTouchEnded: function (touch, event) {\n        if (!this.isVisible())\n            return;\n\n        if (this._touches.length === 1 && this._touchMoved)\n            this.schedule(this._deaccelerateScrolling);\n\n        this._touches.length = 0;\n        this._dragging = false;\n        this._touchMoved = false;\n    },\n\n    onTouchCancelled: function (touch, event) {\n        if (!this.isVisible())\n            return;\n\n        this._touches.length = 0;\n        this._dragging = false;\n        this._touchMoved = false;\n    },\n\n    setContentSize: function (size, height) {\n        if (this.getContainer() !== null) {\n            if (height === undefined)\n                this.getContainer().setContentSize(size);\n            else\n                this.getContainer().setContentSize(size, height);\n            this.updateInset();\n        }\n    },\n    _setWidth: function (value) {\n        var container = this.getContainer();\n        if (container !== null) {\n            container._setWidth(value);\n            this.updateInset();\n        }\n    },\n    _setHeight: function (value) {\n        var container = this.getContainer();\n        if (container !== null) {\n            container._setHeight(value);\n            this.updateInset();\n        }\n    },\n\n    getContentSize: function () {\n        return this._container.getContentSize();\n    },\n\n    updateInset: function () {\n        if (this.getContainer() !== null) {\n            var locViewSize = this._viewSize;\n            var tempOffset = this.maxContainerOffset();\n            this._maxInset.x = tempOffset.x + locViewSize.width * INSET_RATIO;\n            this._maxInset.y = tempOffset.y + locViewSize.height * INSET_RATIO;\n            tempOffset = this.minContainerOffset();\n            this._minInset.x = tempOffset.x - locViewSize.width * INSET_RATIO;\n            this._minInset.y = tempOffset.y - locViewSize.height * INSET_RATIO;\n        }\n    },\n\n    /**\n     * Determines whether it clips its children or not.\n     */\n    isClippingToBounds: function () {\n        return this._clippingToBounds;\n    },\n\n    setClippingToBounds: function (clippingToBounds) {\n        this._clippingToBounds = clippingToBounds;\n    },\n\n    addChild: function (child, zOrder, tag) {\n        if (!child)\n            throw new Error(\"child must not nil!\");\n\n        zOrder = zOrder || child.getLocalZOrder();\n        tag = tag || child.getTag();\n\n        //child.ignoreAnchorPointForPosition(false);\n        //child.setAnchorPoint(0, 0);\n        if (this._container !== child) {\n            this._container.addChild(child, zOrder, tag);\n        } else {\n            cc.Layer.prototype.addChild.call(this, child, zOrder, tag);\n        }\n    },\n\n    isTouchEnabled: function () {\n        return this._touchListener !== null;\n    },\n\n    setTouchEnabled: function (e) {\n        if (this._touchListener)\n            cc.eventManager.removeListener(this._touchListener);\n        this._touchListener = null;\n        if (!e) {\n            this._dragging = false;\n            this._touchMoved = false;\n            this._touches.length = 0;\n        } else {\n            var listener = cc.EventListener.create({\n                event: cc.EventListener.TOUCH_ONE_BY_ONE\n            });\n            if (this.onTouchBegan)\n                listener.onTouchBegan = this.onTouchBegan.bind(this);\n            if (this.onTouchMoved)\n                listener.onTouchMoved = this.onTouchMoved.bind(this);\n            if (this.onTouchEnded)\n                listener.onTouchEnded = this.onTouchEnded.bind(this);\n            if (this.onTouchCancelled)\n                listener.onTouchCancelled = this.onTouchCancelled.bind(this);\n            this._touchListener = listener;\n            cc.eventManager.addListener(listener, this);\n        }\n    },\n\n    /**\n     * Init this object with a given size to clip its content.\n     *\n     * @param size view size\n     * @return initialized scroll view object\n     */\n    _initWithViewSize: function (size) {\n        return null;\n    },\n\n    /**\n     * Relocates the container at the proper offset, in bounds of max/min offsets.\n     *\n     * @param animated If YES, relocation is animated\n     */\n    _relocateContainer: function (animated) {\n        var min = this.minContainerOffset();\n        var max = this.maxContainerOffset();\n        var locDirection = this._direction;\n\n        var oldPoint = this._container.getPosition();\n        var newX = oldPoint.x;\n        var newY = oldPoint.y;\n        if (locDirection === cc.SCROLLVIEW_DIRECTION_BOTH || locDirection === cc.SCROLLVIEW_DIRECTION_HORIZONTAL) {\n            newX = Math.max(newX, min.x);\n            newX = Math.min(newX, max.x);\n        }\n\n        if (locDirection === cc.SCROLLVIEW_DIRECTION_BOTH || locDirection === cc.SCROLLVIEW_DIRECTION_VERTICAL) {\n            newY = Math.min(newY, max.y);\n            newY = Math.max(newY, min.y);\n        }\n\n        if (newY !== oldPoint.y || newX !== oldPoint.x) {\n            this.setContentOffset(cc.p(newX, newY), animated);\n        }\n    },\n    /**\n     * implements auto-scrolling behavior. change SCROLL_DEACCEL_RATE as needed to choose    <br/>\n     * deacceleration speed. it must be less than 1.0.\n     *\n     * @param {Number} dt delta\n     */\n    _deaccelerateScrolling: function (dt) {\n        if (this._dragging) {\n            this.unschedule(this._deaccelerateScrolling);\n            return;\n        }\n\n        var maxInset, minInset;\n        var oldPosition = this._container.getPosition();\n        var locScrollDistance = this._scrollDistance;\n        this._container.setPosition(oldPosition.x + locScrollDistance.x, oldPosition.y + locScrollDistance.y);\n        if (this._bounceable) {\n            maxInset = this._maxInset;\n            minInset = this._minInset;\n        } else {\n            maxInset = this.maxContainerOffset();\n            minInset = this.minContainerOffset();\n        }\n\n        //check to see if offset lies within the inset bounds\n        var newX = this._container.getPositionX();\n        var newY = this._container.getPositionY();\n        \n        locScrollDistance.x = locScrollDistance.x * SCROLL_DEACCEL_RATE;\n        locScrollDistance.y = locScrollDistance.y * SCROLL_DEACCEL_RATE;\n\n        this.setContentOffset(cc.p(newX, newY));\n\n        if ((Math.abs(locScrollDistance.x) <= SCROLL_DEACCEL_DIST &&\n            Math.abs(locScrollDistance.y) <= SCROLL_DEACCEL_DIST) ||\n            newY > maxInset.y || newY < minInset.y ||\n            newX > maxInset.x || newX < minInset.x ||\n            newX === maxInset.x || newX === minInset.x ||\n            newY === maxInset.y || newY === minInset.y) {\n            this.unschedule(this._deaccelerateScrolling);\n            this._relocateContainer(true);\n        }\n    },\n    /**\n     * This method makes sure auto scrolling causes delegate to invoke its method\n     */\n    _performedAnimatedScroll: function (dt) {\n        if (this._dragging) {\n            this.unschedule(this._performedAnimatedScroll);\n            return;\n        }\n\n        if (this._delegate && this._delegate.scrollViewDidScroll)\n            this._delegate.scrollViewDidScroll(this);\n    },\n    /**\n     * Expire animated scroll delegate calls\n     */\n    _stoppedAnimatedScroll: function (node) {\n        this.unschedule(this._performedAnimatedScroll);\n        // After the animation stopped, \"scrollViewDidScroll\" should be invoked, this could fix the bug of lack of tableview cells.\n        if (this._delegate && this._delegate.scrollViewDidScroll) {\n            this._delegate.scrollViewDidScroll(this);\n        }\n    },\n\n    /**\n     * Zoom handling\n     */\n    _handleZoom: function () {\n    },\n\n    _getViewRect: function () {\n        var screenPos = this.convertToWorldSpace(cc.p(0, 0));\n        var locViewSize = this._viewSize;\n\n        var scaleX = this.getScaleX();\n        var scaleY = this.getScaleY();\n\n        for (var p = this._parent; p != null; p = p.getParent()) {\n            scaleX *= p.getScaleX();\n            scaleY *= p.getScaleY();\n        }\n\n        // Support negative scaling. Not doing so causes intersectsRect calls\n        // (eg: to check if the touch was within the bounds) to return false.\n        // Note, CCNode::getScale will assert if X and Y scales are different.\n        if (scaleX < 0) {\n            screenPos.x += locViewSize.width * scaleX;\n            scaleX = -scaleX;\n        }\n        if (scaleY < 0) {\n            screenPos.y += locViewSize.height * scaleY;\n            scaleY = -scaleY;\n        }\n\n        var locViewRect = this._tmpViewRect;\n        locViewRect.x = screenPos.x;\n        locViewRect.y = screenPos.y;\n        locViewRect.width = locViewSize.width * scaleX;\n        locViewRect.height = locViewSize.height * scaleY;\n        return locViewRect;\n    },\n\n    _createRenderCmd: function () {\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            return new cc.ScrollView.CanvasRenderCmd(this);\n        } else {\n            return new cc.ScrollView.WebGLRenderCmd(this);\n        }\n    }\n});\n\nvar _p = cc.ScrollView.prototype;\n\n// Extended properties\n/** @expose */\n_p.minOffset;\ncc.defineGetterSetter(_p, \"minOffset\", _p.minContainerOffset);\n/** @expose */\n_p.maxOffset;\ncc.defineGetterSetter(_p, \"maxOffset\", _p.maxContainerOffset);\n/** @expose */\n_p.bounceable;\ncc.defineGetterSetter(_p, \"bounceable\", _p.isBounceable, _p.setBounceable);\n/** @expose */\n_p.viewSize;\ncc.defineGetterSetter(_p, \"viewSize\", _p.getViewSize, _p.setViewSize);\n/** @expose */\n_p.container;\ncc.defineGetterSetter(_p, \"container\", _p.getContainer, _p.setContainer);\n/** @expose */\n_p.direction;\ncc.defineGetterSetter(_p, \"direction\", _p.getDirection, _p.setDirection);\n/** @expose */\n_p.delegate;\ncc.defineGetterSetter(_p, \"delegate\", _p.getDelegate, _p.setDelegate);\n/** @expose */\n_p.clippingToBounds;\ncc.defineGetterSetter(_p, \"clippingToBounds\", _p.isClippingToBounds, _p.setClippingToBounds);\n\n_p = null;\n\n/**\n * Returns an autoreleased scroll view object.\n * @deprecated\n * @param {cc.Size} size view size\n * @param {cc.Node} container parent object\n * @return {cc.ScrollView} scroll view object\n */\ncc.ScrollView.create = function (size, container) {\n    return new cc.ScrollView(size, container);\n};\n"]}