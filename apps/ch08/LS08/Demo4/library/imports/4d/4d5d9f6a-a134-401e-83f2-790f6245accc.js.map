{"version":3,"sources":["../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/webconsole/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/webconsole/utils.js"],"names":["exports","REGEX_MATCH_FUNCTION_NAME","REGEX_MATCH_FUNCTION_ARGS","CONSOLE_ENTRY_THRESHOLD","MAX_AUTOCOMPLETE_ATTEMPTS","CONSOLE_WORKER_IDS","MAX_AUTOCOMPLETIONS","WebConsoleUtils","supportsString","WCU_supportsString","aString","str","Cc","createInstance","Ci","nsISupportsString","data","cloneObject","WCU_cloneObject","aObject","aRecursive","aFilter","temp","Array","isArray","forEach","aValue","aIndex","push","key","value","hasOwnProperty","copyTextStyles","WCU_copyTextStyles","aFrom","aTo","win","ownerDocument","defaultView","style","getComputedStyle","fontFamily","getPropertyCSSValue","cssText","fontSize","fontWeight","fontStyle","getInnerWindowId","WCU_getInnerWindowId","aWindow","QueryInterface","nsIInterfaceRequestor","getInterface","nsIDOMWindowUtils","currentInnerWindowID","getInnerWindowIDsForFrames","WCU_getInnerWindowIDsForFrames","innerWindowID","ids","frames","i","length","frame","concat","getOuterWindowId","WCU_getOuterWindowId","outerWindowID","abbreviateSourceURL","WCU_abbreviateSourceURL","aSourceURL","aOptions","onlyCropQuery","substr","commaIndex","indexOf","substring","hookIndex","hashIndex","replace","slashIndex","lastIndexOf","isNativeFunction","WCU_isNativeFunction","aFunction","isNonNativeGetter","WCU_isNonNativeGetter","aProp","desc","getPropertyDescriptor","get","WCU_getPropertyDescriptor","Object","getOwnPropertyDescriptor","ex","name","getPrototypeOf","propertiesSort","WCU_propertiesSort","a","b","aNumber","parseFloat","bNumber","isNaN","createValueGrip","WCU_createValueGrip","aObjectWrapper","Infinity","type","Number","Cu","reportError","isIteratorOrGenerator","WCU_isIteratorOrGenerator","__iterator__","constructor","toString","next","isMixedHTTPSRequest","WCU_isMixedHTTPSRequest","aRequest","aLocation","requestURI","Services","io","newURI","contentURI","scheme","getFunctionName","WCF_getFunctionName","toSource","match","getObjectClassName","WCU_getObjectClassName","undefined","charAt","toUpperCase","className","isActorGrip","WCU_isActorGrip","aGrip","actor","_usageCount","usageCount","prefs","getIntPref","getBoolPref","newUC","setIntPref","pasteHandlerGen","WCU_pasteHandlerGen","inputField","notificationBox","msg","okstring","handler","WCU_pasteHandler","aEvent","removeEventListener","getNotificationWithValue","preventDefault","stopPropagation","notification","appendNotification","PRIORITY_WARNING_HIGH","eventType","pasteKeyUpHandler","aEvent2","textContent","includes","removeNotification","addEventListener","Utils","l10n","WCU_l10n","aBundleURI","_bundleUri","prototype","_stringBundle","stringBundle","strings","createBundle","timestampString","WCU_l10n_timestampString","aMilliseconds","d","Date","hours","getHours","minutes","getMinutes","seconds","getSeconds","milliseconds","getMilliseconds","parameters","getFormatStr","getStr","WCU_l10n_getStr","aName","result","GetStringFromName","WCU_l10n_getFormatStr","aArray","formatStringFromName","_JSPP","WCU","STATE_NORMAL","STATE_QUOTE","STATE_DQUOTE","OPEN_BODY","split","CLOSE_BODY","OPEN_CLOSE_BODY","findCompletionBeginning","aStr","bodyStack","state","start","c","token","last","pop","err","startPos","JSPropertyProvider","aDbgObject","anEnvironment","aInputValue","aCursor","inputValue","beginning","completionPart","trim","lastDot","matchProp","slice","getMatchedProps","String","properties","trimLeft","obj","getMatchedPropsInEnvironment","getVariableInEnvironment","shift","isObjectUsable","prop","test","getArrayMemberProperty","DevToolsUtils","getProperty","getMatchedPropsInDbgObject","aObj","propWithoutIndices","arrayIndicesRegex","exec","indexWithBrackets","indexAsText","index","parseInt","class","getExactMatch_impl","DebuggerEnvironmentSupport","aMatch","getMatchedProps_impl","DebuggerObjectSupport","JSObjectSupport","chainIterator","getProperties","matches","Set","numProps","iter","props","size","add","getOwnPropertyNames","proto","aRootObj","parent","names","getVariable","optimizedOut","missingArguments","makeInfallible","ConsoleServiceListener","aListener","window","listener","init","CSL_init","console","registerListener","observe","CSL_observe","aMessage","nsIScriptError","isCategoryAllowed","category","errorWindow","wm","getOuterWindowWithId","isWindowIncluded","onConsoleServiceMessage","CSL_isCategoryAllowed","aCategory","getCachedMessages","CSL_getCachedMessages","aIncludePrivate","errors","getMessageArray","filter","aError","isFromPrivateWindow","destroy","CSL_destroy","unregisterListener","ConsoleAPIListener","aOwner","aConsoleID","owner","consoleID","CAL_init","CAL_observe","aTopic","apiMessage","wrappedJSObject","innerID","msgWindow","getCurrentInnerWindowWithId","onConsoleAPICall","CAL_getCachedMessages","messages","m","private","CAL_destroy","obs","removeObserver","WebConsoleCommands","_registeredCommands","Map","_originalCommands","_registerOriginal","command","register","set","getCommand","unregister","delete","has","hasCommand","JSTH_$","aSelector","document","querySelector","JSTH_$$","nodes","querySelectorAll","consoleActor","getLastConsoleInputEvaluation","JSTH_$x","aXPath","aContext","doc","results","evaluate","nsIDOMXPathResult","ANY_TYPE","node","iterateNext","makeDebuggeeValue","selectedNode","JSTH_clear","helperResult","JSTH_clearHistory","JSTH_keys","cloneInto","keys","waiveXrays","JSTH_values","values","waived","JSTH_help","JSTH_cd","evalWindow","nsIDOMElement","contentWindow","nsIDOMWindow","message","JSTH_inspect","dbgObj","grip","input","evalInput","object","JSTH_pprint","rawOutput","output","getGrip","VariablesView","setGrip","getString","setString","valueGrip","valueString","join","JSTH_print","Symbol","call","JSTH_copy","payload","outerHTML","JSON","stringify","addWebConsoleCommands","Error","sandbox","bind","clone","attr","enumerable","configurable","defineProperty","ConsoleReflowListener","docshell","nsIWebNavigation","nsIDocShell","addWeakReflowObserver","sendReflow","CRL_sendReflow","aStart","aEnd","aInterruptible","components","stack","caller","filename","onReflowActivity","interruptible","end","sourceURL","sourceLine","lineNumber","functionName","reflow","CRL_reflow","reflowInterruptible","CRL_reflowInterruptible","CRL_destroy","removeWeakReflowObserver","gSequenceId","n"],"mappings":"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","file":"utils.js","sourceRoot":"../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/webconsole","sourcesContent":["/****************************************************************************\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n \n http://www.cocos2d-x.org\n \n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n \n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n \n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/* -*- js-indent-level: 2; indent-tabs-mode: nil -*- */\n/* vim: set ft=javascript ts=2 et sw=2 tw=80: */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this file,\n * You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n\"use strict\";\n\n// const {Cc, Ci, Cu, components} = require(\"chrome\");\n// const {isWindowIncluded} = require(\"devtools/toolkit/layout/utils\");\n\n// Cu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\n\n// loader.lazyImporter(this, \"Services\", \"resource://gre/modules/Services.jsm\");\n\n// TODO: Bug 842672 - browser/ imports modules from toolkit/.\n// Note that these are only used in WebConsoleCommands, see $0 and pprint().\n// loader.lazyImporter(this, \"VariablesView\", \"resource:///modules/devtools/VariablesView.jsm\");\n// const DevToolsUtils = require(\"devtools/toolkit/DevToolsUtils\");\n\n// Match the function name from the result of toString() or toSource().\n//\n// Examples:\n// (function foobar(a, b) { ...\n// function foobar2(a) { ...\n// function() { ...\n\nvar exports = exports || {};\n\n\nconst REGEX_MATCH_FUNCTION_NAME = /^\\(?function\\s+([^(\\s]+)\\s*\\(/;\n\n// Match the function arguments from the result of toString() or toSource().\nconst REGEX_MATCH_FUNCTION_ARGS = /^\\(?function\\s*[^\\s(]*\\s*\\((.+?)\\)/;\n\n// Number of terminal entries for the self-xss prevention to go away\nconst CONSOLE_ENTRY_THRESHOLD = 5;\n\n// Provide an easy way to bail out of even attempting an autocompletion\n// if an object has way too many properties. Protects against large objects\n// with numeric values that wouldn't be tallied towards MAX_AUTOCOMPLETIONS.\nconst MAX_AUTOCOMPLETE_ATTEMPTS = exports.MAX_AUTOCOMPLETE_ATTEMPTS = 100000;\n\nconst CONSOLE_WORKER_IDS =  exports.CONSOLE_WORKER_IDS =[ 'SharedWorker', 'ServiceWorker', 'Worker' ];\n\n// Prevent iterating over too many properties during autocomplete suggestions.\nconst MAX_AUTOCOMPLETIONS = exports.MAX_AUTOCOMPLETIONS = 1500;\n\nvar WebConsoleUtils = {\n\n  /**\n   * Wrap a string in an nsISupportsString object.\n   *\n   * @param string aString\n   * @return nsISupportsString\n   */\n  supportsString: function WCU_supportsString(aString)\n  {\n    let str = Cc[\"@mozilla.org/supports-string;1\"].\n              createInstance(Ci.nsISupportsString);\n    str.data = aString;\n    return str;\n  },\n\n  /**\n   * Clone an object.\n   *\n   * @param object aObject\n   *        The object you want cloned.\n   * @param boolean aRecursive\n   *        Tells if you want to dig deeper into the object, to clone\n   *        recursively.\n   * @param function [aFilter]\n   *        Optional, filter function, called for every property. Three\n   *        arguments are passed: key, value and object. Return true if the\n   *        property should be added to the cloned object. Return false to skip\n   *        the property.\n   * @return object\n   *         The cloned object.\n   */\n  cloneObject: function WCU_cloneObject(aObject, aRecursive, aFilter)\n  {\n    if (typeof aObject != \"object\") {\n      return aObject;\n    }\n\n    let temp;\n\n    if (Array.isArray(aObject)) {\n      temp = [];\n      Array.forEach(aObject, function(aValue, aIndex) {\n        if (!aFilter || aFilter(aIndex, aValue, aObject)) {\n          temp.push(aRecursive ? WCU_cloneObject(aValue) : aValue);\n        }\n      });\n    }\n    else {\n      temp = {};\n      for (let key in aObject) {\n        let value = aObject[key];\n        if (aObject.hasOwnProperty(key) &&\n            (!aFilter || aFilter(key, value, aObject))) {\n          temp[key] = aRecursive ? WCU_cloneObject(value) : value;\n        }\n      }\n    }\n\n    return temp;\n  },\n\n  /**\n   * Copies certain style attributes from one element to another.\n   *\n   * @param nsIDOMNode aFrom\n   *        The target node.\n   * @param nsIDOMNode aTo\n   *        The destination node.\n   */\n  copyTextStyles: function WCU_copyTextStyles(aFrom, aTo)\n  {\n    let win = aFrom.ownerDocument.defaultView;\n    let style = win.getComputedStyle(aFrom);\n    aTo.style.fontFamily = style.getPropertyCSSValue(\"font-family\").cssText;\n    aTo.style.fontSize = style.getPropertyCSSValue(\"font-size\").cssText;\n    aTo.style.fontWeight = style.getPropertyCSSValue(\"font-weight\").cssText;\n    aTo.style.fontStyle = style.getPropertyCSSValue(\"font-style\").cssText;\n  },\n\n  /**\n   * Gets the ID of the inner window of this DOM window.\n   *\n   * @param nsIDOMWindow aWindow\n   * @return integer\n   *         Inner ID for the given aWindow.\n   */\n  getInnerWindowId: function WCU_getInnerWindowId(aWindow)\n  {\n    return aWindow.QueryInterface(Ci.nsIInterfaceRequestor).\n             getInterface(Ci.nsIDOMWindowUtils).currentInnerWindowID;\n  },\n\n  /**\n   * Recursively gather a list of inner window ids given a\n   * top level window.\n   *\n   * @param nsIDOMWindow aWindow\n   * @return Array\n   *         list of inner window ids.\n   */\n  getInnerWindowIDsForFrames: function WCU_getInnerWindowIDsForFrames(aWindow)\n  {\n    let innerWindowID = this.getInnerWindowId(aWindow);\n    let ids = [innerWindowID];\n\n    if (aWindow.frames) {\n      for (let i = 0; i < aWindow.frames.length; i++) {\n        let frame = aWindow.frames[i];\n        ids = ids.concat(this.getInnerWindowIDsForFrames(frame));\n      }\n    }\n\n    return ids;\n  },\n\n\n  /**\n   * Gets the ID of the outer window of this DOM window.\n   *\n   * @param nsIDOMWindow aWindow\n   * @return integer\n   *         Outer ID for the given aWindow.\n   */\n  getOuterWindowId: function WCU_getOuterWindowId(aWindow)\n  {\n    return aWindow.QueryInterface(Ci.nsIInterfaceRequestor).\n           getInterface(Ci.nsIDOMWindowUtils).outerWindowID;\n  },\n\n  /**\n   * Abbreviates the given source URL so that it can be displayed flush-right\n   * without being too distracting.\n   *\n   * @param string aSourceURL\n   *        The source URL to shorten.\n   * @param object [aOptions]\n   *        Options:\n   *        - onlyCropQuery: boolean that tells if the URL abbreviation function\n   *        should only remove the query parameters and the hash fragment from\n   *        the given URL.\n   * @return string\n   *         The abbreviated form of the source URL.\n   */\n  abbreviateSourceURL:\n  function WCU_abbreviateSourceURL(aSourceURL, aOptions = {})\n  {\n    if (!aOptions.onlyCropQuery && aSourceURL.substr(0, 5) == \"data:\") {\n      let commaIndex = aSourceURL.indexOf(\",\");\n      if (commaIndex > -1) {\n        aSourceURL = \"data:\" + aSourceURL.substring(commaIndex + 1);\n      }\n    }\n\n    // Remove any query parameters.\n    let hookIndex = aSourceURL.indexOf(\"?\");\n    if (hookIndex > -1) {\n      aSourceURL = aSourceURL.substring(0, hookIndex);\n    }\n\n    // Remove any hash fragments.\n    let hashIndex = aSourceURL.indexOf(\"#\");\n    if (hashIndex > -1) {\n      aSourceURL = aSourceURL.substring(0, hashIndex);\n    }\n\n    // Remove a trailing \"/\".\n    if (aSourceURL[aSourceURL.length - 1] == \"/\") {\n      aSourceURL = aSourceURL.replace(/\\/+$/, \"\");\n    }\n\n    // Remove all but the last path component.\n    if (!aOptions.onlyCropQuery) {\n      let slashIndex = aSourceURL.lastIndexOf(\"/\");\n      if (slashIndex > -1) {\n        aSourceURL = aSourceURL.substring(slashIndex + 1);\n      }\n    }\n\n    return aSourceURL;\n  },\n\n  /**\n   * Tells if the given function is native or not.\n   *\n   * @param function aFunction\n   *        The function you want to check if it is native or not.\n   * @return boolean\n   *         True if the given function is native, false otherwise.\n   */\n  isNativeFunction: function WCU_isNativeFunction(aFunction)\n  {\n    return typeof aFunction == \"function\" && !(\"prototype\" in aFunction);\n  },\n\n  /**\n   * Tells if the given property of the provided object is a non-native getter or\n   * not.\n   *\n   * @param object aObject\n   *        The object that contains the property.\n   * @param string aProp\n   *        The property you want to check if it is a getter or not.\n   * @return boolean\n   *         True if the given property is a getter, false otherwise.\n   */\n  isNonNativeGetter: function WCU_isNonNativeGetter(aObject, aProp)\n  {\n    if (typeof aObject != \"object\") {\n      return false;\n    }\n    let desc = this.getPropertyDescriptor(aObject, aProp);\n    return desc && desc.get && !this.isNativeFunction(desc.get);\n  },\n\n  /**\n   * Get the property descriptor for the given object.\n   *\n   * @param object aObject\n   *        The object that contains the property.\n   * @param string aProp\n   *        The property you want to get the descriptor for.\n   * @return object\n   *         Property descriptor.\n   */\n  getPropertyDescriptor: function WCU_getPropertyDescriptor(aObject, aProp)\n  {\n    let desc = null;\n    while (aObject) {\n      try {\n        if ((desc = Object.getOwnPropertyDescriptor(aObject, aProp))) {\n          break;\n        }\n      } catch (ex) {\n        // Native getters throw here. See bug 520882.\n        // null throws TypeError.\n        if (ex.name != \"NS_ERROR_XPC_BAD_CONVERT_JS\" &&\n            ex.name != \"NS_ERROR_XPC_BAD_OP_ON_WN_PROTO\" &&\n            ex.name != \"TypeError\") {\n          throw ex;\n        }\n      }\n\n      try {\n        aObject = Object.getPrototypeOf(aObject);\n      } catch (ex) {\n        if (ex.name == \"TypeError\") {\n          return desc;\n        }\n        throw ex;\n      }\n    }\n    return desc;\n  },\n\n  /**\n   * Sort function for object properties.\n   *\n   * @param object a\n   *        Property descriptor.\n   * @param object b\n   *        Property descriptor.\n   * @return integer\n   *         -1 if a.name < b.name,\n   *         1 if a.name > b.name,\n   *         0 otherwise.\n   */\n  propertiesSort: function WCU_propertiesSort(a, b)\n  {\n    // Convert the pair.name to a number for later sorting.\n    let aNumber = parseFloat(a.name);\n    let bNumber = parseFloat(b.name);\n\n    // Sort numbers.\n    if (!isNaN(aNumber) && isNaN(bNumber)) {\n      return -1;\n    }\n    else if (isNaN(aNumber) && !isNaN(bNumber)) {\n      return 1;\n    }\n    else if (!isNaN(aNumber) && !isNaN(bNumber)) {\n      return aNumber - bNumber;\n    }\n    // Sort string.\n    else if (a.name < b.name) {\n      return -1;\n    }\n    else if (a.name > b.name) {\n      return 1;\n    }\n    else {\n      return 0;\n    }\n  },\n\n  /**\n   * Create a grip for the given value. If the value is an object,\n   * an object wrapper will be created.\n   *\n   * @param mixed aValue\n   *        The value you want to create a grip for, before sending it to the\n   *        client.\n   * @param function aObjectWrapper\n   *        If the value is an object then the aObjectWrapper function is\n   *        invoked to give us an object grip. See this.getObjectGrip().\n   * @return mixed\n   *         The value grip.\n   */\n  createValueGrip: function WCU_createValueGrip(aValue, aObjectWrapper)\n  {\n    switch (typeof aValue) {\n      case \"boolean\":\n        return aValue;\n      case \"string\":\n        return aObjectWrapper(aValue);\n      case \"number\":\n        if (aValue === Infinity) {\n          return { type: \"Infinity\" };\n        }\n        else if (aValue === -Infinity) {\n          return { type: \"-Infinity\" };\n        }\n        else if (Number.isNaN(aValue)) {\n          return { type: \"NaN\" };\n        }\n        else if (!aValue && 1 / aValue === -Infinity) {\n          return { type: \"-0\" };\n        }\n        return aValue;\n      case \"undefined\":\n        return { type: \"undefined\" };\n      case \"object\":\n        if (aValue === null) {\n          return { type: \"null\" };\n        }\n      case \"function\":\n        return aObjectWrapper(aValue);\n      default:\n        Cu.reportError(\"Failed to provide a grip for value of \" + typeof aValue\n                       + \": \" + aValue);\n        return null;\n    }\n  },\n\n  /**\n   * Check if the given object is an iterator or a generator.\n   *\n   * @param object aObject\n   *        The object you want to check.\n   * @return boolean\n   *         True if the given object is an iterator or a generator, otherwise\n   *         false is returned.\n   */\n  isIteratorOrGenerator: function WCU_isIteratorOrGenerator(aObject)\n  {\n    if (aObject === null) {\n      return false;\n    }\n\n    if (typeof aObject == \"object\") {\n      if (typeof aObject.__iterator__ == \"function\" ||\n          aObject.constructor && aObject.constructor.name == \"Iterator\") {\n        return true;\n      }\n\n      try {\n        let str = aObject.toString();\n        if (typeof aObject.next == \"function\" &&\n            str.indexOf(\"[object Generator\") == 0) {\n          return true;\n        }\n      }\n      catch (ex) {\n        // window.history.next throws in the typeof check above.\n        return false;\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Determine if the given request mixes HTTP with HTTPS content.\n   *\n   * @param string aRequest\n   *        Location of the requested content.\n   * @param string aLocation\n   *        Location of the current page.\n   * @return boolean\n   *         True if the content is mixed, false if not.\n   */\n  isMixedHTTPSRequest: function WCU_isMixedHTTPSRequest(aRequest, aLocation)\n  {\n    try {\n      let requestURI = Services.io.newURI(aRequest, null, null);\n      let contentURI = Services.io.newURI(aLocation, null, null);\n      return (contentURI.scheme == \"https\" && requestURI.scheme != \"https\");\n    }\n    catch (ex) {\n      return false;\n    }\n  },\n\n  /**\n   * Helper function to deduce the name of the provided function.\n   *\n   * @param function aFunction\n   *        The function whose name will be returned.\n   * @return string\n   *         Function name.\n   */\n  getFunctionName: function WCF_getFunctionName(aFunction)\n  {\n    let name = null;\n    if (aFunction.name) {\n      name = aFunction.name;\n    }\n    else {\n      let desc;\n      try {\n        desc = aFunction.getOwnPropertyDescriptor(\"displayName\");\n      }\n      catch (ex) { }\n      if (desc && typeof desc.value == \"string\") {\n        name = desc.value;\n      }\n    }\n    if (!name) {\n      try {\n        let str = (aFunction.toString() || aFunction.toSource()) + \"\";\n        name = (str.match(REGEX_MATCH_FUNCTION_NAME) || [])[1];\n      }\n      catch (ex) { }\n    }\n    return name;\n  },\n\n  /**\n   * Get the object class name. For example, the |window| object has the Window\n   * class name (based on [object Window]).\n   *\n   * @param object aObject\n   *        The object you want to get the class name for.\n   * @return string\n   *         The object class name.\n   */\n  getObjectClassName: function WCU_getObjectClassName(aObject)\n  {\n    if (aObject === null) {\n      return \"null\";\n    }\n    if (aObject === undefined) {\n      return \"undefined\";\n    }\n\n    let type = typeof aObject;\n    if (type != \"object\") {\n      // Grip class names should start with an uppercase letter.\n      return type.charAt(0).toUpperCase() + type.substr(1);\n    }\n\n    let className;\n\n    try {\n      className = ((aObject + \"\").match(/^\\[object (\\S+)\\]$/) || [])[1];\n      if (!className) {\n        className = ((aObject.constructor + \"\").match(/^\\[object (\\S+)\\]$/) || [])[1];\n      }\n      if (!className && typeof aObject.constructor == \"function\") {\n        className = this.getFunctionName(aObject.constructor);\n      }\n    }\n    catch (ex) { }\n\n    return className;\n  },\n\n  /**\n   * Check if the given value is a grip with an actor.\n   *\n   * @param mixed aGrip\n   *        Value you want to check if it is a grip with an actor.\n   * @return boolean\n   *         True if the given value is a grip with an actor.\n   */\n  isActorGrip: function WCU_isActorGrip(aGrip)\n  {\n    return aGrip && typeof(aGrip) == \"object\" && aGrip.actor;\n  },\n  /**\n   * Value of devtools.selfxss.count preference\n   *\n   * @type number\n   * @private\n   */\n  _usageCount: 0,\n  get usageCount() {\n    if (WebConsoleUtils._usageCount < CONSOLE_ENTRY_THRESHOLD) {\n      WebConsoleUtils._usageCount = Services.prefs.getIntPref(\"devtools.selfxss.count\");\n      if (Services.prefs.getBoolPref(\"devtools.chrome.enabled\")) {\n        WebConsoleUtils.usageCount = CONSOLE_ENTRY_THRESHOLD;\n      }\n    }\n    return WebConsoleUtils._usageCount;\n  },\n  set usageCount(newUC) {\n    if (newUC <= CONSOLE_ENTRY_THRESHOLD) {\n      WebConsoleUtils._usageCount = newUC;\n      Services.prefs.setIntPref(\"devtools.selfxss.count\", newUC);\n    }\n  },\n  /**\n   * The inputNode \"paste\" event handler generator. Helps prevent self-xss attacks\n   *\n   * @param nsIDOMElement inputField\n   * @param nsIDOMElement notificationBox\n   * @returns A function to be added as a handler to 'paste' and 'drop' events on the input field\n   */\n  pasteHandlerGen: function WCU_pasteHandlerGen(inputField, notificationBox, msg, okstring) {\n    let handler = function WCU_pasteHandler(aEvent) {\n      if (WebConsoleUtils.usageCount >= CONSOLE_ENTRY_THRESHOLD) {\n        inputField.removeEventListener(\"paste\", handler);\n        inputField.removeEventListener(\"drop\", handler);\n        return true;\n      }\n      if (notificationBox.getNotificationWithValue(\"selfxss-notification\")) {\n        aEvent.preventDefault();\n        aEvent.stopPropagation();\n        return false;\n      }\n\n\n      let notification = notificationBox.appendNotification(msg,\n        \"selfxss-notification\", null, notificationBox.PRIORITY_WARNING_HIGH, null,\n        function(eventType) {\n          // Cleanup function if notification is dismissed\n          if (eventType == \"removed\") {\n            inputField.removeEventListener(\"keyup\", pasteKeyUpHandler);\n          }\n        });\n\n      function pasteKeyUpHandler(aEvent2) {\n        let value = inputField.value || inputField.textContent;\n        if (value.includes(okstring)) {\n          notificationBox.removeNotification(notification);\n          inputField.removeEventListener(\"keyup\", pasteKeyUpHandler);\n          WebConsoleUtils.usageCount = CONSOLE_ENTRY_THRESHOLD;\n        }\n      }\n      inputField.addEventListener(\"keyup\", pasteKeyUpHandler);\n\n      aEvent.preventDefault();\n      aEvent.stopPropagation();\n      return false;\n    };\n    return handler;\n  },\n\n\n};\n\nexports.Utils = WebConsoleUtils;\n\n//////////////////////////////////////////////////////////////////////////\n// Localization\n//////////////////////////////////////////////////////////////////////////\n\nWebConsoleUtils.l10n = function WCU_l10n(aBundleURI)\n{\n  this._bundleUri = aBundleURI;\n};\n\nWebConsoleUtils.l10n.prototype = {\n  _stringBundle: null,\n\n  get stringBundle()\n  {\n    if (!this._stringBundle) {\n      this._stringBundle = Services.strings.createBundle(this._bundleUri);\n    }\n    return this._stringBundle;\n  },\n\n  /**\n   * Generates a formatted timestamp string for displaying in console messages.\n   *\n   * @param integer [aMilliseconds]\n   *        Optional, allows you to specify the timestamp in milliseconds since\n   *        the UNIX epoch.\n   * @return string\n   *         The timestamp formatted for display.\n   */\n  timestampString: function WCU_l10n_timestampString(aMilliseconds)\n  {\n    let d = new Date(aMilliseconds ? aMilliseconds : null);\n    let hours = d.getHours(), minutes = d.getMinutes();\n    let seconds = d.getSeconds(), milliseconds = d.getMilliseconds();\n    let parameters = [hours, minutes, seconds, milliseconds];\n    return this.getFormatStr(\"timestampFormat\", parameters);\n  },\n\n  /**\n   * Retrieve a localized string.\n   *\n   * @param string aName\n   *        The string name you want from the Web Console string bundle.\n   * @return string\n   *         The localized string.\n   */\n  getStr: function WCU_l10n_getStr(aName)\n  {\n    let result;\n    try {\n      result = this.stringBundle.GetStringFromName(aName);\n    }\n    catch (ex) {\n      Cu.reportError(\"Failed to get string: \" + aName);\n      throw ex;\n    }\n    return result;\n  },\n\n  /**\n   * Retrieve a localized string formatted with values coming from the given\n   * array.\n   *\n   * @param string aName\n   *        The string name you want from the Web Console string bundle.\n   * @param array aArray\n   *        The array of values you want in the formatted string.\n   * @return string\n   *         The formatted local string.\n   */\n  getFormatStr: function WCU_l10n_getFormatStr(aName, aArray)\n  {\n    let result;\n    try {\n      result = this.stringBundle.formatStringFromName(aName, aArray, aArray.length);\n    }\n    catch (ex) {\n      Cu.reportError(\"Failed to format string: \" + aName);\n      throw ex;\n    }\n    return result;\n  },\n};\n\n\n//////////////////////////////////////////////////////////////////////////\n// JS Completer\n//////////////////////////////////////////////////////////////////////////\n\n(function _JSPP(WCU) {\nconst STATE_NORMAL = 0;\nconst STATE_QUOTE = 2;\nconst STATE_DQUOTE = 3;\n\nconst OPEN_BODY = \"{[(\".split(\"\");\nconst CLOSE_BODY = \"}])\".split(\"\");\nconst OPEN_CLOSE_BODY = {\n  \"{\": \"}\",\n  \"[\": \"]\",\n  \"(\": \")\",\n};\n\n/**\n * Analyses a given string to find the last statement that is interesting for\n * later completion.\n *\n * @param   string aStr\n *          A string to analyse.\n *\n * @returns object\n *          If there was an error in the string detected, then a object like\n *\n *            { err: \"ErrorMesssage\" }\n *\n *          is returned, otherwise a object like\n *\n *            {\n *              state: STATE_NORMAL|STATE_QUOTE|STATE_DQUOTE,\n *              startPos: index of where the last statement begins\n *            }\n */\nfunction findCompletionBeginning(aStr)\n{\n  let bodyStack = [];\n\n  let state = STATE_NORMAL;\n  let start = 0;\n  let c;\n  for (let i = 0; i < aStr.length; i++) {\n    c = aStr[i];\n\n    switch (state) {\n      // Normal JS state.\n      case STATE_NORMAL:\n        if (c == '\"') {\n          state = STATE_DQUOTE;\n        }\n        else if (c == \"'\") {\n          state = STATE_QUOTE;\n        }\n        else if (c == \";\") {\n          start = i + 1;\n        }\n        else if (c == \" \") {\n          start = i + 1;\n        }\n        else if (OPEN_BODY.indexOf(c) != -1) {\n          bodyStack.push({\n            token: c,\n            start: start\n          });\n          start = i + 1;\n        }\n        else if (CLOSE_BODY.indexOf(c) != -1) {\n          var last = bodyStack.pop();\n          if (!last || OPEN_CLOSE_BODY[last.token] != c) {\n            return {\n              err: \"syntax error\"\n            };\n          }\n          if (c == \"}\") {\n            start = i + 1;\n          }\n          else {\n            start = last.start;\n          }\n        }\n        break;\n\n      // Double quote state > \" <\n      case STATE_DQUOTE:\n        if (c == \"\\\\\") {\n          i++;\n        }\n        else if (c == \"\\n\") {\n          return {\n            err: \"unterminated string literal\"\n          };\n        }\n        else if (c == '\"') {\n          state = STATE_NORMAL;\n        }\n        break;\n\n      // Single quote state > ' <\n      case STATE_QUOTE:\n        if (c == \"\\\\\") {\n          i++;\n        }\n        else if (c == \"\\n\") {\n          return {\n            err: \"unterminated string literal\"\n          };\n        }\n        else if (c == \"'\") {\n          state = STATE_NORMAL;\n        }\n        break;\n    }\n  }\n\n  return {\n    state: state,\n    startPos: start\n  };\n}\n\n/**\n * Provides a list of properties, that are possible matches based on the passed\n * Debugger.Environment/Debugger.Object and inputValue.\n *\n * @param object aDbgObject\n *        When the debugger is not paused this Debugger.Object wraps the scope for autocompletion.\n *        It is null if the debugger is paused.\n * @param object anEnvironment\n *        When the debugger is paused this Debugger.Environment is the scope for autocompletion.\n *        It is null if the debugger is not paused.\n * @param string aInputValue\n *        Value that should be completed.\n * @param number [aCursor=aInputValue.length]\n *        Optional offset in the input where the cursor is located. If this is\n *        omitted then the cursor is assumed to be at the end of the input\n *        value.\n * @returns null or object\n *          If no completion valued could be computed, null is returned,\n *          otherwise a object with the following form is returned:\n *            {\n *              matches: [ string, string, string ],\n *              matchProp: Last part of the inputValue that was used to find\n *                         the matches-strings.\n *            }\n */\nfunction JSPropertyProvider(aDbgObject, anEnvironment, aInputValue, aCursor)\n{\n  if (aCursor === undefined) {\n    aCursor = aInputValue.length;\n  }\n\n  let inputValue = aInputValue.substring(0, aCursor);\n\n  // Analyse the inputValue and find the beginning of the last part that\n  // should be completed.\n  let beginning = findCompletionBeginning(inputValue);\n\n  // There was an error analysing the string.\n  if (beginning.err) {\n    return null;\n  }\n\n  // If the current state is not STATE_NORMAL, then we are inside of an string\n  // which means that no completion is possible.\n  if (beginning.state != STATE_NORMAL) {\n    return null;\n  }\n\n  let completionPart = inputValue.substring(beginning.startPos);\n\n  // Don't complete on just an empty string.\n  if (completionPart.trim() == \"\") {\n    return null;\n  }\n\n  let lastDot = completionPart.lastIndexOf(\".\");\n  if (lastDot > 0 &&\n      (completionPart[0] == \"'\" || completionPart[0] == '\"') &&\n      completionPart[lastDot - 1] == completionPart[0]) {\n    // We are completing a string literal.\n    let matchProp = completionPart.slice(lastDot + 1);\n    return getMatchedProps(String.prototype, matchProp);\n  }\n\n  // We are completing a variable / a property lookup.\n  let properties = completionPart.split(\".\");\n  let matchProp = properties.pop().trimLeft();\n  let obj = aDbgObject;\n\n  // The first property must be found in the environment if the debugger is\n  // paused.\n  if (anEnvironment) {\n    if (properties.length == 0) {\n      return getMatchedPropsInEnvironment(anEnvironment, matchProp);\n    }\n    obj = getVariableInEnvironment(anEnvironment, properties.shift());\n  }\n\n  if (!isObjectUsable(obj)) {\n    return null;\n  }\n\n  // We get the rest of the properties recursively starting from the Debugger.Object\n  // that wraps the first property\n  for (let prop of properties) {\n    prop = prop.trim();\n    if (!prop) {\n      return null;\n    }\n\n    if (/\\[\\d+\\]$/.test(prop)) {\n      // The property to autocomplete is a member of array. For example\n      // list[i][j]..[n]. Traverse the array to get the actual element.\n      obj = getArrayMemberProperty(obj, prop);\n    }\n    else {\n      obj = DevToolsUtils.getProperty(obj, prop);\n    }\n\n    if (!isObjectUsable(obj)) {\n      return null;\n    }\n  }\n\n  // If the final property is a primitive\n  if (typeof obj != \"object\") {\n    return getMatchedProps(obj, matchProp);\n  }\n\n  return getMatchedPropsInDbgObject(obj, matchProp);\n}\n\n/**\n * Get the array member of aObj for the given aProp. For example, given\n * aProp='list[0][1]' the element at [0][1] of aObj.list is returned.\n *\n * @param object aObj\n *        The object to operate on.\n * @param string aProp\n *        The property to return.\n * @return null or Object\n *         Returns null if the property couldn't be located. Otherwise the array\n *         member identified by aProp.\n */\nfunction getArrayMemberProperty(aObj, aProp)\n{\n  // First get the array.\n  let obj = aObj;\n  let propWithoutIndices = aProp.substr(0, aProp.indexOf(\"[\"));\n  obj = DevToolsUtils.getProperty(obj, propWithoutIndices);\n  if (!isObjectUsable(obj)) {\n    return null;\n  }\n\n  // Then traverse the list of indices to get the actual element.\n  let result;\n  let arrayIndicesRegex = /\\[[^\\]]*\\]/g;\n  while ((result = arrayIndicesRegex.exec(aProp)) !== null) {\n    let indexWithBrackets = result[0];\n    let indexAsText = indexWithBrackets.substr(1, indexWithBrackets.length - 2);\n    let index = parseInt(indexAsText);\n\n    if (isNaN(index)) {\n      return null;\n    }\n\n    obj = DevToolsUtils.getProperty(obj, index);\n\n    if (!isObjectUsable(obj)) {\n      return null;\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Check if the given Debugger.Object can be used for autocomplete.\n *\n * @param Debugger.Object aObject\n *        The Debugger.Object to check.\n * @return boolean\n *         True if further inspection into the object is possible, or false\n *         otherwise.\n */\nfunction isObjectUsable(aObject)\n{\n  if (aObject == null) {\n    return false;\n  }\n\n  if (typeof aObject == \"object\" && aObject.class == \"DeadObject\") {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * @see getExactMatch_impl()\n */\nfunction getVariableInEnvironment(anEnvironment, aName)\n{\n  return getExactMatch_impl(anEnvironment, aName, DebuggerEnvironmentSupport);\n}\n\n/**\n * @see getMatchedProps_impl()\n */\nfunction getMatchedPropsInEnvironment(anEnvironment, aMatch)\n{\n  return getMatchedProps_impl(anEnvironment, aMatch, DebuggerEnvironmentSupport);\n}\n\n/**\n * @see getMatchedProps_impl()\n */\nfunction getMatchedPropsInDbgObject(aDbgObject, aMatch)\n{\n  return getMatchedProps_impl(aDbgObject, aMatch, DebuggerObjectSupport);\n}\n\n/**\n * @see getMatchedProps_impl()\n */\nfunction getMatchedProps(aObj, aMatch)\n{\n  if (typeof aObj != \"object\") {\n    aObj = aObj.constructor.prototype;\n  }\n  return getMatchedProps_impl(aObj, aMatch, JSObjectSupport);\n}\n\n/**\n * Get all properties in the given object (and its parent prototype chain) that\n * match a given prefix.\n *\n * @param mixed aObj\n *        Object whose properties we want to filter.\n * @param string aMatch\n *        Filter for properties that match this string.\n * @return object\n *         Object that contains the matchProp and the list of names.\n */\nfunction getMatchedProps_impl(aObj, aMatch, {chainIterator, getProperties})\n{\n  let matches = new Set();\n  let numProps = 0;\n\n  // We need to go up the prototype chain.\n  let iter = chainIterator(aObj);\n  for (let obj of iter) {\n    let props = getProperties(obj);\n    numProps += props.length;\n\n    // If there are too many properties to event attempt autocompletion,\n    // or if we have already added the max number, then stop looping\n    // and return the partial set that has already been discovered.\n    if (numProps >= MAX_AUTOCOMPLETE_ATTEMPTS ||\n        matches.size >= MAX_AUTOCOMPLETIONS) {\n      break;\n    }\n\n    for (let i = 0; i < props.length; i++) {\n      let prop = props[i];\n      if (prop.indexOf(aMatch) != 0) {\n        continue;\n      }\n      if (prop.indexOf('-') > -1) {\n        continue;\n      }\n      // If it is an array index, we can't take it.\n      // This uses a trick: converting a string to a number yields NaN if\n      // the operation failed, and NaN is not equal to itself.\n      if (+prop != +prop) {\n        matches.add(prop);\n      }\n\n      if (matches.size >= MAX_AUTOCOMPLETIONS) {\n        break;\n      }\n    }\n  }\n\n  return {\n    matchProp: aMatch,\n    matches: [...matches],\n  };\n}\n\n/**\n * Returns a property value based on its name from the given object, by\n * recursively checking the object's prototype.\n *\n * @param object aObj\n *        An object to look the property into.\n * @param string aName\n *        The property that is looked up.\n * @returns object|undefined\n *        A Debugger.Object if the property exists in the object's prototype\n *        chain, undefined otherwise.\n */\nfunction getExactMatch_impl(aObj, aName, {chainIterator, getProperty})\n{\n  // We need to go up the prototype chain.\n  let iter = chainIterator(aObj);\n  for (let obj of iter) {\n    let prop = getProperty(obj, aName, aObj);\n    if (prop) {\n      return prop.value;\n    }\n  }\n  return undefined;\n}\n\n\nvar JSObjectSupport = {\n  chainIterator: function*(aObj)\n  {\n    while (aObj) {\n      yield aObj;\n      aObj = Object.getPrototypeOf(aObj);\n    }\n  },\n\n  getProperties: function(aObj)\n  {\n    return Object.getOwnPropertyNames(aObj);\n  },\n\n  getProperty: function()\n  {\n    // getProperty is unsafe with raw JS objects.\n    throw \"Unimplemented!\";\n  },\n};\n\nvar DebuggerObjectSupport = {\n  chainIterator: function*(aObj)\n  {\n    while (aObj) {\n      yield aObj;\n      aObj = aObj.proto;\n    }\n  },\n\n  getProperties: function(aObj)\n  {\n    return aObj.getOwnPropertyNames();\n  },\n\n  getProperty: function(aObj, aName, aRootObj)\n  {\n    // This is left unimplemented in favor to DevToolsUtils.getProperty().\n    throw \"Unimplemented!\";\n  },\n};\n\nvar DebuggerEnvironmentSupport = {\n  chainIterator: function*(aObj)\n  {\n    while (aObj) {\n      yield aObj;\n      aObj = aObj.parent;\n    }\n  },\n\n  getProperties: function(aObj)\n  {\n    return aObj.names();\n  },\n\n  getProperty: function(aObj, aName)\n  {\n    // TODO: we should use getVariableDescriptor() here - bug 725815.\n    let result = aObj.getVariable(aName);\n    // FIXME: Need actual UI, bug 941287.\n    if (result === undefined || result.optimizedOut || result.missingArguments) {\n      return null;\n    }\n    return { value: result };\n  },\n};\n\n\nexports.JSPropertyProvider = DevToolsUtils.makeInfallible(JSPropertyProvider);\n})(WebConsoleUtils);\n\n///////////////////////////////////////////////////////////////////////////////\n// The page errors listener\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * The nsIConsoleService listener. This is used to send all of the console\n * messages (JavaScript, CSS and more) to the remote Web Console instance.\n *\n * @constructor\n * @param nsIDOMWindow [aWindow]\n *        Optional - the window object for which we are created. This is used\n *        for filtering out messages that belong to other windows.\n * @param object aListener\n *        The listener object must have one method:\n *        - onConsoleServiceMessage(). This method is invoked with one argument,\n *        the nsIConsoleMessage, whenever a relevant message is received.\n */\nfunction ConsoleServiceListener(aWindow, aListener)\n{\n  this.window = aWindow;\n  this.listener = aListener;\n}\nexports.ConsoleServiceListener = ConsoleServiceListener;\n\nConsoleServiceListener.prototype =\n{\n  // QueryInterface: XPCOMUtils.generateQI([Ci.nsIConsoleListener]),\n\n  /**\n   * The content window for which we listen to page errors.\n   * @type nsIDOMWindow\n   */\n  window: null,\n\n  /**\n   * The listener object which is notified of messages from the console service.\n   * @type object\n   */\n  listener: null,\n\n  /**\n   * Initialize the nsIConsoleService listener.\n   */\n  init: function CSL_init()\n  {\n    Services.console.registerListener(this);\n  },\n\n  /**\n   * The nsIConsoleService observer. This method takes all the script error\n   * messages belonging to the current window and sends them to the remote Web\n   * Console instance.\n   *\n   * @param nsIConsoleMessage aMessage\n   *        The message object coming from the nsIConsoleService.\n   */\n  observe: function CSL_observe(aMessage)\n  {\n    if (!this.listener) {\n      return;\n    }\n\n    if (this.window) {\n      if (!(aMessage instanceof Ci.nsIScriptError) ||\n          !aMessage.outerWindowID ||\n          !this.isCategoryAllowed(aMessage.category)) {\n        return;\n      }\n\n      let errorWindow = Services.wm.getOuterWindowWithId(aMessage .outerWindowID);\n      if (!errorWindow || !isWindowIncluded(this.window, errorWindow)) {\n        return;\n      }\n    }\n\n    this.listener.onConsoleServiceMessage(aMessage);\n  },\n\n  /**\n   * Check if the given message category is allowed to be tracked or not.\n   * We ignore chrome-originating errors as we only care about content.\n   *\n   * @param string aCategory\n   *        The message category you want to check.\n   * @return boolean\n   *         True if the category is allowed to be logged, false otherwise.\n   */\n  isCategoryAllowed: function CSL_isCategoryAllowed(aCategory)\n  {\n    if (!aCategory) {\n      return false;\n    }\n\n    switch (aCategory) {\n      case \"XPConnect JavaScript\":\n      case \"component javascript\":\n      case \"chrome javascript\":\n      case \"chrome registration\":\n      case \"XBL\":\n      case \"XBL Prototype Handler\":\n      case \"XBL Content Sink\":\n      case \"xbl javascript\":\n        return false;\n    }\n\n    return true;\n  },\n\n  /**\n   * Get the cached page errors for the current inner window and its (i)frames.\n   *\n   * @param boolean [aIncludePrivate=false]\n   *        Tells if you want to also retrieve messages coming from private\n   *        windows. Defaults to false.\n   * @return array\n   *         The array of cached messages. Each element is an nsIScriptError or\n   *         an nsIConsoleMessage\n   */\n  getCachedMessages: function CSL_getCachedMessages(aIncludePrivate = false)\n  {\n    let errors = Services.console.getMessageArray() || [];\n\n    // if !this.window, we're in a browser console. Still need to filter\n    // private messages.\n    if (!this.window) {\n      return errors.filter((aError) => {\n        if (aError instanceof Ci.nsIScriptError) {\n          if (!aIncludePrivate && aError.isFromPrivateWindow) {\n            return false;\n          }\n        }\n\n        return true;\n      });\n    }\n\n    let ids = WebConsoleUtils.getInnerWindowIDsForFrames(this.window);\n\n    return errors.filter((aError) => {\n      if (aError instanceof Ci.nsIScriptError) {\n        if (!aIncludePrivate && aError.isFromPrivateWindow) {\n          return false;\n        }\n        if (ids &&\n            (ids.indexOf(aError.innerWindowID) == -1 ||\n             !this.isCategoryAllowed(aError.category))) {\n          return false;\n        }\n      }\n      else if (ids && ids[0]) {\n        // If this is not an nsIScriptError and we need to do window-based\n        // filtering we skip this message.\n        return false;\n      }\n\n      return true;\n    });\n  },\n\n  /**\n   * Remove the nsIConsoleService listener.\n   */\n  destroy: function CSL_destroy()\n  {\n    Services.console.unregisterListener(this);\n    this.listener = this.window = null;\n  },\n};\n\n\n///////////////////////////////////////////////////////////////////////////////\n// The window.console API observer\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * The window.console API observer. This allows the window.console API messages\n * to be sent to the remote Web Console instance.\n *\n * @constructor\n * @param nsIDOMWindow aWindow\n *        Optional - the window object for which we are created. This is used\n *        for filtering out messages that belong to other windows.\n * @param object aOwner\n *        The owner object must have the following methods:\n *        - onConsoleAPICall(). This method is invoked with one argument, the\n *        Console API message that comes from the observer service, whenever\n *        a relevant console API call is received.\n * @param string aConsoleID\n *        Options - The consoleID that this listener should listen to\n */\nfunction ConsoleAPIListener(aWindow, aOwner, aConsoleID)\n{\n  this.window = aWindow;\n  this.owner = aOwner;\n  this.consoleID = aConsoleID;\n}\nexports.ConsoleAPIListener = ConsoleAPIListener;\n\nConsoleAPIListener.prototype =\n{\n  // QueryInterface: XPCOMUtils.generateQI([Ci.nsIObserver]),\n\n  /**\n   * The content window for which we listen to window.console API calls.\n   * @type nsIDOMWindow\n   */\n  window: null,\n\n  /**\n   * The owner object which is notified of window.console API calls. It must\n   * have a onConsoleAPICall method which is invoked with one argument: the\n   * console API call object that comes from the observer service.\n   *\n   * @type object\n   * @see WebConsoleActor\n   */\n  owner: null,\n\n  /**\n   * The consoleID that we listen for. If not null then only messages from this\n   * console will be returned.\n   */\n  consoleID: null,\n\n  /**\n   * Initialize the window.console API observer.\n   */\n  init: function CAL_init()\n  {\n    // Note that the observer is process-wide. We will filter the messages as\n    // needed, see CAL_observe().\n    // Services.obs.addObserver(this, \"console-api-log-event\", false);\n  },\n\n  /**\n   * The console API message observer. When messages are received from the\n   * observer service we forward them to the remote Web Console instance.\n   *\n   * @param object aMessage\n   *        The message object receives from the observer service.\n   * @param string aTopic\n   *        The message topic received from the observer service.\n   */\n  observe: function CAL_observe(aMessage, aTopic)\n  {\n    if (!this.owner) {\n      return;\n    }\n\n    // Here, wrappedJSObject is not a security wrapper but a property defined\n    // by the XPCOM component which allows us to unwrap the XPCOM interface and\n    // access the underlying JSObject.\n    let apiMessage = aMessage.wrappedJSObject;\n    if (this.window && CONSOLE_WORKER_IDS.indexOf(apiMessage.innerID) == -1) {\n      let msgWindow = Services.wm.getCurrentInnerWindowWithId(apiMessage.innerID);\n      if (!msgWindow || !isWindowIncluded(this.window, msgWindow)) {\n        // Not the same window!\n        return;\n      }\n    }\n    if (this.consoleID && apiMessage.consoleID != this.consoleID) {\n      return;\n    }\n\n    this.owner.onConsoleAPICall(apiMessage);\n  },\n\n  /**\n   * Get the cached messages for the current inner window and its (i)frames.\n   *\n   * @param boolean [aIncludePrivate=false]\n   *        Tells if you want to also retrieve messages coming from private\n   *        windows. Defaults to false.\n   * @return array\n   *         The array of cached messages.\n   */\n  getCachedMessages: function CAL_getCachedMessages(aIncludePrivate = false)\n  {\n    let messages = [];\n    // let ConsoleAPIStorage = Cc[\"@mozilla.org/consoleAPI-storage;1\"]\n    //                           .getService(Ci.nsIConsoleAPIStorage);\n\n    // // if !this.window, we're in a browser console. Retrieve all events\n    // // for filtering based on privacy.\n    // if (!this.window) {\n    //   messages = ConsoleAPIStorage.getEvents();\n    // } else {\n    //   let ids = WebConsoleUtils.getInnerWindowIDsForFrames(this.window);\n    //   ids.forEach((id) => {\n    //     messages = messages.concat(ConsoleAPIStorage.getEvents(id));\n    //   });\n    // }\n\n    // CONSOLE_WORKER_IDS.forEach((id) => {\n    //   messages = messages.concat(ConsoleAPIStorage.getEvents(id));\n    // });\n\n    if (this.consoleID) {\n      messages = messages.filter((m) => m.consoleID == this.consoleID);\n    }\n\n    if (aIncludePrivate) {\n      return messages;\n    }\n\n    return messages.filter((m) => !m.private);\n  },\n\n  /**\n   * Destroy the console API listener.\n   */\n  destroy: function CAL_destroy()\n  {\n    Services.obs.removeObserver(this, \"console-api-log-event\");\n    this.window = this.owner = null;\n  },\n};\n\n/**\n * WebConsole commands manager.\n *\n * Defines a set of functions /variables (\"commands\") that are available from\n * the Web Console but not from the web page.\n *\n */\nvar WebConsoleCommands = {\n  _registeredCommands: new Map(),\n  _originalCommands: new Map(),\n\n  /**\n   * @private\n   * Reserved for built-in commands. To register a command from the code of an\n   * add-on, see WebConsoleCommands.register instead.\n   *\n   * @see WebConsoleCommands.register\n   */\n  _registerOriginal: function (name, command) {\n    this.register(name, command);\n    this._originalCommands.set(name, this.getCommand(name));\n  },\n\n  /**\n   * Register a new command.\n   * @param {string} name The command name (example: \"$\")\n   * @param {(function|object)} command The command to register.\n   *  It can be a function so the command is a function (like \"$()\"),\n   *  or it can also be a property descriptor to describe a getter / value (like\n   *  \"$0\").\n   *\n   *  The command function or the command getter are passed a owner object as\n   *  their first parameter (see the example below).\n   *\n   *  Note that setters don't work currently and \"enumerable\" and \"configurable\"\n   *  are forced to true.\n   *\n   * @example\n   *\n   *   WebConsoleCommands.register(\"$\", function JSTH_$(aOwner, aSelector)\n   *   {\n   *     return aOwner.window.document.querySelector(aSelector);\n   *   });\n   *\n   *   WebConsoleCommands.register(\"$0\", {\n   *     get: function(aOwner) {\n   *       return aOwner.makeDebuggeeValue(aOwner.selectedNode);\n   *     }\n   *   });\n   */\n  register: function(name, command) {\n    this._registeredCommands.set(name, command);\n  },\n\n  /**\n   * Unregister a command.\n   *\n   * If the command being unregister overrode a built-in command,\n   * the latter is restored.\n   *\n   * @param {string} name The name of the command\n   */\n  unregister: function(name) {\n    this._registeredCommands.delete(name);\n    if (this._originalCommands.has(name)) {\n      this.register(name, this._originalCommands.get(name));\n    }\n  },\n\n  /**\n   * Returns a command by its name.\n   *\n   * @param {string} name The name of the command.\n   *\n   * @return {(function|object)} The command.\n   */\n  getCommand: function(name) {\n    return this._registeredCommands.get(name);\n  },\n\n  /**\n   * Returns true if a command is registered with the given name.\n   *\n   * @param {string} name The name of the command.\n   *\n   * @return {boolean} True if the command is registered.\n   */\n  hasCommand: function(name) {\n    return this._registeredCommands.has(name);\n  },\n};\n\nexports.WebConsoleCommands = WebConsoleCommands;\n\n\n/*\n * Built-in commands.\n  *\n  * A list of helper functions used by Firebug can be found here:\n  *   http://getfirebug.com/wiki/index.php/Command_Line_API\n */\n\n/**\n * Find a node by ID.\n *\n * @param string aId\n *        The ID of the element you want.\n * @return nsIDOMNode or null\n *         The result of calling document.querySelector(aSelector).\n */\nWebConsoleCommands._registerOriginal(\"$\", function JSTH_$(aOwner, aSelector)\n{\n  return aOwner.window.document.querySelector(aSelector);\n});\n\n/**\n * Find the nodes matching a CSS selector.\n *\n * @param string aSelector\n *        A string that is passed to window.document.querySelectorAll.\n * @return nsIDOMNodeList\n *         Returns the result of document.querySelectorAll(aSelector).\n */\nWebConsoleCommands._registerOriginal(\"$$\", function JSTH_$$(aOwner, aSelector)\n{\n  let nodes = aOwner.window.document.querySelectorAll(aSelector);\n\n  // Calling aOwner.window.Array.from() doesn't work without accessing the\n  // wrappedJSObject, so just loop through the results instead.\n  let result = new aOwner.window.Array();\n  for (let i = 0; i < nodes.length; i++) {\n    result.push(nodes[i]);\n  }\n  return result;\n});\n\n/**\n * Returns the result of the last console input evaluation\n *\n * @return object|undefined\n * Returns last console evaluation or undefined\n */\nWebConsoleCommands._registerOriginal(\"$_\", {\n  get: function(aOwner) {\n    return aOwner.consoleActor.getLastConsoleInputEvaluation();\n  }\n});\n\n\n/**\n * Runs an xPath query and returns all matched nodes.\n *\n * @param string aXPath\n *        xPath search query to execute.\n * @param [optional] nsIDOMNode aContext\n *        Context to run the xPath query on. Uses window.document if not set.\n * @return array of nsIDOMNode\n */\nWebConsoleCommands._registerOriginal(\"$x\", function JSTH_$x(aOwner, aXPath, aContext)\n{\n  let nodes = new aOwner.window.Array();\n\n  // Not waiving Xrays, since we want the original Document.evaluate function,\n  // instead of anything that's been redefined.\n  let doc =  aOwner.window.document;\n  aContext = aContext || doc;\n\n  let results = doc.evaluate(aXPath, aContext, null,\n                             Ci.nsIDOMXPathResult.ANY_TYPE, null);\n  let node;\n  while ((node = results.iterateNext())) {\n    nodes.push(node);\n  }\n\n  return nodes;\n});\n\n/**\n * Returns the currently selected object in the highlighter.\n *\n * @return Object representing the current selection in the\n *         Inspector, or null if no selection exists.\n */\nWebConsoleCommands._registerOriginal(\"$0\", {\n  get: function(aOwner) {\n    return aOwner.makeDebuggeeValue(aOwner.selectedNode);\n  }\n});\n\n/**\n * Clears the output of the WebConsole.\n */\nWebConsoleCommands._registerOriginal(\"clear\", function JSTH_clear(aOwner)\n{\n  aOwner.helperResult = {\n    type: \"clearOutput\",\n  };\n});\n\n/**\n * Clears the input history of the WebConsole.\n */\nWebConsoleCommands._registerOriginal(\"clearHistory\", function JSTH_clearHistory(aOwner)\n{\n  aOwner.helperResult = {\n    type: \"clearHistory\",\n  };\n});\n\n/**\n * Returns the result of Object.keys(aObject).\n *\n * @param object aObject\n *        Object to return the property names from.\n * @return array of strings\n */\nWebConsoleCommands._registerOriginal(\"keys\", function JSTH_keys(aOwner, aObject)\n{\n  // Need to waive Xrays so we can iterate functions and accessor properties\n  return Cu.cloneInto(Object.keys(Cu.waiveXrays(aObject)), aOwner.window);\n});\n\n/**\n * Returns the values of all properties on aObject.\n *\n * @param object aObject\n *        Object to display the values from.\n * @return array of string\n */\nWebConsoleCommands._registerOriginal(\"values\", function JSTH_values(aOwner, aObject)\n{\n  let values = [];\n  // Need to waive Xrays so we can iterate functions and accessor properties\n  let waived = Cu.waiveXrays(aObject);\n  let names = Object.getOwnPropertyNames(waived);\n\n  for (let name of names) {\n    values.push(waived[name]);\n  }\n\n  return Cu.cloneInto(values, aOwner.window);\n});\n\n/**\n * Opens a help window in MDN.\n */\nWebConsoleCommands._registerOriginal(\"help\", function JSTH_help(aOwner)\n{\n  aOwner.helperResult = { type: \"help\" };\n});\n\n/**\n * Change the JS evaluation scope.\n *\n * @param DOMElement|string|window aWindow\n *        The window object to use for eval scope. This can be a string that\n *        is used to perform document.querySelector(), to find the iframe that\n *        you want to cd() to. A DOMElement can be given as well, the\n *        .contentWindow property is used. Lastly, you can directly pass\n *        a window object. If you call cd() with no arguments, the current\n *        eval scope is cleared back to its default (the top window).\n */\nWebConsoleCommands._registerOriginal(\"cd\", function JSTH_cd(aOwner, aWindow)\n{\n  if (!aWindow) {\n    aOwner.consoleActor.evalWindow = null;\n    aOwner.helperResult = { type: \"cd\" };\n    return;\n  }\n\n  if (typeof aWindow == \"string\") {\n    aWindow = aOwner.window.document.querySelector(aWindow);\n  }\n  if (aWindow instanceof Ci.nsIDOMElement && aWindow.contentWindow) {\n    aWindow = aWindow.contentWindow;\n  }\n  if (!(aWindow instanceof Ci.nsIDOMWindow)) {\n    aOwner.helperResult = { type: \"error\", message: \"cdFunctionInvalidArgument\" };\n    return;\n  }\n\n  aOwner.consoleActor.evalWindow = aWindow;\n  aOwner.helperResult = { type: \"cd\" };\n});\n\n/**\n * Inspects the passed aObject. This is done by opening the PropertyPanel.\n *\n * @param object aObject\n *        Object to inspect.\n */\nWebConsoleCommands._registerOriginal(\"inspect\", function JSTH_inspect(aOwner, aObject)\n{\n  let dbgObj = aOwner.makeDebuggeeValue(aObject);\n  let grip = aOwner.createValueGrip(dbgObj);\n  aOwner.helperResult = {\n    type: \"inspectObject\",\n    input: aOwner.evalInput,\n    object: grip,\n  };\n});\n\n/**\n * Prints aObject to the output.\n *\n * @param object aObject\n *        Object to print to the output.\n * @return string\n */\nWebConsoleCommands._registerOriginal(\"pprint\", function JSTH_pprint(aOwner, aObject)\n{\n  if (aObject === null || aObject === undefined || aObject === true ||\n      aObject === false) {\n    aOwner.helperResult = {\n      type: \"error\",\n      message: \"helperFuncUnsupportedTypeError\",\n    };\n    return null;\n  }\n\n  aOwner.helperResult = { rawOutput: true };\n\n  if (typeof aObject == \"function\") {\n    return aObject + \"\\n\";\n  }\n\n  let output = [];\n\n  let obj = aObject;\n  for (let name in obj) {\n    let desc = WebConsoleUtils.getPropertyDescriptor(obj, name) || {};\n    if (desc.get || desc.set) {\n      // TODO: Bug 842672 - toolkit/ imports modules from browser/.\n      let getGrip = VariablesView.getGrip(desc.get);\n      let setGrip = VariablesView.getGrip(desc.set);\n      let getString = VariablesView.getString(getGrip);\n      let setString = VariablesView.getString(setGrip);\n      output.push(name + \":\", \"  get: \" + getString, \"  set: \" + setString);\n    }\n    else {\n      let valueGrip = VariablesView.getGrip(obj[name]);\n      let valueString = VariablesView.getString(valueGrip);\n      output.push(name + \": \" + valueString);\n    }\n  }\n\n  return \"  \" + output.join(\"\\n  \");\n});\n\n/**\n * Print the String representation of a value to the output, as-is.\n *\n * @param any aValue\n *        A value you want to output as a string.\n * @return void\n */\nWebConsoleCommands._registerOriginal(\"print\", function JSTH_print(aOwner, aValue)\n{\n  aOwner.helperResult = { rawOutput: true };\n  if (typeof aValue === \"symbol\") {\n    return Symbol.prototype.toString.call(aValue);\n  }\n  // Waiving Xrays here allows us to see a closer representation of the\n  // underlying object. This may execute arbitrary content code, but that\n  // code will run with content privileges, and the result will be rendered\n  // inert by coercing it to a String.\n  return String(Cu.waiveXrays(aValue));\n});\n\n/**\n * Copy the String representation of a value to the clipboard.\n *\n * @param any aValue\n *        A value you want to copy as a string.\n * @return void\n */\nWebConsoleCommands._registerOriginal(\"copy\", function JSTH_copy(aOwner, aValue)\n{\n  let payload;\n  try {\n    if (aValue instanceof Ci.nsIDOMElement) {\n      payload = aValue.outerHTML;\n    } else if (typeof aValue == \"string\") {\n      payload = aValue;\n    } else {\n      payload = JSON.stringify(aValue, null, \"  \");\n    }\n  } catch (ex) {\n    payload = \"/* \" + ex  + \" */\";\n  }\n  aOwner.helperResult = {\n    type: \"copyValueToClipboard\",\n    value: payload,\n  };\n});\n\n\n/**\n * (Internal only) Add the bindings to |owner.sandbox|.\n * This is intended to be used by the WebConsole actor only.\n  *\n  * @param object aOwner\n  *        The owning object.\n  */\nfunction addWebConsoleCommands(owner) {\n  if (!owner) {\n    throw new Error(\"The owner is required\");\n  }\n  for (let [name, command] of WebConsoleCommands._registeredCommands) {\n    if (typeof command === \"function\") {\n      owner.sandbox[name] = command.bind(undefined, owner);\n    }\n    else if (typeof command === \"object\") {\n      // let clone = Object.assign({}, command, {\n      //   // We force the enumerability and the configurability (so the\n      //   // WebConsoleActor can reconfigure the property).\n      //   enumerable: true,\n      //   configurable: true\n      // });\n      let clone = {};\n      for (let attr in command) {\n        if (command.hasOwnProperty(attr))\n          clone[attr] = command[attr];\n      }\n      clone.enumerable = true;\n      clone.configurable = true;\n\n      if (typeof command.get === \"function\") {\n        clone.get = command.get.bind(undefined, owner);\n      }\n      if (typeof command.set === \"function\") {\n        clone.set = command.set.bind(undefined, owner);\n      }\n\n      Object.defineProperty(owner.sandbox, name, clone);\n    }\n  }\n}\n\nexports.addWebConsoleCommands = addWebConsoleCommands;\n\n/**\n * A ReflowObserver that listens for reflow events from the page.\n * Implements nsIReflowObserver.\n *\n * @constructor\n * @param object aWindow\n *        The window for which we need to track reflow.\n * @param object aOwner\n *        The listener owner which needs to implement:\n *        - onReflowActivity(aReflowInfo)\n */\n\nfunction ConsoleReflowListener(aWindow, aListener)\n{\n  this.docshell = aWindow.QueryInterface(Ci.nsIInterfaceRequestor)\n                         .getInterface(Ci.nsIWebNavigation)\n                         .QueryInterface(Ci.nsIDocShell);\n  this.listener = aListener;\n  this.docshell.addWeakReflowObserver(this);\n}\n\nexports.ConsoleReflowListener = ConsoleReflowListener;\n\nConsoleReflowListener.prototype =\n{\n  // QueryInterface: XPCOMUtils.generateQI([Ci.nsIReflowObserver,\n  //                                        Ci.nsISupportsWeakReference]),\n  docshell: null,\n  listener: null,\n\n  /**\n   * Forward reflow event to listener.\n   *\n   * @param DOMHighResTimeStamp aStart\n   * @param DOMHighResTimeStamp aEnd\n   * @param boolean aInterruptible\n   */\n  sendReflow: function CRL_sendReflow(aStart, aEnd, aInterruptible)\n  {\n    let frame = components.stack.caller.caller;\n\n    let filename = frame.filename;\n\n    if (filename) {\n      // Because filename could be of the form \"xxx.js -> xxx.js -> xxx.js\",\n      // we only take the last part.\n      filename = filename.split(\" \").pop();\n    }\n\n    this.listener.onReflowActivity({\n      interruptible: aInterruptible,\n      start: aStart,\n      end: aEnd,\n      sourceURL: filename,\n      sourceLine: frame.lineNumber,\n      functionName: frame.name\n    });\n  },\n\n  /**\n   * On uninterruptible reflow\n   *\n   * @param DOMHighResTimeStamp aStart\n   * @param DOMHighResTimeStamp aEnd\n   */\n  reflow: function CRL_reflow(aStart, aEnd)\n  {\n    this.sendReflow(aStart, aEnd, false);\n  },\n\n  /**\n   * On interruptible reflow\n   *\n   * @param DOMHighResTimeStamp aStart\n   * @param DOMHighResTimeStamp aEnd\n   */\n  reflowInterruptible: function CRL_reflowInterruptible(aStart, aEnd)\n  {\n    this.sendReflow(aStart, aEnd, true);\n  },\n\n  /**\n   * Unregister listener.\n   */\n  destroy: function CRL_destroy()\n  {\n    this.docshell.removeWeakReflowObserver(this);\n    this.listener = this.docshell = null;\n  },\n};\n\nfunction gSequenceId()\n{\n  return gSequenceId.n++;\n}\ngSequenceId.n = 0;\n\nexports;\n\n"]}