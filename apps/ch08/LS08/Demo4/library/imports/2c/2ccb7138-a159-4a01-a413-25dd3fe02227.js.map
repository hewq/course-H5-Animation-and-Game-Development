{"version":3,"sources":["../../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/physics/assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/physics/CCColliderDetector.js"],"names":["ccs","PT_RATIO","ColliderFilter","Class","extend","_collisionType","_group","_categoryBits","_groupIndex","_maskBits","ctor","collisionType","group","updateShape","shape","cp","Shape","collision_type","Box2D","b2FilterData","filter","categoryBits","groupIndex","maskBits","SetFilterData","ColliderBody","coutourData","colliderFilter","_calculatedVertexList","contourData","ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX","getContourData","setColliderFilter","getCalculatedVertexList","setB2Fixture","fixture","_fixture","getB2Fixture","setShape","getShape","setContourData","getColliderFilter","ColliderDetector","_colliderBodyList","_bone","_body","_active","_filter","helpPoint","cc","p","bone","prototype","init","call","length","addContourData","colliderBody","push","calculatedVertexList","vertexList","i","newVertex","ContourVertex2","addContourDataList","contourDataList","removeContourData","eraseList","locBodyList","body","arrayRemoveObject","removeAll","setActive","active","locBody","locShape","space","addShape","removeShape","getActive","getColliderBodyList","updateTransform","t","locHelpPoint","vs","cvs","j","x","y","pointApplyAffineTransform","v","verts","b","n","normalize","perp","sub","planes","d","dot","setBody","PolyShape","vzero","sensor","data","getBody","_p","defineGetterSetter","create"],"mappings":"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","file":"CCColliderDetector.js","sourceRoot":"../../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/physics","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * @ignore\n */\nccs.PT_RATIO = 32;\n\n/**\n * Base class for ccs.ColliderFilter\n * @class\n * @extends ccs.Class\n */\nccs.ColliderFilter = ccs.Class.extend(/** @lends ccs.ColliderFilter# */{\n    _collisionType: 0,\n    _group: 0,\n    _categoryBits: 0,\n    _groupIndex: 0,\n    _maskBits: 0,\n\n    ctor: function (collisionType, group) {\n        this._collisionType = collisionType || 0;\n        this._group = group || 0;\n    },\n\n    updateShape: function (shape) {\n        if(shape instanceof cp.Shape){\n            shape.collision_type = this._collisionType;\n            shape.group = this._group;\n        }else if(shape instanceof Box2D.b2FilterData){\n            var filter = new Box2D.b2FilterData();\n            filter.categoryBits = this._categoryBits;\n            filter.groupIndex = this._groupIndex;\n            filter.maskBits = this._maskBits;\n\n            shape.SetFilterData(filter);\n        }\n    }\n});\n\n/**\n * Base class for ccs.ColliderBody\n * @class\n * @extends ccs.Class\n *\n * @property {ccs.ContourData}      contourData     - The contour data of collider body\n * @property {ccs.Shape}            shape           - The shape of collider body\n * @property {ccs.ColliderFilter}   colliderFilter  - The collider filter of collider body\n *\n */\nccs.ColliderBody = ccs.Class.extend(/** @lends ccs.ColliderBody# */{\n    shape: null,\n    coutourData: null,\n    colliderFilter: null,\n    _calculatedVertexList: null,\n    ctor: function (contourData) {\n        this.shape = null;\n        this.coutourData = contourData;\n        this.colliderFilter = new ccs.ColliderFilter();\n        if (ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX) {\n            this._calculatedVertexList = [];\n        }\n    },\n\n    /**\n     * contourData getter\n     * @returns {ccs.ContourData}\n     */\n    getContourData: function () {\n        return this.coutourData;\n    },\n\n    /**\n     * colliderFilter setter\n     * @param {ccs.ColliderFilter} colliderFilter\n     */\n    setColliderFilter: function (colliderFilter) {\n        this.colliderFilter = colliderFilter;\n    },\n\n    /**\n     * get calculated vertex list\n     * @returns {Array}\n     */\n    getCalculatedVertexList: function () {\n        return this._calculatedVertexList;\n    },\n\n    setB2Fixture: function(fixture){\n        this._fixture = fixture;\n    },\n\n    getB2Fixture: function(){\n        return this._fixture;\n    },\n\n    /**\n     * shape getter\n     * @param {ccs.Shape} shape\n     */\n    setShape: function (shape) {\n        this.shape = shape;\n    },\n\n    /**\n     * shape setter\n     * @return {ccs.Shape}\n     */\n    getShape: function () {\n        return this.shape;\n    },\n\n    /**\n     * contourData setter\n     * @param {ccs.ContourData} contourData\n     */\n    setContourData: function (contourData) {\n        this.coutourData = contourData;\n    },\n\n    /**\n     * colliderFilter getter\n     * @returns {ccs.ColliderFilter}\n     */\n    getColliderFilter: function () {\n        return this.colliderFilter;\n    }\n});\n\n/**\n * Base class for ccs.ColliderDetector\n * @class\n * @extends ccs.Class\n *\n * @param {ccs.Bone} [bone]\n *\n * @property {ccs.ColliderFilter}   colliderFilter  - The collider filter of the collider detector\n * @property {Boolean}              active          - Indicate whether the collider detector is active\n * @property {Object}               body            - The collider body\n */\nccs.ColliderDetector = ccs.Class.extend(/** @lends ccs.ColliderDetector# */{\n    _colliderBodyList: null,\n    _bone: null,\n    _body: null,\n    _active: false,\n    _filter: null,\n    helpPoint: cc.p(0, 0),\n\n    ctor: function (bone) {\n        this._colliderBodyList = [];\n        this._bone = null;\n        this._body = null;\n        this._active = false;\n        this._filter = null;\n\n        ccs.ColliderDetector.prototype.init.call(this, bone);\n    },\n    init: function (bone) {\n        this._colliderBodyList.length = 0;\n        if (bone)\n            this._bone = bone;\n        this._filter = new ccs.ColliderFilter();\n        return true;\n    },\n\n    /**\n     *  add contourData\n     * @param {ccs.ContourData} contourData\n     */\n    addContourData: function (contourData) {\n        var colliderBody = new ccs.ColliderBody(contourData);\n        this._colliderBodyList.push(colliderBody);\n\n        if (ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX) {\n            var calculatedVertexList = colliderBody.getCalculatedVertexList();\n            var vertexList = contourData.vertexList;\n            for (var i = 0; i < vertexList.length; i++) {\n                var newVertex = new ccs.ContourVertex2(0, 0);\n                calculatedVertexList.push(newVertex);\n            }\n        }\n    },\n\n    /**\n     * add contourData\n     * @param {Array} contourDataList\n     */\n    addContourDataList: function (contourDataList) {\n        for (var i = 0; i < contourDataList.length; i++) {\n            this.addContourData(contourDataList[i]);\n        }\n    },\n\n    /**\n     * remove contourData\n     * @param contourData\n     */\n    removeContourData: function (contourData) {\n        var eraseList = [], i, locBodyList = this._colliderBodyList;\n        for (i = 0; i < locBodyList.length; i++) {\n            var body = locBodyList[i];\n            if (body && body.getContourData() === contourData)\n                eraseList.push(body);\n        }\n\n        for (i=0; i<eraseList.length; i++)\n            cc.arrayRemoveObject(locBodyList, eraseList[i]);\n    },\n\n    /**\n     * remove all body\n     */\n    removeAll: function () {\n        this._colliderBodyList.length = 0;\n    },\n\n    setActive: function (active) {\n        if (this._active === active)\n            return;\n        this._active = active;\n\n        var locBody = this._body;\n        var locShape;\n        if (locBody) {\n            var colliderBody = null;\n            if (this._active) {\n                for (var i = 0; i < this._colliderBodyList.length; i++) {\n                    colliderBody = this._colliderBodyList[i];\n                    locShape = colliderBody.getShape();\n                    locBody.space.addShape(locShape);\n                }\n            } else {\n                for (var i = 0; i < this._colliderBodyList.length; i++) {\n                    colliderBody = this._colliderBodyList[i];\n                    locShape = colliderBody.getShape();\n                    locBody.space.removeShape(locShape);\n                }\n            }\n        }\n    },\n\n    getActive: function () {\n        return this._active;\n    },\n\n    getColliderBodyList: function(){\n        return this._colliderBodyList;\n    },\n\n    /**\n     * set colliderFilter\n     * @param {ccs.ColliderFilter} filter\n     */\n    setColliderFilter: function (filter) {\n        this._filter = filter;\n        var locBodyList = this._colliderBodyList;\n        for(var i=0; i< locBodyList.length; i++){\n            var colliderBody = locBodyList[i];\n            colliderBody.setColliderFilter(filter);\n            if (colliderBody.getShape())\n                colliderBody.getColliderFilter().updateShape(colliderBody.getShape());\n        }\n    },\n\n    /**\n     * get colliderFilter\n     * @returns {ccs.ColliderFilter}\n     */\n    getColliderFilter: function () {\n        return this._filter;\n    },\n\n    updateTransform: function (t) {\n        if (!this._active)\n            return;\n\n        var colliderBody = null;\n        var locBody = this._body;\n        var locHelpPoint = this.helpPoint;\n        for (var i = 0; i < this._colliderBodyList.length; i++) {\n\n            colliderBody = this._colliderBodyList[i];\n            var contourData = colliderBody.getContourData();\n\n            //default physics engine: Chipmunk\n            var shape = null;\n            if (locBody) {\n                //Box2d shape = (b2PolygonShape *)colliderBody->getB2Fixture()->GetShape();\n                shape = colliderBody.getShape();\n            }\n\n            var vs = contourData.vertexList;\n            var cvs = colliderBody.getCalculatedVertexList();\n\n            for (var j = 0; j < vs.length; j++) {\n                locHelpPoint.x = vs[j].x;\n                locHelpPoint.y = vs[j].y;\n                locHelpPoint = cc.pointApplyAffineTransform(locHelpPoint, t);\n\n                if (ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX) {\n                    var v = cc.p(0, 0);\n                    v.x = locHelpPoint.x;\n                    v.y = locHelpPoint.y;\n                    cvs[j] = v;\n                }\n\n                if (shape) {\n                    shape.verts[j * 2] = locHelpPoint.x;\n                    shape.verts[j * 2 + 1] = locHelpPoint.y;\n                }\n            }\n            if (shape) {\n                for (var j = 0; j < vs.length; j++) {\n                    var b = shape.verts[(j + 1) % shape.verts.length];\n                    var n = cp.v.normalize(cp.v.perp(cp.v.sub(b, shape.verts[j])));\n\n                    if(shape.planes){\n                        shape.planes[j].n = n;\n                        shape.planes[j].d = cp.v.dot(n, shape.verts[j]);\n                    }\n//                    var b = shape.verts[(i + 1) % shape.numVerts];\n//                    var n = cp.v.normalize(cp.v.perp(cp.v.sub(b, shape.verts[i])));\n//\n//                    shape.planes[i].n = n;\n//                    shape.planes[i].d = cp.v.dot(n, shape.verts[i]);\n                }\n            }\n        }\n    },\n\n    setBody: function (body) {\n        this._body = body;\n        var colliderBody, locBodyList = this._colliderBodyList;\n        for (var i = 0; i < locBodyList.length; i++) {\n            colliderBody = locBodyList[i];\n            var contourData = colliderBody.getContourData(), verts = [];\n            var vs = contourData.vertexList;\n            for (var j = 0; j < vs.length; j++) {\n                var v = vs[j];\n                verts.push(v.x);\n                verts.push(v.y);\n            }\n            var shape = new cp.PolyShape(this._body, verts, cp.vzero);\n            shape.sensor = true;\n            shape.data = this._bone;\n            if (this._active)\n                this._body.space.addShape(shape);\n            colliderBody.setShape(shape);\n            colliderBody.getColliderFilter().updateShape(shape);\n        }\n    },\n\n    getBody: function () {\n        return this._body;\n    }\n});\n\nvar _p = ccs.ColliderDetector.prototype;\n\n// Extended properties\n/** @expose */\n_p.colliderFilter;\ncc.defineGetterSetter(_p, \"colliderFilter\", _p.getColliderFilter, _p.setColliderFilter);\n/** @expose */\n_p.active;\ncc.defineGetterSetter(_p, \"active\", _p.getActive, _p.setActive);\n/** @expose */\n_p.body;\ncc.defineGetterSetter(_p, \"body\", _p.getBody, _p.setBody);\n\n_p = null;\n\nccs.ColliderDetector.create = function (bone) {\n    return new ccs.ColliderDetector(bone);\n};"]}