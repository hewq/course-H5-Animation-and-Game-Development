{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/layers/assets/frameworks/cocos2d-html5/cocos2d/core/layers/CCLayerWebGLRenderCmd.js"],"names":["cc","Layer","WebGLRenderCmd","renderable","_rootCtor","_isBaked","proto","prototype","Object","create","Node","constructor","_layerCmdCtor","bake","unbake","_bakeForAddChild","FLOAT_PER_VERTEX","LayerColor","_needDraw","_matrix","initData","_color","Uint32Array","_vertexBuffer","_shaderProgram","shaderCache","programForKey","SHADER_POSITION_COLOR","vertexCount","_data","ArrayBuffer","_positionView","Float32Array","_colorView","_dataDirty","transform","parentCmd","recursive","originTransform","node","_node","width","_contentSize","height","pos","z","_vertexZ","_updateColor","color","_displayedColor","_displayedOpacity","b","g","r","colors","i","rendering","ctx","gl","_renderContext","math","Matrix4","identity","wt","_worldTransform","mat","a","c","tx","d","ty","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","_glProgramState","apply","glBlendFunc","_blendFunc","src","dst","enableVertexAttribArray","VERTEX_ATTRIB_POSITION","VERTEX_ATTRIB_COLOR","vertexAttribPointer","FLOAT","UNSIGNED_BYTE","drawArrays","TRIANGLE_STRIP","updateBlendFunc","blendFunc","LayerGradient","call","_clipRect","Rect","_clippingRectDirty","updateStatus","flags","_dirtyFlags","locFlag","_dirtyFlag","gradientDirty","colorDirty","_updateVertex","originUpdateStatus","_syncStatus","_originSyncStatus","stops","_colorStops","length","stopsLen","verticesLen","contentSize","angle","Math","PI","pAngleSigned","p","_alongVector","locAnchor","degrees","round","radiansToDegrees","transMat","affineTransformMake","x","y","affineTransformRotate","sin","cos","abs","affineTransformScale","stop","p0","pointApplyAffineTransform","offset","p1","stopColor","opacityf","context","clippingRect","_getClippingRect","enable","SCISSOR_TEST","view","setScissorInPoints","disable","rect","trans","getNodeToWorldTransform","_rectApplyAffineTransformIn"],"mappings":"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","file":"CCLayerWebGLRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/layers","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n//-----------------------//\n//  1. cc.Layer          //\n//  2. cc.LayerColor     //\n//  3. cc.LayerGradient  //\n//-----------------------//\n\n/**\n * cc.Layer's rendering objects of WebGL\n */\n(function () {\n    cc.Layer.WebGLRenderCmd = function (renderable) {\n        this._rootCtor(renderable);\n        this._isBaked = false;\n    };\n\n    var proto = cc.Layer.WebGLRenderCmd.prototype = Object.create(cc.Node.WebGLRenderCmd.prototype);\n    proto.constructor = cc.Layer.WebGLRenderCmd;\n    proto._layerCmdCtor = cc.Layer.WebGLRenderCmd;\n\n    proto.bake = function () {\n    };\n\n    proto.unbake = function () {\n    };\n\n    proto._bakeForAddChild = function () {\n    };\n})();\n\n/**\n * cc.LayerColor's rendering objects of WebGL\n */\n(function () {\n    var FLOAT_PER_VERTEX = 4;\n\n    cc.LayerColor.WebGLRenderCmd = function (renderable) {\n        this._layerCmdCtor(renderable);\n        this._needDraw = true;\n\n        this._matrix = null;\n\n        this.initData(4);\n        this._color = new Uint32Array(1);\n        this._vertexBuffer = null;\n\n        this._shaderProgram = cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR);\n    };\n    var proto = cc.LayerColor.WebGLRenderCmd.prototype = Object.create(cc.Layer.WebGLRenderCmd.prototype);\n    proto.constructor = cc.LayerColor.WebGLRenderCmd;\n\n    proto.initData = function (vertexCount) {\n        this._data = new ArrayBuffer(16 * vertexCount);\n        this._positionView = new Float32Array(this._data);\n        this._colorView = new Uint32Array(this._data);\n        this._dataDirty = true;\n    };\n\n    proto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n\n        var node = this._node,\n            width = node._contentSize.width,\n            height = node._contentSize.height;\n\n        var pos = this._positionView;\n        pos[FLOAT_PER_VERTEX] = width;          // br.x\n        pos[FLOAT_PER_VERTEX * 2 + 1] = height; // tl.y\n        pos[FLOAT_PER_VERTEX * 3] = width;      // tr.x\n        pos[FLOAT_PER_VERTEX * 3 + 1] = height; // tr.y\n        pos[2].z = \n        pos[FLOAT_PER_VERTEX + 2] = \n        pos[FLOAT_PER_VERTEX * 2 + 2] = \n        pos[FLOAT_PER_VERTEX * 3 + 2] = node._vertexZ;\n\n        this._dataDirty = true;\n    };\n\n    proto._updateColor = function () {\n        var color = this._displayedColor;\n        this._color[0] = ((this._displayedOpacity << 24) | (color.b << 16) | (color.g << 8) | color.r);\n\n        var colors = this._colorView;\n        for (var i = 0; i < 4; i++) {\n            colors[i * FLOAT_PER_VERTEX + 3] = this._color[0];\n        }\n        this._dataDirty = true;\n    };\n\n    proto.rendering = function (ctx) {\n        var gl = ctx || cc._renderContext;\n        var node = this._node;\n\n        if (!this._matrix) {\n            this._matrix = new cc.math.Matrix4();\n            this._matrix.identity();\n        }\n\n        var wt = this._worldTransform;\n        this._matrix.mat[0] = wt.a;\n        this._matrix.mat[4] = wt.c;\n        this._matrix.mat[12] = wt.tx;\n        this._matrix.mat[1] = wt.b;\n        this._matrix.mat[5] = wt.d;\n        this._matrix.mat[13] = wt.ty;\n\n        if (this._dataDirty) {\n            if (!this._vertexBuffer) {\n                this._vertexBuffer = gl.createBuffer();\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, this._data, gl.DYNAMIC_DRAW);\n            this._dataDirty = false;\n        }\n\n\tthis._glProgramState.apply(this._matrix);\n        cc.glBlendFunc(node._blendFunc.src, node._blendFunc.dst);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);\n\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION, 3, gl.FLOAT, false, 16, 0);\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR, 4, gl.UNSIGNED_BYTE, true, 16, 12);\n\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    };\n\n    proto.updateBlendFunc = function (blendFunc) {\n    };\n})();\n\n/**\n * cc.LayerGradient's rendering objects of WebGL\n */\n(function () {\n    var FLOAT_PER_VERTEX = 4;\n\n    cc.LayerGradient.WebGLRenderCmd = function (renderable) {\n        cc.LayerColor.WebGLRenderCmd.call(this, renderable);\n        this._needDraw = true;\n        this._clipRect = new cc.Rect();\n        this._clippingRectDirty = false;\n    };\n    var proto = cc.LayerGradient.WebGLRenderCmd.prototype = Object.create(cc.LayerColor.WebGLRenderCmd.prototype);\n    proto.constructor = cc.LayerGradient.WebGLRenderCmd;\n\n    proto.updateStatus = function () {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        if (locFlag & flags.gradientDirty) {\n            this._dirtyFlag |= flags.colorDirty;\n            this._updateVertex();\n            this._dirtyFlag &= ~flags.gradientDirty;\n        }\n\n        this.originUpdateStatus();\n    };\n\n    proto._syncStatus = function (parentCmd) {\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        if (locFlag & flags.gradientDirty) {\n            this._dirtyFlag |= flags.colorDirty;\n            this._updateVertex();\n            this._dirtyFlag &= ~flags.gradientDirty;\n        }\n\n        this._originSyncStatus(parentCmd);\n    };\n\n    proto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n        this._updateVertex();\n    };\n\n    proto._updateVertex = function () {\n        var node = this._node, stops = node._colorStops;\n        if (!stops || stops.length < 2)\n            return;\n\n        this._clippingRectDirty = true;\n        var i, stopsLen = stops.length, verticesLen = stopsLen * 2, contentSize = node._contentSize;\n        if (this._positionView.length / FLOAT_PER_VERTEX < verticesLen) {\n            this.initData(verticesLen);\n        }\n\n        //init vertex\n        var angle = Math.PI + cc.pAngleSigned(cc.p(0, -1), node._alongVector), locAnchor = cc.p(contentSize.width / 2, contentSize.height / 2);\n        var degrees = Math.round(cc.radiansToDegrees(angle));\n        var transMat = cc.affineTransformMake(1, 0, 0, 1, locAnchor.x, locAnchor.y);\n        transMat = cc.affineTransformRotate(transMat, angle);\n        var a, b;\n        if (degrees < 90) {\n            a = cc.p(-locAnchor.x, locAnchor.y);\n            b = cc.p(locAnchor.x, locAnchor.y);\n        } else if (degrees < 180) {\n            a = cc.p(locAnchor.x, locAnchor.y);\n            b = cc.p(locAnchor.x, -locAnchor.y);\n        } else if (degrees < 270) {\n            a = cc.p(locAnchor.x, -locAnchor.y);\n            b = cc.p(-locAnchor.x, -locAnchor.y);\n        } else {\n            a = cc.p(-locAnchor.x, -locAnchor.y);\n            b = cc.p(-locAnchor.x, locAnchor.y);\n        }\n\n        var sin = Math.sin(angle), cos = Math.cos(angle);\n        var tx = Math.abs((a.x * cos - a.y * sin) / locAnchor.x), ty = Math.abs((b.x * sin + b.y * cos) / locAnchor.y);\n        transMat = cc.affineTransformScale(transMat, tx, ty);\n        var pos = this._positionView;\n        for (i = 0; i < stopsLen; i++) {\n            var stop = stops[i], y = stop.p * contentSize.height;\n            var p0 = cc.pointApplyAffineTransform(-locAnchor.x, y - locAnchor.y, transMat);\n            var offset = i * 2 * FLOAT_PER_VERTEX;\n            pos[offset] = p0.x;\n            pos[offset + 1] = p0.y;\n            pos[offset + 2] = node._vertexZ;\n            var p1 = cc.pointApplyAffineTransform(contentSize.width - locAnchor.x, y - locAnchor.y, transMat);\n            offset += FLOAT_PER_VERTEX;\n            pos[offset] = p1.x;\n            pos[offset + 1] = p1.y;\n            pos[offset + 2] = node._vertexZ;\n        }\n\n        this._dataDirty = true;\n    };\n\n    proto._updateColor = function () {\n        var node = this._node, stops = node._colorStops;\n        if (!stops || stops.length < 2)\n            return;\n\n        var stopsLen = stops.length,\n            stopColor,\n            offset,\n            colors = this._colorView,\n            opacityf = this._displayedOpacity / 255;\n        for (i = 0; i < stopsLen; i++) {\n            stopColor = stops[i].color;\n            this._color[0] = ((stopColor.a*opacityf) << 24) | (stopColor.b << 16) | (stopColor.g << 8) | stopColor.r;\n            \n            offset = i * 2 * FLOAT_PER_VERTEX;\n            colors[offset + 3] = this._color[0];\n            offset += FLOAT_PER_VERTEX;\n            colors[offset + 3] = this._color[0];\n        }\n        this._dataDirty = true;\n    };\n\n    proto.rendering = function (ctx) {\n        var context = ctx || cc._renderContext, node = this._node;\n\n        if (!this._matrix) {\n            this._matrix = new cc.math.Matrix4();\n            this._matrix.identity();\n        }\n\n        //it is too expensive to use stencil to clip, so it use Scissor,\n        //but it has a bug when layer rotated and layer's content size less than canvas's size.\n        var clippingRect = this._getClippingRect();\n        context.enable(context.SCISSOR_TEST);\n        cc.view.setScissorInPoints(clippingRect.x, clippingRect.y, clippingRect.width, clippingRect.height);\n\n        var wt = this._worldTransform;\n        this._matrix.mat[0] = wt.a;\n        this._matrix.mat[4] = wt.c;\n        this._matrix.mat[12] = wt.tx;\n        this._matrix.mat[1] = wt.b;\n        this._matrix.mat[5] = wt.d;\n        this._matrix.mat[13] = wt.ty;\n\n        if (this._dataDirty) {\n            if (!this._vertexBuffer) {\n                this._vertexBuffer = gl.createBuffer();\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, this._data, gl.DYNAMIC_DRAW);\n            this._dataDirty = false;\n        }\n\n        //draw gradient layer\n        this._glProgramState.apply(this._matrix);\n        cc.glBlendFunc(node._blendFunc.src, node._blendFunc.dst);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);\n\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION, 3, gl.FLOAT, false, 16, 0);\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR, 4, gl.UNSIGNED_BYTE, true, 16, 12);\n\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n        context.disable(context.SCISSOR_TEST);\n    };\n\n    proto._getClippingRect = function () {\n        if (this._clippingRectDirty) {\n            var node = this._node;\n            var rect = cc.rect(0, 0, node._contentSize.width, node._contentSize.height);\n            var trans = node.getNodeToWorldTransform();\n            this._clipRect = cc._rectApplyAffineTransformIn(rect, trans);\n        }\n        return this._clipRect;\n    };\n})();\n"]}