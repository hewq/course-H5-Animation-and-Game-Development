{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/tilemap/assets/frameworks/cocos2d-html5/cocos2d/tilemap/CCTMXTiledMap.js"],"names":["cc","TMX_ORIENTATION_ORTHO","TMX_ORIENTATION_HEX","TMX_ORIENTATION_ISO","TMXTiledMap","Node","extend","properties","mapOrientation","objectGroups","_mapSize","_tileSize","_tileProperties","_className","ctor","tmxFile","resourcePath","prototype","call","size","undefined","initWithXML","initWithTMXFile","getMapSize","width","height","setMapSize","Var","_getMapWidth","_setMapWidth","_getMapHeight","_setMapHeight","getTileSize","setTileSize","_getTileWidth","_setTileWidth","_getTileHeight","_setTileHeight","getMapOrientation","setMapOrientation","getObjectGroups","setObjectGroups","getProperties","setProperties","length","Error","mapInfo","TMXMapInfo","locTilesets","getTilesets","log","_buildWithMapInfo","tmxString","orientation","getTileProperties","idx","layers","getLayers","layerInfo","i","len","visible","child","_parseLayer","addChild","Math","max","allLayers","retArr","locChildren","_children","layer","TMXLayer","push","getLayer","layerName","getObjectGroup","groupName","objectGroup","getProperty","propertyName","toString","propertiesForGID","GID","getPropertiesForGID","tileset","_tilesetForLayer","ownTiles","_layerSize","tilesets","y","x","pos","gid","_tiles","TMX_TILE_FLIPPED_MASK","firstGid","name","_p","mapWidth","defineGetterSetter","mapHeight","tileWidth","tileHeight","create"],"mappings":"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","file":"CCTMXTiledMap.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/tilemap","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n Orthogonal orientation\n * @constant\n * @type Number\n */\ncc.TMX_ORIENTATION_ORTHO = 0;\n\n/**\n * Hexagonal orientation\n * @constant\n * @type Number\n */\n\ncc.TMX_ORIENTATION_HEX = 1;\n\n/**\n * Isometric orientation\n * @constant\n * @type Number\n */\ncc.TMX_ORIENTATION_ISO = 2;\n\n/**\n * <p>cc.TMXTiledMap knows how to parse and render a TMX map.</p>\n *\n * <p>It adds support for the TMX tiled map format used by http://www.mapeditor.org <br />\n * It supports isometric, hexagonal and orthogonal tiles.<br />\n * It also supports object groups, objects, and properties.</p>\n *\n * <p>Features: <br />\n * - Each tile will be treated as an cc.Sprite<br />\n * - The sprites are created on demand. They will be created only when you call \"layer.getTileAt(position)\" <br />\n * - Each tile can be rotated / moved / scaled / tinted / \"opacitied\", since each tile is a cc.Sprite<br />\n * - Tiles can be added/removed in runtime<br />\n * - The z-order of the tiles can be modified in runtime<br />\n * - Each tile has an anchorPoint of (0,0) <br />\n * - The anchorPoint of the TMXTileMap is (0,0) <br />\n * - The TMX layers will be added as a child <br />\n * - The TMX layers will be aliased by default <br />\n * - The tileset image will be loaded using the cc.TextureCache <br />\n * - Each tile will have a unique tag<br />\n * - Each tile will have a unique z value. top-left: z=1, bottom-right: z=max z<br />\n * - Each object group will be treated as an cc.MutableArray <br />\n * - Object class which will contain all the properties in a dictionary<br />\n * - Properties can be assigned to the Map, Layer, Object Group, and Object</p>\n *\n * <p>Limitations: <br />\n * - It only supports one tileset per layer. <br />\n * - Embedded images are not supported <br />\n * - It only supports the XML format (the JSON format is not supported)</p>\n *\n * <p>Technical description: <br />\n * Each layer is created using an cc.TMXLayer (subclass of cc.SpriteBatchNode). If you have 5 layers, then 5 cc.TMXLayer will be created, <br />\n * unless the layer visibility is off. In that case, the layer won't be created at all. <br />\n * You can obtain the layers (cc.TMXLayer objects) at runtime by: <br />\n * - map.getChildByTag(tag_number);  // 0=1st layer, 1=2nd layer, 2=3rd layer, etc...<br />\n * - map.getLayer(name_of_the_layer); </p>\n *\n * <p>Each object group is created using a cc.TMXObjectGroup which is a subclass of cc.MutableArray.<br />\n * You can obtain the object groups at runtime by: <br />\n * - map.getObjectGroup(name_of_the_object_group); </p>\n *\n * <p>Each object is a cc.TMXObject.</p>\n *\n * <p>Each property is stored as a key-value pair in an cc.MutableDictionary.<br />\n * You can obtain the properties at runtime by: </p>\n *\n * <p>map.getProperty(name_of_the_property); <br />\n * layer.getProperty(name_of_the_property); <br />\n * objectGroup.getProperty(name_of_the_property); <br />\n * object.getProperty(name_of_the_property);</p>\n * @class\n * @extends cc.Node\n * @param {String} tmxFile tmxFile fileName or content string\n * @param {String} resourcePath   If tmxFile is a file name ,it is not required.If tmxFile is content string ,it is must required.\n\n *\n * @property {Array}    properties      - Properties from the map. They can be added using tilemap editors\n * @property {Number}   mapOrientation  - Map orientation\n * @property {Array}    objectGroups    - Object groups of the map\n * @property {Number}   mapWidth        - Width of the map\n * @property {Number}   mapHeight       - Height of the map\n * @property {Number}   tileWidth       - Width of a tile\n * @property {Number}   tileHeight      - Height of a tile\n *\n * @example\n * //example\n * 1.\n * //create a TMXTiledMap with file name\n * var tmxTiledMap = new cc.TMXTiledMap(\"res/orthogonal-test1.tmx\");\n * 2.\n * //create a TMXTiledMap with content string and resource path\n * var resources = \"res/TileMaps\";\n * var filePath = \"res/TileMaps/orthogonal-test1.tmx\";\n * var xmlStr = cc.loader.getRes(filePath);\n * var tmxTiledMap = new cc.TMXTiledMap(xmlStr, resources);\n */\ncc.TMXTiledMap = cc.Node.extend(/** @lends cc.TMXTiledMap# */{\n\tproperties: null,\n\tmapOrientation: null,\n\tobjectGroups: null,\n\n    //the map's size property measured in tiles\n    _mapSize: null,\n    _tileSize: null,\n    //tile properties\n    _tileProperties: null,\n    _className: \"TMXTiledMap\",\n\n    /**\n     * Creates a TMX Tiled Map with a TMX file  or content string. <br/>\n     * Constructor of cc.TMXTiledMap\n     * @param {String} tmxFile tmxFile fileName or content string\n     * @param {String} resourcePath   If tmxFile is a file name ,it is not required.If tmxFile is content string ,it is must required.\n     */\n    ctor:function(tmxFile,resourcePath){\n        cc.Node.prototype.ctor.call(this);\n        this._mapSize = cc.size(0, 0);\n        this._tileSize = cc.size(0, 0);\n\n        if(resourcePath !== undefined){\n            this.initWithXML(tmxFile,resourcePath);\n        }else if(tmxFile !== undefined){\n            this.initWithTMXFile(tmxFile);\n        }\n    },\n\n    /**\n     * Gets the map size.\n     * @return {cc.Size}\n     */\n    getMapSize:function () {\n        return cc.size(this._mapSize.width, this._mapSize.height);\n    },\n\n    /**\n     * Set the map size.\n     * @param {cc.Size} Var\n     */\n    setMapSize:function (Var) {\n        this._mapSize.width = Var.width;\n        this._mapSize.height = Var.height;\n    },\n\n\t_getMapWidth: function () {\n\t\treturn this._mapSize.width;\n\t},\n\t_setMapWidth: function (width) {\n\t\tthis._mapSize.width = width;\n\t},\n\t_getMapHeight: function () {\n\t\treturn this._mapSize.height;\n\t},\n\t_setMapHeight: function (height) {\n\t\tthis._mapSize.height = height;\n\t},\n\n    /**\n     * Gets the tile size.\n     * @return {cc.Size}\n     */\n    getTileSize:function () {\n        return cc.size(this._tileSize.width, this._tileSize.height);\n    },\n\n    /**\n     * Set the tile size\n     * @param {cc.Size} Var\n     */\n    setTileSize:function (Var) {\n        this._tileSize.width = Var.width;\n        this._tileSize.height = Var.height;\n    },\n\n\t_getTileWidth: function () {\n\t\treturn this._tileSize.width;\n\t},\n\t_setTileWidth: function (width) {\n\t\tthis._tileSize.width = width;\n\t},\n\t_getTileHeight: function () {\n\t\treturn this._tileSize.height;\n\t},\n\t_setTileHeight: function (height) {\n\t\tthis._tileSize.height = height;\n\t},\n\n    /**\n     * map orientation\n     * @return {Number}\n     */\n    getMapOrientation:function () {\n        return this.mapOrientation;\n    },\n\n    /**\n     * map orientation\n     * @param {Number} Var\n     */\n    setMapOrientation:function (Var) {\n        this.mapOrientation = Var;\n    },\n\n    /**\n     * object groups\n     * @return {Array}\n     */\n    getObjectGroups:function () {\n        return this.objectGroups;\n    },\n\n    /**\n     * object groups\n     * @param {Array} Var\n     */\n    setObjectGroups:function (Var) {\n        this.objectGroups = Var;\n    },\n\n    /**\n     * Gets the properties\n     * @return {object}\n     */\n    getProperties:function () {\n        return this.properties;\n    },\n\n    /**\n     * Set the properties\n     * @param {object} Var\n     */\n    setProperties:function (Var) {\n        this.properties = Var;\n    },\n\n    /**\n     * Initializes the instance of cc.TMXTiledMap with tmxFile\n     * @param {String} tmxFile\n     * @return {Boolean} Whether the initialization was successful.\n     * @example\n     * //example\n     * var map = new cc.TMXTiledMap()\n     * map.initWithTMXFile(\"hello.tmx\");\n     */\n    initWithTMXFile:function (tmxFile) {\n        if(!tmxFile || tmxFile.length === 0)\n            throw new Error(\"cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.\");\n\t    this.width = 0;\n\t    this.height = 0;\n        var mapInfo = new cc.TMXMapInfo(tmxFile);\n        if (!mapInfo)\n            return false;\n\n        var locTilesets = mapInfo.getTilesets();\n        if(!locTilesets || locTilesets.length === 0)\n            cc.log(\"cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename.\");\n        this._buildWithMapInfo(mapInfo);\n        return true;\n    },\n\n    /**\n     * Initializes the instance of cc.TMXTiledMap with tmxString\n     * @param {String} tmxString\n     * @param {String} resourcePath\n     * @return {Boolean} Whether the initialization was successful.\n     */\n    initWithXML:function(tmxString, resourcePath){\n        this.width = 0;\n\t    this.height = 0;\n\n        var mapInfo = new cc.TMXMapInfo(tmxString, resourcePath);\n        var locTilesets = mapInfo.getTilesets();\n        if(!locTilesets || locTilesets.length === 0)\n            cc.log(\"cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename.\");\n        this._buildWithMapInfo(mapInfo);\n        return true;\n    },\n\n    _buildWithMapInfo:function (mapInfo) {\n        this._mapSize = mapInfo.getMapSize();\n        this._tileSize = mapInfo.getTileSize();\n        this.mapOrientation = mapInfo.orientation;\n        this.objectGroups = mapInfo.getObjectGroups();\n        this.properties = mapInfo.properties;\n        this._tileProperties = mapInfo.getTileProperties();\n\n        var idx = 0;\n        var layers = mapInfo.getLayers();\n        if (layers) {\n            var layerInfo = null;\n            for (var i = 0, len = layers.length; i < len; i++) {\n                layerInfo = layers[i];\n                if (layerInfo && layerInfo.visible) {\n                    var child = this._parseLayer(layerInfo, mapInfo);\n                    this.addChild(child, idx, idx);\n                    // update content size with the max size\n\t                this.width = Math.max(this.width, child.width);\n\t                this.height = Math.max(this.height, child.height);\n                    idx++;\n                }\n            }\n        }\n    },\n\n    /**\n     * Return All layers array.\n     * @returns {Array}\n     */\n    allLayers: function () {\n        var retArr = [], locChildren = this._children;\n        for(var i = 0, len = locChildren.length;i< len;i++){\n            var layer = locChildren[i];\n            if(layer && layer instanceof cc.TMXLayer)\n                retArr.push(layer);\n        }\n        return retArr;\n    },\n\n    /**\n     * return the TMXLayer for the specific layer\n     * @param {String} layerName\n     * @return {cc.TMXLayer}\n     */\n    getLayer:function (layerName) {\n        if(!layerName || layerName.length === 0)\n            throw new Error(\"cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.\");\n        var locChildren = this._children;\n        for (var i = 0; i < locChildren.length; i++) {\n            var layer = locChildren[i];\n            if (layer && layer.layerName === layerName)\n                return layer;\n        }\n        // layer not found\n        return null;\n    },\n\n    /**\n     * Return the TMXObjectGroup for the specific group\n     * @param {String} groupName\n     * @return {cc.TMXObjectGroup}\n     */\n    getObjectGroup:function (groupName) {\n        if(!groupName || groupName.length === 0)\n            throw new Error(\"cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.\");\n        if (this.objectGroups) {\n            for (var i = 0; i < this.objectGroups.length; i++) {\n                var objectGroup = this.objectGroups[i];\n                if (objectGroup && objectGroup.groupName === groupName) {\n                    return objectGroup;\n                }\n            }\n        }\n        // objectGroup not found\n        return null;\n    },\n\n    /**\n     * Return the value for the specific property name\n     * @param {String} propertyName\n     * @return {String}\n     */\n    getProperty:function (propertyName) {\n        return this.properties[propertyName.toString()];\n    },\n\n    /**\n     * Return properties dictionary for tile GID\n     * @param {Number} GID\n     * @return {object}\n     * @deprecated\n     */\n    propertiesForGID:function (GID) {\n        cc.log(\"propertiesForGID is deprecated. Please use getPropertiesForGID instead.\");\n        return this.getPropertiesForGID[GID];\n    },\n\n    /**\n     * Return properties dictionary for tile GID\n     * @param {Number} GID\n     * @return {object}\n     */\n    getPropertiesForGID: function(GID) {\n        return this._tileProperties[GID];\n    },\n\n    _parseLayer:function (layerInfo, mapInfo) {\n        var tileset = this._tilesetForLayer(layerInfo, mapInfo);\n        var layer = new cc.TMXLayer(tileset, layerInfo, mapInfo);\n        // tell the layerinfo to release the ownership of the tiles map.\n        layerInfo.ownTiles = false;\n        return layer;\n    },\n\n    _tilesetForLayer:function (layerInfo, mapInfo) {\n        var size = layerInfo._layerSize;\n        var tilesets = mapInfo.getTilesets();\n        if (tilesets) {\n            for (var i = tilesets.length - 1; i >= 0; i--) {\n                var tileset = tilesets[i];\n                if (tileset) {\n                    for (var y = 0; y < size.height; y++) {\n                        for (var x = 0; x < size.width; x++) {\n                            var pos = x + size.width * y;\n                            var gid = layerInfo._tiles[pos];\n                            if (gid !== 0) {\n                                // Optimization: quick return\n                                // if the layer is invalid (more than 1 tileset per layer) an cc.assert will be thrown later\n                                if (((gid & cc.TMX_TILE_FLIPPED_MASK)>>>0) >= tileset.firstGid) {\n                                    return tileset;\n                                }\n                            }\n\n                        }\n                    }\n                }\n            }\n        }\n\n        // If all the tiles are 0, return empty tileset\n        cc.log(\"cocos2d: Warning: TMX Layer \" + layerInfo.name + \" has no tiles\");\n        return null;\n    }\n});\n\nvar _p = cc.TMXTiledMap.prototype;\n\n// Extended properties\n/** @expose */\n_p.mapWidth;\ncc.defineGetterSetter(_p, \"mapWidth\", _p._getMapWidth, _p._setMapWidth);\n/** @expose */\n_p.mapHeight;\ncc.defineGetterSetter(_p, \"mapHeight\", _p._getMapHeight, _p._setMapHeight);\n/** @expose */\n_p.tileWidth;\ncc.defineGetterSetter(_p, \"tileWidth\", _p._getTileWidth, _p._setTileWidth);\n/** @expose */\n_p.tileHeight;\ncc.defineGetterSetter(_p, \"tileHeight\", _p._getTileHeight, _p._setTileHeight);\n\n\n/**\n * Creates a TMX Tiled Map with a TMX file  or content string.\n * Implementation cc.TMXTiledMap\n * @deprecated since v3.0 please use new cc.TMXTiledMap(tmxFile,resourcePath) instead.\n * @param {String} tmxFile tmxFile fileName or content string\n * @param {String} resourcePath   If tmxFile is a file name ,it is not required.If tmxFile is content string ,it is must required.\n * @return {cc.TMXTiledMap|undefined}\n */\ncc.TMXTiledMap.create = function (tmxFile,resourcePath) {\n    return new cc.TMXTiledMap(tmxFile,resourcePath);\n};\n"]}