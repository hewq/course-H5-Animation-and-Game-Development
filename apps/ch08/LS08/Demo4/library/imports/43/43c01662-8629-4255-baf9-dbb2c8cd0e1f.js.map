{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library/assets/frameworks/cocos2d-html5/external/gaf/Library/GAFAsset.js"],"names":["gaf","Asset","cc","Class","extend","_className","_header","_timeLines","_textFields","_protos","_objects","_masks","_rootTimeLine","_textureLoadDelegate","_sceneFps","_sceneWidth","_sceneHeight","_sceneColor","_gafData","_desiredAtlasScale","_usedAtlasScale","_atlases","_onLoadTasks","_atlasScales","_textureLoaded","_atlasesToLoad","_gafName","initWithGAFFile","filePath","textureLoadDelegate","self","gafData","loader","getRes","load","err","data","_init","initWithGAFBundle","zipFilePath","entryFile","delegate","assert","setRootTimelineWithName","name","i","end","length","object","getLinkageName","_setRootTimeline","isAssetVersionPlayable","desiredAtlasScale","setDesiredAtlasScale","currentScale","hasOwnProperty","Math","abs","createObject","_instantiateGaf","createObjectAndRun","looped","arguments","setLooped","start","setTextureLoadDelegate","getSceneFps","getSceneWidth","getSceneHeight","getSceneColor","setSceneFps","fps","setSceneWidth","width","setSceneHeight","height","setSceneColor","color4B","getHeader","getGAFFileName","ctor","apply","_getProtos","timeLine","pivot","getPivot","frameSize","getRect","_setHeader","gafHeader","prop","_getMajorVerison","versionMajor","header","_timeLinesToLink","_pushTimeLine","_TimeLineProto","framesCount","_AssetPreload","Tags","tags","forEach","item","type","TYPE_TEXTURE","objectId","_SpriteProto","elementAtlasIdRef","TYPE_TIME_LINE","TYPE_TEXT_FIELD","log","proto","_MaskProto","Object","keys","dispatchEvent","getId","root","_gafConstruct","_onAtlasLoaded","id","atlas","fn","isLoaded","_getSearchPaths","imageUrl","extendedPath","split","alternativeUrl","join","create","gafFilePath","createWithBundle","asset","EventHelper","prototype"],"mappings":"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","file":"GAFAsset.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library","sourcesContent":["var gaf = gaf || {};\n\ngaf.Asset = cc.Class.extend\n({\n    _className: \"GAFAsset\",\n\n    // Private members\n    _header: null,\n    _timeLines: null,\n    _textFields: null,\n    _protos: null,\n    _objects: null,\n    _masks: null,\n\n    _rootTimeLine: null,\n    _textureLoadDelegate: null,\n    _sceneFps: 60,\n    _sceneWidth: 0,\n    _sceneHeight: 0,\n    _sceneColor: 0,\n    _gafData: null,\n    _desiredAtlasScale: 1,\n    _usedAtlasScale: 0,\n\n    _atlases: null,\n    _onLoadTasks: null,\n    _atlasScales: null,\n    _textureLoaded: false, // For async loading with cc.event manager\n    _atlasesToLoad: null, // Atlases that are not yet loaded\n    _gafName: null,\n\n    /**\n     * @method initWithGAFFile\n     * @param {String} filePath - path to .gaf file\n     * @param {String function(String)} textureLoadDelegate - is used to change atlas path, e.g. to load `atlas.tga` instead of `atlas.png`\n     * @return {bool}\n     */\n    initWithGAFFile: function (filePath, textureLoadDelegate) {\n        var self = this;\n        this._textureLoadDelegate = textureLoadDelegate;\n        this._gafName = filePath;\n        var gafData = cc.loader.getRes(filePath);\n        if(!gafData)\n        {\n            cc.loader.load(filePath, function(err, data){\n                if(!err)\n                {\n                    self._init(data[0]);\n                }\n            });\n        }\n        else {\n            return this._init(gafData);\n        }\n        return false;\n    },\n\n    /**\n     * @method initWithGAFBundle\n     * @param {String} zipFilePath - path to the archive with .gaf and its textures\n     * @param {String} entryFile - name of the .gaf file in archive\n     * @param {function({path:String})} delegate - is used to change atlas path, e.g. to load `atlas.tga` instead of `atlas.png`\n     * @return {bool}\n     */\n    initWithGAFBundle: function (zipFilePath, entryFile, delegate)\n    {\n        cc.assert(false, \"initWithGAFBundle is not yet implemented\");\n        return false;\n    },\n\n    /**\n     * @method setRootTimelineWithName\n     * @param {String} name\n     */\n    setRootTimelineWithName: function (name)\n    {\n        for(var i = 0, end = this._timeLines.length; i < end; ++i)\n        {\n            var object = this._timeLines[i];\n            if (object && object.getLinkageName() === name)\n            {\n                this._setRootTimeline(object);\n                return;\n            }\n        }\n    },\n\n/*    addEventListener: function(name, listener)\n    {},*/\n\n    isAssetVersionPlayable: function ()\n    {\n        return true;\n    },\n\n    /**\n     * Desired atlas scale.\n     * Default is 1.0f\n     * @returns {number}\n     */\n    desiredAtlasScale : function(){\n        return this._desiredAtlasScale;\n    },\n\n    /**\n     * Sets desired atlas scale. Will choose nearest atlas scale from available.\n     * Default is 1.0f\n     * @param scale\n     */\n    setDesiredAtlasScale : function(desiredAtlasScale){\n        this._desiredAtlasScale = desiredAtlasScale;\n        for(var currentScale in this._atlasScales)if(this._atlasScales.hasOwnProperty(currentScale))\n        {\n            if( (this._usedAtlasScale === 0) ||\n                (Math.abs(this._usedAtlasScale - desiredAtlasScale) > Math.abs(currentScale - desiredAtlasScale) ))\n            {\n                this._usedAtlasScale = currentScale;\n            }\n\n        }\n    },\n\n    /**\n     * @method createObject\n     * @return {gaf.Object}\n     */\n    createObject: function ()\n    {\n        return this._instantiateGaf(this._gafData);\n    },\n\n    /**\n     * @method createObjectAndRun\n     * @param {boolean} arg0 - run looped\n     * @return {gaf.Object}\n     */\n    createObjectAndRun: function (looped)\n    {\n        cc.assert(arguments.length === 1, \"GAFAsset::createObjectAndRun should have one param\");\n        var object = this._instantiateGaf(this._gafData);\n        object.setLooped(looped, true);\n        object.start();\n        return object;\n    },\n\n    /**\n     * @method setTextureLoadDelegate\n     * @param {function} delegate\n     */\n    setTextureLoadDelegate: function (delegate)\n    {\n        debugger;\n    },\n\n\n    /**\n     * @method getSceneFps\n     * @return {uint}\n     */\n    getSceneFps: function ()\n    {\n        return this._sceneFps;\n    },\n\n    /**\n     * @method getSceneWidth\n     * @return {uint}\n     */\n    getSceneWidth: function ()\n    {\n        debugger;\n    },\n\n    /**\n     * @method getSceneHeight\n     * @return {uint}\n     */\n    getSceneHeight: function ()\n    {\n        debugger;\n    },\n\n    /**\n     * @method getSceneColor\n     * @return {cc.color4b}\n     */\n    getSceneColor: function ()\n    {\n        debugger;\n    },\n\n    /**\n     * @method setSceneFps\n     * @param {uint} fps\n     */\n    setSceneFps: function (fps)\n    {\n        this._sceneFps = fps;\n    },\n\n    /**\n     * @method setSceneWidth\n     * @param {uint} width\n     */\n    setSceneWidth: function (width)\n    {\n        debugger;\n    },\n\n    /**\n     * @method setSceneHeight\n     * @param {uint} height\n     */\n    setSceneHeight: function (height)\n    {\n        debugger;\n    },\n\n    /**\n     * @method setSceneColor\n     * @param {color4b_object} arg0\n     */\n    setSceneColor: function (color4B)\n    {\n        debugger;\n    },\n\n    /**\n     * @method getHeader\n     * @return {GAFHeader}\n     */\n    getHeader: function ()\n    {\n        return this._header;\n    },\n\n    getGAFFileName: function()\n    {\n        return this._gafName;\n    },\n\n    // Private\n\n    ctor : function()\n    {\n        this._header = {};\n        this._timeLines = [];\n        this._textFields = [];\n        this._objects = [];\n        this._masks = [];\n        this._protos = [];\n        this._atlases = {};\n        this._onLoadTasks = [];\n        this._atlasScales = {};\n        this._atlasesToLoad = {};\n\n        if(arguments.length > 0)\n            this.initWithGAFFile.apply(this, arguments);\n    },\n\n    _getProtos: function()\n    {\n        return this._protos;\n    },\n\n    _setRootTimeline : function(timeLine)\n    {\n        this._rootTimeLine = timeLine;\n        this._header.pivot = timeLine.getPivot();\n        this._header.frameSize = timeLine.getRect();\n    },\n\n    _setHeader : function (gafHeader)\n    {\n        for(var prop in gafHeader)\n        {\n            if(gafHeader.hasOwnProperty(prop))\n            {\n                this._header[prop] = gafHeader[prop];\n            }\n        }\n    },\n\n    _getMajorVerison : function()\n    {\n        return this._header.versionMajor;\n    },\n\n    _init : function(gafData)\n    {\n        var self = this;\n        this._gafData = gafData;\n        this._setHeader(gafData.header);\n        this._timeLinesToLink = [];\n        if(this._getMajorVerison() < 4)\n        {\n            this._pushTimeLine(new gaf._TimeLineProto(this, this._header.framesCount, this._header.frameSize, this._header.pivot));\n        }\n        gaf._AssetPreload.Tags(this, gafData.tags, this._rootTimeLine);\n\n        //Link and create\n        this._objects.forEach(function(item)\n        {\n            switch(item.type)\n            {\n                case gaf.TYPE_TEXTURE:\n                    // Create gaf sprite proto if it is not yet created\n                    if(!self._protos[item.objectId])\n                    {\n                        self._protos[item.objectId] = new gaf._SpriteProto(self, self._atlasScales, item.elementAtlasIdRef);\n                    }\n                    break;\n                case gaf.TYPE_TIME_LINE:\n                    // All time line protos are already created, just copy reference\n                    self._protos[item.objectId] = self._timeLines[item.elementAtlasIdRef];\n                    break;\n                case gaf.TYPE_TEXT_FIELD:\n                    // All text field protos are already created, just copy reference\n                    self._protos[item.objectId] = self._textFields[item.elementAtlasIdRef];\n                    break;\n                default:\n                    cc.log(\"Unknown object type: \" + item.type);\n                    break;\n            }\n        });\n        this._masks.forEach(function(item)\n        {\n            if(self._protos[item.objectId])\n            {\n                return; // this is continue\n            }\n            var proto = null;\n            switch(item.type)\n            {\n                case gaf.TYPE_TEXTURE:\n                    // Create gaf sprite proto if it is not yet created\n                    proto = new gaf._SpriteProto(self, self._atlasScales, item.elementAtlasIdRef);\n                    break;\n                case gaf.TYPE_TIME_LINE:\n                    // All time line protos are already created, just copy reference\n                    proto = self._timeLines[item.elementAtlasIdRef];\n                    break;\n                case gaf.TYPE_TEXT_FIELD:\n                    // All text field protos are already created, just copy reference\n                    proto = self._textFields[item.elementAtlasIdRef];\n                    break;\n            }\n            self._protos[item.objectId] = new gaf._MaskProto(self, proto, item.elementAtlasIdRef);\n        });\n        this.setDesiredAtlasScale(this._desiredAtlasScale);\n\n        if(Object.keys(this._atlasesToLoad).length === 0)\n        {\n            this._textureLoaded = true;\n            this.dispatchEvent(\"load\");\n        }\n    },\n\n    _pushTimeLine : function(timeLine)\n    {\n        this._timeLines[timeLine.getId()] = timeLine;\n\n        if(timeLine.getId() === 0)\n        {\n            this._setRootTimeline(timeLine);\n        }\n    },\n\n    _instantiateGaf : function()\n    {\n        var root = null;\n        root = this._rootTimeLine._gafConstruct();\n        return root;\n    },\n\n    _onAtlasLoaded : function(id, atlas)\n    {\n        this._atlases[id] = atlas;\n        delete this._atlasesToLoad[id];\n        if(Object.keys(this._atlasesToLoad).length === 0)\n        {\n            this._onLoadTasks.forEach(function(fn){fn()});\n            this._onLoadTasks.length = 0;\n            this._textureLoaded = true;\n            this.dispatchEvent(\"load\");\n        }\n    },\n\n    isLoaded : function()\n    {\n        return this._textureLoaded;\n    },\n\n    _getSearchPaths: function(imageUrl)\n    {\n        var extendedPath = this.getGAFFileName().split('/');\n        extendedPath[extendedPath.length-1] = imageUrl;\n        var alternativeUrl = extendedPath.join('/');\n\n        return [imageUrl, alternativeUrl];\n    }\n});\n\n/**\n * @method initWithGAFFile\n * @param {String} gafFilePath - path to .gaf file\n * @param {function({path:String})} delegate - is used to change atlas path, e.g. to load `atlas.tga` instead of `atlas.png`\n * @return {gaf.Asset}\n */\ngaf.Asset.create = function (gafFilePath, delegate)\n{\n    return new gaf.Asset(gafFilePath, delegate);\n};\n\n/**\n * @method createWithBundle\n * @param {String} zipFilePath - path to the archive with .gaf and its textures\n * @param {String} entryFile - name of the .gaf file in archive\n * @param {function({path:String})} delegate - is used to change atlas path, e.g. to load `atlas.tga` instead of `atlas.png`\n * @return {gaf.Asset}\n */\ngaf.Asset.createWithBundle = function (zipFilePath, entryFile, delegate)\n{\n    var asset = new gaf.Asset();\n    asset.initWithGAFBundle(zipFilePath, entryFile, delegate);\n    return asset;\n};\n\ncc.EventHelper.prototype.apply(gaf.Asset.prototype);\n"]}