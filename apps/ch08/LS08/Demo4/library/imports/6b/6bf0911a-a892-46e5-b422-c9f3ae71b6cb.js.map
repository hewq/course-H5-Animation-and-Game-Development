{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library/assets/frameworks/cocos2d-html5/external/gaf/Library/GAFTimeLine.js"],"names":["gaf","TimeLine","Object","extend","_className","_objects","_container","_animationStartedNextLoopDelegate","_animationFinishedPlayDelegate","_framePlayedDelegate","_sequenceDelegate","_fps","_frameTime","_currentSequenceStart","FIRST_FRAME_INDEX","_currentSequenceEnd","_totalFrameCount","_isRunning","_isLooped","_isReversed","_timeDelta","_animationsSelectorScheduled","_currentFrame","setAnimationStartedNextLoopDelegate","delegate","setAnimationFinishedPlayDelegate","setLooped","looped","recursively","forEach","item","getBoundingBoxForCurrentFrame","result","isFirstObj","isVisibleInCurrentFrame","isVisible","bb","getBoundingBox","cc","rectUnion","_rectApplyAffineTransformIn","getNodeToParentTransform","setFps","fps","assert","getObjectByName","name","elements","split","retId","timeLine","BreakException","element","parts","_gafproto","getNamedParts","hasOwnProperty","lastElement","e","log","clearSequence","getTotalFrames","getIsAnimationRunning","gotoAndStop","value","frame","getStartFrame","setFrame","setAnimationRunning","gotoAndPlay","frameLabel","seq","getSequences","start","IDNONE","getEndFrame","end","setFramePlayedDelegate","getCurrentFrameIndex","_showingFrame","getTotalFrameCount","_enableTick","stop","isDone","playSequence","s","resumeAnimation","isReversed","setSequenceDelegate","index","_processAnimation","pauseAnimation","isLooped","setReversed","reversed","hasSequences","length","getFps","ctor","gafTimeLineProto","scale","_super","setExternalTransform","affineTransform","affineTransformEqualToTransform","_additionalTransform","setAdditionalTransform","_init","setContentSize","Node","addChild","self","asset","getAsset","getObjects","object","objectProto","_getProtos","type","_gafConstruct","val","schedule","_processAnimations","unschedule","dt","_step","_getSequenceByLastFrame","_getSequenceByFirstFrame","_isCurrentFrameLastInSequence","_nextFrame","_realizeFrame","out","frameIndex","objects","frames","getFrames","currentFrame","states","stateIdx","total","state","objectIdRef","alpha","_resetState","_updateVisibility","_applyState","parent","hasMask","maskObjectIdRef","_getNode","_lastVisibleInFrame","rearrangeSubobject","depth","obj","sequences","getParent","removeFromParent","setLocalZOrder"],"mappings":"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","file":"GAFTimeLine.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library","sourcesContent":["\ngaf.TimeLine = gaf.Object.extend\n({\n    _className: \"GAFTimeLine\",\n    _objects: null,\n    _container: null,\n    _animationStartedNextLoopDelegate: null,\n    _animationFinishedPlayDelegate: null,\n    _framePlayedDelegate: null,\n    _sequenceDelegate: null,\n    _fps: 60,\n    _frameTime: 1/60,\n    _currentSequenceStart: gaf.FIRST_FRAME_INDEX,\n    _currentSequenceEnd: gaf.FIRST_FRAME_INDEX,\n    _totalFrameCount: 0,\n    _isRunning: false,\n    _isLooped: false,\n    _isReversed: false,\n    _timeDelta: 0,\n    _animationsSelectorScheduled: false,\n    _currentFrame: gaf.FIRST_FRAME_INDEX,\n\n\n    setAnimationStartedNextLoopDelegate: function (delegate)\n    {\n        this._animationStartedNextLoopDelegate = delegate;\n    },\n    setAnimationFinishedPlayDelegate: function (delegate)\n    {\n        this._animationFinishedPlayDelegate = delegate;\n    },\n    setLooped: function (looped, recursively)\n    {\n        this._isLooped = looped;\n        if (recursively)\n        {\n            this._objects.forEach(function (item)\n            {\n                item.setLooped(looped, recursively);\n            });\n        }\n    },\n    getBoundingBoxForCurrentFrame: function ()\n    {\n        var result = null;//cc.rect();\n        var isFirstObj = true;\n        this._objects.forEach(function (item) {\n            if(item.isVisibleInCurrentFrame() && item.isVisible())\n            {\n                var bb = item.getBoundingBoxForCurrentFrame();\n                if(!bb)\n                {\n                    bb = item.getBoundingBox();\n                }\n                if (isFirstObj)\n                {\n                    isFirstObj = false;\n                    result = bb;\n                }\n                else\n                {\n                    result = cc.rectUnion(result, bb);\n                }\n            }\n        });\n        return cc._rectApplyAffineTransformIn(result, this._container.getNodeToParentTransform());\n    },\n    setFps: function (fps)\n    {\n        cc.assert(fps !== 0, 'Error! Fps is set to zero.');\n        this._fps = fps;\n        this._frameTime = 1/fps;\n    },\n    getObjectByName: function (name)\n    {\n        var elements = name.split('.');\n        var result = null;\n        var retId = -1;\n        var timeLine = this;\n        var BreakException = {};\n        try\n        {\n            elements.forEach(function(element)\n            {\n                var parts = timeLine._gafproto.getNamedParts();\n                if(parts.hasOwnProperty(element))\n                {\n                    retId = parts[element];\n                }\n                else\n                {\n                    // Sequence is incorrect\n                    BreakException.lastElement = element;\n                    throw BreakException;\n                }\n                result = timeLine._objects[retId];\n                timeLine = result;\n            });\n        }\n        catch (e)\n        {\n            if (e!==BreakException)\n            {\n                throw e;\n            }\n            cc.log(\"Sequence incorrect: `\" + name + \"` At: `\" + BreakException.lastElement + \"`\");\n            return null;\n        }\n        return result;\n    },\n    clearSequence: function ()\n    {\n        this._currentSequenceStart = gaf.FIRST_FRAME_INDEX;\n        this._currentSequenceEnd = this._gafproto.getTotalFrames();\n    },\n    getIsAnimationRunning: function ()\n    {\n        return this._isRunning;\n    },\n    gotoAndStop: function (value)\n    {\n        var frame = 0;\n        if (typeof value === 'string')\n        {\n            frame = this.getStartFrame(value);\n        }\n        else\n        {\n            frame = value;\n        }\n        if (this.setFrame(frame))\n        {\n            this.setAnimationRunning(false, false);\n            return true;\n        }\n        return false;\n    },\n    gotoAndPlay: function (value)\n    {\n        var frame = 0;\n        if (typeof value === 'string')\n        {\n            frame = this.getStartFrame(value);\n        }\n        else\n        {\n            frame = value;\n        }\n        if (this.setFrame(frame))\n        {\n            this.setAnimationRunning(true, false);\n            return true;\n        }\n        return false;\n    },\n    getStartFrame: function (frameLabel)\n    {\n        var seq = this._gafproto.getSequences()[frameLabel];\n        if (seq)\n        {\n            return seq.start;\n        }\n        return gaf.IDNONE;\n    },\n    getEndFrame: function (frameLabel)\n    {\n        var seq = this._gafproto.getSequences()[frameLabel];\n        if (seq)\n        {\n            return seq.end;\n        }\n        return gaf.IDNONE;\n    },\n    setFramePlayedDelegate: function (delegate)\n    {\n        this._framePlayedDelegate = delegate;\n    },\n    getCurrentFrameIndex: function ()\n    {\n        return this._showingFrame;\n    },\n    getTotalFrameCount: function ()\n    {\n        return this._gafproto.getTotalFrames();\n    },\n    start: function ()\n    {\n        this._enableTick(true);\n        if (!this._isRunning)\n        {\n            this._currentFrame = gaf.FIRST_FRAME_INDEX;\n            this.setAnimationRunning(true, true);\n        }\n    },\n    stop: function ()\n    {\n        this._enableTick(false);\n        if (this._isRunning)\n        {\n            this._currentFrame = gaf.FIRST_FRAME_INDEX;\n            this.setAnimationRunning(false, true);\n        }\n    },\n    isDone: function ()\n    {\n        if (this._isLooped)\n        {\n            return false;\n        }\n        else\n        {\n            if (!this._isReversed)\n            {\n                return this._currentFrame > this._totalFrameCount;\n            }\n            else\n            {\n                return this._currentFrame < gaf.FIRST_FRAME_INDEX - 1;\n            }\n        }\n    },\n    getSequences: function()\n    {\n        return this._gafproto.getSequences();\n    },\n    playSequence: function (name, looped)\n    {\n        var s = this.getStartFrame(name);\n        var e = this.getEndFrame(name);\n        if (gaf.IDNONE === s || gaf.IDNONE === e)\n        {\n            return false;\n        }\n        this._currentSequenceStart = s;\n        this._currentSequenceEnd = e;\n        if (this._currentFrame < this._currentSequenceStart || this._currentFrame > this._currentSequenceEnd)\n        {\n            this._currentFrame = this._currentSequenceStart;\n        }\n        else\n        {\n            this._currentFrame = this._currentSequenceStart;\n        }\n        this.setLooped(looped, false);\n        this.resumeAnimation();\n        return true;\n    },\n    isReversed: function ()\n    {\n        return this._isReversed;\n    },\n    setSequenceDelegate: function (delegate)\n    {\n        this._sequenceDelegate = delegate;\n    },\n    setFrame: function (index)\n    {\n        if (index >= gaf.FIRST_FRAME_INDEX && index < this._totalFrameCount)\n        {\n            this._showingFrame = index;\n            this._currentFrame = index;\n            this._processAnimation();\n            return true;\n        }\n        return false;\n    },\n\n    pauseAnimation: function ()\n    {\n        if (this._isRunning)\n        {\n            this.setAnimationRunning(false, false);\n        }\n    },\n    isLooped: function ()\n    {\n        return this._isLooped;\n    },\n    resumeAnimation: function ()\n    {\n        if (!this._isRunning)\n        {\n            this.setAnimationRunning(true, false);\n        }\n    },\n    setReversed: function (reversed)\n    {\n        this._isReversed = reversed;\n    },\n    hasSequences: function ()\n    {\n        return this._gafproto.getSequences().length > 0;\n    },\n    getFps: function ()\n    {\n        return this._fps;\n    },\n\n\n    // Private\n\n    ctor: function(gafTimeLineProto, scale)\n    {\n        this._super(scale);\n        this._objects = [];\n        cc.assert(gafTimeLineProto,  \"Error! Missing mandatory parameter.\");\n        this._gafproto = gafTimeLineProto;\n    },\n\n    setExternalTransform: function(affineTransform)\n    {\n        if(!cc.affineTransformEqualToTransform(this._container._additionalTransform, affineTransform))\n        {\n           this._container.setAdditionalTransform(affineTransform);\n        }\n    },\n\n    _init: function()\n    {\n        this.setContentSize(this._gafproto.getBoundingBox());\n        this._currentSequenceEnd = this._gafproto.getTotalFrames();\n        this._totalFrameCount = this._currentSequenceEnd;\n        this.setFps(this._gafproto.getFps());\n        this._container = new cc.Node();\n        this.addChild(this._container);\n\n        var self = this;\n        var asset = this._gafproto.getAsset();\n\n        // Construct objects for current time line\n        this._gafproto.getObjects().forEach(function(object)\n        {\n            var objectProto = asset._getProtos()[object];\n            cc.assert(objectProto, \"Error. GAF proto for type: \" + object.type + \" and reference id: \" + object + \" not found.\");\n            self._objects[object] = objectProto._gafConstruct();\n        });\n    },\n\n    _enableTick: function(val)\n    {\n        if (!this._animationsSelectorScheduled && val)\n        {\n            this.schedule(this._processAnimations);\n            this._animationsSelectorScheduled = true;\n        }\n        else if (this._animationsSelectorScheduled && !val)\n        {\n            this.unschedule(this._processAnimations);\n            this._animationsSelectorScheduled = false;\n        }\n    },\n\n    _processAnimations: function (dt)\n    {\n        this._timeDelta += dt;\n        while (this._timeDelta >= this._frameTime)\n        {\n            this._timeDelta -= this._frameTime;\n            this._step();\n        }\n    },\n\n    _step: function ()\n    {\n        this._showingFrame = this._currentFrame;\n\n        if(!this.getIsAnimationRunning())\n        {\n            this._processAnimation();\n            return;\n        }\n\n        if(this._sequenceDelegate)\n        {\n            var seq;\n            if(!this._isReversed)\n            {\n                seq = this._getSequenceByLastFrame(this._currentFrame);\n            }\n            else\n            {\n                seq = this._getSequenceByFirstFrame(this._currentFrame + 1);\n            }\n\n            if (seq)\n            {\n                this._sequenceDelegate(this, seq);\n            }\n        }\n        if (this._isCurrentFrameLastInSequence())\n        {\n            if(this._isLooped)\n            {\n                if(this._animationStartedNextLoopDelegate)\n                    this._animationStartedNextLoopDelegate(this);\n            }\n            else\n            {\n                this.setAnimationRunning(false, false);\n                if(this._animationFinishedPlayDelegate)\n                    this._animationFinishedPlayDelegate(this);\n            }\n        }\n        this._processAnimation();\n        this._currentFrame = this._nextFrame();\n    },\n\n    _isCurrentFrameLastInSequence: function()\n    {\n        if (this._isReversed)\n            return this._currentFrame == this._currentSequenceStart;\n        return this._currentFrame == this._currentSequenceEnd - 1;\n    },\n\n    _nextFrame: function()\n    {\n        if (this._isCurrentFrameLastInSequence())\n        {\n            if (!this._isLooped)\n                return this._currentFrame;\n\n            if (this._isReversed)\n                return this._currentSequenceEnd - 1;\n            else\n                return this._currentSequenceStart;\n        }\n\n        return this._currentFrame + (this._isReversed ? -1 : 1);\n    },\n\n    _processAnimation: function ()\n    {\n        //var id = this._gafproto.getId();\n        this._realizeFrame(this._container, this._currentFrame);\n        if (this._framePlayedDelegate)\n        {\n            this._framePlayedDelegate(this, this._currentFrame);\n        }\n    },\n    _realizeFrame: function(out, frameIndex)\n    {\n        var self = this;\n        var objects = self._objects;\n        var frames = self._gafproto.getFrames();\n        if(frameIndex > frames.length)\n        {\n            return;\n        }\n        var currentFrame = frames[frameIndex];\n        if(!currentFrame)\n        {\n            return;\n        }\n        var states = currentFrame.states;\n        for(var stateIdx = 0, total = states.length; stateIdx < total; ++stateIdx)\n        {\n            var state = states[stateIdx];\n            var object = objects[state.objectIdRef];\n            if(!object)\n            {\n                return;\n            }\n            if(state.alpha < 0)\n            {\n                object._resetState();\n            }\n            object._updateVisibility(state, self);\n            if(!object.isVisible())\n            {\n                continue;\n            }\n            object._applyState(state, self);\n            var parent = out;\n            if(state.hasMask)\n            {\n                parent = objects[state.maskObjectIdRef]._getNode();\n                cc.assert(parent, \"Error! Mask not found.\");\n            }\n            object._lastVisibleInFrame = 1 + frameIndex;\n            gaf.TimeLine.rearrangeSubobject(parent, object, state.depth);\n            if(object._step)\n            {\n                object._step();\n            }\n        }\n    },\n    setAnimationRunning: function (value, recursively)\n    {\n        this._isRunning = value;\n        if(recursively)\n        {\n            this._objects.forEach(function (obj)\n            {\n                if (obj && obj.setAnimationRunning)\n                {\n                    obj.setAnimationRunning(value, recursively);\n                }\n            });\n        }\n    },\n\n    _getSequenceByLastFrame: function(){\n        var sequences = this._gafproto.getSequences();\n        for(var item in sequences){\n            if(sequences.hasOwnProperty(item)){\n                if(sequences[item].end === frame + 1)\n                {\n                    return item;\n                }\n            }\n        }\n        return \"\";\n    },\n\n    _resetState : function()\n    {\n        this._super();\n        this._currentFrame = this._currentSequenceStart;\n    },\n\n    _getSequenceByFirstFrame: function(){\n        var sequences = this._gafproto.getSequences();\n        for(var item in sequences){\n            if(sequences.hasOwnProperty(item)){\n                if(sequences[item].start === frame)\n                {\n                    return item;\n                }\n            }\n        }\n        return \"\";\n    }\n});\n\ngaf.TimeLine.rearrangeSubobject = function(out, object, depth)\n{\n    var parent = object.getParent();\n    if (parent !== out)\n    {\n        object.removeFromParent(false);\n        out.addChild(object, depth);\n    }\n    else\n    {\n        object.setLocalZOrder(depth);\n    }\n};\n"]}