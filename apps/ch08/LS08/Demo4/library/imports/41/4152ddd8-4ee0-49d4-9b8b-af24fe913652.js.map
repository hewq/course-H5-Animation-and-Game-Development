{"version":3,"sources":["../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/root.js"],"names":["RootActor","aConnection","aParameters","conn","_parameters","_onTabListChanged","onTabListChanged","bind","_onAddonListChanged","onAddonListChanged","_extraActors","_globalActorPool","ActorPool","addActorPool","_chromeActor","prototype","constructor","applicationType","traits","sources","editOuterHTML","pasteHTML","highlightable","customHighlighters","urlToImageDataResolver","networkMonitor","storageInspector","storageInspectorReadOnly","conditionalBreakpoints","debuggerSourceActors","bulk","selectorEditable","addNewRule","getUniqueSelector","directorScripts","noBlackBoxing","noPrettyPrinting","getUsedFontFaces","memoryActorAllocations","noNeedToFakeResumptionOnNavigation","webConsoleCommands","allowChromeProcess","DebuggerServer","profilerDataFilterable","sayHello","from","actorID","testConnectionPrefix","prefix","disconnect","tabList","onListChanged","addonList","onShutdown","_tabActorPool","onListTabs","error","message","newActorPool","tabActorList","selected","getList","then","tabActors","tabActor","length","parentID","addActor","push","removeActorPool","reply","map","actor","form","url","onGetTab","options","getTab","tab","send","type","onListAddons","addonActors","addonActorPool","addonActor","_addonActorPool","onListProcesses","processes","i","ppmm","childCount","id","parent","tabCount","undefined","onGetProcess","aRequest","require","ChromeActor","mm","getChildAt","connectToContent","onEcho","Cu","cloneInto","onProtocolDescription","dumpProtocolSpec","removeActorByName","aName","has","removeActor","forEach","requestTypes"],"mappings":"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","file":"root.js","sourceRoot":"../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors","sourcesContent":["/****************************************************************************\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n \n http://www.cocos2d-x.org\n \n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n \n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n \n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */\n/* vim: set ft=javascript ts=2 et sw=2 tw=80: */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n\"use strict\";\n\n// const { Cc, Ci, Cu } = require(\"chrome\");\n// const Services = require(\"Services\");\n// const { ActorPool, appendExtraActors, createExtraActors } = require(\"devtools/server/actors/common\");\n// const { DebuggerServer } = require(\"devtools/server/main\");\n\n// loader.lazyGetter(this, \"ppmm\", () => {\n//   return Cc[\"@mozilla.org/parentprocessmessagemanager;1\"].getService(Ci.nsIMessageBroadcaster);\n// });\n\n/* Root actor for the remote debugging protocol. */\n\n/**\n * Create a remote debugging protocol root actor.\n *\n * @param aConnection\n *     The DebuggerServerConnection whose root actor we are constructing.\n *\n * @param aParameters\n *     The properties of |aParameters| provide backing objects for the root\n *     actor's requests; if a given property is omitted from |aParameters|, the\n *     root actor won't implement the corresponding requests or notifications.\n *     Supported properties:\n *\n *     - tabList: a live list (see below) of tab actors. If present, the\n *       new root actor supports the 'listTabs' request, providing the live\n *       list's elements as its tab actors, and sending 'tabListChanged'\n *       notifications when the live list's contents change. One actor in\n *       this list must have a true '.selected' property.\n *\n *     - addonList: a live list (see below) of addon actors. If present, the\n *       new root actor supports the 'listAddons' request, providing the live\n *       list's elements as its addon actors, and sending 'addonListchanged'\n *       notifications when the live list's contents change.\n *\n *     - globalActorFactories: an object |A| describing further actors to\n *       attach to the 'listTabs' reply. This is the type accumulated by\n *       DebuggerServer.addGlobalActor. For each own property |P| of |A|,\n *       the root actor adds a property named |P| to the 'listTabs'\n *       reply whose value is the name of an actor constructed by\n *       |A[P]|.\n *\n *     - onShutdown: a function to call when the root actor is disconnected.\n *\n * Instance properties:\n *\n * - applicationType: the string the root actor will include as the\n *      \"applicationType\" property in the greeting packet. By default, this\n *      is \"browser\".\n *\n * Live lists:\n *\n * A \"live list\", as used for the |tabList|, is an object that presents a\n * list of actors, and also notifies its clients of changes to the list. A\n * live list's interface is two properties:\n *\n * - getList: a method that returns a promise to the contents of the list.\n *\n * - onListChanged: a handler called, with no arguments, when the set of\n *             values the iterator would produce has changed since the last\n *             time 'iterator' was called. This may only be set to null or a\n *             callable value (one for which the typeof operator returns\n *             'function'). (Note that the live list will not call the\n *             onListChanged handler until the list has been iterated over\n *             once; if nobody's seen the list in the first place, nobody\n *             should care if its contents have changed!)\n *\n * When the list changes, the list implementation should ensure that any\n * actors yielded in previous iterations whose referents (tabs) still exist\n * get yielded again in subsequent iterations. If the underlying referent\n * is the same, the same actor should be presented for it.\n *\n * The root actor registers an 'onListChanged' handler on the appropriate\n * list when it may need to send the client 'tabListChanged' notifications,\n * and is careful to remove the handler whenever it does not need to send\n * such notifications (including when it is disconnected). This means that\n * live list implementations can use the state of the handler property (set\n * or null) to install and remove observers and event listeners.\n *\n * Note that, as the only way for the root actor to see the members of the\n * live list is to begin an iteration over the list, the live list need not\n * actually produce any actors until they are reached in the course of\n * iteration: alliterative lazy live lists.\n */\n\nfunction RootActor(aConnection, aParameters) {\n  this.conn = aConnection;\n  this._parameters = aParameters;\n  this._onTabListChanged = this.onTabListChanged.bind(this);\n  this._onAddonListChanged = this.onAddonListChanged.bind(this);\n  this._extraActors = {};\n\n  this._globalActorPool = new ActorPool(this.conn);\n  this.conn.addActorPool(this._globalActorPool);\n\n  this._chromeActor = null;\n}\n\nRootActor.prototype = {\n  constructor: RootActor,\n  applicationType: \"browser\",\n\n  traits: {\n    sources: true,\n    // Whether the inspector actor allows modifying outer HTML.\n    editOuterHTML: true,\n    // Whether the inspector actor allows modifying innerHTML and inserting\n    // adjacent HTML.\n    pasteHTML: true,\n    // Whether the server-side highlighter actor exists and can be used to\n    // remotely highlight nodes (see server/actors/highlighters.js)\n    highlightable: true,\n    // Which custom highlighter does the server-side highlighter actor supports?\n    // (see server/actors/highlighters.js)\n    customHighlighters: true,\n    // Whether the inspector actor implements the getImageDataFromURL\n    // method that returns data-uris for image URLs. This is used for image\n    // tooltips for instance\n    urlToImageDataResolver: true,\n    networkMonitor: true,\n    // Whether the storage inspector actor to inspect cookies, etc.\n    storageInspector: true,\n    // Whether storage inspector is read only\n    storageInspectorReadOnly: true,\n    // Whether conditional breakpoints are supported\n    conditionalBreakpoints: true,\n    // Whether the server supports full source actors (breakpoints on\n    // eval scripts, etc)\n    debuggerSourceActors: true,\n    bulk: true,\n    // Whether the style rule actor implements the modifySelector method\n    // that modifies the rule's selector\n    selectorEditable: true,\n    // Whether the page style actor implements the addNewRule method that\n    // adds new rules to the page\n    addNewRule: true,\n    // Whether the dom node actor implements the getUniqueSelector method\n    getUniqueSelector: true,\n    // Whether the director scripts are supported\n    directorScripts: true,\n    // Whether the debugger server supports\n    // blackboxing/pretty-printing (not supported in Fever Dream yet)\n    noBlackBoxing: false,\n    noPrettyPrinting: false,\n    // Whether the page style actor implements the getUsedFontFaces method\n    // that returns the font faces used on a node\n    getUsedFontFaces: true,\n    // Trait added in Gecko 38, indicating that all features necessary for\n    // grabbing allocations from the MemoryActor are available for the performance tool\n    memoryActorAllocations: true,\n    // Added in Gecko 40, indicating that the backend isn't stupid about\n    // sending resumption packets on tab navigation.\n    noNeedToFakeResumptionOnNavigation: true,\n    // Added in Firefox 40. Indicates that the backend supports registering custom\n    // commands through the WebConsoleCommands API.\n    webConsoleCommands: true,\n    // Whether root actor exposes tab actors\n    // if allowChromeProcess is true, you can fetch a ChromeActor instance\n    // to debug chrome and any non-content ressource via getProcess request\n    // if allocChromeProcess is defined, but not true, it means that root actor\n    // no longer expose tab actors, but also that getProcess forbids\n    // exposing actors for security reasons\n    get allowChromeProcess() {\n      return DebuggerServer.allowChromeProcess;\n    },\n    // Whether or not `getProfile()` supports specifying a `startTime`\n    // and `endTime` to filter out samples. Fx40+\n    profilerDataFilterable: true,\n  },\n\n  /**\n   * Return a 'hello' packet as specified by the Remote Debugging Protocol.\n   */\n  sayHello: function() {\n    return {\n      from: this.actorID,\n      applicationType: this.applicationType,\n      /* This is not in the spec, but it's used by tests. */\n      testConnectionPrefix: this.conn.prefix,\n      traits: this.traits\n    };\n  },\n\n  /**\n   * Disconnects the actor from the browser window.\n   */\n  disconnect: function() {\n    /* Tell the live lists we aren't watching any more. */\n    if (this._parameters.tabList) {\n      this._parameters.tabList.onListChanged = null;\n    }\n    if (this._parameters.addonList) {\n      this._parameters.addonList.onListChanged = null;\n    }\n    if (typeof this._parameters.onShutdown === 'function') {\n      this._parameters.onShutdown();\n    }\n    this._extraActors = null;\n    this.conn = null;\n    this._tabActorPool = null;\n    this._globalActorPool = null;\n    this._parameters = null;\n    this._chromeActor = null;\n  },\n\n  /* The 'listTabs' request and the 'tabListChanged' notification. */\n\n  /**\n   * Handles the listTabs request. The actors will survive until at least\n   * the next listTabs request.\n   */\n  onListTabs: function() {\n    let tabList = this._parameters.tabList;\n    if (!tabList) {\n      return { from: this.actorID, error: \"noTabs\",\n               message: \"This root actor has no browser tabs.\" };\n    }\n\n    /*\n     * Walk the tab list, accumulating the array of tab actors for the\n     * reply, and moving all the actors to a new ActorPool. We'll\n     * replace the old tab actor pool with the one we build here, thus\n     * retiring any actors that didn't get listed again, and preparing any\n     * new actors to receive packets.\n     */\n    let newActorPool = new ActorPool(this.conn);\n    let tabActorList = [];\n    let selected;\n    return tabList.getList().then((tabActors) => {\n      for (let tabActor of tabActors) {\n        if (tabActor.selected) {\n          selected = tabActorList.length;\n        }\n        tabActor.parentID = this.actorID;\n        newActorPool.addActor(tabActor);\n        tabActorList.push(tabActor);\n      }\n      /* DebuggerServer.addGlobalActor support: create actors. */\n      if (!this._globalActorPool) {\n        this._globalActorPool = new ActorPool(this.conn);\n        this.conn.addActorPool(this._globalActorPool);\n      }\n      // this._createExtraActors(this._parameters.globalActorFactories, this._globalActorPool);\n      /*\n       * Drop the old actorID -> actor map. Actors that still mattered were\n       * added to the new map; others will go away.\n       */\n      if (this._tabActorPool) {\n        this.conn.removeActorPool(this._tabActorPool);\n      }\n      this._tabActorPool = newActorPool;\n      this.conn.addActorPool(this._tabActorPool);\n\n      let reply = {\n        \"from\": this.actorID,\n        \"selected\": selected || 0,\n        \"tabs\": tabActorList.map(actor => actor.form())\n      };\n\n      /* If a root window is accessible, include its URL. */\n      if (this.url) {\n        reply.url = this.url;\n      }\n\n      /* DebuggerServer.addGlobalActor support: name actors in 'listTabs' reply. */\n      // this._appendExtraActors(reply);\n\n      /*\n       * Now that we're actually going to report the contents of tabList to\n       * the client, we're responsible for letting the client know if it\n       * changes.\n       */\n      tabList.onListChanged = this._onTabListChanged;\n\n      return reply;\n    });\n  },\n\n  onGetTab: function (options) {\n    let tabList = this._parameters.tabList;\n    if (!tabList) {\n      return { error: \"noTabs\",\n               message: \"This root actor has no browser tabs.\" };\n    }\n    if (!this._tabActorPool) {\n      this._tabActorPool = new ActorPool(this.conn);\n      this.conn.addActorPool(this._tabActorPool);\n    }\n    return tabList.getTab(options)\n                  .then(tabActor => {\n      tabActor.parentID = this.actorID;\n      this._tabActorPool.addActor(tabActor);\n\n      return { tab: tabActor.form() };\n    }, error => {\n      if (error.error) {\n        // Pipe expected errors as-is to the client\n        return error;\n      } else {\n        return { error: \"noTab\",\n                 message: \"Unexpected error while calling getTab(): \" + error };\n      }\n    });\n  },\n\n  onTabListChanged: function () {\n    this.conn.send({ from: this.actorID, type:\"tabListChanged\" });\n    /* It's a one-shot notification; no need to watch any more. */\n    this._parameters.tabList.onListChanged = null;\n  },\n\n  onListAddons: function () {\n    let addonList = this._parameters.addonList;\n    if (!addonList) {\n      return { from: this.actorID, error: \"noAddons\",\n               message: \"This root actor has no browser addons.\" };\n    }\n\n    return addonList.getList().then((addonActors) => {\n      let addonActorPool = new ActorPool(this.conn);\n      for (let addonActor of addonActors) {\n          addonActorPool.addActor(addonActor);\n      }\n\n      if (this._addonActorPool) {\n        this.conn.removeActorPool(this._addonActorPool);\n      }\n      this._addonActorPool = addonActorPool;\n      this.conn.addActorPool(this._addonActorPool);\n\n      addonList.onListChanged = this._onAddonListChanged;\n\n      return {\n        \"from\": this.actorID,\n        \"addons\": addonActors.map(addonActor => addonActor.form())\n      };\n    });\n  },\n\n  onAddonListChanged: function () {\n    this.conn.send({ from: this.actorID, type: \"addonListChanged\" });\n    this._parameters.addonList.onListChanged = null;\n  },\n\n  onListProcesses: function () {\n    let processes = [];\n    for (let i = 0; i < ppmm.childCount; i++) {\n      processes.push({\n        id: i, // XXX: may not be a perfect id, but process message manager doesn't expose anything...\n        parent: i == 0, // XXX Weak, but appear to be stable\n        tabCount: undefined, // TODO: exposes process message manager on frameloaders in order to compute this\n      });\n    }\n    return { processes: processes };\n  },\n\n  onGetProcess: function (aRequest) {\n    if (!DebuggerServer.allowChromeProcess) {\n      return { error: \"forbidden\",\n               message: \"You are not allowed to debug chrome.\" };\n    }\n    if ((\"id\" in aRequest) && typeof(aRequest.id) != \"number\") {\n      return { error: \"wrongParameter\",\n               message: \"getProcess requires a valid `id` attribute.\" };\n    }\n    // If the request doesn't contains id parameter or id is 0\n    // (id == 0, based on onListProcesses implementation)\n    if ((!(\"id\" in aRequest)) || aRequest.id === 0) {\n      if (!this._chromeActor) {\n        // Create a ChromeActor for the parent process\n        let { ChromeActor } = require(\"devtools/server/actors/chrome\");\n        this._chromeActor = new ChromeActor(this.conn);\n        this._globalActorPool.addActor(this._chromeActor);\n      }\n\n      return { form: this._chromeActor.form() };\n    } else {\n      let mm = ppmm.getChildAt(aRequest.id);\n      if (!mm) {\n        return { error: \"noProcess\",\n                 message: \"There is no process with id '\" + aRequest.id + \"'.\" };\n      }\n      return DebuggerServer.connectToContent(this.conn, mm)\n                           .then(form => ({ form }));\n    }\n  },\n\n  /* This is not in the spec, but it's used by tests. */\n  onEcho: function (aRequest) {\n    /*\n     * Request packets are frozen. Copy aRequest, so that\n     * DebuggerServerConnection.onPacket can attach a 'from' property.\n     */\n    return Cu.cloneInto(aRequest, {});\n  },\n\n  onProtocolDescription: function () {\n    return require(\"devtools/server/protocol\").dumpProtocolSpec();\n  },\n\n  /* Support for DebuggerServer.addGlobalActor. */\n  // _createExtraActors: createExtraActors,\n  // _appendExtraActors: appendExtraActors,\n\n  /**\n   * Remove the extra actor (added by DebuggerServer.addGlobalActor or\n   * DebuggerServer.addTabActor) name |aName|.\n   */\n  removeActorByName: function(aName) {\n    if (aName in this._extraActors) {\n      const actor = this._extraActors[aName];\n      if (this._globalActorPool.has(actor)) {\n        this._globalActorPool.removeActor(actor);\n      }\n      if (this._tabActorPool) {\n        // Iterate over TabActor instances to also remove tab actors\n        // created during listTabs for each document.\n        this._tabActorPool.forEach(tab => {\n          tab.removeActorByName(aName);\n        });\n      }\n      delete this._extraActors[aName];\n    }\n   }\n};\n\nRootActor.prototype.requestTypes = {\n  \"listTabs\": RootActor.prototype.onListTabs,\n  \"getTab\": RootActor.prototype.onGetTab,\n  \"listAddons\": RootActor.prototype.onListAddons,\n  \"listProcesses\": RootActor.prototype.onListProcesses,\n  \"getProcess\": RootActor.prototype.onGetProcess,\n  \"echo\": RootActor.prototype.onEcho,\n  \"protocolDescription\": RootActor.prototype.onProtocolDescription\n};\n\n// exports.RootActor = RootActor;\n"]}