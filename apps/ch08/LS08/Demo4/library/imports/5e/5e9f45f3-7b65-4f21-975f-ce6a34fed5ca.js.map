{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/labelttf/assets/frameworks/cocos2d-html5/cocos2d/core/labelttf/CCLabelTTF.js"],"names":["cc","LabelTTF","Sprite","extend","_dimensions","_hAlignment","TEXT_ALIGNMENT_CENTER","_vAlignment","VERTICAL_TEXT_ALIGNMENT_TOP","_fontName","_fontSize","_string","_originalText","_onCacheCanvasMode","_shadowEnabled","_shadowOffset","_shadowOpacity","_shadowBlur","_shadowColor","_strokeEnabled","_strokeColor","_strokeSize","_textFillColor","_strokeShadowOffsetX","_strokeShadowOffsetY","_needUpdateTexture","_lineWidths","_className","_fontStyle","_fontWeight","_lineHeight","initWithString","label","fontName","fontSize","dimensions","hAlignment","vAlignment","strInfo","size","TEXT_ALIGNMENT_LEFT","_opacityModifyRGB","width","height","_renderCmd","_setFontStyle","string","_setColorsString","_updateTexture","_setUpdateTextureDirty","_scaleX","_scaleY","view","getDevicePixelRatio","setDirtyFlag","Node","_dirtyFlags","textDirty","ctor","text","prototype","call","p","color","_textureLoaded","FontDefinition","initWithStringAndTextDefinition","init","description","toFixed","getLineHeight","charAt","_getFontClientHeight","setLineHeight","lineHeight","getString","getHorizontalAlignment","getVerticalAlignment","getDimensions","getFontSize","getFontName","textDefinition","_updateWithTextDefinition","setTextDefinition","theDefinition","getTextDefinition","_prepareTextDefinition","enableShadow","a","b","c","d","r","g","_enableShadow","_enableShadowNoneColor","shadowOffsetX","shadowOffsetY","shadowOpacity","shadowBlur","locShadowOffset","x","_y","y","shadowColor","offset","blurRadius","_getShadowOffsetX","_setShadowOffsetX","_getShadowOffsetY","_setShadowOffsetY","_getShadowOffset","_setShadowOffset","_getShadowOpacity","_setShadowOpacity","_getShadowBlur","_setShadowBlur","disableShadow","enableStroke","strokeColor","strokeSize","locStrokeColor","_getStrokeStyle","_setStrokeStyle","strokeStyle","_getLineWidth","_setLineWidth","lineWidth","disableStroke","setFontFillColor","fillColor","locTextFillColor","_getFillStyle","mustUpdateTexture","fontDimensions","boundingWidth","boundingHeight","textAlign","verticalAlign","shadowEnabled","strokeEnabled","fillStyle","flags","colorDirty","opacityDirty","adjustForResolution","texDef","contentScaleFactor","getScale","log","_LogInfos","Node_getScale","setScale","scale","scaleY","ratio","transformDirty","getScaleX","setScaleX","newScaleX","getScaleY","setScaleY","newScaleY","setString","String","_updateString","renderer","childrenOrderDirty","setHorizontalAlignment","alignment","setVerticalAlignment","verticalAlignment","setDimensions","dim","undefined","_getBoundingWidth","_setBoundingWidth","_getBoundingHeight","_setBoundingHeight","setFontSize","setFontName","_getFont","_getFontStyle","_setFont","fontStyle","res","_fontStyleRE","exec","parseInt","getContentSize","_updateTTF","_contentSize","_getWidth","_getHeight","setTextureRect","rect","rotated","untrimmedSize","_t","_rectRotated","setContentSize","locRect","_rect","_setTextureCoords","relativeOffsetX","_unflippedOffsetPositionFromCenter","relativeOffsetY","_flippedX","_flippedY","_offsetPosition","setDrawMode","onCacheMode","_createRenderCmd","_renderType","game","RENDER_TYPE_WEBGL","WebGLRenderCmd","CacheCanvasRenderCmd","CanvasRenderCmd","_setFontWeight","fontWeight","_getFontWeight","assert","isFunction","_tmp","PrototypeLabelTTF","MissingFile","create","createWithFontDefinition","__labelHeightDiv","document","createElement","style","fontFamily","position","left","top","body","appendChild","window","addEventListener","removeEventListener","arguments","callee","__getFontHeightByDiv","clientHeight","labelDiv","fontDef","__fontHeightCache","_getCanvasFontStr","innerHTML"],"mappings":"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","file":"CCLabelTTF.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/labelttf","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * <p>cc.LabelTTF is a subclass of cc.TextureNode that knows how to render text labels with system font or a ttf font file<br/>\n * All features from cc.Sprite are valid in cc.LabelTTF<br/>\n * cc.LabelTTF objects are slow for js-binding on mobile devices.<br/>\n * Consider using cc.LabelAtlas or cc.LabelBMFont instead.<br/>\n * You can create a cc.LabelTTF from a font name, alignment, dimension and font size or a cc.FontDefinition object.</p>\n * @class\n * @extends cc.Sprite\n *\n * @param {String} text\n * @param {String|cc.FontDefinition} [fontName=\"Arial\"]\n * @param {Number} [fontSize=16]\n * @param {cc.Size} [dimensions=cc.size(0,0)]\n * @param {Number} [hAlignment=cc.TEXT_ALIGNMENT_LEFT]\n * @param {Number} [vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP]\n * @example\n * var myLabel = new cc.LabelTTF('label text',  'Times New Roman', 32, cc.size(320,32), cc.TEXT_ALIGNMENT_LEFT);\n *\n * var fontDef = new cc.FontDefinition();\n * fontDef.fontName = \"Arial\";\n * fontDef.fontSize = \"32\";\n * var myLabel = new cc.LabelTTF('label text',  fontDef);\n *\n * @property {String}       string          - Content string of label\n * @property {Number}       textAlign       - Horizontal Alignment of label: cc.TEXT_ALIGNMENT_LEFT|cc.TEXT_ALIGNMENT_CENTER|cc.TEXT_ALIGNMENT_RIGHT\n * @property {Number}       verticalAlign   - Vertical Alignment of label: cc.VERTICAL_TEXT_ALIGNMENT_TOP|cc.VERTICAL_TEXT_ALIGNMENT_CENTER|cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM\n * @property {Number}       fontSize        - Font size of label\n * @property {String}       fontName        - Font name of label\n * @property {String}       font            - The label font with a style string: e.g. \"18px Verdana\"\n * @property {Number}       boundingWidth   - Width of the bounding box of label, the real content width is limited by boundingWidth\n * @property {Number}       boundingHeight  - Height of the bounding box of label, the real content height is limited by boundingHeight\n * @property {cc.Color}     fillStyle       - The fill color\n * @property {cc.Color}     strokeStyle     - The stroke color\n * @property {Number}       lineWidth       - The line width for stroke\n * @property {Number}       shadowOffsetX   - The x axis offset of shadow\n * @property {Number}       shadowOffsetY   - The y axis offset of shadow\n * @property {Number}       shadowOpacity   - The opacity of shadow\n * @property {Number}       shadowBlur      - The blur size of shadow\n */\ncc.LabelTTF = cc.Sprite.extend(/** @lends cc.LabelTTF# */{\n    _dimensions: null,\n    _hAlignment: cc.TEXT_ALIGNMENT_CENTER,\n    _vAlignment: cc.VERTICAL_TEXT_ALIGNMENT_TOP,\n    _fontName: null,\n    _fontSize: 0.0,\n    _string: \"\",\n    _originalText: null,\n    _onCacheCanvasMode: true,\n\n    // font shadow\n    _shadowEnabled: false,\n    _shadowOffset: null,\n    _shadowOpacity: 0,\n    _shadowBlur: 0,\n    _shadowColor: null,\n\n    // font stroke\n    _strokeEnabled: false,\n    _strokeColor: null,\n    _strokeSize: 0,\n\n    // font tint\n    _textFillColor: null,\n\n    _strokeShadowOffsetX: 0,\n    _strokeShadowOffsetY: 0,\n    _needUpdateTexture: false,\n\n    _lineWidths: null,\n    _className: \"LabelTTF\",\n\n    //for web\n    _fontStyle: \"normal\",\n    _fontWeight: \"normal\",\n    _lineHeight: \"normal\",\n\n    /**\n     * Initializes the cc.LabelTTF with a font name, alignment, dimension and font size, do not call it by yourself,\n     * you should pass the correct arguments in constructor to initialize the label.\n     * @param {String} label string\n     * @param {String} fontName\n     * @param {Number} fontSize\n     * @param {cc.Size} [dimensions=]\n     * @param {Number} [hAlignment=]\n     * @param {Number} [vAlignment=]\n     * @return {Boolean} return false on error\n     */\n    initWithString: function (label, fontName, fontSize, dimensions, hAlignment, vAlignment) {\n        var strInfo;\n        if (label)\n            strInfo = label + \"\";\n        else\n            strInfo = \"\";\n\n        fontSize = fontSize || 16;\n        dimensions = dimensions || cc.size(0, 0/*fontSize*/);\n        hAlignment = hAlignment || cc.TEXT_ALIGNMENT_LEFT;\n        vAlignment = vAlignment || cc.VERTICAL_TEXT_ALIGNMENT_TOP;\n\n        this._opacityModifyRGB = false;\n        this._dimensions = cc.size(dimensions.width, dimensions.height);\n        this._fontName = fontName || \"Arial\";\n        this._hAlignment = hAlignment;\n        this._vAlignment = vAlignment;\n\n        this._fontSize = fontSize;\n        this._renderCmd._setFontStyle(this._fontName, fontSize, this._fontStyle, this._fontWeight);\n        this.string = strInfo;\n        this._renderCmd._setColorsString();\n        this._renderCmd._updateTexture();\n        this._setUpdateTextureDirty();\n\n        // Needed for high dpi text.\n        // In order to render it crisp, we request devicePixelRatio times the\n        // font size and scale it down 1/devicePixelRatio.\n        this._scaleX = this._scaleY = 1 / cc.view.getDevicePixelRatio();\n        return true;\n    },\n\n    _setUpdateTextureDirty: function () {\n        this._needUpdateTexture = true;\n        this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty);\n    },\n\n    ctor: function (text, fontName, fontSize, dimensions, hAlignment, vAlignment) {\n        cc.Sprite.prototype.ctor.call(this);\n\n        this._dimensions = cc.size(0, 0);\n        this._hAlignment = cc.TEXT_ALIGNMENT_LEFT;\n        this._vAlignment = cc.VERTICAL_TEXT_ALIGNMENT_TOP;\n        this._opacityModifyRGB = false;\n        this._fontName = \"Arial\";\n\n        this._shadowEnabled = false;\n        this._shadowOffset = cc.p(0, 0);\n        this._shadowOpacity = 0;\n        this._shadowBlur = 0;\n\n        this._strokeEnabled = false;\n        this._strokeColor = cc.color(255, 255, 255, 255);\n        this._strokeSize = 0;\n\n        this._textFillColor = cc.color(255, 255, 255, 255);\n        this._strokeShadowOffsetX = 0;\n        this._strokeShadowOffsetY = 0;\n        this._needUpdateTexture = false;\n\n        this._lineWidths = [];\n        this._renderCmd._setColorsString();\n        this._textureLoaded = true;\n\n        if (fontName && fontName instanceof cc.FontDefinition) {\n            this.initWithStringAndTextDefinition(text, fontName);\n        } else {\n            cc.LabelTTF.prototype.initWithString.call(this, text, fontName, fontSize, dimensions, hAlignment, vAlignment);\n        }\n    },\n\n    init: function () {\n        return this.initWithString(\" \", this._fontName, this._fontSize);\n    },\n\n    description: function () {\n        return \"<cc.LabelTTF | FontName =\" + this._fontName + \" FontSize = \" + this._fontSize.toFixed(1) + \">\";\n    },\n\n    getLineHeight: function () {\n        return !this._lineHeight || this._lineHeight.charAt ?\n            this._renderCmd._getFontClientHeight() :\n            this._lineHeight || this._renderCmd._getFontClientHeight();\n    },\n\n    setLineHeight: function (lineHeight) {\n        this._lineHeight = lineHeight;\n    },\n\n    /**\n     * Returns the text of the label\n     * @return {String}\n     */\n    getString: function () {\n        return this._string;\n    },\n\n    /**\n     * Returns Horizontal Alignment of cc.LabelTTF\n     * @return {cc.TEXT_ALIGNMENT_LEFT|cc.TEXT_ALIGNMENT_CENTER|cc.TEXT_ALIGNMENT_RIGHT}\n     */\n    getHorizontalAlignment: function () {\n        return this._hAlignment;\n    },\n\n    /**\n     * Returns Vertical Alignment of cc.LabelTTF\n     * @return {cc.VERTICAL_TEXT_ALIGNMENT_TOP|cc.VERTICAL_TEXT_ALIGNMENT_CENTER|cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM}\n     */\n    getVerticalAlignment: function () {\n        return this._vAlignment;\n    },\n\n    /**\n     * Returns the dimensions of cc.LabelTTF, the dimension is the maximum size of the label, set it so that label will automatically change lines when necessary.\n     * @see cc.LabelTTF#setDimensions, cc.LabelTTF#boundingWidth and cc.LabelTTF#boundingHeight\n     * @return {cc.Size}\n     */\n    getDimensions: function () {\n        return cc.size(this._dimensions);\n    },\n\n    /**\n     * Returns font size of cc.LabelTTF\n     * @return {Number}\n     */\n    getFontSize: function () {\n        return this._fontSize;\n    },\n\n    /**\n     * Returns font name of cc.LabelTTF\n     * @return {String}\n     */\n    getFontName: function () {\n        return this._fontName;\n    },\n\n    /**\n     * Initializes the CCLabelTTF with a font name, alignment, dimension and font size, do not call it by yourself, you should pass the correct arguments in constructor to initialize the label.\n     * @param {String} text\n     * @param {cc.FontDefinition} textDefinition\n     * @return {Boolean}\n     */\n    initWithStringAndTextDefinition: function (text, textDefinition) {\n        // prepare everything needed to render the label\n        this._updateWithTextDefinition(textDefinition, false);\n        // set the string\n        this.string = text;\n        return true;\n    },\n\n    /**\n     * Sets the text definition used by this label\n     * @param {cc.FontDefinition} theDefinition\n     */\n    setTextDefinition: function (theDefinition) {\n        if (theDefinition)\n            this._updateWithTextDefinition(theDefinition, true);\n    },\n\n    /**\n     * Extract the text definition used by this label\n     * @return {cc.FontDefinition}\n     */\n    getTextDefinition: function () {\n        return this._prepareTextDefinition(false);\n    },\n\n    /**\n     * Enable or disable shadow for the label\n     * @param {cc.Color | Number} a Color or The x axis offset of the shadow\n     * @param {cc.Size | Number} b Size or The y axis offset of the shadow\n     * @param {Number} c The blur size of the shadow or The opacity of the shadow (0 to 1)\n     * @param {null | Number} d Null or The blur size of the shadow\n     * @example\n     *   old:\n     *     labelttf.enableShadow(shadowOffsetX, shadowOffsetY, shadowOpacity, shadowBlur);\n     *   new:\n     *     labelttf.enableShadow(shadowColor, offset, blurRadius);\n     */\n    enableShadow: function (a, b, c, d) {\n        if (a.r != null && a.g != null && a.b != null && a.a != null) {\n            this._enableShadow(a, b, c);\n        } else {\n            this._enableShadowNoneColor(a, b, c, d);\n        }\n    },\n\n    _enableShadowNoneColor: function (shadowOffsetX, shadowOffsetY, shadowOpacity, shadowBlur) {\n        shadowOpacity = shadowOpacity || 0.5;\n        if (false === this._shadowEnabled)\n            this._shadowEnabled = true;\n\n        var locShadowOffset = this._shadowOffset;\n        if (locShadowOffset && (locShadowOffset.x !== shadowOffsetX) || (locShadowOffset._y !== shadowOffsetY)) {\n            locShadowOffset.x = shadowOffsetX;\n            locShadowOffset.y = shadowOffsetY;\n        }\n\n        if (this._shadowOpacity !== shadowOpacity) {\n            this._shadowOpacity = shadowOpacity;\n        }\n        this._renderCmd._setColorsString();\n\n        if (this._shadowBlur !== shadowBlur)\n            this._shadowBlur = shadowBlur;\n        this._setUpdateTextureDirty();\n    },\n\n    _enableShadow: function (shadowColor, offset, blurRadius) {\n        if (!this._shadowColor) {\n            this._shadowColor = cc.color(255, 255, 255, 128);\n        }\n        this._shadowColor.r = shadowColor.r;\n        this._shadowColor.g = shadowColor.g;\n        this._shadowColor.b = shadowColor.b;\n\n        var x, y, a, b;\n        x = offset.width || offset.x || 0;\n        y = offset.height || offset.y || 0;\n        a = (shadowColor.a != null) ? (shadowColor.a / 255) : 0.5;\n        b = blurRadius;\n\n        this._enableShadowNoneColor(x, y, a, b);\n    },\n\n    _getShadowOffsetX: function () {\n        return this._shadowOffset.x;\n    },\n    _setShadowOffsetX: function (x) {\n        if (false === this._shadowEnabled)\n            this._shadowEnabled = true;\n\n        if (this._shadowOffset.x !== x) {\n            this._shadowOffset.x = x;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getShadowOffsetY: function () {\n        return this._shadowOffset._y;\n    },\n    _setShadowOffsetY: function (y) {\n        if (false === this._shadowEnabled)\n            this._shadowEnabled = true;\n\n        if (this._shadowOffset._y !== y) {\n            this._shadowOffset._y = y;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getShadowOffset: function () {\n        return cc.p(this._shadowOffset.x, this._shadowOffset.y);\n    },\n    _setShadowOffset: function (offset) {\n        if (false === this._shadowEnabled)\n            this._shadowEnabled = true;\n\n        if (this._shadowOffset.x !== offset.x || this._shadowOffset.y !== offset.y) {\n            this._shadowOffset.x = offset.x;\n            this._shadowOffset.y = offset.y;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getShadowOpacity: function () {\n        return this._shadowOpacity;\n    },\n    _setShadowOpacity: function (shadowOpacity) {\n        if (false === this._shadowEnabled)\n            this._shadowEnabled = true;\n\n        if (this._shadowOpacity !== shadowOpacity) {\n            this._shadowOpacity = shadowOpacity;\n            this._renderCmd._setColorsString();\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getShadowBlur: function () {\n        return this._shadowBlur;\n    },\n    _setShadowBlur: function (shadowBlur) {\n        if (false === this._shadowEnabled)\n            this._shadowEnabled = true;\n\n        if (this._shadowBlur !== shadowBlur) {\n            this._shadowBlur = shadowBlur;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Disable shadow rendering\n     */\n    disableShadow: function () {\n        if (this._shadowEnabled) {\n            this._shadowEnabled = false;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Enable label stroke with stroke parameters\n     * @param {cc.Color} strokeColor The color of stroke\n     * @param {Number} strokeSize The size of stroke\n     */\n    enableStroke: function (strokeColor, strokeSize) {\n        if (this._strokeEnabled === false)\n            this._strokeEnabled = true;\n\n        var locStrokeColor = this._strokeColor;\n        if ((locStrokeColor.r !== strokeColor.r) || (locStrokeColor.g !== strokeColor.g) || (locStrokeColor.b !== strokeColor.b)) {\n            locStrokeColor.r = strokeColor.r;\n            locStrokeColor.g = strokeColor.g;\n            locStrokeColor.b = strokeColor.b;\n            this._renderCmd._setColorsString();\n        }\n\n        if (this._strokeSize !== strokeSize)\n            this._strokeSize = strokeSize || 0;\n        this._setUpdateTextureDirty();\n    },\n\n    _getStrokeStyle: function () {\n        return this._strokeColor;\n    },\n    _setStrokeStyle: function (strokeStyle) {\n        if (this._strokeEnabled === false)\n            this._strokeEnabled = true;\n\n        var locStrokeColor = this._strokeColor;\n        if ((locStrokeColor.r !== strokeStyle.r) || (locStrokeColor.g !== strokeStyle.g) || (locStrokeColor.b !== strokeStyle.b)) {\n            locStrokeColor.r = strokeStyle.r;\n            locStrokeColor.g = strokeStyle.g;\n            locStrokeColor.b = strokeStyle.b;\n            this._renderCmd._setColorsString();\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getLineWidth: function () {\n        return this._strokeSize;\n    },\n    _setLineWidth: function (lineWidth) {\n        if (this._strokeEnabled === false)\n            this._strokeEnabled = true;\n        if (this._strokeSize !== lineWidth) {\n            this._strokeSize = lineWidth || 0;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Disable label stroke\n     */\n    disableStroke: function () {\n        if (this._strokeEnabled) {\n            this._strokeEnabled = false;\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Sets the text fill color\n     * @function\n     * @param {cc.Color} fillColor The fill color of the label\n     */\n    setFontFillColor: function (fillColor) {\n        var locTextFillColor = this._textFillColor;\n        if (locTextFillColor.r !== fillColor.r || locTextFillColor.g !== fillColor.g || locTextFillColor.b !== fillColor.b) {\n            locTextFillColor.r = fillColor.r;\n            locTextFillColor.g = fillColor.g;\n            locTextFillColor.b = fillColor.b;\n            this._renderCmd._setColorsString();\n            this._needUpdateTexture = true;\n        }\n    },\n\n    _getFillStyle: function () {\n        return this._textFillColor;\n    },\n\n    //set the text definition for this label\n    _updateWithTextDefinition: function (textDefinition, mustUpdateTexture) {\n        if (textDefinition.fontDimensions) {\n            this._dimensions.width = textDefinition.boundingWidth;\n            this._dimensions.height = textDefinition.boundingHeight;\n        } else {\n            this._dimensions.width = 0;\n            this._dimensions.height = 0;\n        }\n\n        this._hAlignment = textDefinition.textAlign;\n        this._vAlignment = textDefinition.verticalAlign;\n\n        this._fontName = textDefinition.fontName;\n        this._fontSize = textDefinition.fontSize || 12;\n\n        if (textDefinition.lineHeight)\n            this._lineHeight = textDefinition.lineHeight;\n        else\n            this._lineHeight = this._fontSize;\n\n        this._renderCmd._setFontStyle(textDefinition);\n\n\n        // shadow\n        if (textDefinition.shadowEnabled)\n            this.enableShadow(textDefinition.shadowOffsetX,\n                textDefinition.shadowOffsetY,\n                textDefinition.shadowOpacity,\n                textDefinition.shadowBlur);\n\n        // stroke\n        if (textDefinition.strokeEnabled)\n            this.enableStroke(textDefinition.strokeStyle, textDefinition.lineWidth);\n\n        // fill color\n        this.setFontFillColor(textDefinition.fillStyle);\n\n        if (mustUpdateTexture)\n            this._renderCmd._updateTexture();\n        var flags = cc.Node._dirtyFlags;\n        this._renderCmd.setDirtyFlag(flags.colorDirty | flags.opacityDirty | flags.textDirty);\n    },\n\n    _prepareTextDefinition: function (adjustForResolution) {\n        var texDef = new cc.FontDefinition();\n\n        if (adjustForResolution) {\n            texDef.fontSize = this._fontSize;\n            texDef.boundingWidth = cc.contentScaleFactor() * this._dimensions.width;\n            texDef.boundingHeight = cc.contentScaleFactor() * this._dimensions.height;\n        } else {\n            texDef.fontSize = this._fontSize;\n            texDef.boundingWidth = this._dimensions.width;\n            texDef.boundingHeight = this._dimensions.height;\n        }\n\n        texDef.fontName = this._fontName;\n        texDef.textAlign = this._hAlignment;\n        texDef.verticalAlign = this._vAlignment;\n\n        // stroke\n        if (this._strokeEnabled) {\n            texDef.strokeEnabled = true;\n            var locStrokeColor = this._strokeColor;\n            texDef.strokeStyle = cc.color(locStrokeColor.r, locStrokeColor.g, locStrokeColor.b);\n            texDef.lineWidth = this._strokeSize;\n        } else\n            texDef.strokeEnabled = false;\n\n        // shadow\n        if (this._shadowEnabled) {\n            texDef.shadowEnabled = true;\n            texDef.shadowBlur = this._shadowBlur;\n            texDef.shadowOpacity = this._shadowOpacity;\n\n            texDef.shadowOffsetX = (adjustForResolution ? cc.contentScaleFactor() : 1) * this._shadowOffset.x;\n            texDef.shadowOffsetY = (adjustForResolution ? cc.contentScaleFactor() : 1) * this._shadowOffset.y;\n        } else\n            texDef._shadowEnabled = false;\n\n        // text tint\n        var locTextFillColor = this._textFillColor;\n        texDef.fillStyle = cc.color(locTextFillColor.r, locTextFillColor.g, locTextFillColor.b);\n        return texDef;\n    },\n\n    /*\n     * BEGIN SCALE METHODS\n     *\n     * In order to make the value of scaleX and scaleY consistent across\n     * screens, we provide patched versions that return the same values as if\n     * the screen was not HiDPI.\n     */\n\n    /**\n     * Returns the scale factor of the node.\n     * @warning: Assertion will fail when _scaleX != _scaleY.\n     * @function\n     * @return {Number} The scale factor\n     */\n    getScale: function () {\n        if (this._scaleX !== this._scaleY)\n            cc.log(cc._LogInfos.Node_getScale);\n        return this._scaleX * cc.view.getDevicePixelRatio();\n    },\n\n    /**\n     * Sets the scale factor of the node. 1.0 is the default scale factor. This function can modify the X and Y scale at the same time.\n     * @function\n     * @param {Number} scale or scaleX value\n     * @param {Number} [scaleY=]\n     */\n    setScale: function (scale, scaleY) {\n        var ratio = cc.view.getDevicePixelRatio();\n        this._scaleX = scale / ratio;\n        this._scaleY = ((scaleY || scaleY === 0) ? scaleY : scale) / ratio;\n        this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n    },\n\n    /**\n     * Returns the scale factor on X axis of this node\n     * @function\n     * @return {Number} The scale factor on X axis.\n     */\n    getScaleX: function () {\n        return this._scaleX * cc.view.getDevicePixelRatio();\n    },\n\n    /**\n     * <p>\n     *     Changes the scale factor on X axis of this node                                   <br/>\n     *     The default value is 1.0 if you haven't changed it before\n     * </p>\n     * @function\n     * @param {Number} newScaleX The scale factor on X axis.\n     */\n    setScaleX: function (newScaleX) {\n        this._scaleX = newScaleX / cc.view.getDevicePixelRatio();\n        this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n    },\n\n    /**\n     * Returns the scale factor on Y axis of this node\n     * @function\n     * @return {Number} The scale factor on Y axis.\n     */\n    getScaleY: function () {\n        return this._scaleY * cc.view.getDevicePixelRatio();\n    },\n\n    /**\n     * <p>\n     *     Changes the scale factor on Y axis of this node                                            <br/>\n     *     The Default value is 1.0 if you haven't changed it before.\n     * </p>\n     * @function\n     * @param {Number} newScaleY The scale factor on Y axis.\n     */\n    setScaleY: function (newScaleY) {\n        this._scaleY = newScaleY / cc.view.getDevicePixelRatio();\n        this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n    },\n\n    /*\n     * END SCALE METHODS\n     */\n\n    /**\n     * Changes the text content of the label\n     * @warning Changing the string is as expensive as creating a new cc.LabelTTF. To obtain better performance use cc.LabelAtlas\n     * @param {String} text Text content for the label\n     */\n    setString: function (text) {\n        text = String(text);\n        if (this._originalText !== text) {\n            this._originalText = text + \"\";\n\n            this._updateString();\n\n            // Force update\n            this._setUpdateTextureDirty();\n            this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n        }\n    },\n    _updateString: function () {\n        if ((!this._string || this._string === \"\") && this._string !== this._originalText)\n            cc.renderer.childrenOrderDirty = true;\n        this._string = this._originalText;\n    },\n\n    /**\n     * Sets Horizontal Alignment of cc.LabelTTF\n     * @param {cc.TEXT_ALIGNMENT_LEFT|cc.TEXT_ALIGNMENT_CENTER|cc.TEXT_ALIGNMENT_RIGHT} alignment Horizontal Alignment\n     */\n    setHorizontalAlignment: function (alignment) {\n        if (alignment !== this._hAlignment) {\n            this._hAlignment = alignment;\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Sets Vertical Alignment of cc.LabelTTF\n     * @param {cc.VERTICAL_TEXT_ALIGNMENT_TOP|cc.VERTICAL_TEXT_ALIGNMENT_CENTER|cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM} verticalAlignment\n     */\n    setVerticalAlignment: function (verticalAlignment) {\n        if (verticalAlignment !== this._vAlignment) {\n            this._vAlignment = verticalAlignment;\n\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Set Dimensions of cc.LabelTTF, the dimension is the maximum size of the label, set it so that label will automatically change lines when necessary.\n     * @param {cc.Size|Number} dim dimensions or width of dimensions\n     * @param {Number} [height] height of dimensions\n     */\n    setDimensions: function (dim, height) {\n        var width;\n        if (height === undefined) {\n            width = dim.width;\n            height = dim.height;\n        } else\n            width = dim;\n\n        if (width !== this._dimensions.width || height !== this._dimensions.height) {\n            this._dimensions.width = width;\n            this._dimensions.height = height;\n            this._updateString();\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getBoundingWidth: function () {\n        return this._dimensions.width;\n    },\n    _setBoundingWidth: function (width) {\n        if (width !== this._dimensions.width) {\n            this._dimensions.width = width;\n            this._updateString();\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getBoundingHeight: function () {\n        return this._dimensions.height;\n    },\n    _setBoundingHeight: function (height) {\n        if (height !== this._dimensions.height) {\n            this._dimensions.height = height;\n            this._updateString();\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Sets font size of cc.LabelTTF\n     * @param {Number} fontSize\n     */\n    setFontSize: function (fontSize) {\n        if (this._fontSize !== fontSize) {\n            this._fontSize = fontSize;\n            this._renderCmd._setFontStyle(this._fontName, this._fontSize, this._fontStyle, this._fontWeight);\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Sets font name of cc.LabelTTF\n     * @param {String} fontName\n     */\n    setFontName: function (fontName) {\n        if (this._fontName && this._fontName !== fontName) {\n            this._fontName = fontName;\n            this._renderCmd._setFontStyle(this._fontName, this._fontSize, this._fontStyle, this._fontWeight);\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getFont: function () {\n        return this._renderCmd._getFontStyle();\n    },\n    _setFont: function (fontStyle) {\n        var res = cc.LabelTTF._fontStyleRE.exec(fontStyle);\n        if (res) {\n            this._fontSize = parseInt(res[1]);\n            this._fontName = res[2];\n            this._renderCmd._setFontStyle(this._fontName, this._fontSize, this._fontStyle, this._fontWeight);\n\n            // Force update\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    /**\n     * Returns the actual content size of the label, the content size is the real size that the label occupied while dimension is the outer bounding box of the label.\n     * @returns {cc.Size} The content size\n     */\n    getContentSize: function () {\n        if (this._needUpdateTexture)\n            this._renderCmd._updateTTF();\n        var ratio = cc.view.getDevicePixelRatio();\n        return cc.size( this._contentSize.width / ratio, this._contentSize.height / ratio );\n    },\n\n    _getWidth: function () {\n        if (this._needUpdateTexture)\n            this._renderCmd._updateTTF();\n        return this._contentSize.width / cc.view.getDevicePixelRatio();\n    },\n    _getHeight: function () {\n        if (this._needUpdateTexture)\n            this._renderCmd._updateTTF();\n        return this._contentSize.height / cc.view.getDevicePixelRatio();\n    },\n\n    setTextureRect: function (rect, rotated, untrimmedSize) {\n        var _t = this;\n        _t._rectRotated = rotated || false;\n        _t.setContentSize(untrimmedSize || rect);\n\n        var locRect = _t._rect;\n        locRect.x = rect.x;\n        locRect.y = rect.y;\n        locRect.width = rect.width;\n        locRect.height = rect.height;\n        _t._renderCmd._setTextureCoords(rect, false);\n\n        var relativeOffsetX = _t._unflippedOffsetPositionFromCenter.x, relativeOffsetY = _t._unflippedOffsetPositionFromCenter.y;\n        if (_t._flippedX)\n            relativeOffsetX = -relativeOffsetX;\n        if (_t._flippedY)\n            relativeOffsetY = -relativeOffsetY;\n        _t._offsetPosition.x = relativeOffsetX + (rect.width - locRect.width) / 2;\n        _t._offsetPosition.y = relativeOffsetY + (rect.height - locRect.height) / 2;\n    },\n\n    /**\n     * set Target to draw on\n     * @param boolean onCanvas\n     */\n    setDrawMode: function (onCacheMode) {\n        this._onCacheCanvasMode = onCacheMode;\n    },\n\n    _createRenderCmd: function () {\n        if (cc._renderType === cc.game.RENDER_TYPE_WEBGL)\n            return new cc.LabelTTF.WebGLRenderCmd(this);\n        else if (this._onCacheCanvasMode)\n            return new cc.LabelTTF.CacheCanvasRenderCmd(this);\n        else\n            return new cc.LabelTTF.CanvasRenderCmd(this);\n    },\n\n    //For web only\n    _setFontStyle: function (fontStyle) {\n        if (this._fontStyle !== fontStyle) {\n            this._fontStyle = fontStyle;\n            this._renderCmd._setFontStyle(this._fontName, this._fontSize, this._fontStyle, this._fontWeight);\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getFontStyle: function () {\n        return this._fontStyle;\n    },\n\n    _setFontWeight: function (fontWeight) {\n        if (this._fontWeight !== fontWeight) {\n            this._fontWeight = fontWeight;\n            this._renderCmd._setFontStyle(this._fontName, this._fontSize, this._fontStyle, this._fontWeight);\n            this._setUpdateTextureDirty();\n        }\n    },\n\n    _getFontWeight: function () {\n        return this._fontWeight;\n    }\n});\n\ncc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF), cc._LogInfos.MissingFile, \"LabelTTFPropertyDefine.js\");\ncc._tmp.PrototypeLabelTTF();\ndelete cc._tmp.PrototypeLabelTTF;\n\n// Only support style in this format: \"18px Verdana\" or \"18px 'Helvetica Neue'\"\ncc.LabelTTF._fontStyleRE = /^(\\d+)px\\s+['\"]?([\\w\\s\\d]+)['\"]?$/;\n\n/**\n * creates a cc.LabelTTF from a font name, alignment, dimension and font size\n * @deprecated since v3.0, please use the new construction instead\n * @see cc.LabelTTF\n * @static\n * @param {String} text\n * @param {String|cc.FontDefinition} [fontName=\"Arial\"]\n * @param {Number} [fontSize=16]\n * @param {cc.Size} [dimensions=cc.size(0,0)]\n * @param {Number} [hAlignment=cc.TEXT_ALIGNMENT_LEFT]\n * @param {Number} [vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP]\n * @return {cc.LabelTTF|Null}\n */\ncc.LabelTTF.create = function (text, fontName, fontSize, dimensions, hAlignment, vAlignment) {\n    return new cc.LabelTTF(text, fontName, fontSize, dimensions, hAlignment, vAlignment);\n};\n\n/**\n * @deprecated since v3.0, please use the new construction instead\n * @function\n * @static\n */\ncc.LabelTTF.createWithFontDefinition = cc.LabelTTF.create;\n\ncc.LabelTTF.__labelHeightDiv = document.createElement(\"div\");\ncc.LabelTTF.__labelHeightDiv.style.fontFamily = \"Arial\";\ncc.LabelTTF.__labelHeightDiv.style.position = \"absolute\";\ncc.LabelTTF.__labelHeightDiv.style.left = \"-100px\";\ncc.LabelTTF.__labelHeightDiv.style.top = \"-100px\";\ncc.LabelTTF.__labelHeightDiv.style.lineHeight = \"normal\";\n\ndocument.body ?\n    document.body.appendChild(cc.LabelTTF.__labelHeightDiv) :\n    window.addEventListener('load', function () {\n        this.removeEventListener('load', arguments.callee, false);\n        document.body.appendChild(cc.LabelTTF.__labelHeightDiv);\n    }, false);\n\n/**\n * Returns the height of text with an specified font family and font size, in\n * device independent pixels.\n *\n * @param {string|cc.FontDefinition} fontName\n * @param {number} fontSize\n * @returns {number}\n * @private\n */\ncc.LabelTTF.__getFontHeightByDiv = function (fontName, fontSize) {\n    var clientHeight, labelDiv = cc.LabelTTF.__labelHeightDiv;\n    if(fontName instanceof cc.FontDefinition){\n        /** @type cc.FontDefinition */\n        var fontDef = fontName;\n        clientHeight = cc.LabelTTF.__fontHeightCache[fontDef._getCanvasFontStr()];\n        if (clientHeight > 0) return clientHeight;\n        labelDiv.innerHTML = \"ajghl~!\";\n        labelDiv.style.fontFamily = fontDef.fontName;\n        labelDiv.style.fontSize = fontDef.fontSize + \"px\";\n        labelDiv.style.fontStyle = fontDef.fontStyle;\n        labelDiv.style.fontWeight = fontDef.fontWeight;\n\n        clientHeight = labelDiv.clientHeight;\n        cc.LabelTTF.__fontHeightCache[fontDef._getCanvasFontStr()] = clientHeight;\n        labelDiv.innerHTML = \"\";\n    }\n    else {\n        //Default\n        clientHeight = cc.LabelTTF.__fontHeightCache[fontName + \".\" + fontSize];\n        if (clientHeight > 0) return clientHeight;\n        labelDiv.innerHTML = \"ajghl~!\";\n        labelDiv.style.fontFamily = fontName;\n        labelDiv.style.fontSize = fontSize + \"px\";\n        clientHeight = labelDiv.clientHeight;\n        cc.LabelTTF.__fontHeightCache[fontName + \".\" + fontSize] = clientHeight;\n        labelDiv.innerHTML = \"\";\n    }\n    return clientHeight;\n\n};\n\ncc.LabelTTF.__fontHeightCache = {};\n"]}