{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/platform/assets/frameworks/cocos2d-html5/cocos2d/core/platform/CCLoaders.js"],"names":["cc","_txtLoader","load","realUrl","url","res","cb","loader","loadTxt","register","_jsonLoader","loadJson","_jsLoader","loadJs","_imgLoader","callback","isLoading","err","img","tex","textureCache","getTextureForKey","handleLoadedTexture","loadImg","_serverImgLoader","src","_plistLoader","txt","plistParser","parse","_fontLoader","TYPE","_loadFont","name","srcs","type","doc","document","path","fontStyle","createElement","body","appendChild","fontStr","isNaN","Array","i","li","length","extname","toLowerCase","textContent","preloadDiv","_divStyle","style","fontFamily","innerHTML","position","left","top","self","isString","basename","fonts","then","_binaryLoader","loadBinary","_csbLoader","loadCsb"],"mappings":"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","file":"CCLoaders.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/platform","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\ncc._txtLoader = {\n    load: function (realUrl, url, res, cb) {\n        cc.loader.loadTxt(realUrl, cb);\n    }\n};\ncc.loader.register([\"txt\", \"xml\", \"vsh\", \"fsh\", \"atlas\"], cc._txtLoader);\n\ncc._jsonLoader = {\n    load: function (realUrl, url, res, cb) {\n        cc.loader.loadJson(realUrl, cb);\n    }\n};\ncc.loader.register([\"json\", \"ExportJson\"], cc._jsonLoader);\n\ncc._jsLoader = {\n    load: function (realUrl, url, res, cb) {\n        cc.loader.loadJs(realUrl, cb);\n    }\n};\ncc.loader.register([\"js\"], cc._jsLoader);\n\ncc._imgLoader = {\n    load: function (realUrl, url, res, cb) {\n        var callback;\n        if (cc.loader.isLoading(realUrl)) {\n            callback = function (err, img) {\n                if (err)\n                    return cb(err);\n                var tex = cc.textureCache.getTextureForKey(url) || cc.textureCache.handleLoadedTexture(url, img);\n                cb(null, tex);\n            };\n        }\n        else {\n            callback = function (err, img) {\n                if (err)\n                    return cb(err);\n                var tex = cc.textureCache.handleLoadedTexture(url, img);\n                cb(null, tex);\n            };\n        }\n        cc.loader.loadImg(realUrl, callback);\n    }\n};\ncc.loader.register([\"png\", \"jpg\", \"bmp\", \"jpeg\", \"gif\", \"ico\", \"tiff\", \"webp\"], cc._imgLoader);\ncc._serverImgLoader = {\n    load: function (realUrl, url, res, cb) {\n        cc._imgLoader.load(res.src, url, res, cb);\n    }\n};\ncc.loader.register([\"serverImg\"], cc._serverImgLoader);\n\ncc._plistLoader = {\n    load: function (realUrl, url, res, cb) {\n        cc.loader.loadTxt(realUrl, function (err, txt) {\n            if (err)\n                return cb(err);\n            cb(null, cc.plistParser.parse(txt));\n        });\n    }\n};\ncc.loader.register([\"plist\"], cc._plistLoader);\n\ncc._fontLoader = {\n    TYPE: {\n        \".eot\": \"embedded-opentype\",\n        \".ttf\": \"truetype\",\n        \".ttc\": \"truetype\",\n        \".woff\": \"woff\",\n        \".svg\": \"svg\"\n    },\n    _loadFont: function (name, srcs, type) {\n        var doc = document, path = cc.path, TYPE = this.TYPE, fontStyle = document.createElement(\"style\");\n        fontStyle.type = \"text/css\";\n        doc.body.appendChild(fontStyle);\n\n        var fontStr = \"\";\n        if (isNaN(name - 0))\n            fontStr += \"@font-face { font-family:\" + name + \"; src:\";\n        else\n            fontStr += \"@font-face { font-family:'\" + name + \"'; src:\";\n        if (srcs instanceof Array) {\n            for (var i = 0, li = srcs.length; i < li; i++) {\n                var src = srcs[i];\n                type = path.extname(src).toLowerCase();\n                fontStr += \"url('\" + srcs[i] + \"') format('\" + TYPE[type] + \"')\";\n                fontStr += (i === li - 1) ? \";\" : \",\";\n            }\n        } else {\n            type = type.toLowerCase();\n            fontStr += \"url('\" + srcs + \"') format('\" + TYPE[type] + \"');\";\n        }\n        fontStyle.textContent += fontStr + \"}\";\n\n        //<div style=\"font-family: PressStart;\">.</div>\n        var preloadDiv = document.createElement(\"div\");\n        var _divStyle = preloadDiv.style;\n        _divStyle.fontFamily = name;\n        preloadDiv.innerHTML = \".\";\n        _divStyle.position = \"absolute\";\n        _divStyle.left = \"-100px\";\n        _divStyle.top = \"-100px\";\n        doc.body.appendChild(preloadDiv);\n    },\n    load: function (realUrl, url, res, cb) {\n        var self = this;\n        var type = res.type, name = res.name, srcs = res.srcs;\n        if (cc.isString(res)) {\n            type = cc.path.extname(res);\n            name = cc.path.basename(res, type);\n            self._loadFont(name, res, type);\n        } else {\n            self._loadFont(name, srcs);\n        }\n        if (document.fonts) {\n            document.fonts.load(\"1em \" + name).then(function () {\n                cb(null, true);\n            }, function (err) {\n                cb(err);\n            });\n        } else {\n            cb(null, true);\n        }\n    }\n};\ncc.loader.register([\"font\", \"eot\", \"ttf\", \"woff\", \"svg\", \"ttc\"], cc._fontLoader);\n\ncc._binaryLoader = {\n    load: function (realUrl, url, res, cb) {\n        cc.loader.loadBinary(realUrl, cb);\n    }\n};\n\ncc._csbLoader = {\n    load: function(realUrl, url, res, cb){\n        cc.loader.loadCsb(realUrl, cb);\n    }\n};\ncc.loader.register([\"csb\"], cc._csbLoader);\n"]}