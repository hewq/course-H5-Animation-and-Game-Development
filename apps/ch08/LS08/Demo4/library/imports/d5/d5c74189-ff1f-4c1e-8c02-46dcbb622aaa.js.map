{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/particle/assets/frameworks/cocos2d-html5/cocos2d/particle/CCTIFFReader.js"],"names":["cc","tiffReader","_littleEndian","_tiffData","_fileDirectories","getUint8","offset","getUint16","getUint32","a","checkLittleEndian","BOM","littleEndian","console","log","TypeError","hasTowel","RangeError","getFieldTypeName","fieldType","typeNames","fieldTypeNames","getFieldTagName","fieldTag","tagNames","fieldTagNames","getFieldTypeLength","fieldTypeName","indexOf","getFieldValues","fieldTagName","typeCount","valueOffset","fieldValues","fieldTypeLength","fieldValueSize","push","i","indexOffset","getBytes","forEach","e","String","fromCharCode","numBytes","getBits","numBits","byteOffset","bitOffset","extraBytes","Math","floor","newByteOffset","totalBits","shiftRight","shiftLeft","rawBits","parseFileDirectory","numDirEntries","tiffFields","entryCount","type","values","nextIFDByteOffset","clampColorSample","colorSample","bitsPerSample","multiplier","pow","parseTIFF","tiffData","canvas","document","createElement","firstIFDByteOffset","length","fileDirectory","imageWidth","imageLength","width","height","strips","compression","samplesPerPixel","sampleProperties","bitsPerPixel","hasBytesPerPixel","bitsPerSampleValues","hasBytesPerSample","bytesPerSample","undefined","bytesPerPixel","stripOffsetValues","numStripOffsetValues","stripByteCountValues","ceil","Error","stripOffset","stripByteCount","jIncrement","getHeader","pixel","sample","currentSample","m","sampleOffset","sampleInfo","bits","blockLength","iterations","header","getInt8","currentByte","getContext","ctx","fillStyle","rowsPerStrip","numStrips","imageLengthModRowsPerStrip","rowsInLastStrip","numRowsInStrip","numRowsInPreviousStrip","photometricInterpretation","extraSamplesValues","numExtraSamples","colorMapValues","colorMapSampleSize","numPixels","yPadding","y","j","x","pixelSamples","red","green","blue","opacity","k","invertValue","index","samples","colorMapIndex","fillRect"],"mappings":"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","file":"CCTIFFReader.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/particle","sourcesContent":["/****************************************************************************\n Copyright (c) 2011 Gordon P. Hemsley\n http://gphemsley.org/\n\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * cc.tiffReader is a singleton object, it's a tiff file reader, it can parse byte array to draw into a canvas\n * @class\n * @name cc.tiffReader\n */\ncc.tiffReader = /** @lends cc.tiffReader# */{\n    _littleEndian: false,\n    _tiffData: null,\n    _fileDirectories: [],\n\n    getUint8: function (offset) {\n        return this._tiffData[offset];\n    },\n\n    getUint16: function (offset) {\n        if (this._littleEndian)\n            return (this._tiffData[offset + 1] << 8) | (this._tiffData[offset]);\n        else\n            return (this._tiffData[offset] << 8) | (this._tiffData[offset + 1]);\n    },\n\n    getUint32: function (offset) {\n        var a = this._tiffData;\n        if (this._littleEndian)\n            return (a[offset + 3] << 24) | (a[offset + 2] << 16) | (a[offset + 1] << 8) | (a[offset]);\n        else\n            return (a[offset] << 24) | (a[offset + 1] << 16) | (a[offset + 2] << 8) | (a[offset + 3]);\n    },\n\n    checkLittleEndian: function () {\n        var BOM = this.getUint16(0);\n\n        if (BOM === 0x4949) {\n            this.littleEndian = true;\n        } else if (BOM === 0x4D4D) {\n            this.littleEndian = false;\n        } else {\n            console.log(BOM);\n            throw TypeError(\"Invalid byte order value.\");\n        }\n\n        return this.littleEndian;\n    },\n\n    hasTowel: function () {\n        // Check for towel.\n        if (this.getUint16(2) !== 42) {\n            throw RangeError(\"You forgot your towel!\");\n            return false;\n        }\n\n        return true;\n    },\n\n    getFieldTypeName: function (fieldType) {\n        var typeNames = this.fieldTypeNames;\n        if (fieldType in typeNames) {\n            return typeNames[fieldType];\n        }\n        return null;\n    },\n\n    getFieldTagName: function (fieldTag) {\n        var tagNames = this.fieldTagNames;\n\n        if (fieldTag in tagNames) {\n            return tagNames[fieldTag];\n        } else {\n            console.log(\"Unknown Field Tag:\", fieldTag);\n            return \"Tag\" + fieldTag;\n        }\n    },\n\n    getFieldTypeLength: function (fieldTypeName) {\n        if (['BYTE', 'ASCII', 'SBYTE', 'UNDEFINED'].indexOf(fieldTypeName) !== -1) {\n            return 1;\n        } else if (['SHORT', 'SSHORT'].indexOf(fieldTypeName) !== -1) {\n            return 2;\n        } else if (['LONG', 'SLONG', 'FLOAT'].indexOf(fieldTypeName) !== -1) {\n            return 4;\n        } else if (['RATIONAL', 'SRATIONAL', 'DOUBLE'].indexOf(fieldTypeName) !== -1) {\n            return 8;\n        }\n        return null;\n    },\n\n    getFieldValues: function (fieldTagName, fieldTypeName, typeCount, valueOffset) {\n        var fieldValues = [];\n        var fieldTypeLength = this.getFieldTypeLength(fieldTypeName);\n        var fieldValueSize = fieldTypeLength * typeCount;\n\n        if (fieldValueSize <= 4) {\n            // The value is stored at the big end of the valueOffset.\n            if (this.littleEndian === false)\n                fieldValues.push(valueOffset >>> ((4 - fieldTypeLength) * 8));\n            else\n                fieldValues.push(valueOffset);\n        } else {\n            for (var i = 0; i < typeCount; i++) {\n                var indexOffset = fieldTypeLength * i;\n                if (fieldTypeLength >= 8) {\n                    if (['RATIONAL', 'SRATIONAL'].indexOf(fieldTypeName) !== -1) {\n                        // Numerator\n                        fieldValues.push(this.getUint32(valueOffset + indexOffset));\n                        // Denominator\n                        fieldValues.push(this.getUint32(valueOffset + indexOffset + 4));\n                    } else {\n                        cc.log(\"Can't handle this field type or size\");\n                    }\n                } else {\n                    fieldValues.push(this.getBytes(fieldTypeLength, valueOffset + indexOffset));\n                }\n            }\n        }\n\n        if (fieldTypeName === 'ASCII') {\n            fieldValues.forEach(function (e, i, a) {\n                a[i] = String.fromCharCode(e);\n            });\n        }\n        return fieldValues;\n    },\n\n    getBytes: function (numBytes, offset) {\n        if (numBytes <= 0) {\n            cc.log(\"No bytes requested\");\n        } else if (numBytes <= 1) {\n            return this.getUint8(offset);\n        } else if (numBytes <= 2) {\n            return this.getUint16(offset);\n        } else if (numBytes <= 3) {\n            return this.getUint32(offset) >>> 8;\n        } else if (numBytes <= 4) {\n            return this.getUint32(offset);\n        } else {\n            cc.log(\"Too many bytes requested\");\n        }\n    },\n\n    getBits: function (numBits, byteOffset, bitOffset) {\n        bitOffset = bitOffset || 0;\n        var extraBytes = Math.floor(bitOffset / 8);\n        var newByteOffset = byteOffset + extraBytes;\n        var totalBits = bitOffset + numBits;\n        var shiftRight = 32 - numBits;\n        var shiftLeft,rawBits;\n\n        if (totalBits <= 0) {\n            console.log(\"No bits requested\");\n        } else if (totalBits <= 8) {\n            shiftLeft = 24 + bitOffset;\n            rawBits = this.getUint8(newByteOffset);\n        } else if (totalBits <= 16) {\n            shiftLeft = 16 + bitOffset;\n            rawBits = this.getUint16(newByteOffset);\n        } else if (totalBits <= 32) {\n            shiftLeft = bitOffset;\n            rawBits = this.getUint32(newByteOffset);\n        } else {\n            console.log( \"Too many bits requested\" );\n        }\n\n        return {\n            'bits': ((rawBits << shiftLeft) >>> shiftRight),\n            'byteOffset': newByteOffset + Math.floor(totalBits / 8),\n            'bitOffset': totalBits % 8\n        };\n    },\n\n    parseFileDirectory: function (byteOffset) {\n        var numDirEntries = this.getUint16(byteOffset);\n        var tiffFields = [];\n\n        for (var i = byteOffset + 2, entryCount = 0; entryCount < numDirEntries; i += 12, entryCount++) {\n            var fieldTag = this.getUint16(i);\n            var fieldType = this.getUint16(i + 2);\n            var typeCount = this.getUint32(i + 4);\n            var valueOffset = this.getUint32(i + 8);\n\n            var fieldTagName = this.getFieldTagName(fieldTag);\n            var fieldTypeName = this.getFieldTypeName(fieldType);\n            var fieldValues = this.getFieldValues(fieldTagName, fieldTypeName, typeCount, valueOffset);\n\n            tiffFields[fieldTagName] = { type: fieldTypeName, values: fieldValues };\n        }\n\n        this._fileDirectories.push(tiffFields);\n\n        var nextIFDByteOffset = this.getUint32(i);\n        if (nextIFDByteOffset !== 0x00000000) {\n            this.parseFileDirectory(nextIFDByteOffset);\n        }\n    },\n\n    clampColorSample: function(colorSample, bitsPerSample) {\n        var multiplier = Math.pow(2, 8 - bitsPerSample);\n\n        return Math.floor((colorSample * multiplier) + (multiplier - 1));\n    },\n\n    /**\n     * @function\n     * @param {Array} tiffData\n     * @param {HTMLCanvasElement} canvas\n     * @returns {*}\n     */\n    parseTIFF: function (tiffData, canvas) {\n        canvas = canvas || document.createElement('canvas');\n\n        this._tiffData = tiffData;\n        this.canvas = canvas;\n\n        this.checkLittleEndian();\n\n        if (!this.hasTowel()) {\n            return;\n        }\n\n        var firstIFDByteOffset = this.getUint32(4);\n\n        this._fileDirectories.length = 0;\n        this.parseFileDirectory(firstIFDByteOffset);\n\n        var fileDirectory = this._fileDirectories[0];\n\n        var imageWidth = fileDirectory['ImageWidth'].values[0];\n        var imageLength = fileDirectory['ImageLength'].values[0];\n\n        this.canvas.width = imageWidth;\n        this.canvas.height = imageLength;\n\n        var strips = [];\n\n        var compression = (fileDirectory['Compression']) ? fileDirectory['Compression'].values[0] : 1;\n\n        var samplesPerPixel = fileDirectory['SamplesPerPixel'].values[0];\n\n        var sampleProperties = [];\n\n        var bitsPerPixel = 0;\n        var hasBytesPerPixel = false;\n\n        fileDirectory['BitsPerSample'].values.forEach(function (bitsPerSample, i, bitsPerSampleValues) {\n            sampleProperties[i] = {\n                bitsPerSample: bitsPerSample,\n                hasBytesPerSample: false,\n                bytesPerSample: undefined\n            };\n\n            if ((bitsPerSample % 8) === 0) {\n                sampleProperties[i].hasBytesPerSample = true;\n                sampleProperties[i].bytesPerSample = bitsPerSample / 8;\n            }\n\n            bitsPerPixel += bitsPerSample;\n        }, this);\n\n        if ((bitsPerPixel % 8) === 0) {\n            hasBytesPerPixel = true;\n            var bytesPerPixel = bitsPerPixel / 8;\n        }\n\n        var stripOffsetValues = fileDirectory['StripOffsets'].values;\n        var numStripOffsetValues = stripOffsetValues.length;\n\n        // StripByteCounts is supposed to be required, but see if we can recover anyway.\n        if (fileDirectory['StripByteCounts']) {\n            var stripByteCountValues = fileDirectory['StripByteCounts'].values;\n        } else {\n            cc.log(\"Missing StripByteCounts!\");\n\n            // Infer StripByteCounts, if possible.\n            if (numStripOffsetValues === 1) {\n                var stripByteCountValues = [Math.ceil((imageWidth * imageLength * bitsPerPixel) / 8)];\n            } else {\n                throw Error(\"Cannot recover from missing StripByteCounts\");\n            }\n        }\n\n        // Loop through strips and decompress as necessary.\n        for (var i = 0; i < numStripOffsetValues; i++) {\n            var stripOffset = stripOffsetValues[i];\n            strips[i] = [];\n\n            var stripByteCount = stripByteCountValues[i];\n\n            // Loop through pixels.\n            for (var byteOffset = 0, bitOffset = 0, jIncrement = 1, getHeader = true, pixel = [], numBytes = 0, sample = 0, currentSample = 0;\n                 byteOffset < stripByteCount; byteOffset += jIncrement) {\n                // Decompress strip.\n                switch (compression) {\n                    // Uncompressed\n                    case 1:\n                        // Loop through samples (sub-pixels).\n                        for (var m = 0, pixel = []; m < samplesPerPixel; m++) {\n                            if (sampleProperties[m].hasBytesPerSample) {\n                                // XXX: This is wrong!\n                                var sampleOffset = sampleProperties[m].bytesPerSample * m;\n                                pixel.push(this.getBytes(sampleProperties[m].bytesPerSample, stripOffset + byteOffset + sampleOffset));\n                            } else {\n                                var sampleInfo = this.getBits(sampleProperties[m].bitsPerSample, stripOffset + byteOffset, bitOffset);\n                                pixel.push(sampleInfo.bits);\n                                byteOffset = sampleInfo.byteOffset - stripOffset;\n                                bitOffset = sampleInfo.bitOffset;\n\n                                throw RangeError(\"Cannot handle sub-byte bits per sample\");\n                            }\n                        }\n\n                        strips[i].push(pixel);\n\n                        if (hasBytesPerPixel) {\n                            jIncrement = bytesPerPixel;\n                        } else {\n                            jIncrement = 0;\n                            throw RangeError(\"Cannot handle sub-byte bits per pixel\");\n                        }\n                        break;\n\n                    // CITT Group 3 1-Dimensional Modified Huffman run-length encoding\n                    case 2:\n                        // XXX: Use PDF.js code?\n                        break;\n\n                    // Group 3 Fax\n                    case 3:\n                        // XXX: Use PDF.js code?\n                        break;\n\n                    // Group 4 Fax\n                    case 4:\n                        // XXX: Use PDF.js code?\n                        break;\n\n                    // LZW\n                    case 5:\n                        // XXX: Use PDF.js code?\n                        break;\n\n                    // Old-style JPEG (TIFF 6.0)\n                    case 6:\n                        // XXX: Use PDF.js code?\n                        break;\n\n                    // New-style JPEG (TIFF Specification Supplement 2)\n                    case 7:\n                        // XXX: Use PDF.js code?\n                        break;\n\n                    // PackBits\n                    case 32773:\n                        // Are we ready for a new block?\n                        if (getHeader) {\n                            getHeader = false;\n\n                            var blockLength = 1;\n                            var iterations = 1;\n\n                            // The header byte is signed.\n                            var header = this.getInt8(stripOffset + byteOffset);\n\n                            if ((header >= 0) && (header <= 127)) { // Normal pixels.\n                                blockLength = header + 1;\n                            } else if ((header >= -127) && (header <= -1)) { // Collapsed pixels.\n                                iterations = -header + 1;\n                            } else /*if (header === -128)*/ { // Placeholder byte?\n                                getHeader = true;\n                            }\n                        } else {\n                            var currentByte = this.getUint8(stripOffset + byteOffset);\n\n                            // Duplicate bytes, if necessary.\n                            for (var m = 0; m < iterations; m++) {\n                                if (sampleProperties[sample].hasBytesPerSample) {\n                                    // We're reading one byte at a time, so we need to handle multi-byte samples.\n                                    currentSample = (currentSample << (8 * numBytes)) | currentByte;\n                                    numBytes++;\n\n                                    // Is our sample complete?\n                                    if (numBytes === sampleProperties[sample].bytesPerSample) {\n                                        pixel.push(currentSample);\n                                        currentSample = numBytes = 0;\n                                        sample++;\n                                    }\n                                } else {\n                                    throw RangeError(\"Cannot handle sub-byte bits per sample\");\n                                }\n\n                                // Is our pixel complete?\n                                if (sample === samplesPerPixel) {\n                                    strips[i].push(pixel);\n                                    pixel = [];\n                                    sample = 0;\n                                }\n                            }\n\n                            blockLength--;\n\n                            // Is our block complete?\n                            if (blockLength === 0) {\n                                getHeader = true;\n                            }\n                        }\n\n                        jIncrement = 1;\n                        break;\n\n                    // Unknown compression algorithm\n                    default:\n                        // Do not attempt to parse the image data.\n                        break;\n                }\n            }\n        }\n\n        if (canvas.getContext) {\n            var ctx = this.canvas.getContext(\"2d\");\n\n            // Set a default fill style.\n            ctx.fillStyle = \"rgba(255, 255, 255, 0)\";\n\n            // If RowsPerStrip is missing, the whole image is in one strip.\n            var rowsPerStrip = fileDirectory['RowsPerStrip'] ? fileDirectory['RowsPerStrip'].values[0] : imageLength;\n\n            var numStrips = strips.length;\n\n            var imageLengthModRowsPerStrip = imageLength % rowsPerStrip;\n            var rowsInLastStrip = (imageLengthModRowsPerStrip === 0) ? rowsPerStrip : imageLengthModRowsPerStrip;\n\n            var numRowsInStrip = rowsPerStrip;\n            var numRowsInPreviousStrip = 0;\n\n            var photometricInterpretation = fileDirectory['PhotometricInterpretation'].values[0];\n\n            var extraSamplesValues = [];\n            var numExtraSamples = 0;\n\n            if (fileDirectory['ExtraSamples']) {\n                extraSamplesValues = fileDirectory['ExtraSamples'].values;\n                numExtraSamples = extraSamplesValues.length;\n            }\n\n            if (fileDirectory['ColorMap']) {\n                var colorMapValues = fileDirectory['ColorMap'].values;\n                var colorMapSampleSize = Math.pow(2, sampleProperties[0].bitsPerSample);\n            }\n\n            // Loop through the strips in the image.\n            for (var i = 0; i < numStrips; i++) {\n                // The last strip may be short.\n                if ((i + 1) === numStrips) {\n                    numRowsInStrip = rowsInLastStrip;\n                }\n\n                var numPixels = strips[i].length;\n                var yPadding = numRowsInPreviousStrip * i;\n\n                // Loop through the rows in the strip.\n                for (var y = 0, j = 0; y < numRowsInStrip, j < numPixels; y++) {\n                    // Loop through the pixels in the row.\n                    for (var x = 0; x < imageWidth; x++, j++) {\n                        var pixelSamples = strips[i][j];\n\n                        var red = 0;\n                        var green = 0;\n                        var blue = 0;\n                        var opacity = 1.0;\n\n                        if (numExtraSamples > 0) {\n                            for (var k = 0; k < numExtraSamples; k++) {\n                                if (extraSamplesValues[k] === 1 || extraSamplesValues[k] === 2) {\n                                    // Clamp opacity to the range [0,1].\n                                    opacity = pixelSamples[3 + k] / 256;\n\n                                    break;\n                                }\n                            }\n                        }\n\n                        switch (photometricInterpretation) {\n                            // Bilevel or Grayscale\n                            // WhiteIsZero\n                            case 0:\n                                if (sampleProperties[0].hasBytesPerSample) {\n                                    var invertValue = Math.pow(0x10, sampleProperties[0].bytesPerSample * 2);\n                                }\n\n                                // Invert samples.\n                                pixelSamples.forEach(function (sample, index, samples) {\n                                    samples[index] = invertValue - sample;\n                                });\n\n                            // Bilevel or Grayscale\n                            // BlackIsZero\n                            case 1:\n                                red = green = blue = this.clampColorSample(pixelSamples[0], sampleProperties[0].bitsPerSample);\n                                break;\n\n                            // RGB Full Color\n                            case 2:\n                                red = this.clampColorSample(pixelSamples[0], sampleProperties[0].bitsPerSample);\n                                green = this.clampColorSample(pixelSamples[1], sampleProperties[1].bitsPerSample);\n                                blue = this.clampColorSample(pixelSamples[2], sampleProperties[2].bitsPerSample);\n                                break;\n\n                            // RGB Color Palette\n                            case 3:\n                                if (colorMapValues === undefined) {\n                                    throw Error(\"Palette image missing color map\");\n                                }\n\n                                var colorMapIndex = pixelSamples[0];\n\n                                red = this.clampColorSample(colorMapValues[colorMapIndex], 16);\n                                green = this.clampColorSample(colorMapValues[colorMapSampleSize + colorMapIndex], 16);\n                                blue = this.clampColorSample(colorMapValues[(2 * colorMapSampleSize) + colorMapIndex], 16);\n                                break;\n\n                            // Unknown Photometric Interpretation\n                            default:\n                                throw RangeError('Unknown Photometric Interpretation:', photometricInterpretation);\n                                break;\n                        }\n\n                        ctx.fillStyle = \"rgba(\" + red + \", \" + green + \", \" + blue + \", \" + opacity + \")\";\n                        ctx.fillRect(x, yPadding + y, 1, 1);\n                    }\n                }\n\n                numRowsInPreviousStrip = numRowsInStrip;\n            }\n        }\n\n        return this.canvas;\n    },\n\n    // See: http://www.digitizationguidelines.gov/guidelines/TIFF_Metadata_Final.pdf\n    // See: http://www.digitalpreservation.gov/formats/content/tiff_tags.shtml\n    fieldTagNames: {\n        // TIFF Baseline\n        0x013B: 'Artist',\n        0x0102: 'BitsPerSample',\n        0x0109: 'CellLength',\n        0x0108: 'CellWidth',\n        0x0140: 'ColorMap',\n        0x0103: 'Compression',\n        0x8298: 'Copyright',\n        0x0132: 'DateTime',\n        0x0152: 'ExtraSamples',\n        0x010A: 'FillOrder',\n        0x0121: 'FreeByteCounts',\n        0x0120: 'FreeOffsets',\n        0x0123: 'GrayResponseCurve',\n        0x0122: 'GrayResponseUnit',\n        0x013C: 'HostComputer',\n        0x010E: 'ImageDescription',\n        0x0101: 'ImageLength',\n        0x0100: 'ImageWidth',\n        0x010F: 'Make',\n        0x0119: 'MaxSampleValue',\n        0x0118: 'MinSampleValue',\n        0x0110: 'Model',\n        0x00FE: 'NewSubfileType',\n        0x0112: 'Orientation',\n        0x0106: 'PhotometricInterpretation',\n        0x011C: 'PlanarConfiguration',\n        0x0128: 'ResolutionUnit',\n        0x0116: 'RowsPerStrip',\n        0x0115: 'SamplesPerPixel',\n        0x0131: 'Software',\n        0x0117: 'StripByteCounts',\n        0x0111: 'StripOffsets',\n        0x00FF: 'SubfileType',\n        0x0107: 'Threshholding',\n        0x011A: 'XResolution',\n        0x011B: 'YResolution',\n\n        // TIFF Extended\n        0x0146: 'BadFaxLines',\n        0x0147: 'CleanFaxData',\n        0x0157: 'ClipPath',\n        0x0148: 'ConsecutiveBadFaxLines',\n        0x01B1: 'Decode',\n        0x01B2: 'DefaultImageColor',\n        0x010D: 'DocumentName',\n        0x0150: 'DotRange',\n        0x0141: 'HalftoneHints',\n        0x015A: 'Indexed',\n        0x015B: 'JPEGTables',\n        0x011D: 'PageName',\n        0x0129: 'PageNumber',\n        0x013D: 'Predictor',\n        0x013F: 'PrimaryChromaticities',\n        0x0214: 'ReferenceBlackWhite',\n        0x0153: 'SampleFormat',\n        0x022F: 'StripRowCounts',\n        0x014A: 'SubIFDs',\n        0x0124: 'T4Options',\n        0x0125: 'T6Options',\n        0x0145: 'TileByteCounts',\n        0x0143: 'TileLength',\n        0x0144: 'TileOffsets',\n        0x0142: 'TileWidth',\n        0x012D: 'TransferFunction',\n        0x013E: 'WhitePoint',\n        0x0158: 'XClipPathUnits',\n        0x011E: 'XPosition',\n        0x0211: 'YCbCrCoefficients',\n        0x0213: 'YCbCrPositioning',\n        0x0212: 'YCbCrSubSampling',\n        0x0159: 'YClipPathUnits',\n        0x011F: 'YPosition',\n\n        // EXIF\n        0x9202: 'ApertureValue',\n        0xA001: 'ColorSpace',\n        0x9004: 'DateTimeDigitized',\n        0x9003: 'DateTimeOriginal',\n        0x8769: 'Exif IFD',\n        0x9000: 'ExifVersion',\n        0x829A: 'ExposureTime',\n        0xA300: 'FileSource',\n        0x9209: 'Flash',\n        0xA000: 'FlashpixVersion',\n        0x829D: 'FNumber',\n        0xA420: 'ImageUniqueID',\n        0x9208: 'LightSource',\n        0x927C: 'MakerNote',\n        0x9201: 'ShutterSpeedValue',\n        0x9286: 'UserComment',\n\n        // IPTC\n        0x83BB: 'IPTC',\n\n        // ICC\n        0x8773: 'ICC Profile',\n\n        // XMP\n        0x02BC: 'XMP',\n\n        // GDAL\n        0xA480: 'GDAL_METADATA',\n        0xA481: 'GDAL_NODATA',\n\n        // Photoshop\n        0x8649: 'Photoshop'\n    },\n\n    fieldTypeNames: {\n        0x0001: 'BYTE',\n        0x0002: 'ASCII',\n        0x0003: 'SHORT',\n        0x0004: 'LONG',\n        0x0005: 'RATIONAL',\n        0x0006: 'SBYTE',\n        0x0007: 'UNDEFINED',\n        0x0008: 'SSHORT',\n        0x0009: 'SLONG',\n        0x000A: 'SRATIONAL',\n        0x000B: 'FLOAT',\n        0x000C: 'DOUBLE'\n    }\n};"]}