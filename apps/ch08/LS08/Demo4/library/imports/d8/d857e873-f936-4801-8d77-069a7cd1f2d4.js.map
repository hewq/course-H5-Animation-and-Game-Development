{"version":3,"sources":["../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/jsb_debugger.js"],"names":["gTestGlobals","needToSendNavigation","testTab","TestTabList","aConnection","conn","_tabActors","_tabActorPool","ActorPool","global","actor","TestTabActor","selected","push","addActor","length","addActorPool","prototype","constructor","getList","resolve","createRootActor","root","RootActor","tabList","globalActorFactories","DebuggerServer","aGlobal","makeDebugger","dbg","Debugger","addDebuggee","_global","wrappedJSObject","threadActor","ThreadActor","consoleActor","WebConsoleActor","_attached","_extraActors","actorPrefix","window","url","sources","_sources","TabSources","form","response","actorID","title","actorPool","isEmpty","onAttach","aRequest","type","onDetach","onReload","reset","sourceMaps","clearDebuggees","addDebuggees","removeActorByName","aName","removeActor","requestTypes","transport","incomingData","processInput","inputstr","init","setRootActor","_onConnection","extractPacket","inputString","sep","indexOf","count","substring","exec","packet","handlePacket","DevToolsUtils","utf8to16","parsed","JSON","parse","onPacket","e","msg","stack","_prepareDebugger","globalDebuggee","cc","require","DebuggerTransport"],"mappings":"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","file":"jsb_debugger.js","sourceRoot":"../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script","sourcesContent":["/*\n * Copyright (c) 2013-2016 Chukong Technologies Inc.\n * Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n\n// const { ActorPool, appendExtraActors, createExtraActors } = require(\"devtools/server/actors/common\");\n// const { RootActor } = require(\"devtools/server/actors/root\");\n// const { ThreadActor } = require(\"devtools/server/actors/script\");\n// const { DebuggerServer } = require(\"devtools/server/main\");\n// const { TabSources } = require(\"devtools/server/actors/utils/TabSources\");\n// const promise = require(\"promise\");\n// const makeDebugger = require(\"devtools/server/actors/utils/make-debugger\");\n\n\nlet gTestGlobals = [];\nlet needToSendNavigation = false;\nlet testTab = null;\n\n// A mock tab list, for use by tests. This simply presents each global in\n// gTestGlobals as a tab, and the list is fixed: it never calls its\n// onListChanged handler.\n//\n// As implemented now, we consult gTestGlobals when we're constructed, not\n// when we're iterated over, so tests have to add their globals before the\n// root actor is created.\nfunction TestTabList(aConnection) {\n  this.conn = aConnection;\n\n  // An array of actors for each global added with\n  // DebuggerServer.addTestGlobal.\n  this._tabActors = [];\n\n  // A pool mapping those actors' names to the actors.\n  this._tabActorPool = new ActorPool(aConnection);\n\n  for (let global of gTestGlobals) {\n    let actor = new TestTabActor(aConnection, global);\n    testTab = actor;\n    actor.selected = false;\n    this._tabActors.push(actor);\n    this._tabActorPool.addActor(actor);\n  }\n  if (this._tabActors.length > 0) {\n    this._tabActors[0].selected = true;\n  }\n\n  aConnection.addActorPool(this._tabActorPool);\n}\n\nTestTabList.prototype = {\n  constructor: TestTabList,\n  getList: function () {\n    return resolve([...this._tabActors]);\n  }\n};\n\nfunction createRootActor(aConnection)\n{\n  let root = new RootActor(aConnection, {\n    tabList: new TestTabList(aConnection),\n    globalActorFactories: DebuggerServer.globalActorFactories,\n  });\n\n  // root.applicationType = \"xpcshell-tests\";\n  return root;\n}\n\nfunction TestTabActor(aConnection, aGlobal)\n{\n  this.makeDebugger = function() {\n    let dbg = new Debugger();\n    dbg.addDebuggee(this._global);\n    return dbg;\n  };\n\n  this.conn = aConnection;\n  this._global = aGlobal;\n  this._global.wrappedJSObject = aGlobal;\n  this.threadActor = new ThreadActor(this, this._global);\n  this.conn.addActor(this.threadActor);\n  this.consoleActor = new WebConsoleActor(this.conn, this);\n  this.conn.addActor(this.consoleActor);\n  this._attached = false;\n  this._extraActors = {};\n  // this.makeDebugger = makeDebugger.bind(null, {\n  //   findDebuggees: () => [this._global],\n  //   shouldAddNewGlobalAsDebuggee: g => g.hostAnnotations &&\n  //                                      g.hostAnnotations.type == \"document\" &&\n  //                                      g.hostAnnotations.element === this._global\n\n  // });\n}\n\nTestTabActor.prototype = {\n  constructor: TestTabActor,\n  actorPrefix: \"TestTabActor\",\n\n  get window() {\n    return this._global;\n  },\n\n  get url() {\n    // return \"http://cocos2d-x.org\";\n    return \"about:cehome\";\n  },\n\n  get sources() {\n    if (!this._sources) {\n      this._sources = new TabSources(this.threadActor);\n    }\n    return this._sources;\n  },\n\n  form: function() {\n    let response = { actor: this.actorID, title: \"cocos project\", 'consoleActor': this.consoleActor.actorID };\n\n    // Walk over tab actors added by extensions and add them to a new ActorPool.\n    let actorPool = new ActorPool(this.conn);\n    // this._createExtraActors(DebuggerServer.tabActorFactories, actorPool);\n    if (!actorPool.isEmpty()) {\n      this._tabActorPool = actorPool;\n      this.conn.addActorPool(this._tabActorPool);\n    }\n\n    // this._appendExtraActors(response);\n\n    return response;\n  },\n\n  onAttach: function(aRequest) {\n    this._attached = true;\n\n    let response = { type: \"tabAttached\", threadActor: this.threadActor.actorID};\n    // this._appendExtraActors(response);\n\n    return response;\n  },\n\n  onDetach: function(aRequest) {\n    if (!this._attached) {\n      return { \"error\":\"wrongState\" };\n    }\n    return { type: \"detached\" };\n  },\n\n  onReload: function(aRequest) {\n    this.sources.reset({ sourceMaps: true });\n    this.threadActor.clearDebuggees();\n    this.threadActor.dbg.addDebuggees();\n    return {};\n  },\n\n  removeActorByName: function(aName) {\n    const actor = this._extraActors[aName];\n    if (this._tabActorPool) {\n      this._tabActorPool.removeActor(actor);\n    }\n    delete this._extraActors[aName];\n  },\n\n  /* Support for DebuggerServer.addTabActor. */\n  // _createExtraActors: createExtraActors,\n  // _appendExtraActors: appendExtraActors\n};\n\nTestTabActor.prototype.requestTypes = {\n  \"attach\": TestTabActor.prototype.onAttach,\n  \"detach\": TestTabActor.prototype.onDetach,\n  \"reload\": TestTabActor.prototype.onReload\n};\n\nlet conn = null;\nlet transport = null;\n\nlet incomingData = '';\n\nthis.processInput = function (inputstr) {\n    if (!inputstr) {\n\n      return;\n    }\n\n    if (inputstr === \"connected\")\n    {\n    \tDebuggerServer.init();\n      DebuggerServer.setRootActor(createRootActor);\n      conn = DebuggerServer._onConnection(transport);\n        \n      return;\n    }\n\n    \n    function extractPacket(inputString) {\n      // Well this is ugly.\n      let sep = inputString.indexOf(':');\n      if (sep < 0) {\n        return null;\n      }\n\n      let count = inputString.substring(0, sep);\n      // Check for a positive number with no garbage afterwards.\n      if (!/^[0-9]+$/.exec(count)) {\n        return null;\n      }\n\n      count = +count;\n      if (inputString.length - (sep + 1) < count) {\n        // Don't have a complete request yet.\n        return null;\n      }\n\n      // We have a complete request, pluck it out of the data and parse it.\n      inputString = inputString.substring(sep + 1);\n      let packet = inputString.substring(0, count);\n      incomingData = inputString.substring(count);\n\n      return packet;\n    }\n\n    function handlePacket(packet) {\n      try {\n        // packet = this._converter.ConvertToUnicode(packet);\n        packet = DevToolsUtils.utf8to16(packet);\n        var parsed = JSON.parse(packet);\n        conn.onPacket(parsed);\n      } catch(e) {\n        let msg = \"Error parsing incoming packet: \" + packet + \" (\" + e + \" - \" + e.stack + \")\";\n      }\n    }\n\n    incomingData += inputstr;\n    var packet;\n    while (packet = extractPacket(incomingData)) {\n      handlePacket(packet);\n    }\n};\n\nthis._prepareDebugger = function (global) {\n\n    this.globalDebuggee = global;\n    cc = global.cc;\n    // exports = global;\n    // load all functions exported in DevToolsUtils to global(exports)\n    require('script/debugger/DevToolsUtils.js', 'debug');\n    require('script/debugger/event-emitter.js', 'debug');\n    require('script/debugger/actors/utils/ScriptStore.js', 'debug');\n    require('script/debugger/actors/common.js', 'debug');\n    require('script/debugger/core/promise.js', 'debug');\n    require('script/debugger/transport.js', 'debug');\n    require('script/debugger/main.js', 'debug');\n    require('script/debugger/actors/object.js', 'debug');\n    require('script/debugger/actors/root.js', 'debug');\n    require('script/debugger/actors/script.js', 'debug');\n    require('script/debugger/actors/webconsole.js', 'debug')\n    require('script/debugger/actors/utils/TabSources.js', 'debug');\n    \n    //DebuggerServer.addTestGlobal = function(aGlobal) {\n      gTestGlobals.push(global);\n    //};\n\n    transport = new DebuggerTransport();\n};\n\n"]}