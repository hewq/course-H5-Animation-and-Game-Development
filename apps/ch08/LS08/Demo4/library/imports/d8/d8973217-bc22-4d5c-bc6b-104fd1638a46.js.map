{"version":3,"sources":["../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/common.js"],"names":["OriginalLocation","actor","line","column","name","_connection","conn","_actorID","actorID","undefined","_line","_column","_name","fromGeneratedLocation","generatedLocation","generatedSourceActor","generatedLine","generatedColumn","prototype","originalSourceActor","getActor","originalUrl","source","url","_originalUrl","originalLine","originalColumn","originalName","Error","equals","other","toJSON","form","GeneratedLocation","lastColumn","_lastColumn","fromOriginalLocation","originalLocation","generatedLastColumn","getOffsetColumn","aOffset","aScript","bestOffsetMapping","getAllColumnOffsets","offsetMapping","offset","reportError","columnNumber","ActorPool","aConnection","_cleanups","_actors","addActor","AP_addActor","aActor","prefix","actorPrefix","typeName","allocID","registeredPool","removeActor","disconnect","get","AP_get","aActorID","has","AP_has","isEmpty","AP_isEmpty","Object","keys","length","AP_remove","unmanage","cleanup","AP_cleanup","id","forEach","callback"],"mappings":"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","file":"common.js","sourceRoot":"../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors","sourcesContent":["/****************************************************************************\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n \n http://www.cocos2d-x.org\n \n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n \n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n \n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * An OriginalLocation represents a location in an original source.\n *\n * @param SourceActor actor\n *        A SourceActor representing an original source.\n * @param Number line\n *        A line within the given source.\n * @param Number column\n *        A column within the given line.\n * @param String name\n *        The name of the symbol corresponding to this OriginalLocation.\n */\n\nfunction OriginalLocation(actor, line, column, name) {\n  this._connection = actor ? actor.conn : null;\n  this._actorID = actor ? actor.actorID : undefined;\n  this._line = line;\n  this._column = column;\n  this._name = name;\n}\n\nOriginalLocation.fromGeneratedLocation = function (generatedLocation) {\n  return new OriginalLocation(\n    generatedLocation.generatedSourceActor,\n    generatedLocation.generatedLine,\n    generatedLocation.generatedColumn\n  );\n};\n\nOriginalLocation.prototype = {\n  get originalSourceActor() {\n    return this._connection ? this._connection.getActor(this._actorID) : null;\n  },\n\n  get originalUrl() {\n    let actor = this.originalSourceActor;\n    let source = actor.source;\n    return source ? source.url : actor._originalUrl;\n  },\n\n  get originalLine() {\n    return this._line;\n  },\n\n  get originalColumn() {\n    return this._column;\n  },\n\n  get originalName() {\n    return this._name;\n  },\n\n  get generatedSourceActor() {\n    throw new Error(\"Shouldn't  access generatedSourceActor from an OriginalLocation\");\n  },\n\n  get generatedLine() {\n    throw new Error(\"Shouldn't access generatedLine from an OriginalLocation\");\n  },\n\n  get generatedColumn() {\n    throw new Error(\"Shouldn't access generatedColumn from an Originallocation\");\n  },\n\n  equals: function (other) {\n    return this.originalSourceActor.url == other.originalSourceActor.url &&\n           this.originalLine === other.originalLine &&\n           (this.originalColumn === undefined ||\n            other.originalColumn === undefined ||\n            this.originalColumn === other.originalColumn);\n  },\n\n  toJSON: function () {\n    return {\n      source: this.originalSourceActor.form(),\n      line: this.originalLine,\n      column: this.originalColumn\n    };\n  }\n};\n\n/**\n * A GeneratedLocation represents a location in a generated source.\n *\n * @param SourceActor actor\n *        A SourceActor representing a generated source.\n * @param Number line\n *        A line within the given source.\n * @param Number column\n *        A column within the given line.\n */\nfunction GeneratedLocation(actor, line, column, lastColumn) {\n  this._connection = actor ? actor.conn : null;\n  this._actorID = actor ? actor.actorID : undefined;\n  this._line = line;\n  this._column = column;\n  this._lastColumn = (lastColumn !== undefined) ? lastColumn : column + 1;\n}\n\nGeneratedLocation.fromOriginalLocation = function (originalLocation) {\n  return new GeneratedLocation(\n    originalLocation.originalSourceActor,\n    originalLocation.originalLine,\n    originalLocation.originalColumn\n  );\n};\n\nGeneratedLocation.prototype = {\n  get originalSourceActor() {\n    throw new Error();\n  },\n\n  get originalUrl() {\n    throw new Error(\"Shouldn't access originalUrl from a GeneratedLocation\");\n  },\n\n  get originalLine() {\n    throw new Error(\"Shouldn't access originalLine from a GeneratedLocation\");\n  },\n\n  get originalColumn() {\n    throw new Error(\"Shouldn't access originalColumn from a GeneratedLocation\");\n  },\n\n  get originalName() {\n    throw new Error(\"Shouldn't access originalName from a GeneratedLocation\");\n  },\n\n  get generatedSourceActor() {\n    return this._connection ? this._connection.getActor(this._actorID) : null;\n  },\n\n  get generatedLine() {\n    return this._line;\n  },\n\n  get generatedColumn() {\n    return this._column;\n  },\n\n  get generatedLastColumn() {\n    return this._lastColumn;\n  },\n\n  equals: function (other) {\n    return this.generatedSourceActor.url == other.generatedSourceActor.url &&\n           this.generatedLine === other.generatedLine &&\n           (this.generatedColumn === undefined ||\n            other.generatedColumn === undefined ||\n            this.generatedColumn === other.generatedColumn);\n  },\n\n  toJSON: function () {\n    return {\n      source: this.generatedSourceActor.form(),\n      line: this.generatedLine,\n      column: this.generatedColumn,\n      lastColumn: this.generatedLastColumn\n    };\n  }\n};\n\ngetOffsetColumn = function getOffsetColumn(aOffset, aScript) {\n  let bestOffsetMapping = null;\n  for (let offsetMapping of aScript.getAllColumnOffsets()) {\n    if (!bestOffsetMapping ||\n        (offsetMapping.offset <= aOffset &&\n         offsetMapping.offset > bestOffsetMapping.offset)) {\n      bestOffsetMapping = offsetMapping;\n    }\n  }\n\n  if (!bestOffsetMapping) {\n    // XXX: Try not to completely break the experience of using the debugger for\n    // the user by assuming column 0. Simultaneously, report the error so that\n    // there is a paper trail if the assumption is bad and the debugging\n    // experience becomes wonky.\n    reportError(new Error(\"Could not find a column for offset \" + aOffset\n                          + \" in the script \" + aScript));\n    return 0;\n  }\n\n  return bestOffsetMapping.columnNumber;\n}\n\n/**\n * Construct an ActorPool.\n *\n * ActorPools are actorID -> actor mapping and storage.  These are\n * used to accumulate and quickly dispose of groups of actors that\n * share a lifetime.\n */\nfunction ActorPool(aConnection)\n{\n  this.conn = aConnection;\n  this._cleanups = {};\n  this._actors = {};\n}\n\nActorPool.prototype = {\n  /**\n   * Add an actor to the actor pool.  If the actor doesn't have an ID,\n   * allocate one from the connection.\n   *\n   * @param aActor object\n   *        The actor implementation.  If the object has a\n   *        'disconnect' property, it will be called when the actor\n   *        pool is cleaned up.\n   */\n  addActor: function AP_addActor(aActor) {\n    aActor.conn = this.conn;\n    if (!aActor.actorID) {\n      let prefix = aActor.actorPrefix;\n      if (!prefix && typeof aActor == \"function\") {\n        // typeName is a convention used with protocol.js-based actors\n        prefix = aActor.prototype.actorPrefix || aActor.prototype.typeName;\n      }\n      aActor.actorID = this.conn.allocID(prefix || undefined);\n    }\n\n    if (aActor.registeredPool) {\n      aActor.registeredPool.removeActor(aActor);\n    }\n    aActor.registeredPool = this;\n\n    this._actors[aActor.actorID] = aActor;\n    if (aActor.disconnect) {\n      this._cleanups[aActor.actorID] = aActor;\n    }\n  },\n\n  get: function AP_get(aActorID) {\n    return this._actors[aActorID] || undefined;\n  },\n\n  has: function AP_has(aActorID) {\n    return aActorID in this._actors;\n  },\n\n  /**\n   * Returns true if the pool is empty.\n   */\n  isEmpty: function AP_isEmpty() {\n    return Object.keys(this._actors).length == 0;\n  },\n\n  /**\n   * Remove an actor from the actor pool.\n   */\n  removeActor: function AP_remove(aActor) {\n    delete this._actors[aActor.actorID];\n    delete this._cleanups[aActor.actorID];\n  },\n\n  /**\n   * Match the api expected by the protocol library.\n   */\n  unmanage: function(aActor) {\n    return this.removeActor(aActor);\n  },\n\n  /**\n   * Run all actor cleanups.\n   */\n  cleanup: function AP_cleanup() {\n    for (let id in this._cleanups) {\n      this._cleanups[id].disconnect();\n    }\n    this._cleanups = {};\n  },\n\n  forEach: function(callback) {\n    for (let name in this._actors) {\n      callback(this._actors[name]);\n    }\n  },\n}"]}