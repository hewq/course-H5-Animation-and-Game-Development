{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/extensions/editbox/assets/frameworks/cocos2d-html5/extensions/editbox/CCEditBox.js"],"names":["cc","KEYBOARD_RETURNTYPE_DEFAULT","KEYBOARD_RETURNTYPE_DONE","KEYBOARD_RETURNTYPE_SEND","KEYBOARD_RETURNTYPE_SEARCH","KEYBOARD_RETURNTYPE_GO","EDITBOX_INPUT_MODE_ANY","EDITBOX_INPUT_MODE_EMAILADDR","EDITBOX_INPUT_MODE_NUMERIC","EDITBOX_INPUT_MODE_PHONENUMBER","EDITBOX_INPUT_MODE_URL","EDITBOX_INPUT_MODE_DECIMAL","EDITBOX_INPUT_MODE_SINGLELINE","EDITBOX_INPUT_FLAG_PASSWORD","EDITBOX_INPUT_FLAG_SENSITIVE","EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD","EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE","EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS","EditBoxDelegate","Class","extend","editBoxEditingDidBegin","sender","editBoxEditingDidEnd","editBoxTextChanged","text","editBoxReturn","EditBox","Node","_backgroundSprite","_delegate","_editBoxInputMode","_editBoxInputFlag","_keyboardReturnType","_maxLength","_text","_textColor","_placeholderText","_placeholderFontName","_placeholderFontSize","_placeholderColor","_className","_touchListener","_touchEnabled","ctor","size","normal9SpriteBg","prototype","call","_anchorPoint","p","color","WHITE","GRAY","_renderCmd","_createLabels","createDomElementIfNeeded","initWithSizeAndBackgroundSprite","EventListener","create","event","TOUCH_ONE_BY_ONE","swallowTouches","onTouchBegan","_onTouchBegan","bind","onTouchEnded","_onTouchEnded","eventManager","addListener","setInputFlag","setTouchEnabled","enable","removeListener","_createRenderCmd","_renderType","game","RENDER_TYPE_CANVAS","CanvasRenderCmd","WebGLRenderCmd","setContentSize","width","height","undefined","_updateEditBoxSize","setVisible","visible","updateVisibility","_edTxt","_createDomTextArea","setTabIndex","index","tabIndex","getTabIndex","warn","setFocus","focus","isFocused","document","activeElement","stayOnTop","flag","_alwaysOnTop","cleanup","_super","_removeDomFromGameContainer","_isAncestorsVisible","node","parent","getParent","isVisible","touch","touchPoint","getLocation","bb","rect","_contentSize","hitted","rectContainsPoint","convertToNodeSpace","_endEditing","_beginEditing","_updateBackgroundSpriteSize","newWidth","newHeight","updateSize","setLineHeight","lineHeight","setFont","fontName","fontSize","_setFont","fontStyle","getBackgroundSprite","setFontName","setFontSize","setString","length","slice","setFontColor","setMaxLength","maxLength","isNaN","getMaxLength","setPlaceHolder","setPlaceholderFont","_updateDOMPlaceholderFontStyle","_setPlaceholderFont","res","LabelTTF","_fontStyleRE","exec","parseInt","setPlaceholderFontName","setPlaceholderFontSize","setPlaceholderFontColor","inputFlag","getString","removeFromParent","setAnchorPoint","addChild","x","y","setDelegate","delegate","getPlaceHolder","setInputMode","inputMode","oldText","transform","_updateLabelPosition","getContentSize","setReturnType","returnType","_updateDomInputType","initWithBackgroundColor","bgColor","_edWidth","dom","style","toString","_edHeight","backgroundColor","colorToHex","_p","font","defineGetterSetter","fontColor","string","placeHolder","placeHolderFont","placeHolderFontName","placeHolderFontSize","placeHolderFontColor","press9SpriteBg","disabled9SpriteBg","editbox","_polyfill","zoomInvalid","sys","OS_ANDROID","os","browserType","BROWSER_TYPE_SOUGOU","BROWSER_TYPE_360","polyfill","SCROLLY","TIMER_NAME","LEFT_PADDING","adjustEditBoxPosition","editBox","worldPos","convertToWorldSpace","windowHeight","visibleRect","windowWidth","factor","setTimeout","window","scrollY","scrollOffset","scrollTo","capitalize","replace","a","toUpperCase","capitalizeFirstLetter","charAt","EditBoxImpl","proto","Object","updateMatrix","_node","scaleX","view","_scaleX","scaleY","_scaleY","dpr","_devicePixelRatio","t","_worldTransform","container","b","c","d","offsetX","paddingLeft","offsetY","paddingBottom","tx","ty","matrix","visibility","_removeLabels","display","_showLabels","_beginEditingOnMobile","__orientationChanged","addEventListener","isAutoFullScreenEnabled","__fullscreen","enableAutoFullScreen","screen","exitFullScreen","__autoResize","__resizeWithBrowserSize","resizeWithBrowserSize","_endEditingOnMobile","__rotateScreen","containerStyle","_originalDesignResolutionSize","setDesignResolutionSize","_resolutionPolicy","removeEventListener","_onFocusOnMobile","_isRotated","margin","_createDomInput","thisPointer","tmpEdTxt","createElement","type","fontFamily","_edFontName","_edFontSize","border","background","active","outline","padding","textTransform","position","bottom","left","className","_editBox","value","_updateDomTextCases","e","keyCode","KEY","enter","stopPropagation","preventDefault","_canvas","_hiddenLabels","isMobile","_addDomToGameContainer","resize","overflow_y","toLowerCase","editBoxSize","_textLabel","_placeholderLabel","setColor","removeChild","labelContentSize","setDimensions","placeholderLabelSize","setPosition","setVerticalAlignment","VERTICAL_TEXT_ALIGNMENT_TOP","VERTICAL_TEXT_ALIGNMENT_CENTER","_updateLabelStringStyle","passwordString","len","i","_editingMode","self","textFontName","textFontSize","_updateDOMFontStyle","pattern","contentSize","editboxDomNode","appendChild","hasChild","contains","compareDocumentPosition","initializeRenderCmd","_rootCtor","canvasRenderCmdProto","inject","constructor","parentCmd","recursive","originTransform","webGLRenderCmdProto"],"mappings":"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","file":"CCEditBox.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/extensions/editbox","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n Copyright (c) 2012 James Chen\n Copyright (c) 2011-2012 cocos2d-x.org\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * @constant\n * @type Number\n */\ncc.KEYBOARD_RETURNTYPE_DEFAULT = 0;\n\n/**\n * @constant\n * @type Number\n */\ncc.KEYBOARD_RETURNTYPE_DONE = 1;\n\n/**\n * @constant\n * @type Number\n */\ncc.KEYBOARD_RETURNTYPE_SEND = 2;\n\n/**\n * @constant\n * @type Number\n */\ncc.KEYBOARD_RETURNTYPE_SEARCH = 3;\n\n/**\n * @constant\n * @type Number\n */\ncc.KEYBOARD_RETURNTYPE_GO = 4;\n\n/**\n * The EditBoxInputMode defines the type of text that the user is allowed * to enter.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_ANY = 0;\n\n/**\n * The user is allowed to enter an e-mail address.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_EMAILADDR = 1;\n\n/**\n * The user is allowed to enter an integer value.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_NUMERIC = 2;\n\n/**\n * The user is allowed to enter a phone number.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_PHONENUMBER = 3;\n\n/**\n * The user is allowed to enter a URL.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_URL = 4;\n\n/**\n * The user is allowed to enter a real number value.\n * This extends kEditBoxInputModeNumeric by allowing a decimal point.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_DECIMAL = 5;\n\n/**\n * The user is allowed to enter any text, except for line breaks.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_MODE_SINGLELINE = 6;\n\n/**\n * Indicates that the text entered is confidential data that should be\n * obscured whenever possible. This implies EDIT_BOX_INPUT_FLAG_SENSITIVE.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_FLAG_PASSWORD = 0;\n\n/**\n * Indicates that the text entered is sensitive data that the\n * implementation must never store into a dictionary or table for use\n * in predictive, auto-completing, or other accelerated input schemes.\n * A credit card number is an example of sensitive data.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_FLAG_SENSITIVE = 1;\n\n/**\n * This flag is a hint to the implementation that during text editing,\n * the initial letter of each word should be capitalized.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD = 2;\n\n/**\n * This flag is a hint to the implementation that during text editing,\n * the initial letter of each sentence should be capitalized.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE = 3;\n\n/**\n * Capitalize all characters automatically.\n * @constant\n * @type Number\n */\ncc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS = 4;\n\n/**\n * @class\n * @extends cc.Class\n */\ncc.EditBoxDelegate = cc.Class.extend({\n    /**\n     * This method is called when an edit box gains focus after keyboard is shown.\n     * @param {cc.EditBox} sender\n     */\n    editBoxEditingDidBegin: function (sender) {\n    },\n\n    /**\n     * This method is called when an edit box loses focus after keyboard is hidden.\n     * @param {cc.EditBox} sender\n     */\n    editBoxEditingDidEnd: function (sender) {\n    },\n\n    /**\n     * This method is called when the edit box text was changed.\n     * @param {cc.EditBox} sender\n     * @param {String} text\n     */\n    editBoxTextChanged: function (sender, text) {\n    },\n\n    /**\n     * This method is called when the return button was pressed.\n     * @param {cc.EditBox} sender\n     */\n    editBoxReturn: function (sender) {\n    }\n});\n\n\n/**\n * <p>cc.EditBox is a brief Class for edit box.<br/>\n * You can use this widget to gather small amounts of text from the user.</p>\n *\n * @class\n * @extends cc.Node\n *\n * @property {String}   string                  - Content string of edit box\n * @property {String}   maxLength               - Max length of the content string\n * @property {String}   font                    - <@writeonly> Config font of edit box\n * @property {String}   fontName                - <@writeonly> Config font name of edit box\n * @property {Number}   fontSize                - <@writeonly> Config font size of edit box\n * @property {cc.Color} fontColor               - <@writeonly> Config font color of edit box\n * @property {String}   placeHolder             - Place holder of edit box\n * @property {String}   placeHolderFont         - <@writeonly> Config font of place holder\n * @property {String}   placeHolderFontName     - <@writeonly> Config font name of place holder\n * @property {Number}   placeHolderFontSize     - <@writeonly> Config font size of place holder\n * @property {cc.Color} placeHolderFontColor    - <@writeonly> Config font color of place holder\n * @property {Number}   inputFlag               - <@writeonly> Input flag of edit box, one of the EditBoxInputFlag constants. e.g.cc.EDITBOX_INPUT_FLAG_PASSWORD\n * @property {Object}   delegate                - <@writeonly> Delegate of edit box\n * @property {Number}   inputMode               - <@writeonly> Input mode of the edit box. Value should be one of the EditBoxInputMode constants.\n * @property {Number}   returnType              - <@writeonly> Return type of edit box, value should be one of the KeyboardReturnType constants.\n *\n */\ncc.EditBox = cc.Node.extend({\n    _backgroundSprite: null,\n    _delegate: null,\n    _editBoxInputMode: cc.EDITBOX_INPUT_MODE_ANY,\n    _editBoxInputFlag: cc.EDITBOX_INPUT_FLAG_SENSITIVE,\n    _keyboardReturnType: cc.KEYBOARD_RETURNTYPE_DEFAULT,\n    _maxLength: 50,\n    _text: '',\n    _textColor: null,\n    _placeholderText: '',\n    _placeholderFontName: '',\n    _placeholderFontSize: 14,\n    _placeholderColor: null,\n    _className: 'EditBox',\n    _touchListener: null,\n    _touchEnabled: true,\n\n    /**\n     * constructor of cc.EditBox\n     * @param {cc.Size} size\n     * @param {cc.Scale9Sprite} normal9SpriteBg\n     * @param {cc.Scale9Sprite} press9SpriteBg\n     * @param {cc.Scale9Sprite} disabled9SpriteBg\n     */\n    ctor: function (size, normal9SpriteBg) {\n        cc.Node.prototype.ctor.call(this);\n\n        this._anchorPoint = cc.p(0.5, 0.5);\n        this._textColor = cc.color.WHITE;\n        this._placeholderColor = cc.color.GRAY;\n\n        this._renderCmd._createLabels();\n        this.createDomElementIfNeeded();\n        this.initWithSizeAndBackgroundSprite(size, normal9SpriteBg);\n\n        this._touchListener = cc.EventListener.create({\n            event: cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches: true,\n            onTouchBegan: this._onTouchBegan.bind(this),\n            onTouchEnded: this._onTouchEnded.bind(this)\n        });\n        cc.eventManager.addListener(this._touchListener, this);\n\n        this.setInputFlag(this._editBoxInputFlag);\n    },\n\n    setTouchEnabled: function (enable) {\n        if (this._touchEnabled === enable) {\n            return;\n        }\n        this._touchEnabled = enable;\n        if (this._touchEnabled) {\n            cc.eventManager.addListener(this._touchListener, this);\n        } else {\n            cc.eventManager.removeListener(this._touchListener);\n        }\n    },\n\n    _createRenderCmd: function () {\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            return new cc.EditBox.CanvasRenderCmd(this);\n        } else {\n            return new cc.EditBox.WebGLRenderCmd(this);\n        }\n    },\n\n    setContentSize: function (width, height) {\n        if (width.width !== undefined && width.height !== undefined) {\n            height = width.height;\n            width = width.width;\n        }\n        cc.Node.prototype.setContentSize.call(this, width, height);\n        this._updateEditBoxSize(width, height);\n    },\n\n    setVisible: function (visible) {\n        cc.Node.prototype.setVisible.call(this, visible);\n        this._renderCmd.updateVisibility();\n    },\n\n    createDomElementIfNeeded: function () {\n        if (!this._renderCmd._edTxt) {\n            this._renderCmd._createDomTextArea();\n        }\n    },\n\n    setTabIndex: function (index) {\n        if (this._renderCmd._edTxt) {\n            this._renderCmd._edTxt.tabIndex = index;\n        }\n    },\n\n    getTabIndex: function () {\n        if (this._renderCmd._edTxt) {\n            return this._renderCmd._edTxt.tabIndex;\n        }\n        cc.warn('The dom control is not created!');\n        return -1;\n    },\n\n    setFocus: function () {\n        if (this._renderCmd._edTxt) {\n            this._renderCmd._edTxt.focus();\n        }\n    },\n\n    isFocused: function () {\n        if (this._renderCmd._edTxt) {\n            return document.activeElement === this._renderCmd._edTxt;\n        }\n        cc.warn('The dom control is not created!');\n        return false;\n    },\n\n    stayOnTop: function (flag) {\n        if (this._alwaysOnTop === flag) return;\n\n        this._alwaysOnTop = flag;\n        this._renderCmd.stayOnTop(this._alwaysOnTop);\n    },\n\n    cleanup: function () {\n        this._super();\n\n        this._renderCmd._removeDomFromGameContainer();\n    },\n\n    _isAncestorsVisible: function (node) {\n        if (null == node)\n            return true;\n\n        var parent = node.getParent();\n\n        if (parent && !parent.isVisible())\n            return false;\n        return this._isAncestorsVisible(parent);\n    },\n\n    _onTouchBegan: function (touch) {\n        if (!this.isVisible() || !this._isAncestorsVisible(this)) {\n            return;\n        }\n        var touchPoint = touch.getLocation();\n        var bb = cc.rect(0, 0, this._contentSize.width, this._contentSize.height);\n        var hitted = cc.rectContainsPoint(bb, this.convertToNodeSpace(touchPoint));\n        if (hitted) {\n            return true;\n        }\n        else {\n            this._renderCmd._endEditing();\n            return false;\n        }\n    },\n\n    _onTouchEnded: function () {\n        if (!this.isVisible() || !this._isAncestorsVisible(this)) {\n            return;\n        }\n        this._renderCmd._beginEditing();\n    },\n\n    _updateBackgroundSpriteSize: function (width, height) {\n        if (this._backgroundSprite) {\n            this._backgroundSprite.setContentSize(width, height);\n        }\n    },\n\n    _updateEditBoxSize: function (size, height) {\n        var newWidth = (typeof size.width === 'number') ? size.width : size;\n        var newHeight = (typeof size.height === 'number') ? size.height : height;\n\n        this._updateBackgroundSpriteSize(newWidth, newHeight);\n        this._renderCmd.updateSize(newWidth, newHeight);\n    },\n\n    setLineHeight: function (lineHeight) {\n        this._renderCmd.setLineHeight(lineHeight);\n    },\n\n    /**\n     * Sets the font.\n     * @param {String} fontName  The font name.\n     * @param {Number} fontSize  The font size.\n     */\n    setFont: function (fontName, fontSize) {\n        this._renderCmd.setFont(fontName, fontSize);\n    },\n\n    _setFont: function (fontStyle) {\n        this._renderCmd._setFont(fontStyle);\n    },\n\n    getBackgroundSprite: function () {\n        return this._backgroundSprite;\n    },\n\n    /**\n     * Sets fontName\n     * @param {String} fontName\n     */\n    setFontName: function (fontName) {\n        this._renderCmd.setFontName(fontName);\n    },\n\n    /**\n     * Sets fontSize\n     * @param {Number} fontSize\n     */\n    setFontSize: function (fontSize) {\n        this._renderCmd.setFontSize(fontSize);\n    },\n\n    /**\n     * Sets the text entered in the edit box.\n     * @param {string} text The given text.\n     */\n    setString: function (text) {\n        if (text.length >= this._maxLength) {\n            text = text.slice(0, this._maxLength);\n        }\n        this._text = text;\n        this._renderCmd.setString(text);\n    },\n\n    /**\n     * Sets the font color of the widget's text.\n     * @param {cc.Color} color\n     */\n    setFontColor: function (color) {\n        this._textColor = color;\n        this._renderCmd.setFontColor(color);\n    },\n\n    /**\n     * Sets the maximum input length of the edit box. <br/>\n     * Setting this value enables multiline input mode by default.\n     * @param {Number} maxLength The maximum length.\n     */\n    setMaxLength: function (maxLength) {\n        if (!isNaN(maxLength)) {\n            if (maxLength < 0) {\n                //we can't set Number.MAX_VALUE to input's maxLength property\n                //so we use a magic number here, it should works at most use cases.\n                maxLength = 65535;\n            }\n            this._maxLength = maxLength;\n            this._renderCmd.setMaxLength(maxLength);\n        }\n    },\n\n    /**\n     * Gets the maximum input length of the edit box.\n     * @return {Number} Maximum input length.\n     */\n    getMaxLength: function () {\n        return this._maxLength;\n    },\n\n    /**\n     * Sets a text in the edit box that acts as a placeholder when an edit box is empty.\n     * @param {string} text The given text.\n     */\n    setPlaceHolder: function (text) {\n        if (text !== null) {\n            this._renderCmd.setPlaceHolder(text);\n            this._placeholderText = text;\n        }\n    },\n\n    /**\n     * Sets the placeholder's font.\n     * @param {String} fontName\n     * @param {Number} fontSize\n     */\n    setPlaceholderFont: function (fontName, fontSize) {\n        this._placeholderFontName = fontName;\n        this._placeholderFontSize = fontSize;\n        this._renderCmd._updateDOMPlaceholderFontStyle();\n    },\n\n    _setPlaceholderFont: function (fontStyle) {\n        var res = cc.LabelTTF._fontStyleRE.exec(fontStyle);\n        if (res) {\n            this._placeholderFontName = res[2];\n            this._placeholderFontSize = parseInt(res[1]);\n            this._renderCmd._updateDOMPlaceholderFontStyle();\n        }\n    },\n\n    /**\n     * Sets the placeholder's fontName.\n     * @param {String} fontName\n     */\n    setPlaceholderFontName: function (fontName) {\n        this._placeholderFontName = fontName;\n        this._renderCmd._updateDOMPlaceholderFontStyle();\n    },\n\n    /**\n     * Sets the placeholder's fontSize.\n     * @param {Number} fontSize\n     */\n    setPlaceholderFontSize: function (fontSize) {\n        this._placeholderFontSize = fontSize;\n        this._renderCmd._updateDOMPlaceholderFontStyle();\n    },\n\n    /**\n     * Sets the font color of the placeholder text when the edit box is empty.\n     * @param {cc.Color} color\n     */\n    setPlaceholderFontColor: function (color) {\n        this._placeholderColor = color;\n        this._renderCmd.setPlaceholderFontColor(color);\n    },\n\n    /**\n     * Sets the input flags that are to be applied to the edit box.\n     * @param {Number} inputFlag One of the EditBoxInputFlag constants.\n     * e.g.cc.EDITBOX_INPUT_FLAG_PASSWORD\n     */\n    setInputFlag: function (inputFlag) {\n        this._editBoxInputFlag = inputFlag;\n        this._renderCmd.setInputFlag(inputFlag);\n    },\n\n    /**\n     * Gets the input string of the edit box.\n     * @return {string}\n     */\n    getString: function () {\n        return this._text;\n    },\n\n    /**\n     * Init edit box with specified size.\n     * @param {cc.Size} size\n     * @param {cc.Color | cc.Scale9Sprite} normal9SpriteBg\n     */\n    initWithSizeAndBackgroundSprite: function (size, normal9SpriteBg) {\n        if (this._backgroundSprite) {\n            this._backgroundSprite.removeFromParent();\n        }\n        this._backgroundSprite = normal9SpriteBg;\n        this.setContentSize(size);\n\n        if (this._backgroundSprite && !this._backgroundSprite.parent) {\n            this._backgroundSprite.setAnchorPoint(cc.p(0, 0));\n            this.addChild(this._backgroundSprite);\n\n            this._updateBackgroundSpriteSize(size.width, size.height);\n        }\n\n        this.x = 0;\n        this.y = 0;\n        return true;\n    },\n\n    /**\n     * Sets the delegate for edit box.\n     * @param {cc.EditBoxDelegate} delegate\n     */\n    setDelegate: function (delegate) {\n        this._delegate = delegate;\n    },\n\n    /**\n     * Gets the text in the edit box that acts as a placeholder when an\n     * edit box is empty.\n     * @return {String}\n     */\n    getPlaceHolder: function () {\n        return this._placeholderText;\n    },\n\n    /**\n     * Sets the input mode of the edit box.\n     * @param {Number} inputMode One of the EditBoxInputMode constants.\n     */\n    setInputMode: function (inputMode) {\n        if (this._editBoxInputMode === inputMode) return;\n\n        var oldText = this.getString();\n        this._editBoxInputMode = inputMode;\n\n        this._renderCmd.setInputMode(inputMode);\n        this._renderCmd.transform();\n\n        this.setString(oldText);\n        this._renderCmd._updateLabelPosition(this.getContentSize());\n    },\n\n    /**\n     * Sets the return type that are to be applied to the edit box.\n     * @param {Number} returnType One of the CCKeyboardReturnType constants.\n     */\n    setReturnType: function (returnType) {\n        this._keyboardReturnType = returnType;\n        this._renderCmd._updateDomInputType();\n    },\n\n    /**\n     * @warning HTML5 Only\n     * @param {cc.Size} size\n     * @param {cc.color} bgColor\n     */\n    initWithBackgroundColor: function (size, bgColor) {\n        this._edWidth = size.width;\n        this.dom.style.width = this._edWidth.toString() + 'px';\n        this._edHeight = size.height;\n        this.dom.style.height = this._edHeight.toString() + 'px';\n        this.dom.style.backgroundColor = cc.colorToHex(bgColor);\n    }\n});\n\nvar _p = cc.EditBox.prototype;\n\n// Extended properties\n/** @expose */\n_p.font;\ncc.defineGetterSetter(_p, 'font', null, _p._setFont);\n/** @expose */\n_p.fontName;\ncc.defineGetterSetter(_p, 'fontName', null, _p.setFontName);\n/** @expose */\n_p.fontSize;\ncc.defineGetterSetter(_p, 'fontSize', null, _p.setFontSize);\n/** @expose */\n_p.fontColor;\ncc.defineGetterSetter(_p, 'fontColor', null, _p.setFontColor);\n/** @expose */\n_p.string;\ncc.defineGetterSetter(_p, 'string', _p.getString, _p.setString);\n/** @expose */\n_p.maxLength;\ncc.defineGetterSetter(_p, 'maxLength', _p.getMaxLength, _p.setMaxLength);\n/** @expose */\n_p.placeHolder;\ncc.defineGetterSetter(_p, 'placeholder', _p.getPlaceHolder, _p.setPlaceHolder);\n/** @expose */\n_p.placeHolderFont;\ncc.defineGetterSetter(_p, 'placeholderFont', null, _p._setPlaceholderFont);\n/** @expose */\n_p.placeHolderFontName;\ncc.defineGetterSetter(_p, 'placeholderFontName', null, _p.setPlaceholderFontName);\n/** @expose */\n_p.placeHolderFontSize;\ncc.defineGetterSetter(_p, 'placeholderFontSize', null, _p.setPlaceholderFontSize);\n/** @expose */\n_p.placeHolderFontColor;\ncc.defineGetterSetter(_p, 'placeholderFontColor', null, _p.setPlaceholderFontColor);\n/** @expose */\n_p.inputFlag;\ncc.defineGetterSetter(_p, 'inputFlag', null, _p.setInputFlag);\n/** @expose */\n_p.delegate;\ncc.defineGetterSetter(_p, 'delegate', null, _p.setDelegate);\n/** @expose */\n_p.inputMode;\ncc.defineGetterSetter(_p, 'inputMode', null, _p.setInputMode);\n/** @expose */\n_p.returnType;\ncc.defineGetterSetter(_p, 'returnType', null, _p.setReturnType);\n\n_p = null;\n\n/**\n * create a edit box with size and background-color or\n * @deprecated since v3.0, please use new cc.EditBox(size, normal9SpriteBg, press9SpriteBg, disabled9SpriteBg) instead\n * @param {cc.Size} size\n * @param {cc.Scale9Sprite } normal9SpriteBg\n * @param {cc.Scale9Sprite } [press9SpriteBg]\n * @param {cc.Scale9Sprite } [disabled9SpriteBg]\n * @return {cc.EditBox}\n */\ncc.EditBox.create = function (size, normal9SpriteBg, press9SpriteBg, disabled9SpriteBg) {\n    return new cc.EditBox(size, normal9SpriteBg, press9SpriteBg, disabled9SpriteBg);\n};\n\n\n(function (editbox) {\n    editbox._polyfill = {\n        zoomInvalid: false\n    };\n\n    if (cc.sys.OS_ANDROID === cc.sys.os\n        && (cc.sys.browserType === cc.sys.BROWSER_TYPE_SOUGOU\n        || cc.sys.browserType === cc.sys.BROWSER_TYPE_360)) {\n        editbox._polyfill.zoomInvalid = true;\n    }\n})(cc.EditBox);\n\n(function (polyfill) {\n    // https://segmentfault.com/q/1010000002914610\n    var SCROLLY = 40;\n    var TIMER_NAME = 400;\n    var LEFT_PADDING = 2;\n\n    function adjustEditBoxPosition (editBox) {\n        var worldPos = editBox.convertToWorldSpace(cc.p(0,0));\n        var windowHeight = cc.visibleRect.height;\n        var windowWidth = cc.visibleRect.width;\n        var factor = 0.5;\n        if(windowWidth > windowHeight) {\n            factor = 0.7;\n        }\n        setTimeout(function() {\n            if(window.scrollY < SCROLLY && worldPos.y < windowHeight * factor) {\n                var scrollOffset = windowHeight * factor - worldPos.y - window.scrollY;\n                if (scrollOffset < 35) scrollOffset = 35;\n                if (scrollOffset > 320) scrollOffset = 320;\n                window.scrollTo(scrollOffset, scrollOffset);\n            }\n        }, TIMER_NAME);\n    }\n\n    var capitalize = function(string) {\n        return string.replace(/(?:^|\\s)\\S/g, function(a) { return a.toUpperCase(); });\n    };\n\n    function capitalizeFirstLetter(string) {\n        return string.charAt(0).toUpperCase() + string.slice(1);\n    }\n\n    var EditBoxImpl = function () {\n    };\n    var proto = EditBoxImpl.prototype = Object.create(Object.prototype);\n\n    proto.updateMatrix = function () {\n        if (!this._edTxt) return;\n\n        var node = this._node, scaleX = cc.view._scaleX, scaleY = cc.view._scaleY;\n        var dpr = cc.view._devicePixelRatio;\n        var t = this._worldTransform;\n\n        scaleX /= dpr;\n        scaleY /= dpr;\n\n        var container = cc.game.container;\n        var a = t.a * scaleX, b = t.b, c = t.c, d = t.d * scaleY;\n\n        var offsetX = container && container.style.paddingLeft && parseInt(container.style.paddingLeft);\n        var offsetY = container && container.style.paddingBottom && parseInt(container.style.paddingBottom);\n        var tx = t.tx * scaleX + offsetX, ty = t.ty * scaleY + offsetY;\n\n        if (polyfill.zoomInvalid) {\n            this.updateSize(node._contentSize.width * a, node._contentSize.height * d);\n            a = 1;\n            d = 1;\n        }\n\n        var matrix = \"matrix(\" + a + \",\" + -b + \",\" + -c + \",\" + d + \",\" + tx + \",\" + -ty + \")\";\n        this._edTxt.style['transform'] = matrix;\n        this._edTxt.style['-webkit-transform'] = matrix;\n        this._edTxt.style['transform-origin'] = '0px 100% 0px';\n        this._edTxt.style['-webkit-transform-origin'] = '0px 100% 0px';\n    };\n\n    proto.updateVisibility = function () {\n        if (!this._edTxt) return;\n\n        if (this._node.visible) {\n            this._edTxt.style.visibility = 'visible';\n        } else {\n            this._edTxt.style.visibility = 'hidden';\n        }\n    };\n\n    proto.stayOnTop = function (flag) {\n        if (flag) {\n            this._removeLabels();\n            this._edTxt.style.display = '';\n        } else {\n            this._createLabels();\n            this._edTxt.style.display = 'none';\n            this._showLabels();\n        }\n    };\n\n    // Called before editbox focus to register cc.view status\n    proto._beginEditingOnMobile = function (editBox) {\n        this.__orientationChanged = function () {\n            adjustEditBoxPosition(editBox);\n        };\n\n        window.addEventListener('orientationchange', this.__orientationChanged);\n\n        if (cc.view.isAutoFullScreenEnabled()) {\n            this.__fullscreen = true;\n            cc.view.enableAutoFullScreen(false);\n            cc.screen.exitFullScreen();\n        } else {\n            this.__fullscreen = false;\n        }\n        this.__autoResize = cc.view.__resizeWithBrowserSize;\n        cc.view.resizeWithBrowserSize(false);\n    };\n    // Called after keyboard disappeared to readapte the game view\n    proto._endEditingOnMobile = function () {\n        if (this.__rotateScreen) {\n            var containerStyle = cc.game.container.style;\n            containerStyle['-webkit-transform'] = 'rotate(90deg)';\n            containerStyle.transform = 'rotate(90deg)';\n\n            var view = cc.view;\n            var width = view._originalDesignResolutionSize.width;\n            var height = view._originalDesignResolutionSize.height;\n            if (width > 0) {\n                view.setDesignResolutionSize(width, height, view._resolutionPolicy);\n            }\n            this.__rotateScreen = false;\n        }\n\n        window.removeEventListener('orientationchange', this.__orientationChanged);\n\n        window.scrollTo(0, 0);\n        if (this.__fullscreen) {\n            cc.view.enableAutoFullScreen(true);\n        }\n        if (this.__autoResize) {\n            cc.view.resizeWithBrowserSize(true);\n        }\n    };\n    // Called after editbox focus to readapte the game view\n    proto._onFocusOnMobile = function (editBox) {\n        if (cc.view._isRotated) {\n            var containerStyle = cc.game.container.style;\n            containerStyle['-webkit-transform'] = 'rotate(0deg)';\n            containerStyle.transform = 'rotate(0deg)';\n            containerStyle.margin = '0px';\n            // cc.view._isRotated = false;\n            // var policy = cc.view.getResolutionPolicy();\n            // policy.apply(cc.view, cc.view.getDesignResolutionSize());\n            // cc.view._isRotated = true;\n            //use window scrollTo to adjust the input area\n            window.scrollTo(35, 35);\n            this.__rotateScreen = true;\n        } else {\n            this.__rotateScreen = false;\n        }\n        adjustEditBoxPosition(editBox);\n    };\n\n\n    proto._createDomInput = function () {\n        this._removeDomFromGameContainer();\n        var thisPointer = this;\n        var tmpEdTxt = this._edTxt = document.createElement('input');\n        tmpEdTxt.type = 'text';\n        tmpEdTxt.style.fontFamily = this._edFontName;     \n        tmpEdTxt.style.fontSize = this._edFontSize + 'px';\n        tmpEdTxt.style.color = '#000000';\n        tmpEdTxt.style.border = 0;\n        tmpEdTxt.style.background = 'transparent';\n        tmpEdTxt.style.width = '100%';\n        tmpEdTxt.style.height = '100%';\n        tmpEdTxt.style.active = 0;\n        tmpEdTxt.style.outline = 'medium';\n        tmpEdTxt.style.padding = '0';\n        tmpEdTxt.style.textTransform = 'uppercase';\n        tmpEdTxt.style.display = 'none';\n\n        tmpEdTxt.style.position = \"absolute\";\n        tmpEdTxt.style.bottom = \"0px\";\n        tmpEdTxt.style.left = LEFT_PADDING + \"px\";\n        tmpEdTxt.style.className = \"cocosEditBox\";\n        this.setMaxLength(thisPointer._editBox._maxLength);\n\n        tmpEdTxt.addEventListener('input', function () {\n            var editBox = thisPointer._editBox;\n\n\n            if (this.value.length > this.maxLength) {\n                this.value = this.value.slice(0, this.maxLength);\n            }\n\n            if (editBox._delegate && editBox._delegate.editBoxTextChanged) {\n                if (editBox._text !== this.value) {\n                    editBox._text = this.value;\n                    thisPointer._updateDomTextCases();\n                    editBox._delegate.editBoxTextChanged(editBox, editBox._text);\n                }\n            }\n        });\n        tmpEdTxt.addEventListener('keypress', function (e) {\n            var editBox = thisPointer._editBox;\n\n            if (e.keyCode === cc.KEY.enter) {\n                e.stopPropagation();\n                e.preventDefault();\n                if (this.value === '') {\n                    this.style.fontSize = editBox._placeholderFontSize + 'px';\n                    this.style.color = cc.colorToHex(editBox._placeholderColor);\n                }\n\n                editBox._text = this.value;\n                thisPointer._updateDomTextCases();\n\n                thisPointer._endEditing();\n                if (editBox._delegate && editBox._delegate.editBoxReturn) {\n                    editBox._delegate.editBoxReturn(editBox);\n                }\n                cc._canvas.focus();\n            }\n        });\n\n        tmpEdTxt.addEventListener('focus', function () {\n            var editBox = thisPointer._editBox;\n            this.style.fontSize = thisPointer._edFontSize + 'px';\n            this.style.color = cc.colorToHex(editBox._textColor);\n            thisPointer._hiddenLabels();\n\n            if (cc.sys.isMobile) {\n                thisPointer._onFocusOnMobile(editBox);\n            }\n\n            if (editBox._delegate && editBox._delegate.editBoxEditingDidBegin) {\n                editBox._delegate.editBoxEditingDidBegin(editBox);\n            }\n        });\n        tmpEdTxt.addEventListener('blur', function () {\n            var editBox = thisPointer._editBox;\n            editBox._text = this.value;\n            thisPointer._updateDomTextCases();\n\n            if (editBox._delegate && editBox._delegate.editBoxEditingDidEnd) {\n                editBox._delegate.editBoxEditingDidEnd(editBox);\n            }\n\n            if (this.value === '') {\n                this.style.fontSize = editBox._placeholderFontSize + 'px';\n                this.style.color = cc.colorToHex(editBox._placeholderColor);\n            }\n            thisPointer._endEditing();\n        });\n        \n        this._addDomToGameContainer();\n        return tmpEdTxt;\n    };\n\n    proto._createDomTextArea = function () {\n        this._removeDomFromGameContainer();\n        var thisPointer = this;\n        var tmpEdTxt = this._edTxt = document.createElement('textarea');\n        tmpEdTxt.type = 'text';\n        tmpEdTxt.style.fontFamily = this._edFontName;     \n        tmpEdTxt.style.fontSize = this._edFontSize + 'px';\n        tmpEdTxt.style.color = '#000000';\n        tmpEdTxt.style.border = 0;\n        tmpEdTxt.style.background = 'transparent';\n        tmpEdTxt.style.width = '100%';\n        tmpEdTxt.style.height = '100%';\n        tmpEdTxt.style.active = 0;\n        tmpEdTxt.style.outline = 'medium';\n        tmpEdTxt.style.padding = '0';\n        tmpEdTxt.style.resize = 'none';\n        tmpEdTxt.style.textTransform = 'uppercase';\n        tmpEdTxt.style.overflow_y = 'scroll';\n        tmpEdTxt.style.display = 'none';\n        tmpEdTxt.style.position = \"absolute\";\n        tmpEdTxt.style.bottom = \"0px\";\n        tmpEdTxt.style.left = LEFT_PADDING + \"px\";\n        tmpEdTxt.style.className = \"cocosEditBox\";\n        this.setMaxLength(thisPointer._editBox._maxLength);\n\n        tmpEdTxt.addEventListener('input', function () {\n            if (this.value.length > this.maxLength) {\n                this.value = this.value.slice(0, this.maxLength);\n            }\n\n            var editBox = thisPointer._editBox;\n            if (editBox._delegate && editBox._delegate.editBoxTextChanged) {\n                if (editBox._text.toLowerCase() !== this.value.toLowerCase()) {\n                    editBox._text = this.value;\n                    thisPointer._updateDomTextCases();\n                    editBox._delegate.editBoxTextChanged(editBox, editBox._text);\n                }\n            }\n        });\n\n        tmpEdTxt.addEventListener('focus', function () {\n            var editBox = thisPointer._editBox;\n            thisPointer._hiddenLabels();\n\n            this.style.fontSize = thisPointer._edFontSize + 'px';\n            this.style.color = cc.colorToHex(editBox._textColor);\n\n            if (cc.sys.isMobile) {\n                thisPointer._onFocusOnMobile(editBox);\n            }\n\n            if (editBox._delegate && editBox._delegate.editBoxEditingDidBegin) {\n                editBox._delegate.editBoxEditingDidBegin(editBox);\n            }\n\n        });\n        tmpEdTxt.addEventListener('keypress', function (e) {\n            var editBox = thisPointer._editBox;\n\n            if (e.keyCode === cc.KEY.enter) {\n                e.stopPropagation();\n\n                if (editBox._delegate && editBox._delegate.editBoxReturn) {\n                    editBox._delegate.editBoxReturn(editBox);\n                }\n            }\n        });\n        tmpEdTxt.addEventListener('blur', function () {\n            var editBox = thisPointer._editBox;\n            editBox._text = this.value;\n            thisPointer._updateDomTextCases();\n\n            if (editBox._delegate && editBox._delegate.editBoxEditingDidEnd) {\n                editBox._delegate.editBoxEditingDidEnd(editBox);\n            }\n\n            if (this.value === '') {\n                this.style.fontSize = editBox._placeholderFontSize + 'px';\n                this.style.color = cc.colorToHex(editBox._placeholderColor);\n            }\n\n            thisPointer._endEditing();\n        });\n\n        this._addDomToGameContainer();\n        return tmpEdTxt;\n    };\n\n    proto._createLabels = function () {\n        var editBoxSize = this._editBox.getContentSize();\n        if (!this._textLabel) {\n            this._textLabel = new cc.LabelTTF();\n            this._textLabel.setAnchorPoint(cc.p(0, 1));\n            this._editBox.addChild(this._textLabel, 100);\n        }\n\n        if (!this._placeholderLabel) {\n            this._placeholderLabel = new cc.LabelTTF();\n            this._placeholderLabel.setAnchorPoint(cc.p(0, 1));\n            this._placeholderLabel.setColor(cc.color.GRAY);\n            this._editBox.addChild(this._placeholderLabel, 100);\n        }\n\n        this._updateLabelPosition(editBoxSize);\n    };\n\n    proto._removeLabels = function () {\n        if (!this._textLabel) return;\n\n        this._editBox.removeChild(this._textLabel);\n        this._textLabel = null;\n    };\n\n    proto._updateLabelPosition = function (editBoxSize) {\n        if (!this._textLabel || !this._placeholderLabel) return;\n\n        var labelContentSize = cc.size(editBoxSize.width - LEFT_PADDING, editBoxSize.height);\n        this._textLabel.setContentSize(labelContentSize);\n        this._textLabel.setDimensions(labelContentSize);\n        this._placeholderLabel.setLineHeight(editBoxSize.height);\n        var placeholderLabelSize = this._placeholderLabel.getContentSize();\n\n        if (this._editBox._editBoxInputMode === cc.EDITBOX_INPUT_MODE_ANY) {\n            this._textLabel.setPosition(LEFT_PADDING, editBoxSize.height);\n            this._placeholderLabel.setPosition(LEFT_PADDING, editBoxSize.height);\n            this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP);\n            this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP);\n            // this._textLabel.enableWrapText(true);\n        }\n        else {\n            // this._textLabel.enableWrapText(false);\n            this._textLabel.setPosition(LEFT_PADDING, editBoxSize.height);\n            this._placeholderLabel.setPosition(LEFT_PADDING, (editBoxSize.height + placeholderLabelSize.height) / 2);\n            this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);\n            this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);\n        }\n\n    };\n\n    proto.setLineHeight = function (lineHeight) {\n        if (this._textLabel) {\n            this._textLabel.setLineHeight(lineHeight);\n        }\n    };\n\n    proto._hiddenLabels = function () {\n        if (this._textLabel) {\n            this._textLabel.setVisible(false);\n        }\n\n        if (this._placeholderLabel) {\n            this._placeholderLabel.setVisible(false);\n        }\n    };\n\n    proto._updateDomTextCases = function () {\n        var inputFlag = this._editBox._editBoxInputFlag;\n        if (inputFlag === cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS) {\n            this._editBox._text = this._editBox._text.toUpperCase();\n        }\n        else if (inputFlag === cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD) {\n            this._editBox._text = capitalize(this._editBox._text);\n        }\n        else if (inputFlag === cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE) {\n            this._editBox._text = capitalizeFirstLetter(this._editBox._text);\n        }\n    };\n\n    proto._updateLabelStringStyle = function () {\n        if (this._edTxt.type === 'password') {\n            var passwordString = '';\n            var len = this._editBox._text.length;\n            for (var i = 0; i < len; ++i) {\n                passwordString += '\\u25CF';\n            }\n            if (this._textLabel) {\n                this._textLabel.setString(passwordString);\n            }\n        } else {\n            this._updateDomTextCases();\n            if (this._textLabel) {\n                this._textLabel.setString(this._editBox._text);\n            }\n        }\n    };\n\n    proto._showLabels = function () {\n        this._hiddenLabels();\n        if (this._edTxt.value === '') {\n            if (this._placeholderLabel) {\n                this._placeholderLabel.setVisible(true);\n                this._placeholderLabel.setString(this._editBox._placeholderText);\n            }\n        }\n        else {\n            if (this._textLabel) {\n                this._textLabel.setVisible(true);\n                this._textLabel.setString(this._editBox._text);\n            }\n        }\n        this._updateLabelStringStyle();\n    };\n\n    proto._beginEditing = function () {\n        if (!this._editBox._alwaysOnTop) {\n            if (this._edTxt.style.display === 'none') {\n                this._edTxt.style.display = '';\n                this._edTxt.focus();\n            }\n        }\n\n        if (cc.sys.isMobile && !this._editingMode) {\n            // Pre adaptation and \n            this._beginEditingOnMobile(this._editBox);\n        }\n        this._editingMode = true;\n    };\n\n    proto._endEditing = function () {\n        if (!this._editBox._alwaysOnTop) {\n            this._edTxt.style.display = 'none';\n        }\n        this._showLabels();\n        if (cc.sys.isMobile && this._editingMode) {\n            var self = this;\n            // Delay end editing adaptation to ensure virtual keyboard is disapeared\n            setTimeout(function () {\n                self._endEditingOnMobile();\n            }, TIMER_NAME);\n        }\n        this._editingMode = false;\n    };\n\n    proto._setFont = function (fontStyle) {\n        var res = cc.LabelTTF._fontStyleRE.exec(fontStyle);\n        var textFontName = res[2];\n        var textFontSize = parseInt(res[1]);\n        if (res) {\n            this.setFont(textFontName, textFontSize);\n        }\n    };\n\n    proto.setFont = function (fontName, fontSize) {\n        this._edFontName = fontName || this._edFontName;\n        this._edFontSize = fontSize || this._edFontSize;\n        this._updateDOMFontStyle();\n    };\n\n    proto.setFontName = function (fontName) {\n        this._edFontName = fontName || this._edFontName;\n        this._updateDOMFontStyle();\n    };\n\n    proto.setFontSize = function (fontSize) {\n        this._edFontSize = fontSize || this._edFontSize;\n        this._updateDOMFontStyle();\n    };\n\n    proto.setFontColor = function (color) {\n        if (!this._edTxt) return;\n\n        if (this._edTxt.value !== this._editBox._placeholderText) {\n            this._edTxt.style.color = cc.colorToHex(color);\n        }\n        if (this._textLabel) {\n            this._textLabel.setColor(color);\n        }\n    };\n\n    proto.setPlaceHolder = function (text) {\n        this._placeholderLabel.setString(text);\n    };\n\n    proto.setMaxLength = function (maxLength) {\n        if (!this._edTxt) return;\n        this._edTxt.maxLength = maxLength;\n    };\n\n    proto._updateDOMPlaceholderFontStyle = function () {\n        this._placeholderLabel.setFontName(this._editBox._placeholderFontName);\n        this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize);\n    };\n\n    proto.setPlaceholderFontColor = function (color) {\n        this._placeholderLabel.setColor(color);\n    };\n\n    proto._updateDomInputType = function () {\n        var inputMode = this._editBox._editBoxInputMode;\n        if (inputMode === cc.EDITBOX_INPUT_MODE_EMAILADDR) {\n            this._edTxt.type = 'email';\n        } else if (inputMode === cc.EDITBOX_INPUT_MODE_DECIMAL ||\n            inputMode === cc.EDITBOX_INPUT_MODE_NUMERIC) {\n            this._edTxt.type = 'number';\n        } else if (inputMode === cc.EDITBOX_INPUT_MODE_PHONENUMBER) {\n            this._edTxt.type = 'number';\n            this._edTxt.pattern = '[0-9]*';\n        } else if (inputMode === cc.EDITBOX_INPUT_MODE_URL) {\n            this._edTxt.type = 'url';\n        } else {\n            this._edTxt.type = 'text';\n\n            if (this._editBox._keyboardReturnType === cc.KEYBOARD_RETURNTYPE_SEARCH) {\n                this._edTxt.type = 'search';\n            }\n        }\n\n        if (this._editBox._editBoxInputFlag === cc.EDITBOX_INPUT_FLAG_PASSWORD) {\n            this._edTxt.type = 'password';\n        }\n    };\n\n    proto.setInputFlag = function (inputFlag) {\n        if (!this._edTxt) return;\n\n        this._updateDomInputType();\n\n        this._edTxt.style.textTransform = 'none';\n\n        if (inputFlag === cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS) {\n            this._edTxt.style.textTransform = 'uppercase';\n        }\n        else if (inputFlag === cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD) {\n            this._edTxt.style.textTransform = 'capitalize';\n        }\n        this._updateLabelStringStyle();\n    };\n\n    proto.setInputMode = function (inputMode) {\n        if (inputMode === cc.EDITBOX_INPUT_MODE_ANY) {\n            this._createDomTextArea();\n        }\n        else {\n            this._createDomInput();\n        }\n\n        this._updateDomInputType();\n        var contentSize = this._node.getContentSize();\n        this.updateSize(contentSize.width, contentSize.height);\n    };\n\n    proto.setString = function (text) {\n        if (!this._edTxt) return;\n\n        if (text !== null) {\n            this._edTxt.value = text;\n\n            if (text === '') {\n                if (this._placeholderLabel) {\n                    this._placeholderLabel.setString(this._editBox._placeholderText);\n                    this._placeholderLabel.setColor(this._editBox._placeholderColor);\n                }\n                if (!this._editingMode) {\n                    if (this._placeholderLabel) {\n                        this._placeholderLabel.setVisible(true);\n                    }\n\n                    if (this._textLabel) {\n                        this._textLabel.setVisible(false);\n                    }\n                }\n            }\n            else {\n                this._edTxt.style.color = cc.colorToHex(this._editBox._textColor);\n                if (this._textLabel) {\n                    this._textLabel.setColor(this._editBox._textColor);\n                }\n                if (!this._editingMode) {\n                    if (this._placeholderLabel) {\n                        this._placeholderLabel.setVisible(false);\n                    }\n                    if (this._textLabel) {\n                        this._textLabel.setVisible(true);\n                    }\n                }\n\n                this._updateLabelStringStyle();\n            }\n        }\n    };\n\n    proto._updateDOMFontStyle = function () {\n        if (!this._edTxt) return;\n\n        if (this._edTxt.value !== '') {\n            this._edTxt.style.fontFamily = this._edFontName;\n            this._edTxt.style.fontSize = this._edFontSize + 'px';\n        }\n        if (this._textLabel) {\n            this._textLabel.setFontSize(this._edFontSize);\n            this._textLabel.setFontName(this._edFontName);\n        }\n    };\n\n\n    proto.updateSize = function (newWidth, newHeight) {\n        var editboxDomNode = this._edTxt;\n        if (!editboxDomNode) return;\n\n        editboxDomNode.style['width'] = newWidth + 'px';\n        editboxDomNode.style['height'] = newHeight + 'px';\n\n        this._updateLabelPosition(cc.size(newWidth, newHeight));\n    };\n\n    proto._addDomToGameContainer = function () {\n        cc.game.container.appendChild(this._edTxt);\n    };\n\n    proto._removeDomFromGameContainer = function () {\n        var editBox = this._edTxt;\n        if (editBox) {\n            var hasChild = false;\n            if ('contains' in cc.game.container) {\n                hasChild = cc.game.container.contains(editBox);\n            } else {\n                hasChild = cc.game.container.compareDocumentPosition(editBox) % 16;\n            }\n            if (hasChild)\n                cc.game.container.removeChild(editBox);\n        }\n        this._edTxt = null;\n    };\n\n    proto.initializeRenderCmd = function (node) {\n        this._editBox = node;\n\n        //it's a dom node, may be assigned with Input or TextArea.\n        this._edFontSize = 14;\n        this._edFontName = 'Arial';\n        this._textLabel = null;\n        this._placeholderLabel = null;\n        this._editingMode = false;\n        \n        this.__fullscreen = false;\n        this.__autoResize = false;\n        this.__rotateScreen = false;\n        this.__orientationChanged = null;\n    };\n\n    //define the canvas render command\n    cc.EditBox.CanvasRenderCmd = function (node) {\n        this._rootCtor(node);\n        this.initializeRenderCmd(node);\n    };\n\n    var canvasRenderCmdProto = cc.EditBox.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n\n    cc.inject(proto, canvasRenderCmdProto);\n    canvasRenderCmdProto.constructor = cc.EditBox.CanvasRenderCmd;\n\n    canvasRenderCmdProto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n        this.updateMatrix();\n    };\n\n\n    //define the webgl render command\n    cc.EditBox.WebGLRenderCmd = function (node) {\n        this._rootCtor(node);\n        this.initializeRenderCmd(node);\n    };\n\n    var webGLRenderCmdProto = cc.EditBox.WebGLRenderCmd.prototype = Object.create(cc.Node.WebGLRenderCmd.prototype);\n    cc.inject(proto, webGLRenderCmdProto);\n    webGLRenderCmdProto.constructor = cc.EditBox.WebGLRenderCmd;\n\n    webGLRenderCmdProto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n        this.updateMatrix();\n    };\n\n}(cc.EditBox._polyfill));\n"]}