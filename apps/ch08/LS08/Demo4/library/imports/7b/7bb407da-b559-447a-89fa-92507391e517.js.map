{"version":3,"sources":["../../../../../../assets/frameworks/cocos2d-html5/tools/assets/frameworks/cocos2d-html5/tools/genBuildXml.js"],"names":["fs","require","path","module","exports","projectDir","projectJson","buildOpt","engineDir","realEngineDir","join","realPublishDir","realToolsDir","dirname","__filename","moduleConfig","ccModuleMap","modules","renderMode","mainJs","main","ccJsList","bootFile","userJsList","jsList","indexOf","splice","_jsAddedCache","_getJsListOfModule","moduleMap","moduleName","jsAddedCache","tempList","Error","i","li","length","item","extname","arr","concat","toLowerCase","push","externalList","getFileArrStr","str","test","buildContent","readFileSync","toString","replace","outputFileName","compilationLevel","sourceMapOpened","writeFileSync"],"mappings":"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","file":"genBuildXml.js","sourceRoot":"../../../../../../assets/frameworks/cocos2d-html5/tools","sourcesContent":["/**\n * Put the `tools` in the root of your project, then run this script with nodejs.\n * @type {exports|*}\n */\n\nvar fs = require(\"fs\");\nvar path = require(\"path\");\n\n\nmodule.exports = function(projectDir, projectJson, buildOpt){\n    var engineDir = projectJson.engineDir || \"frameworks/cocos2d-html5\";\n    var realEngineDir = path.join(projectDir, engineDir);\n    var realPublishDir = path.join(projectDir, \"publish/html5\");\n    var realToolsDir = path.dirname(__filename);\n    var moduleConfig = require(path.join(realEngineDir, \"moduleConfig.json\"));\n    var ccModuleMap = moduleConfig.module;\n    var modules = projectJson.modules || [\"core\"];\n    var renderMode = projectJson.renderMode || 0;\n    var mainJs = projectJson.main || \"main.js\";\n\n\n    var ccJsList = [moduleConfig.bootFile];\n    var userJsList = projectJson.jsList || [];\n\n    if(renderMode != 1 && modules.indexOf(\"base4webgl\") < 0){\n        modules.splice(0, 0, \"base4webgl\");\n    }\n\n\n    //cache for js and module that has added into jsList to be loaded.\n    var _jsAddedCache = {};\n    function _getJsListOfModule(moduleMap, moduleName){\n        var jsAddedCache = _jsAddedCache;\n        if(jsAddedCache[moduleName]) return null;\n        jsAddedCache[moduleName] = true;\n        var jsList = [];\n        var tempList = moduleMap[moduleName];\n        if(!tempList) throw new Error(\"can not find module [\" + moduleName + \"]\");\n        for(var i = 0, li = tempList.length; i < li; i++){\n            var item = tempList[i];\n            if(jsAddedCache[item]) continue;\n            var extname = path.extname(item);\n            if(!extname) {\n                var arr = _getJsListOfModule(moduleMap, item);\n                if(arr) jsList = jsList.concat(arr);\n            }else if(extname.toLowerCase() == \".js\") jsList.push(item);\n            jsAddedCache[item] = true;\n        }\n        return jsList;\n    };\n\n\n\n    for(var i = 0, li = modules.length; i < li; i++){\n        var item = modules[i];\n        var arr = _getJsListOfModule(ccModuleMap, item, \"\");\n        if(arr) ccJsList = ccJsList.concat(arr);\n    }\n\n    var externalList = [];\n    function getFileArrStr(jsList){\n        var str = \"\";\n        for(var i = 0, li = jsList.length; i < li; i++){\n            if(/^external/.test(jsList[i]) && !/Plugin/.test(jsList[i])){\n                externalList.push(jsList[i]);\n            }else{\n                str += '                <file name=\"' + jsList[i] + '\"/>';\n                if(i < li - 1) str += '\\r\\n';\n            }\n        }\n        return str;\n    }\n\n    userJsList.push(mainJs);\n\n    var buildContent = fs.readFileSync(path.join(realToolsDir, \"template/build.xml\")).toString();\n    buildContent = buildContent.replace(/%projectDir%/gi, projectDir);\n    buildContent = buildContent.replace(/%engineDir%/gi, realEngineDir);\n    buildContent = buildContent.replace(/%publishDir%/gi, realPublishDir);\n    buildContent = buildContent.replace(/%outputFileName%/gi, buildOpt.outputFileName);\n    buildContent = buildContent.replace(/%toolsDir%/gi, realToolsDir);\n    buildContent = buildContent.replace(/%compilationLevel%/gi, buildOpt.compilationLevel);\n    buildContent = buildContent.replace(/%sourceMapCfg%/gi, buildOpt.sourceMapOpened ? 'sourceMapOutputFile=\"' + path.join(realPublishDir, \"sourcemap\") + '\" sourceMapFormat=\"V3\"' : \"\");\n    buildContent = buildContent.replace(/%ccJsList%/gi, getFileArrStr(ccJsList));\n    buildContent = buildContent.replace(/%userJsList%/gi, getFileArrStr(userJsList));\n    fs.writeFileSync(path.join(realPublishDir, \"build.xml\"), buildContent);\n\n    return externalList;\n};\n"]}