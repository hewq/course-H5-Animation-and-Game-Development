{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath/assets/frameworks/cocos2d-html5/cocos2d/kazmath/mat4.js"],"names":["cc","math","Matrix4","mat4","mat","Float32Array","kmMat4","proto","prototype","fill","scalarArr","i","kmMat4Identity","pOut","identity","get","row","col","set","value","swap","r1","c1","r2","c2","tmp","_gaussj","a","b","icol","irow","j","k","l","ll","n","m","selElement","big","dumb","pivinv","indxc","indxr","ipiv","Math","abs","identityMatrix","kmMat4Inverse","pM","inv","assignFrom","inverse","isIdentity","transpose","m1","m2","m3","m4","m6","m7","m8","m9","m11","m12","m13","m14","kmMat4Multiply","pM1","pM2","outArray","mat1","mat2","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b00","b01","b02","b03","b10","b11","b12","b13","b20","b21","b22","b23","b30","b31","b32","b33","multiply","getMat4MultiplyValue","kmMat4Assign","pIn","log","outArr","inArr","equals","matA","matB","EPSILON","createByRotationX","radians","matrix","cos","sin","createByRotationY","createByRotationZ","createByPitchYawRoll","pitch","yaw","roll","cr","sr","cp","sp","cy","sy","srsp","crsp","createByQuaternion","quaternion","y","z","x","w","createByRotationTranslation","rotation","translation","rMat","createByScale","kmMat4Translation","createByTranslation","getUpVec3","ret","Vec3","normalize","getRightVec3","getForwardVec3","kmMat4PerspectiveProjection","fovY","aspect","zNear","zFar","r","degreesToRadians","deltaZ","s","cotangent","createPerspectiveProjection","kmMat4OrthographicProjection","left","right","bottom","top","nearVal","farVal","createOrthographicProjection","kmMat4LookAt","pEye","pCenter","pUp","f","up","subtract","cross","u","translate","tempMatrix","lookAt","eyeVec","centerVec","upVec","kmMat4RotationAxisAngle","axis","rcos","rsin","normalizedAxis","createByAxisAndAngle","extractRotation","Matrix3","mat3","extractPlane","planeType","plane","Plane","RIGHT","c","d","LEFT","BOTTOM","TOP","FAR","NEAR","t","sqrt","toAxisAndAngle","temp","Quaternion","rotationMatrix"],"mappings":"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","file":"mat4.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/kazmath","sourcesContent":["/**\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n Copyright (c) 2008, Luke Benstead.\n All rights reserved.\n\n Redistribution and use in source and binary forms, with or without modification,\n are permitted provided that the following conditions are met:\n\n * Redistributions of source code must retain the above copyright notice,\n this list of conditions and the following disclaimer.\n * Redistributions in binary form must reproduce the above copyright notice,\n this list of conditions and the following disclaimer in the documentation\n and/or other materials provided with the distribution.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n(function(cc) {\n    /**\n     * <p>\n     * A 4x4 matrix                         </br>\n     * </br>\n     * mat =                                 </br>\n     * | 0   4   8  12 |                     </br>\n     * | 1   5   9  13 |                     </br>\n     * | 2   6  10  14 |                     </br>\n     * | 3   7  11  15 |\n     * </p>\n     * @class\n     * @param {cc.math.Matrix4} [mat4]\n     */\n    cc.math.Matrix4 = function (mat4) {\n        if(mat4 && mat4.mat){\n            this.mat = new Float32Array(mat4.mat);\n        } else {\n            this.mat = new Float32Array(16);\n        }\n    };\n    cc.kmMat4 = cc.math.Matrix4;\n    var proto = cc.math.Matrix4.prototype;\n\n    /**\n     * Fills a cc.math.Matrix4 structure with the values from a 16 element array of floats\n     * @param {Array} scalarArr\n     */\n    proto.fill = function(scalarArr){        //cc.kmMat4Fill\n         var mat = this.mat;\n        for(var i = 0; i < 16; i++){\n            mat[i] = scalarArr[i];\n        }\n        return this;\n    };\n\n    /**\n     * Sets pOut to an identity matrix returns pOut\n     * @param pOut - A pointer to the matrix to set to identity\n     * @returns Returns pOut so that the call can be nested\n     */\n    cc.kmMat4Identity = function (pOut) {\n        var mat = pOut.mat;\n        mat[1] = mat[2] = mat[3] = mat[4] = mat[6] = mat[7]\n            = mat[8] = mat[9] = mat[11] = mat[12] = mat[13] = mat[14] = 0;\n        mat[0] = mat[5] = mat[10] = mat[15] = 1.0;\n        return pOut;\n    };\n\n    /**\n     * Sets matrix to identity value.\n     * @returns {cc.math.Matrix4}\n     */\n    proto.identity = function(){\n        var mat = this.mat;\n        mat[1] = mat[2] = mat[3] = mat[4] = mat[6] = mat[7]\n            = mat[8] = mat[9] = mat[11] = mat[12] = mat[13] = mat[14] = 0;\n        mat[0] = mat[5] = mat[10] = mat[15] = 1.0;\n        return this;\n    };\n\n    proto.get = function(row, col){\n        return this.mat[row + 4 * col];\n    };\n\n    proto.set = function(row, col, value){\n        this.mat[row + 4 * col] = value;\n    };\n\n    proto.swap = function(r1, c1, r2, c2) {\n/*        var tmp = this.get(r1, c1);\n        this.set(r1, c1, this.get(r2, c2));\n        this.set(r2, c2, tmp);*/\n        var mat = this.mat, tmp = mat[r1 + 4 * c1];\n        mat[r1 + 4 * c1] = mat[r2 + 4 * c2];\n        mat[r2 + 4 * c2] = tmp;\n    };\n\n    //Returns an upper and a lower triangular matrix which are L and R in the Gauss algorithm\n    cc.math.Matrix4._gaussj = function (a, b) {\n        var i, icol = 0, irow = 0, j, k, l, ll, n = 4, m = 4, selElement;\n        var big, dumb, pivinv;\n        var indxc = [0, 0, 0, 0], indxr = [0, 0, 0, 0], ipiv = [0, 0, 0, 0];\n\n        /*    for (j = 0; j < n; j++) {\n         ipiv[j] = 0;\n         }*/\n\n        for (i = 0; i < n; i++) {\n            big = 0.0;\n            for (j = 0; j < n; j++) {\n                if (ipiv[j] !== 1) {\n                    for (k = 0; k < n; k++) {\n                        if (ipiv[k] === 0) {\n                            selElement = Math.abs(a.get(j, k));\n                            if (selElement >= big) {\n                                big = selElement;\n                                irow = j;\n                                icol = k;\n                            }\n                        }\n                    }\n                }\n            }\n            ++(ipiv[icol]);\n            if (irow !== icol) {\n                for (l = 0; l < n; l++)\n                    a.swap(irow, l, icol, l);\n                for (l = 0; l < m; l++)\n                    b.swap(irow, l, icol, l);\n            }\n            indxr[i] = irow;\n            indxc[i] = icol;\n            if (a.get(icol, icol) === 0.0)\n                return false;\n\n            pivinv = 1.0 / a.get(icol, icol);\n            a.set(icol, icol, 1.0);\n            for (l = 0; l < n; l++)\n                a.set(icol, l, a.get(icol, l) * pivinv);\n\n            for (l = 0; l < m; l++)\n                b.set(icol, l, b.get(icol, l) * pivinv);\n\n            for (ll = 0; ll < n; ll++) {\n                if (ll !== icol) {\n                    dumb = a.get(ll, icol);\n                    a.set(ll, icol, 0.0);\n                    for (l = 0; l < n; l++)\n                        a.set(ll, l, a.get(ll, l) - a.get(icol, l) * dumb);\n\n                    for (l = 0; l < m; l++)\n                        b.set(ll, l, a.get(ll, l) - b.get(icol, l) * dumb);\n                }\n            }\n        }\n        //    This is the end of the main loop over columns of the reduction. It only remains to unscram-\n        //    ble the solution in view of the column interchanges. We do this by interchanging pairs of\n        //    columns in the reverse order that the permutation was built up.\n        for (l = n - 1; l >= 0; l--) {\n            if (indxr[l] !== indxc[l]) {\n                for (k = 0; k < n; k++)\n                    a.swap(k, indxr[l], k, indxc[l]);\n            }\n        }\n        return true;\n    };\n\n    var identityMatrix = new cc.math.Matrix4().identity();\n    /**\n     * Calculates the inverse of pM and stores the result in pOut.\n     * Please use matrix4's inverse function instead.\n     * @Return Returns NULL if there is no inverse, else pOut\n     */\n    cc.kmMat4Inverse = function (pOut, pM) {\n        var inv = new cc.math.Matrix4(pM);\n        var tmp = new cc.math.Matrix4(identityMatrix);\n        if (cc.math.Matrix4._gaussj(inv, tmp) === false)\n            return null;\n        pOut.assignFrom(inv);\n        return pOut;\n    };\n\n    /**\n     * Calculates the inverse of current matrix.\n     * @returns {cc.math.Matrix4} Returns null if there is no inverse, else returns a new inverse matrix object\n     */\n    proto.inverse = function(){    //cc.kmMat4Inverse\n        var inv = new cc.math.Matrix4(this);\n        var tmp = new cc.math.Matrix4(identityMatrix);\n        if (cc.math.Matrix4._gaussj(inv, tmp) === false)\n            return null;\n        return inv;\n    };\n\n    /**\n     * Returns true if current matrix is an identity matrix, false otherwise\n     */\n    proto.isIdentity = function () {       // cc.kmMat4IsIdentity\n        var mat = this.mat;\n        return (mat[0] === 1 && mat[1] === 0 && mat[2] === 0 && mat[3] === 0\n        && mat[4] === 0 && mat[5] === 1 && mat[6] === 0 && mat[7] === 0\n        && mat[8] === 0 && mat[9] === 0 && mat[10] === 1 && mat[11] === 0\n        && mat[12] === 0 && mat[13] === 0 && mat[14] === 0 && mat[15] === 1);\n    };\n\n    /**\n     *  transpose the current matrix\n     */\n    proto.transpose = function() {        // cc.kmMat4Transpose\n        var mat = this.mat;\n        var m1 = mat[1], m2 = mat[2], m3 = mat[3],\n            m4 = mat[4], m6 = mat[6], m7 = mat[7],\n            m8 = mat[8], m9 = mat[9], m11 = mat[11],\n            m12 = mat[12], m13 = mat[13], m14 = mat[14];\n        mat[1] = m4;\n        mat[2] = m8;\n        mat[3] = m12;\n\n        mat[4] = m1;\n        mat[6] = m9;\n        mat[7] = m13;\n\n        mat[8] = m2;\n        mat[9] = m6;\n        mat[11] = m14;\n\n        mat[12] = m3;\n        mat[13] = m7;\n        mat[14] = m11;\n        return this;\n    };\n\n    /**\n     * Multiplies pM1 with pM2, stores the result in pOut, returns pOut\n     */\n    cc.kmMat4Multiply = function (pOut, pM1, pM2) {\n        // Cache the matrix values (makes for huge speed increases!)\n        var outArray = pOut.mat, mat1 = pM1.mat, mat2 = pM2.mat;\n        var a00 = mat1[0], a01 = mat1[1], a02 = mat1[2], a03 = mat1[3];\n        var a10 = mat1[4], a11 = mat1[5], a12 = mat1[6], a13 = mat1[7];\n        var a20 = mat1[8], a21 = mat1[9], a22 = mat1[10], a23 = mat1[11];\n        var a30 = mat1[12], a31 = mat1[13], a32 = mat1[14], a33 = mat1[15];\n\n        var b00 = mat2[0], b01 = mat2[1], b02 = mat2[2], b03 = mat2[3];\n        var b10 = mat2[4], b11 = mat2[5], b12 = mat2[6], b13 = mat2[7];\n        var b20 = mat2[8], b21 = mat2[9], b22 = mat2[10], b23 = mat2[11];\n        var b30 = mat2[12], b31 = mat2[13], b32 = mat2[14], b33 = mat2[15];\n\n        outArray[0] = b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30;\n        outArray[1] = b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31;\n        outArray[2] = b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32;\n        outArray[3] = b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33;\n        outArray[4] = b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30;\n        outArray[5] = b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31;\n        outArray[6] = b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32;\n        outArray[7] = b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33;\n        outArray[8] = b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30;\n        outArray[9] = b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31;\n        outArray[10] = b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32;\n        outArray[11] = b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33;\n        outArray[12] = b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30;\n        outArray[13] = b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31;\n        outArray[14] = b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32;\n        outArray[15] = b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33;\n        return pOut;\n    };\n\n    /**\n     * current matrix multiplies with other matrix mat4\n     * @param {cc.math.Matrix4} mat4\n     * @returns {cc.math.Matrix4}\n     */\n    proto.multiply = function(mat4){\n        // Cache the matrix values (makes for huge speed increases!)\n        var mat = this.mat, mat2 = mat4.mat;\n        var a00 = mat[0], a01 = mat[1], a02 = mat[2], a03 = mat[3];\n        var a10 = mat[4], a11 = mat[5], a12 = mat[6], a13 = mat[7];\n        var a20 = mat[8], a21 = mat[9], a22 = mat[10], a23 = mat[11];\n        var a30 = mat[12], a31 = mat[13], a32 = mat[14], a33 = mat[15];\n\n        var b00 = mat2[0], b01 = mat2[1], b02 = mat2[2], b03 = mat2[3];\n        var b10 = mat2[4], b11 = mat2[5], b12 = mat2[6], b13 = mat2[7];\n        var b20 = mat2[8], b21 = mat2[9], b22 = mat2[10], b23 = mat2[11];\n        var b30 = mat2[12], b31 = mat2[13], b32 = mat2[14], b33 = mat2[15];\n\n        mat[0] = b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30;\n        mat[1] = b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31;\n        mat[2] = b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32;\n        mat[3] = b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33;\n        mat[4] = b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30;\n        mat[5] = b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31;\n        mat[6] = b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32;\n        mat[7] = b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33;\n        mat[8] = b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30;\n        mat[9] = b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31;\n        mat[10] = b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32;\n        mat[11] = b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33;\n        mat[12] = b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30;\n        mat[13] = b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31;\n        mat[14] = b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32;\n        mat[15] = b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33;\n        return this;\n    };\n\n    cc.getMat4MultiplyValue = function (pM1, pM2) {\n        var m1 = pM1.mat, m2 = pM2.mat;\n        var mat = new Float32Array(16);\n\n        mat[0] = m1[0] * m2[0] + m1[4] * m2[1] + m1[8] * m2[2] + m1[12] * m2[3];\n        mat[1] = m1[1] * m2[0] + m1[5] * m2[1] + m1[9] * m2[2] + m1[13] * m2[3];\n        mat[2] = m1[2] * m2[0] + m1[6] * m2[1] + m1[10] * m2[2] + m1[14] * m2[3];\n        mat[3] = m1[3] * m2[0] + m1[7] * m2[1] + m1[11] * m2[2] + m1[15] * m2[3];\n\n        mat[4] = m1[0] * m2[4] + m1[4] * m2[5] + m1[8] * m2[6] + m1[12] * m2[7];\n        mat[5] = m1[1] * m2[4] + m1[5] * m2[5] + m1[9] * m2[6] + m1[13] * m2[7];\n        mat[6] = m1[2] * m2[4] + m1[6] * m2[5] + m1[10] * m2[6] + m1[14] * m2[7];\n        mat[7] = m1[3] * m2[4] + m1[7] * m2[5] + m1[11] * m2[6] + m1[15] * m2[7];\n\n        mat[8] = m1[0] * m2[8] + m1[4] * m2[9] + m1[8] * m2[10] + m1[12] * m2[11];\n        mat[9] = m1[1] * m2[8] + m1[5] * m2[9] + m1[9] * m2[10] + m1[13] * m2[11];\n        mat[10] = m1[2] * m2[8] + m1[6] * m2[9] + m1[10] * m2[10] + m1[14] * m2[11];\n        mat[11] = m1[3] * m2[8] + m1[7] * m2[9] + m1[11] * m2[10] + m1[15] * m2[11];\n\n        mat[12] = m1[0] * m2[12] + m1[4] * m2[13] + m1[8] * m2[14] + m1[12] * m2[15];\n        mat[13] = m1[1] * m2[12] + m1[5] * m2[13] + m1[9] * m2[14] + m1[13] * m2[15];\n        mat[14] = m1[2] * m2[12] + m1[6] * m2[13] + m1[10] * m2[14] + m1[14] * m2[15];\n        mat[15] = m1[3] * m2[12] + m1[7] * m2[13] + m1[11] * m2[14] + m1[15] * m2[15];\n\n        return mat;\n    };\n\n    /**\n     * Assigns the value of pIn to pOut\n     */\n    cc.kmMat4Assign = function (pOut, pIn) {\n        if (pOut === pIn) {\n            cc.log(\"cc.kmMat4Assign(): pOut equals pIn\");\n            return pOut;\n        }\n\n        var outArr = pOut.mat;\n        var inArr = pIn.mat;\n\n        outArr[0] = inArr[0];\n        outArr[1] = inArr[1];\n        outArr[2] = inArr[2];\n        outArr[3] = inArr[3];\n\n        outArr[4] = inArr[4];\n        outArr[5] = inArr[5];\n        outArr[6] = inArr[6];\n        outArr[7] = inArr[7];\n\n        outArr[8] = inArr[8];\n        outArr[9] = inArr[9];\n        outArr[10] = inArr[10];\n        outArr[11] = inArr[11];\n\n        outArr[12] = inArr[12];\n        outArr[13] = inArr[13];\n        outArr[14] = inArr[14];\n        outArr[15] = inArr[15];\n        return pOut;\n    };\n\n    /**\n     * Assigns the value of current matrix from mat4\n     * @param {cc.math.Matrix4} mat4\n     * @returns {cc.math.Matrix4}\n     */\n    proto.assignFrom = function(mat4) {\n        if (this === mat4) {\n            cc.log(\"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix\");\n            return this;\n        }\n        var outArr = this.mat, inArr = mat4.mat;\n\n        outArr[0] = inArr[0];\n        outArr[1] = inArr[1];\n        outArr[2] = inArr[2];\n        outArr[3] = inArr[3];\n\n        outArr[4] = inArr[4];\n        outArr[5] = inArr[5];\n        outArr[6] = inArr[6];\n        outArr[7] = inArr[7];\n\n        outArr[8] = inArr[8];\n        outArr[9] = inArr[9];\n        outArr[10] = inArr[10];\n        outArr[11] = inArr[11];\n\n        outArr[12] = inArr[12];\n        outArr[13] = inArr[13];\n        outArr[14] = inArr[14];\n        outArr[15] = inArr[15];\n        return this;\n    };\n\n    /**\n     * Returns true if current matrix equal mat4 (approximately)\n     * @param {cc.math.Matrix4} mat4\n     * @returns {boolean}\n     */\n    proto.equals = function(mat4) {\n        if (this === mat4) {\n            cc.log(\"cc.kmMat4AreEqual(): pMat1 and pMat2 are same object.\");\n            return true;\n        }\n        var matA = this.mat, matB = mat4.mat, EPSILON = cc.math.EPSILON;\n        for (var i = 0; i < 16; i++) {\n            if (!(matA[i] + EPSILON > matB[i] && matA[i] - EPSILON < matB[i]))\n                return false;\n        }\n        return true;\n    };\n\n    /**\n     * Builds an X-axis rotation matrix and stores it in matrix, returns matrix, if matrix is null, create a new matrix\n     * @param {Number} radians\n     * @param {cc.math.Matrix4} [matrix]\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByRotationX = function(radians, matrix) {    //cc.kmMat4RotationX\n        /*\n         |  1  0       0       0 |\n         M = |  0  cos(A) -sin(A)  0 |\n         |  0  sin(A)  cos(A)  0 |\n         |  0  0       0       1 |\n         */\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = matrix.mat;\n        mat[0] = 1.0;\n        mat[3] = mat[2] = mat[1] = 0.0;\n\n        mat[4] = 0.0;\n        mat[5] = Math.cos(radians);\n        mat[6] = Math.sin(radians);\n        mat[7] = 0.0;\n\n        mat[8] = 0.0;\n        mat[9] = -Math.sin(radians);\n        mat[10] = Math.cos(radians);\n        mat[11] = 0.0;\n\n        mat[14] = mat[13] = mat[12] = 0.0;\n        mat[15] = 1.0;\n        return matrix;\n    };\n\n    /**\n     * Builds a rotation matrix using the rotation around the Y-axis, The result is stored in matrix, matrix is returned.\n     * @param {Number} radians\n     * @param {cc.math.Matrix4} [matrix]\n     * @returns {*}\n     */\n    cc.math.Matrix4.createByRotationY = function(radians, matrix) {      // cc.kmMat4RotationY\n        /*\n         |  cos(A)  0   sin(A)  0 |\n         M = |  0       1   0       0 |\n         | -sin(A)  0   cos(A)  0 |\n         |  0       0   0       1 |\n         */\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = matrix.mat;\n        mat[0] = Math.cos(radians);\n        mat[1] = 0.0;\n        mat[2] = -Math.sin(radians);\n        mat[3] = 0.0;\n\n        mat[7] = mat[6] = mat[4] = 0.0;\n        mat[5] = 1.0;\n\n        mat[8] = Math.sin(radians);\n        mat[9] = 0.0;\n        mat[10] = Math.cos(radians);\n        mat[11] = 0.0;\n\n        mat[14] = mat[13] = mat[12] = 0.0;\n        mat[15] = 1.0;\n        return matrix;\n    };\n\n    /**\n     * Builds a rotation matrix around the Z-axis. The resulting matrix is stored in matrix. matrix is returned.\n     * @param {Number} radians\n     * @param {cc.math.Matrix4} matrix\n     * @return {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByRotationZ = function(radians, matrix){    // cc.kmMat4RotationZ\n        /*\n         |  cos(A)  -sin(A)   0   0 |\n         M = |  sin(A)   cos(A)   0   0 |\n         |  0        0        1   0 |\n         |  0        0        0   1 |\n         */\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = matrix.mat;\n        mat[0] = Math.cos(radians);\n        mat[1] = Math.sin(radians);\n        mat[3] = mat[2] = 0.0;\n\n        mat[4] = -Math.sin(radians);\n        mat[5] = Math.cos(radians);\n        mat[7] = mat[6] = 0.0;\n\n        mat[11] = mat[9] = mat[8] = 0.0;\n        mat[10] = 1.0;\n\n        mat[14] = mat[13] = mat[12] = 0.0;\n        mat[15] = 1.0;\n\n        return matrix;\n    };\n\n    /**\n     * Builds a rotation matrix from pitch, yaw and roll. The resulting matrix is stored in parameter matrix and returns.\n     * @param {Number} pitch\n     * @param {Number} yaw\n     * @param {Number} roll\n     * @param {cc.math.Matrix4} [matrix] if matrix is undefined, creates a new matrix.\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByPitchYawRoll = function(pitch, yaw, roll, matrix) {\n        matrix = matrix || new cc.math.Matrix4();\n        var cr = Math.cos(pitch), sr = Math.sin(pitch);\n        var cp = Math.cos(yaw), sp = Math.sin(yaw);\n        var cy = Math.cos(roll), sy = Math.sin(roll);\n        var srsp = sr * sp, crsp = cr * sp;\n        var mat = matrix.mat;\n\n        mat[0] = cp * cy;\n        mat[4] = cp * sy;\n        mat[8] = -sp;\n\n        mat[1] = srsp * cy - cr * sy;\n        mat[5] = srsp * sy + cr * cy;\n        mat[9] = sr * cp;\n\n        mat[2] = crsp * cy + sr * sy;\n        mat[6] = crsp * sy - sr * cy;\n        mat[10] = cr * cp;\n\n        mat[3] = mat[7] = mat[11] = 0.0;\n        mat[15] = 1.0;\n        return matrix;\n    };\n\n    /**\n     * Builds a matrix by a quaternion.\n     * @param {cc.math.Quaternion} quaternion\n     * @param {cc.math.Matrix4} [matrix] if matrix is undefined, creates a new matrix.\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByQuaternion = function(quaternion, matrix) {\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = matrix.mat;\n        mat[0] = 1.0 - 2.0 * (quaternion.y * quaternion.y + quaternion.z * quaternion.z );\n        mat[1] = 2.0 * (quaternion.x * quaternion.y + quaternion.z * quaternion.w);\n        mat[2] = 2.0 * (quaternion.x * quaternion.z - quaternion.y * quaternion.w);\n        mat[3] = 0.0;\n\n        // Second row\n        mat[4] = 2.0 * ( quaternion.x * quaternion.y - quaternion.z * quaternion.w );\n        mat[5] = 1.0 - 2.0 * ( quaternion.x * quaternion.x + quaternion.z * quaternion.z );\n        mat[6] = 2.0 * (quaternion.z * quaternion.y + quaternion.x * quaternion.w );\n        mat[7] = 0.0;\n\n        // Third row\n        mat[8] = 2.0 * ( quaternion.x * quaternion.z + quaternion.y * quaternion.w );\n        mat[9] = 2.0 * ( quaternion.y * quaternion.z - quaternion.x * quaternion.w );\n        mat[10] = 1.0 - 2.0 * ( quaternion.x * quaternion.x + quaternion.y * quaternion.y );\n        mat[11] = 0.0;\n\n        // Fourth row\n        mat[14] = mat[13] = mat[12] = 0;\n        mat[15] = 1.0;\n        return matrix;\n    };\n\n    /**\n     * Build a 4x4 OpenGL transformation matrix using a 3x3 rotation matrix, and a 3d vector representing a translation.\n     * @param {cc.math.Matrix3} rotation\n     * @param {cc.math.Vec3} translation\n     * @param {cc.math.Matrix4} [matrix] if matrix is undefined, creates a new matrix.\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByRotationTranslation = function(rotation, translation, matrix) {\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = matrix.mat, rMat = rotation.mat;\n        mat[0] = rMat[0];\n        mat[1] = rMat[1];\n        mat[2] = rMat[2];\n        mat[3] = 0.0;\n\n        mat[4] = rMat[3];\n        mat[5] = rMat[4];\n        mat[6] = rMat[5];\n        mat[7] = 0.0;\n\n        mat[8] = rMat[6];\n        mat[9] = rMat[7];\n        mat[10] = rMat[8];\n        mat[11] = 0.0;\n\n        mat[12] = translation.x;\n        mat[13] = translation.y;\n        mat[14] = translation.z;\n        mat[15] = 1.0;\n        return matrix;\n    };\n\n    /**\n     * Builds a scaling matrix\n     * @param {Number} x\n     * @param {Number} y\n     * @param {Number} z\n     * @param {cc.math.Matrix4} [matrix] if matrix is undefined, creates a new matrix.\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByScale = function(x, y, z, matrix) {  //cc.kmMat4Scaling\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = matrix.mat;\n        mat[0] = x;\n        mat[5] = y;\n        mat[10] = z;\n        mat[15] = 1.0;\n        mat[1] = mat[2] = mat[3] = mat[4] = mat[6] = mat[7] =\n            mat[8] = mat[9] = mat[11] = mat[12] = mat[13] = mat[14] = 0;\n         return matrix;\n    };\n\n    /**\n     * Builds a translation matrix. All other elements in the matrix\n     * will be set to zero except for the diagonal which is set to 1.0\n     */\n    cc.kmMat4Translation = function (pOut, x, y, z) {\n        //FIXME: Write a test for this\n        pOut.mat[0] = pOut.mat[5] = pOut.mat[10] = pOut.mat[15] = 1.0;\n        pOut.mat[1] = pOut.mat[2] = pOut.mat[3] =\n            pOut.mat[4] = pOut.mat[6] = pOut.mat[7] =\n                pOut.mat[8] = pOut.mat[9] = pOut.mat[11] = 0.0;\n        pOut.mat[12] = x;\n        pOut.mat[13] = y;\n        pOut.mat[14] = z;\n        return pOut;\n    };\n\n    /**\n     *  Builds a translation matrix.\n     * @param {Number} x\n     * @param {Number} y\n     * @param {Number} z\n     * @param {cc.math.Matrix4} [matrix] if matrix is undefined, creates a new matrix.\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByTranslation = function(x, y, z, matrix){       //cc.kmMat4Translation\n        matrix = matrix || new cc.math.Matrix4();\n        matrix.identity();\n        matrix.mat[12] = x;\n        matrix.mat[13] = y;\n        matrix.mat[14] = z;\n        return matrix;\n    };\n\n    /**\n     *  Get the up vector from a matrix.\n     *  @returns {cc.math.Vec3}\n     */\n    proto.getUpVec3 = function() {\n        var mat = this.mat;\n        var ret = new cc.math.Vec3(mat[4],mat[5], mat[6]);\n        return ret.normalize();\n    };\n\n    /**\n     * Extract the right vector from a 4x4 matrix.\n     * @returns {cc.math.Vec3}\n     */\n    proto.getRightVec3 = function(){\n        var mat = this.mat;\n        var ret = new cc.math.Vec3(mat[0],mat[1], mat[2]);\n        return ret.normalize();\n    };\n\n    /**\n     * Extract the forward vector from a 4x4 matrix.\n     * @returns {cc.math.Vec3}\n     */\n    proto.getForwardVec3 = function() {\n        var mat = this.mat;\n        var ret = new cc.math.Vec3(mat[8],mat[9], mat[10]);\n        return ret.normalize();\n    };\n\n    /**\n     * Creates a perspective projection matrix in the\n     * same way as gluPerspective\n     */\n    cc.kmMat4PerspectiveProjection = function (pOut, fovY, aspect, zNear, zFar) {\n        var r = cc.degreesToRadians(fovY / 2);\n        var deltaZ = zFar - zNear;\n        var s = Math.sin(r);\n\n        if (deltaZ === 0 || s === 0 || aspect === 0)\n            return null;\n\n        //cos(r) / sin(r) = cot(r)\n        var cotangent = Math.cos(r) / s;\n        pOut.identity();\n        pOut.mat[0] = cotangent / aspect;\n        pOut.mat[5] = cotangent;\n        pOut.mat[10] = -(zFar + zNear) / deltaZ;\n        pOut.mat[11] = -1;\n        pOut.mat[14] = -2 * zNear * zFar / deltaZ;\n        pOut.mat[15] = 0;\n\n        return pOut;\n    };\n\n    /**\n     * Creates a perspective projection matrix in the same way as gluPerspective\n     * @param {Number} fovY\n     * @param {Number} aspect\n     * @param {Number} zNear\n     * @param {Number} zFar\n     * @returns {cc.math.Matrix4|Null}\n     */\n    cc.math.Matrix4.createPerspectiveProjection = function(fovY, aspect, zNear, zFar){\n        var r = cc.degreesToRadians(fovY / 2), deltaZ = zFar - zNear;\n        var s = Math.sin(r);\n\n        if (deltaZ === 0 || s === 0 || aspect === 0)\n            return null;\n\n        //cos(r) / sin(r) = cot(r)\n        var cotangent = Math.cos(r) / s;\n        var matrix = new cc.math.Matrix4(), mat = matrix.mat;\n        matrix.identity();\n        mat[0] = cotangent / aspect;\n        mat[5] = cotangent;\n        mat[10] = -(zFar + zNear) / deltaZ;\n        mat[11] = -1;\n        mat[14] = -2 * zNear * zFar / deltaZ;\n        mat[15] = 0;\n        return matrix;\n    };\n\n    /** Creates an orthographic projection matrix like glOrtho */\n    cc.kmMat4OrthographicProjection = function (pOut, left, right, bottom, top, nearVal, farVal) {\n        pOut.identity();\n        pOut.mat[0] = 2 / (right - left);\n        pOut.mat[5] = 2 / (top - bottom);\n        pOut.mat[10] = -2 / (farVal - nearVal);\n        pOut.mat[12] = -((right + left) / (right - left));\n        pOut.mat[13] = -((top + bottom) / (top - bottom));\n        pOut.mat[14] = -((farVal + nearVal) / (farVal - nearVal));\n        return pOut;\n    };\n\n    /**\n     * Creates an orthographic projection matrix like glOrtho\n     * @param {Number} left\n     * @param {Number} right\n     * @param {Number} bottom\n     * @param {Number} top\n     * @param {Number} nearVal\n     * @param {Number} farVal\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createOrthographicProjection = function (left, right, bottom, top, nearVal, farVal) {\n        var matrix = new cc.math.Matrix4(), mat = matrix.mat;\n        matrix.identity();\n        mat[0] = 2 / (right - left);\n        mat[5] = 2 / (top - bottom);\n        mat[10] = -2 / (farVal - nearVal);\n        mat[12] = -((right + left) / (right - left));\n        mat[13] = -((top + bottom) / (top - bottom));\n        mat[14] = -((farVal + nearVal) / (farVal - nearVal));\n        return matrix;\n    };\n\n    /**\n     * Builds a translation matrix in the same way as gluLookAt()\n     * the resulting matrix is stored in pOut. pOut is returned.\n     */\n    cc.kmMat4LookAt = function (pOut, pEye, pCenter, pUp) {\n        var f = new cc.math.Vec3(pCenter), up = new cc.math.Vec3(pUp);\n        f.subtract(pEye);\n        f.normalize();\n        up.normalize();\n\n        var s = new cc.math.Vec3(f);\n        s.cross(up);\n        s.normalize();\n\n        var u = new cc.math.Vec3(s);\n        u.cross(f);\n        s.normalize();\n\n        pOut.identity();\n\n        pOut.mat[0] = s.x;\n        pOut.mat[4] = s.y;\n        pOut.mat[8] = s.z;\n\n        pOut.mat[1] = u.x;\n        pOut.mat[5] = u.y;\n        pOut.mat[9] = u.z;\n\n        pOut.mat[2] = -f.x;\n        pOut.mat[6] = -f.y;\n        pOut.mat[10] = -f.z;\n\n        var translate = cc.math.Matrix4.createByTranslation(-pEye.x, -pEye.y, -pEye.z);\n        pOut.multiply(translate);\n        return pOut;\n    };\n\n    var tempMatrix = new cc.math.Matrix4();         // an internal matrix\n    proto.lookAt = function(eyeVec, centerVec, upVec) {\n        var f = new cc.math.Vec3(centerVec), up = new cc.math.Vec3(upVec), mat = this.mat;\n        f.subtract(eyeVec);\n        f.normalize();\n        up.normalize();\n\n        var s = new cc.math.Vec3(f);\n        s.cross(up);\n        s.normalize();\n\n        var u = new cc.math.Vec3(s);\n        u.cross(f);\n        s.normalize();\n\n        this.identity();\n        mat[0] = s.x;\n        mat[4] = s.y;\n        mat[8] = s.z;\n\n        mat[1] = u.x;\n        mat[5] = u.y;\n        mat[9] = u.z;\n\n        mat[2] = -f.x;\n        mat[6] = -f.y;\n        mat[10] = -f.z;\n\n        tempMatrix = cc.math.Matrix4.createByTranslation(-eyeVec.x, -eyeVec.y, -eyeVec.z, tempMatrix);\n        this.multiply(tempMatrix);\n        return this;\n    };\n\n    /**\n     * Build a rotation matrix from an axis and an angle. Result is stored in pOut.\n     * pOut is returned.\n     */\n    cc.kmMat4RotationAxisAngle = function (pOut, axis, radians) {\n        var rcos = Math.cos(radians), rsin = Math.sin(radians);\n\n        var normalizedAxis = new cc.math.Vec3(axis);\n        normalizedAxis.normalize();\n\n        pOut.mat[0] = rcos + normalizedAxis.x * normalizedAxis.x * (1 - rcos);\n        pOut.mat[1] = normalizedAxis.z * rsin + normalizedAxis.y * normalizedAxis.x * (1 - rcos);\n        pOut.mat[2] = -normalizedAxis.y * rsin + normalizedAxis.z * normalizedAxis.x * (1 - rcos);\n        pOut.mat[3] = 0.0;\n\n        pOut.mat[4] = -normalizedAxis.z * rsin + normalizedAxis.x * normalizedAxis.y * (1 - rcos);\n        pOut.mat[5] = rcos + normalizedAxis.y * normalizedAxis.y * (1 - rcos);\n        pOut.mat[6] = normalizedAxis.x * rsin + normalizedAxis.z * normalizedAxis.y * (1 - rcos);\n        pOut.mat[7] = 0.0;\n\n        pOut.mat[8] = normalizedAxis.y * rsin + normalizedAxis.x * normalizedAxis.z * (1 - rcos);\n        pOut.mat[9] = -normalizedAxis.x * rsin + normalizedAxis.y * normalizedAxis.z * (1 - rcos);\n        pOut.mat[10] = rcos + normalizedAxis.z * normalizedAxis.z * (1 - rcos);\n        pOut.mat[11] = 0.0;\n\n        pOut.mat[12] = 0.0;\n        pOut.mat[13] = 0.0;\n        pOut.mat[14] = 0.0;\n        pOut.mat[15] = 1.0;\n\n        return pOut;\n    };\n\n    /**\n     * Build a rotation matrix from an axis and an angle.\n     * @param {cc.math.Vec3} axis\n     * @param {Number} radians\n     * @param {cc.math.Matrix4} [matrix]\n     * @returns {cc.math.Matrix4}\n     */\n    cc.math.Matrix4.createByAxisAndAngle = function(axis, radians, matrix) {\n        matrix = matrix || new cc.math.Matrix4();\n        var mat = this.mat, rcos = Math.cos(radians), rsin = Math.sin(radians) ;\n\n        var normalizedAxis = new cc.math.Vec3(axis);\n        normalizedAxis.normalize();\n\n        mat[0] = rcos + normalizedAxis.x * normalizedAxis.x * (1 - rcos);\n        mat[1] = normalizedAxis.z * rsin + normalizedAxis.y * normalizedAxis.x * (1 - rcos);\n        mat[2] = -normalizedAxis.y * rsin + normalizedAxis.z * normalizedAxis.x * (1 - rcos);\n        mat[3] = 0.0;\n\n        mat[4] = -normalizedAxis.z * rsin + normalizedAxis.x * normalizedAxis.y * (1 - rcos);\n        mat[5] = rcos + normalizedAxis.y * normalizedAxis.y * (1 - rcos);\n        mat[6] = normalizedAxis.x * rsin + normalizedAxis.z * normalizedAxis.y * (1 - rcos);\n        mat[7] = 0.0;\n\n        mat[8] = normalizedAxis.y * rsin + normalizedAxis.x * normalizedAxis.z * (1 - rcos);\n        mat[9] = -normalizedAxis.x * rsin + normalizedAxis.y * normalizedAxis.z * (1 - rcos);\n        mat[10] = rcos + normalizedAxis.z * normalizedAxis.z * (1 - rcos);\n        mat[11] = 0.0;\n\n        mat[12] = mat[13] = mat[14] = 0.0;\n        mat[15] = 1.0;\n        return matrix;\n    };\n\n    /**\n     * Extract a 3x3 rotation matrix from the input 4x4 transformation.\n     * @returns {cc.math.Matrix3}\n     */\n    proto.extractRotation = function(){\n        var matrix = new cc.math.Matrix3(), mat4 = this.mat, mat3 = matrix.mat;\n        mat3[0] = mat4[0];\n        mat3[1] = mat4[1];\n        mat3[2] = mat4[2];\n\n        mat3[3] = mat4[4];\n        mat3[4] = mat4[5];\n        mat3[5] = mat4[6];\n\n        mat3[6] = mat4[8];\n        mat3[7] = mat4[9];\n        mat3[8] = mat4[10];\n        return matrix;\n    };\n\n    proto.extractPlane = function(planeType) {\n        var plane = new cc.math.Plane(), mat = this.mat;\n        switch (planeType) {\n            case cc.math.Plane.RIGHT:\n                plane.a = mat[3] - mat[0];\n                plane.b = mat[7] - mat[4];\n                plane.c = mat[11] - mat[8];\n                plane.d = mat[15] - mat[12];\n                break;\n            case cc.math.Plane.LEFT:\n                plane.a = mat[3] + mat[0];\n                plane.b = mat[7] + mat[4];\n                plane.c = mat[11] + mat[8];\n                plane.d = mat[15] + mat[12];\n                break;\n            case cc.math.Plane.BOTTOM:\n                plane.a = mat[3] + mat[1];\n                plane.b = mat[7] + mat[5];\n                plane.c = mat[11] + mat[9];\n                plane.d = mat[15] + mat[13];\n                break;\n            case cc.math.Plane.TOP:\n                plane.a = mat[3] - mat[1];\n                plane.b = mat[7] - mat[5];\n                plane.c = mat[11] - mat[9];\n                plane.d = mat[15] - mat[13];\n                break;\n            case cc.math.Plane.FAR:\n                plane.a = mat[3] - mat[2];\n                plane.b = mat[7] - mat[6];\n                plane.c = mat[11] - mat[10];\n                plane.d = mat[15] - mat[14];\n                break;\n            case cc.math.Plane.NEAR:\n                plane.a = mat[3] + mat[2];\n                plane.b = mat[7] + mat[6];\n                plane.c = mat[11] + mat[10];\n                plane.d = mat[15] + mat[14];\n                break;\n            default:\n                cc.log(\"cc.math.Matrix4.extractPlane: Invalid plane index\");\n                break;\n        }\n\n        var t = Math.sqrt(plane.a * plane.a + plane.b * plane.b + plane.c * plane.c);\n        plane.a /= t;\n        plane.b /= t;\n        plane.c /= t;\n        plane.d /= t;\n        return plane;\n    };\n\n    /**\n     * Take the rotation from a 4x4 transformation matrix, and return it as an axis and an angle (in radians)\n     * @returns {*|{axis: cc.math.Vec3, angle: number}}\n     */\n    proto.toAxisAndAngle = function() {\n        /*Surely not this easy?*/\n        var rotation = this.extractRotation();\n        var temp = cc.math.Quaternion.rotationMatrix(rotation);\n        return temp.toAxisAndAngle();\n    };\n})(cc);\n"]}