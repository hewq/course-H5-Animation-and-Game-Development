{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/base-nodes/assets/frameworks/cocos2d-html5/cocos2d/core/base-nodes/CCNodeCanvasRenderCmd.js"],"names":["cc","CustomRenderCmd","target","func","_needDraw","_target","_callback","prototype","rendering","ctx","scaleX","scaleY","call","needDraw","dirtyFlags","Node","_dirtyFlags","transformDirty","visibleDirty","colorDirty","opacityDirty","cacheDirty","orderDirty","textDirty","gradientDirty","textureDirty","contentDirty","COUNT","all","ONE_DEGREE","Math","PI","transformChildTree","root","index","children","child","curr","parentCmd","i","len","stack","_performStacks","_performing","push","length","_children","_renderCmd","transform","pChildren","_protectedChildren","RenderCmd","renderable","_node","_anchorPointInPoints","x","y","_displayedColor","color","constructor","_dirtyFlag","_curLevel","_displayedOpacity","_cascadeColorEnabledDirty","_cascadeOpacityEnabledDirty","_transform","_worldTransform","_inverse","getAnchorPointInPoints","p","getDisplayedColor","tmpColor","r","g","b","a","getDisplayedOpacity","setCascadeColorEnabledDirty","setDirtyFlag","setCascadeOpacityEnabledDirty","getParentToNodeTransform","c","d","tx","ty","affineTransformInvertOut","getNodeToParentTransform","detachFromParent","_updateAnchorPointInPoint","locAPP","locSize","_contentSize","locAnchorPoint","_anchorPoint","width","height","dirtyFlag","renderer","pushDirtyNode","getParentRenderCmd","_parent","recursive","node","pt","t","wt","_usingNormalizedPosition","conSize","_position","_normalizedPosition","_normalizedPositionDirty","hasRotation","_rotationX","_rotationY","hasSkew","_skewX","_skewY","sx","_scaleX","sy","_scaleY","appX","appY","rotationRadiansX","sin","cos","rotationRadiansY","skx","tan","sky","Infinity","_ignoreAnchorPointForPosition","_additionalTransformDirty","affineTransformConcatIn","_additionalTransform","_updateCurrentRegions","_notifyRegionStatus","CanvasRenderCmd","RegionStatus","DirtyDouble","_cacheDirty","visit","isNaN","_customZ","_vertexZ","assignedZ","assignedZStep","_syncStatus","_updateDisplayColor","parentColor","locDispColor","locRealColor","_realColor","selChildren","item","Dirty","_cascadeColorEnabled","whiteColor","Color","undefined","locParent","WHITE","_updateColor","_updateDisplayOpacity","parentOpacity","_cascadeOpacityEnabled","_realOpacity","_syncDisplayColor","_syncDisplayOpacity","_propagateFlagsDown","locFlag","parentNode","updateStatus","setShaderProgram","shaderProgram","getShaderProgram","getGLProgramState","setGLProgramState","glProgramState","originTransform","originUpdateStatus","_originSyncStatus","_cachedParent","_currentRegion","Region","_oldRegion","_regionFlag","_canUseDirtyRegion","NotDirty","proto","Object","create","_rootCtor","status","localBB","Rect","getLocalBB","temp","isEmpty","union","updateRegion","_setCacheDirty","cachedP","_setNodeDirtyForCache","_setCachedParent","cachedParent","_getCompositeOperationByBlendFunc","blendFunc","src","SRC_ALPHA","dst","ONE","ZERO","ONE_MINUS_SRC_ALPHA"],"mappings":"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","file":"CCNodeCanvasRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/base-nodes","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n//---------------------- Customer render cmd --------------------\ncc.CustomRenderCmd = function (target, func) {\n    this._needDraw = true;\n    this._target = target;\n    this._callback = func;\n};\ncc.CustomRenderCmd.prototype.rendering = function (ctx, scaleX, scaleY) {\n    if (!this._callback)\n        return;\n    this._callback.call(this._target, ctx, scaleX, scaleY);\n};\ncc.CustomRenderCmd.prototype.needDraw = function () {\n    return this._needDraw;\n};\n\nvar dirtyFlags = cc.Node._dirtyFlags = {\n    transformDirty: 1 << 0, visibleDirty: 1 << 1, colorDirty: 1 << 2, opacityDirty: 1 << 3, cacheDirty: 1 << 4,\n    orderDirty: 1 << 5, textDirty: 1 << 6, gradientDirty: 1 << 7, textureDirty: 1 << 8,\n    contentDirty: 1 << 9,\n    COUNT: 10,\n    all: (1 << 10) - 1\n};\n\nvar ONE_DEGREE = Math.PI / 180;\n\nfunction transformChildTree(root) {\n    var index = 1;\n    var children, child, curr, parentCmd, i, len;\n    var stack = cc.Node._performStacks[cc.Node._performing];\n    if (!stack) {\n        stack = [];\n        cc.Node._performStacks.push(stack);\n    }\n    stack.length = 0;\n    cc.Node._performing++;\n    stack[0] = root;\n    while (index) {\n        index--;\n        curr = stack[index];\n        // Avoid memory leak\n        stack[index] = null;\n        if (!curr) continue;\n        children = curr._children;\n        if (children && children.length > 0) {\n            parentCmd = curr._renderCmd;\n            for (i = 0, len = children.length; i < len; ++i) {\n                child = children[i];\n                stack[index] = child;\n                index++;\n                child._renderCmd.transform(parentCmd);\n            }\n        }\n        var pChildren = curr._protectedChildren;\n        if (pChildren && pChildren.length > 0) {\n            parentCmd = curr._renderCmd;\n            for (i = 0, len = pChildren.length; i < len; ++i) {\n                child = pChildren[i];\n                stack[index] = child;\n                index++;\n                child._renderCmd.transform(parentCmd);\n            }\n        }\n    }\n    cc.Node._performing--;\n}\n\n//-------------------------Base -------------------------\ncc.Node.RenderCmd = function (renderable) {\n    this._node = renderable;\n    this._anchorPointInPoints = {x: 0, y: 0};\n    this._displayedColor = cc.color(255, 255, 255, 255);\n};\n\ncc.Node.RenderCmd.prototype = {\n    constructor: cc.Node.RenderCmd,\n\n    _needDraw: false,\n    _dirtyFlag: 1,\n    _curLevel: -1,\n\n    _displayedOpacity: 255,\n    _cascadeColorEnabledDirty: false,\n    _cascadeOpacityEnabledDirty: false,\n\n    _transform: null,\n    _worldTransform: null,\n    _inverse: null,\n\n    needDraw: function () {\n        return this._needDraw;\n    },\n\n    getAnchorPointInPoints: function () {\n        return cc.p(this._anchorPointInPoints);\n    },\n\n    getDisplayedColor: function () {\n        var tmpColor = this._displayedColor;\n        return cc.color(tmpColor.r, tmpColor.g, tmpColor.b, tmpColor.a);\n    },\n\n    getDisplayedOpacity: function () {\n        return this._displayedOpacity;\n    },\n\n    setCascadeColorEnabledDirty: function () {\n        this._cascadeColorEnabledDirty = true;\n        this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);\n    },\n\n    setCascadeOpacityEnabledDirty: function () {\n        this._cascadeOpacityEnabledDirty = true;\n        this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty);\n    },\n\n    getParentToNodeTransform: function () {\n        if (!this._inverse) {\n            this._inverse = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n        }\n        if (this._dirtyFlag & cc.Node._dirtyFlags.transformDirty) {\n            cc.affineTransformInvertOut(this.getNodeToParentTransform(), this._inverse);\n        }\n        return this._inverse;\n    },\n\n    detachFromParent: function () {\n    },\n\n    _updateAnchorPointInPoint: function () {\n        var locAPP = this._anchorPointInPoints, locSize = this._node._contentSize, locAnchorPoint = this._node._anchorPoint;\n        locAPP.x = locSize.width * locAnchorPoint.x;\n        locAPP.y = locSize.height * locAnchorPoint.y;\n        this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);\n    },\n\n    setDirtyFlag: function (dirtyFlag) {\n        if (this._dirtyFlag === 0 && dirtyFlag !== 0)\n            cc.renderer.pushDirtyNode(this);\n        this._dirtyFlag |= dirtyFlag;\n    },\n\n    getParentRenderCmd: function () {\n        if (this._node && this._node._parent && this._node._parent._renderCmd)\n            return this._node._parent._renderCmd;\n        return null;\n    },\n\n    transform: function (parentCmd, recursive) {\n        if (!this._transform) {\n            this._transform = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n            this._worldTransform = {a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0};\n        }\n\n        var node = this._node,\n            pt = parentCmd ? parentCmd._worldTransform : null,\n            t = this._transform,\n            wt = this._worldTransform;         //get the world transform\n\n        if (node._usingNormalizedPosition && node._parent) {\n            var conSize = node._parent._contentSize;\n            node._position.x = node._normalizedPosition.x * conSize.width;\n            node._position.y = node._normalizedPosition.y * conSize.height;\n            node._normalizedPositionDirty = false;\n        }\n\n        var hasRotation = node._rotationX || node._rotationY;\n        var hasSkew = node._skewX || node._skewY;\n        var sx = node._scaleX, sy = node._scaleY;\n        var appX = this._anchorPointInPoints.x, appY = this._anchorPointInPoints.y;\n        var a = 1, b = 0, c = 0, d = 1;\n        if (hasRotation || hasSkew) {\n            // position \n            t.tx = node._position.x;\n            t.ty = node._position.y;\n\n            // rotation\n            if (hasRotation) {\n                var rotationRadiansX = node._rotationX * ONE_DEGREE;\n                c = Math.sin(rotationRadiansX);\n                d = Math.cos(rotationRadiansX);\n                if (node._rotationY === node._rotationX) {\n                    a = d;\n                    b = -c;\n                }\n                else {\n                    var rotationRadiansY = node._rotationY * ONE_DEGREE;\n                    a = Math.cos(rotationRadiansY);\n                    b = -Math.sin(rotationRadiansY);\n                }\n            }\n\n            // scale\n            t.a = a *= sx;\n            t.b = b *= sx;\n            t.c = c *= sy;\n            t.d = d *= sy;\n\n            // skew\n            if (hasSkew) {\n                var skx = Math.tan(node._skewX * ONE_DEGREE);\n                var sky = Math.tan(node._skewY * ONE_DEGREE);\n                if (skx === Infinity)\n                    skx = 99999999;\n                if (sky === Infinity)\n                    sky = 99999999;\n                t.a = a + c * sky;\n                t.b = b + d * sky;\n                t.c = c + a * skx;\n                t.d = d + b * skx;\n            }\n\n            if (appX || appY) {\n                t.tx -= t.a * appX + t.c * appY;\n                t.ty -= t.b * appX + t.d * appY;\n                // adjust anchorPoint\n                if (node._ignoreAnchorPointForPosition) {\n                    t.tx += appX;\n                    t.ty += appY;\n                }\n            }\n\n            if (node._additionalTransformDirty) {\n                cc.affineTransformConcatIn(t, node._additionalTransform);\n            }\n\n            if (pt) {\n                // cc.AffineTransformConcat is incorrect at get world transform\n                wt.a = t.a * pt.a + t.b * pt.c;                               //a\n                wt.b = t.a * pt.b + t.b * pt.d;                               //b\n                wt.c = t.c * pt.a + t.d * pt.c;                               //c\n                wt.d = t.c * pt.b + t.d * pt.d;                               //d\n                wt.tx = pt.a * t.tx + pt.c * t.ty + pt.tx;\n                wt.ty = pt.d * t.ty + pt.ty + pt.b * t.tx;\n            } else {\n                wt.a = t.a;\n                wt.b = t.b;\n                wt.c = t.c;\n                wt.d = t.d;\n                wt.tx = t.tx;\n                wt.ty = t.ty;\n            }\n        }\n        else {\n            t.a = sx;\n            t.b = 0;\n            t.c = 0;\n            t.d = sy;\n            t.tx = node._position.x;\n            t.ty = node._position.y;\n\n            if (appX || appY) {\n                t.tx -= t.a * appX;\n                t.ty -= t.d * appY;\n                // adjust anchorPoint\n                if (node._ignoreAnchorPointForPosition) {\n                    t.tx += appX;\n                    t.ty += appY;\n                }\n            }\n\n            if (node._additionalTransformDirty) {\n                cc.affineTransformConcatIn(t, node._additionalTransform);\n            }\n\n            if (pt) {\n                wt.a = t.a * pt.a + t.b * pt.c;\n                wt.b = t.a * pt.b + t.b * pt.d;\n                wt.c = t.c * pt.a + t.d * pt.c;\n                wt.d = t.c * pt.b + t.d * pt.d;\n                wt.tx = t.tx * pt.a + t.ty * pt.c + pt.tx;\n                wt.ty = t.tx * pt.b + t.ty * pt.d + pt.ty;\n            } else {\n                wt.a = t.a;\n                wt.b = t.b;\n                wt.c = t.c;\n                wt.d = t.d;\n                wt.tx = t.tx;\n                wt.ty = t.ty;\n            }\n        }\n\n        if (this._updateCurrentRegions) {\n            this._updateCurrentRegions();\n            this._notifyRegionStatus && this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble);\n        }\n\n        if (recursive) {\n            transformChildTree(node);\n        }\n\n        this._cacheDirty = true;\n    },\n\n    getNodeToParentTransform: function () {\n        if (!this._transform || this._dirtyFlag & cc.Node._dirtyFlags.transformDirty) {\n            this.transform();\n        }\n        return this._transform;\n    },\n\n    visit: function (parentCmd) {\n        var node = this._node, renderer = cc.renderer;\n\n        parentCmd = parentCmd || this.getParentRenderCmd();\n        if (parentCmd)\n            this._curLevel = parentCmd._curLevel + 1;\n\n        if (isNaN(node._customZ)) {\n            node._vertexZ = renderer.assignedZ;\n            renderer.assignedZ += renderer.assignedZStep;\n        }\n\n        this._syncStatus(parentCmd);\n    },\n\n    _updateDisplayColor: function (parentColor) {\n        var node = this._node;\n        var locDispColor = this._displayedColor, locRealColor = node._realColor;\n        var i, len, selChildren, item;\n        this._notifyRegionStatus && this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);\n        if (this._cascadeColorEnabledDirty && !node._cascadeColorEnabled) {\n            locDispColor.r = locRealColor.r;\n            locDispColor.g = locRealColor.g;\n            locDispColor.b = locRealColor.b;\n            var whiteColor = new cc.Color(255, 255, 255, 255);\n            selChildren = node._children;\n            for (i = 0, len = selChildren.length; i < len; i++) {\n                item = selChildren[i];\n                if (item && item._renderCmd)\n                    item._renderCmd._updateDisplayColor(whiteColor);\n            }\n            this._cascadeColorEnabledDirty = false;\n        } else {\n            if (parentColor === undefined) {\n                var locParent = node._parent;\n                if (locParent && locParent._cascadeColorEnabled)\n                    parentColor = locParent.getDisplayedColor();\n                else\n                    parentColor = cc.color.WHITE;\n            }\n            locDispColor.r = 0 | (locRealColor.r * parentColor.r / 255.0);\n            locDispColor.g = 0 | (locRealColor.g * parentColor.g / 255.0);\n            locDispColor.b = 0 | (locRealColor.b * parentColor.b / 255.0);\n            if (node._cascadeColorEnabled) {\n                selChildren = node._children;\n                for (i = 0, len = selChildren.length; i < len; i++) {\n                    item = selChildren[i];\n                    if (item && item._renderCmd) {\n                        item._renderCmd._updateDisplayColor(locDispColor);\n                        item._renderCmd._updateColor();\n                    }\n                }\n            }\n        }\n        this._dirtyFlag &= ~dirtyFlags.colorDirty;\n    },\n\n    _updateDisplayOpacity: function (parentOpacity) {\n        var node = this._node;\n        var i, len, selChildren, item;\n        this._notifyRegionStatus && this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);\n        if (this._cascadeOpacityEnabledDirty && !node._cascadeOpacityEnabled) {\n            this._displayedOpacity = node._realOpacity;\n            selChildren = node._children;\n            for (i = 0, len = selChildren.length; i < len; i++) {\n                item = selChildren[i];\n                if (item && item._renderCmd)\n                    item._renderCmd._updateDisplayOpacity(255);\n            }\n            this._cascadeOpacityEnabledDirty = false;\n        } else {\n            if (parentOpacity === undefined) {\n                var locParent = node._parent;\n                parentOpacity = 255;\n                if (locParent && locParent._cascadeOpacityEnabled)\n                    parentOpacity = locParent.getDisplayedOpacity();\n            }\n            this._displayedOpacity = node._realOpacity * parentOpacity / 255.0;\n            if (node._cascadeOpacityEnabled) {\n                selChildren = node._children;\n                for (i = 0, len = selChildren.length; i < len; i++) {\n                    item = selChildren[i];\n                    if (item && item._renderCmd) {\n                        item._renderCmd._updateDisplayOpacity(this._displayedOpacity);\n                        item._renderCmd._updateColor();\n                    }\n                }\n            }\n        }\n        this._dirtyFlag &= ~dirtyFlags.opacityDirty;\n    },\n\n    _syncDisplayColor: function (parentColor) {\n        var node = this._node, locDispColor = this._displayedColor, locRealColor = node._realColor;\n        if (parentColor === undefined) {\n            var locParent = node._parent;\n            if (locParent && locParent._cascadeColorEnabled)\n                parentColor = locParent.getDisplayedColor();\n            else\n                parentColor = cc.color.WHITE;\n        }\n        locDispColor.r = 0 | (locRealColor.r * parentColor.r / 255.0);\n        locDispColor.g = 0 | (locRealColor.g * parentColor.g / 255.0);\n        locDispColor.b = 0 | (locRealColor.b * parentColor.b / 255.0);\n    },\n\n    _syncDisplayOpacity: function (parentOpacity) {\n        var node = this._node;\n        if (parentOpacity === undefined) {\n            var locParent = node._parent;\n            parentOpacity = 255;\n            if (locParent && locParent._cascadeOpacityEnabled)\n                parentOpacity = locParent.getDisplayedOpacity();\n        }\n        this._displayedOpacity = node._realOpacity * parentOpacity / 255.0;\n    },\n\n    _updateColor: function () {\n    },\n\n    _propagateFlagsDown: function (parentCmd) {\n        var locFlag = this._dirtyFlag;\n        var parentNode = parentCmd ? parentCmd._node : null;\n\n        if(parentNode && parentNode._cascadeColorEnabled && (parentCmd._dirtyFlag & dirtyFlags.colorDirty))\n            locFlag |= dirtyFlags.colorDirty;\n\n        if(parentNode && parentNode._cascadeOpacityEnabled && (parentCmd._dirtyFlag & dirtyFlags.opacityDirty))\n            locFlag |= dirtyFlags.opacityDirty;\n\n        if(parentCmd && (parentCmd._dirtyFlag & dirtyFlags.transformDirty))\n            locFlag |= dirtyFlags.transformDirty;\n\n        this._dirtyFlag = locFlag;\n    },\n\n    updateStatus: function () {\n        var locFlag = this._dirtyFlag;\n        var colorDirty = locFlag & dirtyFlags.colorDirty,\n            opacityDirty = locFlag & dirtyFlags.opacityDirty;\n\n        if (locFlag & dirtyFlags.contentDirty) {\n            this._notifyRegionStatus && this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);\n            this._dirtyFlag &= ~dirtyFlags.contentDirty;\n        }\n\n        if (colorDirty)\n            this._updateDisplayColor();\n\n        if (opacityDirty)\n            this._updateDisplayOpacity();\n\n        if (colorDirty || opacityDirty)\n            this._updateColor();\n\n        if (locFlag & dirtyFlags.transformDirty) {\n            //update the transform\n            this.transform(this.getParentRenderCmd(), true);\n            this._dirtyFlag &= ~dirtyFlags.transformDirty;\n        }\n\n        if (locFlag & dirtyFlags.orderDirty)\n            this._dirtyFlag &= ~dirtyFlags.orderDirty;\n    },\n\n    _syncStatus: function (parentCmd) {\n        //  In the visit logic does not restore the _dirtyFlag\n        //  Because child elements need parent's _dirtyFlag to change himself\n        var locFlag = this._dirtyFlag, parentNode = parentCmd ? parentCmd._node : null;\n\n        //  There is a possibility:\n        //    The parent element changed color, child element not change\n        //    This will cause the parent element changed color\n        //    But while the child element does not enter the circulation\n        //    Here will be reset state in last\n        //    In order the child elements get the parent state\n        if (parentNode && parentNode._cascadeColorEnabled && (parentCmd._dirtyFlag & dirtyFlags.colorDirty))\n            locFlag |= dirtyFlags.colorDirty;\n\n        if (parentNode && parentNode._cascadeOpacityEnabled && (parentCmd._dirtyFlag & dirtyFlags.opacityDirty))\n            locFlag |= dirtyFlags.opacityDirty;\n\n        if (parentCmd && (parentCmd._dirtyFlag & dirtyFlags.transformDirty))\n            locFlag |= dirtyFlags.transformDirty;\n\n        this._dirtyFlag = locFlag;\n\n        var colorDirty = locFlag & dirtyFlags.colorDirty,\n            opacityDirty = locFlag & dirtyFlags.opacityDirty;\n\n        if (colorDirty)\n            //update the color\n            this._syncDisplayColor();\n\n        if (opacityDirty)\n            //update the opacity\n            this._syncDisplayOpacity();\n\n        if (colorDirty || opacityDirty)\n            this._updateColor();\n\n        if (locFlag & dirtyFlags.transformDirty)\n            //update the transform\n            this.transform(parentCmd);\n\n        if (locFlag & dirtyFlags.orderDirty)\n            this._dirtyFlag &= ~dirtyFlags.orderDirty;\n    },\n\n    setShaderProgram: function (shaderProgram) {\n        //do nothing.\n    },\n\n    getShaderProgram: function () {\n        return null;\n    },\n\n    getGLProgramState: function () {\n        return null;\n    },\n\n    setGLProgramState: function (glProgramState) {\n        // do nothing\n    },\n};\n\ncc.Node.RenderCmd.prototype.originTransform = cc.Node.RenderCmd.prototype.transform;\ncc.Node.RenderCmd.prototype.originUpdateStatus = cc.Node.RenderCmd.prototype.updateStatus;\ncc.Node.RenderCmd.prototype._originSyncStatus = cc.Node.RenderCmd.prototype._syncStatus;\n\n//-----------------------Canvas ---------------------------\n\n(function () {\n//The cc.Node's render command for Canvas\n    cc.Node.CanvasRenderCmd = function (renderable) {\n        this._node = renderable;\n        this._anchorPointInPoints = {x: 0, y: 0};\n        this._displayedColor = cc.color(255, 255, 255, 255);\n        this._cachedParent = null;\n        this._cacheDirty = false;\n        this._currentRegion = new cc.Region();\n        this._oldRegion = new cc.Region();\n        this._regionFlag = 0;\n        this._canUseDirtyRegion = false;\n    };\n\n    cc.Node.CanvasRenderCmd.RegionStatus = {\n        NotDirty: 0,    //the region is not dirty\n        Dirty: 1,       //the region is dirty, because of color, opacity or context\n        DirtyDouble: 2  //the region is moved, the old and the new one need considered when rendering\n    };\n\n    var proto = cc.Node.CanvasRenderCmd.prototype = Object.create(cc.Node.RenderCmd.prototype);\n    proto.constructor = cc.Node.CanvasRenderCmd;\n    proto._rootCtor = cc.Node.CanvasRenderCmd;\n\n    proto._notifyRegionStatus = function (status) {\n        if (this._needDraw && this._regionFlag < status) {\n            this._regionFlag = status;\n        }\n    };\n\n    var localBB = new cc.Rect();\n    proto.getLocalBB = function () {\n        var node = this._node;\n        localBB.x = localBB.y = 0;\n        localBB.width = node._contentSize.width;\n        localBB.height = node._contentSize.height;\n        return localBB;\n    };\n\n    proto._updateCurrentRegions = function () {\n        var temp = this._currentRegion;\n        this._currentRegion = this._oldRegion;\n        this._oldRegion = temp;\n        //hittest will call the transform, and set region flag to DirtyDouble, and the changes need to be considered for rendering\n        if (cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble === this._regionFlag && (!this._currentRegion.isEmpty())) {\n            this._oldRegion.union(this._currentRegion);\n        }\n        this._currentRegion.updateRegion(this.getLocalBB(), this._worldTransform);\n    };\n\n    proto.setDirtyFlag = function (dirtyFlag, child) {\n        cc.Node.RenderCmd.prototype.setDirtyFlag.call(this, dirtyFlag, child);\n        this._setCacheDirty(child);                  //TODO it should remove from here.\n        if (this._cachedParent)\n            this._cachedParent.setDirtyFlag(dirtyFlag, true);\n    };\n\n    proto._setCacheDirty = function () {\n        if (this._cacheDirty === false) {\n            this._cacheDirty = true;\n            var cachedP = this._cachedParent;\n            cachedP && cachedP !== this && cachedP._setNodeDirtyForCache && cachedP._setNodeDirtyForCache();\n        }\n    };\n\n    proto._setCachedParent = function (cachedParent) {\n        if (this._cachedParent === cachedParent)\n            return;\n\n        this._cachedParent = cachedParent;\n        var children = this._node._children;\n        for (var i = 0, len = children.length; i < len; i++)\n            children[i]._renderCmd._setCachedParent(cachedParent);\n    };\n\n    proto.detachFromParent = function () {\n        this._cachedParent = null;\n        var selChildren = this._node._children, item;\n        for (var i = 0, len = selChildren.length; i < len; i++) {\n            item = selChildren[i];\n            if (item && item._renderCmd)\n                item._renderCmd.detachFromParent();\n        }\n    };\n\n    //util functions\n    cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc = function (blendFunc) {\n        if (!blendFunc)\n            return \"source-over\";\n        else {\n            if (( blendFunc.src === cc.SRC_ALPHA && blendFunc.dst === cc.ONE) || (blendFunc.src === cc.ONE && blendFunc.dst === cc.ONE))\n                return \"lighter\";\n            else if (blendFunc.src === cc.ZERO && blendFunc.dst === cc.SRC_ALPHA)\n                return \"destination-in\";\n            else if (blendFunc.src === cc.ZERO && blendFunc.dst === cc.ONE_MINUS_SRC_ALPHA)\n                return \"destination-out\";\n            else\n                return \"source-over\";\n        }\n    };\n})();\n"]}