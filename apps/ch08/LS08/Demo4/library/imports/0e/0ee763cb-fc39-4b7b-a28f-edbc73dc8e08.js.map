{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library/assets/frameworks/cocos2d-html5/external/gaf/Library/GAFLoader.js"],"names":["gaf","Loader","readHeaderBegin","stream","header","compression","Uint","versionMajor","Ubyte","versionMinor","fileLength","readHeaderEndV3","framesCount","Ushort","frameSize","Rect","pivot","Point","readHeaderEndV4","scaleCount","scaleValues","i","push","Float","csfCount","csfValues","LoadFile","filePath","onLoaded","oReq","XMLHttpRequest","open","self","responseType","onload","oEvent","gaf_data","DataReader","response","gafFile","LoadStream","send","COMPRESSION_NONE","COMPRESSION_ZIP","compressed","dataRaw","slice","tell","inflate","window","Zlib","Inflate","Uint8Array","decompressed","decompress","buffer","Error","tags","ReadTags"],"mappings":"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","file":"GAFLoader.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library","sourcesContent":["var gaf = gaf || {};\n\n//@Private class\ngaf.Loader = function(){\n\n    var readHeaderBegin = function(stream, header){\n        header.compression = stream.Uint();\n        header.versionMajor = stream.Ubyte();\n        header.versionMinor = stream.Ubyte();\n        header.fileLength = stream.Uint();\n    };\n\n    var readHeaderEndV3 = function(stream, header) {\n        header.framesCount = stream.Ushort();\n        header.frameSize = stream.Rect();\n        header.pivot = stream.Point();\n    };\n\n    var readHeaderEndV4 = function(stream, header){\n        var scaleCount = stream.Uint();\n        header.scaleValues = [];\n        for(var i = 0; i < scaleCount; ++i){\n            header.scaleValues.push(stream.Float());\n        }\n        var csfCount = stream.Uint();\n        header.csfValues = [];\n        for(var i = 0; i < csfCount; ++i){\n            header.csfValues.push(stream.Float());\n        }\n    };\n\n    this.LoadFile = function(filePath, onLoaded){\n        var oReq = new XMLHttpRequest();\n        oReq.open(\"GET\", filePath, true);\n        var self = this;\n        oReq.responseType = \"arraybuffer\";\n        oReq.onload = function(oEvent) {\n            var gaf_data = new gaf.DataReader(oReq.response);\n            var gafFile = self.LoadStream(gaf_data);\n            if(onLoaded)\n                onLoaded(gafFile);\n        };\n        oReq.send();\n    };\n\n    this.LoadStream = function(stream){\n        var header = {};\n        readHeaderBegin(stream, header);\n        if(header.compression == gaf.COMPRESSION_NONE) { // GAF\n        }\n        else if(header.compression == gaf.COMPRESSION_ZIP){ // GAC\n            var compressed = stream.dataRaw.slice(stream.tell());\n\n            var inflate = new window.Zlib.Inflate(new Uint8Array(compressed));\n            var decompressed = inflate.decompress();\n            stream = new gaf.DataReader(decompressed.buffer);\n        }\n        else{\n            throw new Error(\"GAF syntax error.\");\n        }\n\n        if(header.versionMajor < 4){\n            readHeaderEndV3(stream, header);\n        }\n        else{\n            readHeaderEndV4(stream, header);\n        }\n\n        var tags = gaf.ReadTags(stream);\n        return {\n            header: header,\n            tags: tags\n        };\n    };\n};\n"]}