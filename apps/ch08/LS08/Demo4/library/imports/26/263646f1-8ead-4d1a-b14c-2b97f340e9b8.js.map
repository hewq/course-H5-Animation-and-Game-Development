{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/base-classes/assets/frameworks/cocos2d-html5/extensions/ccui/base-classes/UIScale9SpriteCanvasRenderCmd.js"],"names":["ccui","Scale9Sprite","CanvasRenderCmd","renderable","cc","Node","call","_needDraw","_state","state","NORMAL","_originalTexture","_textureToRender","proto","prototype","Object","create","constructor","transform","parentCmd","recursive","originTransform","_node","_rebuildQuads","needDraw","loaded","_updateDisplayColor","parentColor","RenderCmd","setState","_setColorDirty","setDirtyFlag","_dirtyFlags","colorDirty","opacityDirty","rendering","ctx","scaleX","scaleY","node","locDisplayOpacity","_displayedOpacity","alpha","locTexture","_spriteFrame","_texture","GRAY","_generateGrayTexture","color","getDisplayedColor","r","g","b","_generateColorTexture","wrapper","_renderContext","context","getContext","setTransform","_worldTransform","setCompositeOperation","_getCompositeOperationByBlendFunc","_blendFunc","setGlobalAlpha","_quadsDirty","sx","sy","sw","sh","x","y","w","h","textureWidth","_pixelsWide","textureHeight","_pixelsHigh","image","_htmlElementObj","vertices","_vertices","uvs","_uvs","i","off","_renderingType","RenderingType","SLICED","c","drawImage","g_NumberOfDraws","quadCount","Math","floor","_vertCount","_pattern","setFillStyle","createPattern","fillRect"],"mappings":"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","file":"UIScale9SpriteCanvasRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/base-classes","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2016 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function() {\n    ccui.Scale9Sprite.CanvasRenderCmd = function (renderable) {\n        cc.Node.CanvasRenderCmd.call(this, renderable);\n        this._needDraw = true;\n\n        this._state = ccui.Scale9Sprite.state.NORMAL;\n        this._originalTexture = this._textureToRender = null;\n    };\n\n    var proto = ccui.Scale9Sprite.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n    proto.constructor = ccui.Scale9Sprite.CanvasRenderCmd;\n\n    proto.transform = function(parentCmd, recursive){\n        this.originTransform(parentCmd, recursive);\n        this._node._rebuildQuads();\n    };\n\n    proto.needDraw = function () {\n        return this._needDraw && this._node.loaded();\n    };\n\n    proto._updateDisplayColor = function(parentColor){\n        cc.Node.RenderCmd.prototype._updateDisplayColor.call(this, parentColor);\n        this._originalTexture = this._textureToRender = null;\n    };\n\n    proto.setState = function(state){\n        if(this._state === state) return;\n\n        this._state = state;\n        this._originalTexture = this._textureToRender = null;\n    };\n\n    proto._setColorDirty = function () {\n        this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty | cc.Node._dirtyFlags.opacityDirty);\n    };\n\n    proto.rendering = function (ctx, scaleX, scaleY) {\n        var node = this._node;\n        var locDisplayOpacity = this._displayedOpacity;\n        var alpha =  locDisplayOpacity/ 255;\n        var locTexture = null;\n        if (node._spriteFrame) locTexture = node._spriteFrame._texture;\n        if (!node.loaded() || locDisplayOpacity === 0)\n            return;\n        if (this._textureToRender === null || this._originalTexture !== locTexture) {\n            this._textureToRender = this._originalTexture = locTexture;\n            if (cc.Scale9Sprite.state.GRAY === this._state) {\n                this._textureToRender = this._textureToRender._generateGrayTexture();\n            }\n            var color = node.getDisplayedColor();\n            if (locTexture && (color.r !== 255 || color.g !==255 || color.b !== 255))\n                this._textureToRender = this._textureToRender._generateColorTexture(color.r,color.g,color.b);\n        }\n\n        var wrapper = ctx || cc._renderContext, context = wrapper.getContext();\n        wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n        wrapper.setCompositeOperation(cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(node._blendFunc));\n        wrapper.setGlobalAlpha(alpha);\n\n        if (this._textureToRender) {\n            if (node._quadsDirty) {\n                node._rebuildQuads();\n            }\n            var sx,sy,sw,sh;\n            var x, y, w,h;\n            var textureWidth = this._textureToRender._pixelsWide;\n            var textureHeight = this._textureToRender._pixelsHigh;\n            var image = this._textureToRender._htmlElementObj;\n            var vertices = node._vertices;\n            var uvs = node._uvs;\n            var i = 0, off = 0;\n\n            if (node._renderingType === cc.Scale9Sprite.RenderingType.SLICED) {\n                // Sliced use a special vertices layout 16 vertices for 9 quads\n                for (var r = 0; r < 3; ++r) {\n                    for (var c = 0; c < 3; ++c) {\n                        off = r*8 + c*2;\n                        x = vertices[off];\n                        y = vertices[off+1];\n                        w = vertices[off+10] - x;\n                        h = vertices[off+11] - y;\n                        y = - y - h;\n\n                        sx = uvs[off] * textureWidth;\n                        sy = uvs[off+11] * textureHeight;\n                        sw = (uvs[off+10] - uvs[off]) * textureWidth;\n                        sh = (uvs[off+1] - uvs[off+11]) * textureHeight;\n\n                        if (sw > 0 && sh > 0 && w > 0 && h > 0) {\n                            context.drawImage(image,\n                                              sx, sy, sw, sh,\n                                              x, y, w, h);\n                        }\n                    }\n                }\n                cc.g_NumberOfDraws += 9;\n            } else {\n                var quadCount = Math.floor(node._vertCount / 4);\n                for (i = 0, off = 0; i < quadCount; i++) {\n                    x = vertices[off];\n                    y = vertices[off+1];\n                    w = vertices[off+6] - x;\n                    h = vertices[off+7] - y;\n                    y = - y - h;\n\n                    sx = uvs[off] * textureWidth;\n                    sy = uvs[off+7] * textureHeight;\n                    sw = (uvs[off+6] - uvs[off]) * textureWidth;\n                    sh = (uvs[off+1] - uvs[off+7]) * textureHeight;\n\n\n                    if (this._textureToRender._pattern !== '') {\n                        wrapper.setFillStyle(context.createPattern(image, this._textureToRender._pattern));\n                        context.fillRect(x, y, w, h);\n                    } else {\n                        if (sw > 0 && sh > 0 && w > 0 && h > 0) {\n                            context.drawImage(image,\n                                              sx, sy, sw, sh,\n                                              x, y, w, h);\n                        }\n                    }\n                    off += 8;\n                }\n                cc.g_NumberOfDraws += quadCount;\n            }\n        }\n    };\n\n})();\n"]}