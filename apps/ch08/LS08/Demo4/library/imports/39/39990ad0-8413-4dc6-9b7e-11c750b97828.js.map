{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/timeline/assets/frameworks/cocos2d-html5/extensions/cocostudio/timeline/CCBoneNode.js"],"names":["ccs","BoneNode","Node","cc","SkinNode","BlendFunc","type","p","size","rect","debug","log","assert","extend","_customCommand","_blendFunc","_rackColor","_rackLength","_rackWidth","_childBones","_boneSkins","_rootSkeleton","_squareVertices","_squareColors","_noMVPVertices","ctor","length","prototype","call","x","y","color","WHITE","ALPHA_NON_PREMULTIPLIED","undefined","_updateVertices","visit","parent","_visit","_renderCmd","addSkin","skin","display","hideOthers","boneSkins","i","setVisible","addChild","push","getChildBones","getSkins","displaySkin","boneSkin","getName","getVisibleSkins","displayingSkins","isVisible","getRootSkeletonNode","getAllSubBones","allBones","boneStack","childBones","top","pop","topChildren","j","getAllSubSkins","allSkins","skins","child","localZOrder","tag","_addToChildrenListHelper","removeChild","cleanup","_children","indexOf","_removeFromChildrenListHelper","setBlendFunc","blendFunc","ob","src","dst","getBlendFunc","setDebugDrawLength","getDebugDrawLength","setDebugDrawWidth","width","getDebugDrawWidth","setDebugDrawEnabled","isDebugDraw","renderCmd","_debug","renderer","childrenOrderDirty","_visible","_subBonesDirty","_subBonesOrderDirty","isDebugDrawEnabled","setDebugDrawColor","getDebugDrawColor","getVisibleSkinsRect","minx","miny","maxx","maxy","first","displayRect","r","getBoundingBox","height","rectGetMinX","rectGetMinY","rectGetMaxX","rectGetMaxY","Math","min","max","setRect","boundingBox","rectApplyAffineTransform","getNodeToParentAffineTransform","batchBoneDrawToSkeleton","bone","setLocalZOrder","setName","name","rootSkeleton","oldName","oIter","_subBonesMap","nIter","setContentSize","contentSize","setAnchorPoint","anchorPoint","visible","_addToBoneList","_addToSkinList","_removeFromBoneList","_removeFromSkinList","SkeletonNode","subBones","subBone","arrayRemoveObject","_setRootSkeleton","skeletonNode","bonename","_visitSkins","cmd","parentCmd","getParentRenderCmd","_curLevel","children","_syncStatus","len","sortAllChildren","_localZOrder","_dirtyFlag","_sortArray","array","tmp","arrivalOrder","squareVertices","anchorPointInPoints","_anchorPointInPoints","updateDebugPoint","_createRenderCmd","_renderType","game","RENDER_TYPE_CANVAS","BoneNodeCanvasCmd","BoneNodeWebGLCmd","create","ccui","node","_rootCtor","_color","_drawNode","DrawNode","proto","Object","CanvasRenderCmd","constructor","points","clear","drawPoly","transform","recursive","_node","originTransform","WebGLRenderCmd"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;;AAEA;;;;;AAKAA,IAAIC,QAAJ,GAAgB,YAAY;;AAExB,QAAIC,OAAOC,GAAGD,IAAd;AACA,QAAIE,WAAWJ,IAAII,QAAnB;AACA,QAAIC,YAAYF,GAAGE,SAAnB;AACA,QAAIC,OAAO;AACPC,WAAGJ,GAAGI,CADC;AAEPC,cAAML,GAAGK,IAFF;AAGPC,cAAMN,GAAGM;AAHF,KAAX;AAKA,QAAIC,QAAQ;AACRC,aAAKR,GAAGQ,GADA;AAERC,gBAAQT,GAAGS;AAFH,KAAZ;;AAKA,QAAIX,WAAWC,KAAKW,MAAL,EAAY,2BAA2B;AAClDC,wBAAgB,IADkC;AAElDC,oBAAY,IAFsC;;AAIlDC,oBAAY,IAJsC;;AAMlDC,qBAAa,IANqC;AAOlDC,oBAAY,IAPsC;;AASlDC,qBAAa,IATqC;AAUlDC,oBAAY,IAVsC;AAWlDC,uBAAe,IAXmC;;AAalDC,yBAAiB,IAbiC;AAclDC,uBAAe,IAdmC;AAelDC,wBAAgB,IAfkC;;AAiBlDC,cAAM,cAAUC,MAAV,EAAkB;AACpBxB,iBAAKyB,SAAL,CAAeF,IAAf,CAAoBG,IAApB,CAAyB,IAAzB;AACA;AACA;AACA;AACA,gBAAI,KAAKN,eAAL,KAAyB,IAA7B,EACI,KAAKA,eAAL,GAAuB,CACnB,EAACO,GAAG,CAAJ,EAAOC,GAAG,CAAV,EADmB,EACL,EAACD,GAAG,CAAJ,EAAOC,GAAG,CAAV,EADK,EACS,EAACD,GAAG,CAAJ,EAAOC,GAAG,CAAV,EADT,EACuB,EAACD,GAAG,CAAJ,EAAOC,GAAG,CAAV,EADvB,CAAvB;;AAIJ,iBAAKd,UAAL,GAAkBb,GAAG4B,KAAH,CAASC,KAA3B;AACA,iBAAKjB,UAAL,GAAkBV,UAAU4B,uBAA5B;;AAEA,iBAAKd,WAAL,GAAmB,EAAnB;AACA,iBAAKC,UAAL,GAAkB,EAAlB;;AAEA,iBAAKH,WAAL,GAAmBS,WAAWQ,SAAX,GAAuB,EAAvB,GAA4BR,MAA/C;AACA,iBAAKR,UAAL,GAAkB,EAAlB;AACA,iBAAKiB,eAAL;AACA;AACH,SArCiD;;AAuClDC,eAAO,eAAUC,MAAV,EAAkB;AACrB,iBAAKC,MAAL,IAAe,KAAKA,MAAL,CAAYD,UAAUA,OAAOE,UAA7B,CAAf;AACH,SAzCiD;;AA2ClDC,iBAAS,iBAAUC,IAAV,EAAgBC,OAAhB,EAAyBC,UAAzB,CAAmC,SAAnC,EAA8C;AACnD;AACA;AACA,gBAAIC,YAAY,KAAKxB,UAArB;AACAV,kBAAME,MAAN,CAAa6B,QAAQ,IAArB,EAA2B,0BAA3B;AACA,gBAAIE,UAAJ,EAAgB;AACZ,qBAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAID,UAAUlB,MAA9B,EAAsCmB,GAAtC,EAA2C;AACvCD,8BAAUC,CAAV,EAAaC,UAAb,CAAwB,KAAxB;AACH;AACJ;AACD5C,iBAAKyB,SAAL,CAAeoB,QAAf,CAAwBnB,IAAxB,CAA6B,IAA7B,EAAmCa,IAAnC;AACA,iBAAKrB,UAAL,CAAgB4B,IAAhB,CAAqBP,IAArB;AACAA,iBAAKK,UAAL,CAAgBJ,OAAhB;AACH,SAxDiD;;AA0DlDO,uBAAe,yBAAY;AACvB,mBAAO,KAAK9B,WAAZ;AACH,SA5DiD;;AA8DlD+B,kBAAU,oBAAY;AAClB,mBAAO,KAAK9B,UAAZ;AACH,SAhEiD;;AAkElD+B,qBAAa,qBAAUV,IAAV,EAAgBE,UAAhB,EAA4B;AACrC,gBAAIC,YAAY,KAAKxB,UAArB;AACA,gBAAIgC,QAAJ,EAAcP,CAAd;AACA,gBAAI,OAAOJ,IAAP,KAAgB,QAApB,EAA8B;AAC1B,qBAAKI,IAAI,CAAT,EAAYA,IAAID,UAAUlB,MAA1B,EAAkCmB,GAAlC,EAAuC;AACnCO,+BAAWR,UAAUC,CAAV,CAAX;AACA,wBAAIJ,QAAQW,SAASC,OAAT,EAAZ,EAAgC;AAC5BD,iCAASN,UAAT,CAAoB,IAApB;AACH,qBAFD,MAEO,IAAIH,UAAJ,EAAgB;AACnBS,iCAASN,UAAT,CAAoB,KAApB;AACH;AACJ;AACJ,aATD,MASO;AACH,qBAAKD,IAAI,CAAT,EAAYA,IAAID,UAAUlB,MAA1B,EAAkCmB,GAAlC,EAAuC;AACnCO,+BAAWR,UAAUC,CAAV,CAAX;AACA,wBAAIO,YAAYX,IAAhB,EAAsB;AAClBW,iCAASN,UAAT,CAAoB,IAApB;AACH,qBAFD,MAEO,IAAIH,UAAJ,EAAgB;AACnBS,iCAASN,UAAT,CAAoB,KAApB;AACH;AACJ;AACJ;AACJ,SAxFiD;;AA0FlDQ,yBAAiB,2BAAY;AACzB,gBAAIC,kBAAkB,EAAtB;AACA,gBAAIX,YAAY,KAAKxB,UAArB;AACA,iBAAK,IAAIgC,QAAJ,EAAcP,IAAI,CAAvB,EAA0BA,IAAID,UAAUlB,MAAxC,EAAgDmB,GAAhD,EAAqD;AACjDO,2BAAWR,UAAUC,CAAV,CAAX;AACA,oBAAIO,SAASI,SAAT,EAAJ,EAA0B;AACtBD,oCAAgBP,IAAhB,CAAqBI,QAArB;AACH;AACJ;AACD,mBAAOG,eAAP;AACH,SApGiD;;AAsGlDE,6BAAqB,+BAAY;AAC7B,mBAAO,KAAKpC,aAAZ;AACH,SAxGiD;;AA0GlDqC,wBAAgB,0BAAY;AACxB,gBAAIC,WAAW,EAAf;AACA,gBAAIC,YAAY,EAAhB,CAFwB,CAEJ;AACpB,gBAAIC,aAAa,KAAK1C,WAAtB;AACA,iBAAK,IAAI0B,IAAI,CAAb,EAAgBA,IAAIgB,WAAWnC,MAA/B,EAAuCmB,GAAvC,EAA4C;AACxCe,0BAAUZ,IAAV,CAAea,WAAWhB,CAAX,CAAf;AACH;;AAED,mBAAOe,UAAUlC,MAAV,GAAmB,CAA1B,EAA6B;AACzB,oBAAIoC,MAAMF,UAAUG,GAAV,EAAV;AACAJ,yBAASX,IAAT,CAAcc,GAAd;AACA,oBAAIE,cAAcF,IAAIb,aAAJ,EAAlB;AACA,qBAAK,IAAIgB,IAAI,CAAb,EAAgBA,IAAID,WAApB,EAAiCC,GAAjC,EAAsC;AAClCL,8BAAUZ,IAAV,CAAegB,YAAYC,CAAZ,CAAf;AACH;AACJ;AACD,mBAAON,QAAP;AACH,SA3HiD;;AA6HlDO,wBAAgB,0BAAY;AACxB,gBAAIP,WAAW,KAAKD,cAAL,EAAf;AACA,gBAAIS,WAAW,EAAf;AACA,iBAAK,IAAItB,IAAI,CAAb,EAAgBA,IAAIc,SAASjC,MAA7B,EAAqCmB,GAArC,EAA0C;AACtC,oBAAIuB,QAAQT,SAASd,CAAT,EAAYK,QAAZ,EAAZ;AACA,qBAAK,IAAIe,IAAI,CAAb,EAAgBA,IAAIG,MAAM1C,MAA1B,EAAkCuC,GAAlC,EAAuC;AACnCE,6BAASnB,IAAT,CAAcoB,MAAMvB,CAAN,CAAd;AACH;AACJ;AACD,mBAAOsB,QAAP;AACH,SAvIiD;;AAyIlDpB,kBAAU,kBAAUsB,KAAV,EAAiBC,WAAjB,EAA8BC,GAA9B,EAAmC;AACzC;AACA;AACArE,iBAAKyB,SAAL,CAAeoB,QAAf,CAAwBnB,IAAxB,CAA6B,IAA7B,EAAmCyC,KAAnC,EAA0CC,WAA1C,EAAuDC,GAAvD;AACA,iBAAKC,wBAAL,CAA8BH,KAA9B;AACH,SA9IiD;;AAgJlDI,qBAAa,qBAAUJ,KAAV,EAAiBK,OAAjB,EAA0B;AACnC,gBAAI,KAAKC,SAAL,CAAeC,OAAf,CAAuBP,KAAvB,MAAkC,CAAC,CAAvC,EAA0C;AACtCnE,qBAAKyB,SAAL,CAAe8C,WAAf,CAA2B7C,IAA3B,CAAgC,IAAhC,EAAsCyC,KAAtC,EAA6CK,OAA7C;AACA,qBAAKG,6BAAL,CAAmCR,KAAnC;AACH;AACJ,SArJiD;;AAuJlDS,sBAAc,sBAAUC,SAAV,EAAqB;AAC/B,gBAAIC,KAAK,KAAKjE,UAAd;AACA,gBAAIgE,aAAaC,GAAGC,GAAH,KAAWF,UAAUE,GAAlC,IAAyCD,GAAGE,GAAH,KAAWH,UAAUG,GAAlE,EAAuE;AACnE,qBAAKnE,UAAL,GAAkBgE,SAAlB;AACA,oBAAInC,YAAY,KAAKxB,UAArB;AACA,qBAAK,IAAIgC,QAAJ,EAAcP,IAAI,CAAvB,EAA0BA,IAAID,UAAUlB,MAAxC,EAAgDmB,GAAhD,EAAqD;AACjDO,+BAAWR,UAAUC,CAAV,CAAX;AACAO,6BAAS0B,YAAT,CAAsBC,SAAtB;AACH;AACJ;AACJ,SAjKiD;;AAmKlDI,sBAAc,wBAAY;AACtB,mBAAO,KAAKpE,UAAZ;AACH,SArKiD;;AAuKlDqE,4BAAoB,4BAAU1D,MAAV,EAAkB;AAClC,iBAAKT,WAAL,GAAmBS,MAAnB;AACA,iBAAKS,eAAL;AACH,SA1KiD;;AA4KlDkD,4BAAoB,8BAAY;AAC5B,mBAAO,KAAKpE,WAAZ;AACH,SA9KiD;;AAgLlDqE,2BAAmB,2BAAUC,KAAV,EAAiB;AAChC,iBAAKrE,UAAL,GAAkBqE,KAAlB;AACA,iBAAKpD,eAAL;AACH,SAnLiD;;AAqLlDqD,2BAAmB,6BAAY;AAC3B,mBAAO,KAAKtE,UAAZ;AACH,SAvLiD;;AAyLlDuE,6BAAqB,6BAAUC,WAAV,EAAuB;AACxC,gBAAIC,YAAY,KAAKpD,UAArB;AACA,gBAAIoD,UAAUC,MAAV,KAAqBF,WAAzB,EACI;;AAEJC,sBAAUC,MAAV,GAAmBF,WAAnB;AACAvF,eAAG0F,QAAH,CAAYC,kBAAZ,GAAiC,IAAjC;;AAEA,gBAAI,KAAKC,QAAL,IAAiB,QAAQ,KAAK1E,aAAlC,EAAiD;AAC7C,qBAAKA,aAAL,CAAmB2E,cAAnB,GAAoC,IAApC;AACA,qBAAK3E,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACH;AACJ,SArMiD;;AAuMlDC,4BAAoB,8BAAY;AAC5B,mBAAO,KAAK3D,UAAL,CAAgBqD,MAAvB;AACH,SAzMiD;;AA2MlDO,2BAAmB,2BAAUpE,KAAV,EAAiB;AAChC,iBAAKf,UAAL,GAAkBe,KAAlB;AACH,SA7MiD;;AA+MlDqE,2BAAmB,6BAAY;AAC3B,mBAAO,KAAKpF,UAAZ;AACH,SAjNiD;;AAmNlDqF,6BAAqB,+BAAY;AAC7B,gBAAIC,IAAJ;AAAA,gBAAUC,IAAV;AAAA,gBAAgBC,IAAhB;AAAA,gBAAsBC,OAAO,CAA7B;AACAH,mBAAOC,OAAOC,OAAOC,IAArB;AACA,gBAAIC,QAAQ,IAAZ;;AAEA,gBAAIC,cAAcrG,KAAKG,IAAL,CAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAlB;AACA,gBAAI,KAAK8B,UAAL,CAAgBqD,MAAhB,IAA0B,KAAKvE,aAAL,IAAsB,IAAhD,IAAwD,KAAKA,aAAL,CAAmBkB,UAAnB,CAA8BqD,MAA1F,EAAkG;AAC9FY,uBAAO,KAAKtF,UAAZ;AACAuF,uBAAO,KAAKxF,WAAZ;AACAyF,wBAAQ,KAAR;AACH;;AAED,gBAAI9D,YAAY,KAAKxB,UAArB;AACA,iBAAK,IAAIqB,IAAJ,EAAUI,IAAI,CAAnB,EAAsBA,IAAID,UAAUlB,MAApC,EAA4CmB,GAA5C,EAAiD;AAC7CJ,uBAAOG,UAAUC,CAAV,CAAP;AACA,oBAAI+D,IAAInE,KAAKoE,cAAL,EAAR;AACA,oBAAI,CAACpE,KAAKe,SAAL,EAAD,IAAsBoD,EAAE/E,CAAF,KAAQ,CAAR,IAAa+E,EAAE9E,CAAF,KAAQ,CAArB,IAA0B8E,EAAErB,KAAF,KAAY,CAAtC,IAA2CqB,EAAEE,MAAF,KAAa,CAAlF,EACI;;AAEJ,oBAAIJ,KAAJ,EAAW;AACPJ,2BAAOnG,GAAG4G,WAAH,CAAeH,CAAf,CAAP;AACAL,2BAAOpG,GAAG6G,WAAH,CAAeJ,CAAf,CAAP;AACAJ,2BAAOrG,GAAG8G,WAAH,CAAeL,CAAf,CAAP;AACAH,2BAAOtG,GAAG+G,WAAH,CAAeN,CAAf,CAAP;;AAEAF,4BAAQ,KAAR;AACH,iBAPD,MAOO;AACHJ,2BAAOa,KAAKC,GAAL,CAASjH,GAAG4G,WAAH,CAAeH,CAAf,CAAT,EAA4BN,IAA5B,CAAP;AACAC,2BAAOY,KAAKC,GAAL,CAASjH,GAAG6G,WAAH,CAAeJ,CAAf,CAAT,EAA4BL,IAA5B,CAAP;AACAC,2BAAOW,KAAKE,GAAL,CAASlH,GAAG8G,WAAH,CAAeL,CAAf,CAAT,EAA4BJ,IAA5B,CAAP;AACAC,2BAAOU,KAAKE,GAAL,CAASlH,GAAG+G,WAAH,CAAeN,CAAf,CAAT,EAA4BH,IAA5B,CAAP;AACH;AACDE,4BAAYW,OAAZ,CAAoBhB,IAApB,EAA0BC,IAA1B,EAAgCC,OAAOF,IAAvC,EAA6CG,OAAOF,IAApD;AACH;AACD,mBAAOI,WAAP;AACH,SAtPiD;;AAwPlDE,wBAAgB,0BAAY;AACxB,gBAAIU,cAAc,KAAKlB,mBAAL,EAAlB;AACA,mBAAOlG,GAAGqH,wBAAH,CAA4BD,WAA5B,EAAyC,KAAKE,8BAAL,EAAzC,CAAP;AACH,SA3PiD;;AA6PlDC,iCAAyB,iCAAUC,IAAV,EAAgB,CACxC,CA9PiD;;AAgQlDC,wBAAgB,wBAAUtD,WAAV,EAAuB;AACnCpE,iBAAKyB,SAAL,CAAeiG,cAAf,CAA8BhG,IAA9B,CAAmC,IAAnC,EAAyC0C,WAAzC;AACA,gBAAI,KAAKjD,aAAL,IAAsB,IAA1B,EACI,KAAKA,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACP,SApQiD;;AAsQlD4B,iBAAS,iBAAUC,IAAV,EAAgB;AACrB,gBAAIC,eAAe,KAAK1G,aAAxB;AACA,gBAAI2G,UAAU,KAAK3E,OAAL,EAAd;AACAnD,iBAAKyB,SAAL,CAAekG,OAAf,CAAuBjG,IAAvB,CAA4B,IAA5B,EAAkCkG,IAAlC;AACA,gBAAIC,gBAAgB,IAApB,EAA0B;AACtB,oBAAIE,QAAQF,aAAaG,YAAb,CAA0BF,OAA1B,CAAZ;AACA,oBAAIG,QAAQJ,aAAaG,YAAb,CAA0BJ,IAA1B,CAAZ;AACA,oBAAIG,SAAS,CAACE,KAAd,EAAqB;AACjB,2BAAOJ,aAAaG,YAAb,CAA0BD,KAA1B,CAAP;AACAF,iCAAaG,YAAb,CAA0BJ,IAA1B,IAAkCG,KAAlC;AACH;AACJ;AACJ,SAlRiD;;AAoRlDG,wBAAgB,wBAAUC,WAAV,EAAuB;AACnCnI,iBAAKyB,SAAL,CAAeyG,cAAf,CAA8BxG,IAA9B,CAAmC,IAAnC,EAAyCyG,WAAzC;AACA,iBAAKlG,eAAL;AACH,SAvRiD;;AAyRlDmG,wBAAgB,wBAAUC,WAAV,EAAuB;AACnCrI,iBAAKyB,SAAL,CAAe2G,cAAf,CAA8B1G,IAA9B,CAAmC,IAAnC,EAAyC2G,WAAzC;AACA,iBAAKpG,eAAL;AACH,SA5RiD;;AA8RlDW,oBAAY,oBAAU0F,OAAV,EAAmB;AAC3B,gBAAI,KAAKzC,QAAL,IAAiByC,OAArB,EACI;AACJtI,iBAAKyB,SAAL,CAAemB,UAAf,CAA0BlB,IAA1B,CAA+B,IAA/B,EAAqC4G,OAArC;AACA,gBAAI,KAAKnH,aAAL,IAAsB,IAA1B,EAAgC;AAC5B,qBAAKA,aAAL,CAAmB2E,cAAnB,GAAoC,IAApC;AACA,qBAAK3E,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACH;AACJ,SAtSiD;;AAwSlDzB,kCAA0B,kCAAUH,KAAV,EAAiB;AACvC,gBAAIA,iBAAiBpE,QAArB,EAA+B;AAC3B,qBAAKwI,cAAL,CAAoBpE,KAApB;AACH,aAFD,MAEO;AACH;AACA,qBAAKqE,cAAL,CAAoBrE,KAApB;AACA;AACH;AACJ,SAhTiD;;AAkTlDQ,uCAA+B,uCAAUR,KAAV,EAAiB;AAC5C,gBAAIA,iBAAiBpE,QAArB,EAA+B;AAC3B,qBAAK0I,mBAAL,CAAyBtE,KAAzB;AACH,aAFD,MAEO;AACH,oBAAIA,iBAAiBjE,QAArB,EACI,KAAKwI,mBAAL,CAAyBnG,IAAzB;AACP;AACJ,SAzTiD;;AA2TlDkG,6BAAqB,6BAAUhB,IAAV,EAAgB;AACjC,gBACI,KAAKtG,aAAL,IAAsB,IAAtB,IACAsG,gBAAgB3H,IAAI6I,YADpB,IAEAlB,KAAKtG,aAAL,KAAuB,KAAKA,aAHhC,EAIE;AACEsG,qBAAKtG,aAAL,GAAqB,IAArB;AACA,oBAAIyH,WAAWnB,KAAKjE,cAAL,EAAf;AACAoF,yBAAS9F,IAAT,CAAc2E,IAAd;AACA,qBAAK,IAAIoB,OAAJ,EAAalG,IAAI,CAAtB,EAAyBA,IAAIiG,SAASpH,MAAtC,EAA8CmB,GAA9C,EAAmD;AAC/CkG,8BAAUD,SAASjG,CAAT,CAAV;AACAkG,4BAAQ1H,aAAR,GAAwB,IAAxB;AACA,2BAAO,KAAKA,aAAL,CAAmB6G,YAAnB,CAAgCa,QAAQ1F,OAAR,EAAhC,CAAP;AACA,yBAAKhC,aAAL,CAAmB2E,cAAnB,GAAoC,IAApC;AACA,yBAAK3E,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACH;AACJ,aAfD,MAeO;AACH,qBAAK5E,aAAL,CAAmB2E,cAAnB,GAAoC,IAApC;AACA,qBAAK3E,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACH;AACD9F,eAAG6I,iBAAH,CAAqB,KAAK7H,WAA1B,EAAuCwG,IAAvC;AACH,SAhViD;;AAkVlDsB,0BAAkB,0BAAUlB,YAAV,EAAwB;AACtC,iBAAK1G,aAAL,GAAqB0G,YAArB;AACA,gBAAIe,WAAW,KAAKpF,cAAL,EAAf;AACA,iBAAK,IAAIb,IAAI,CAAb,EAAgBA,IAAIiG,SAASpH,MAA7B,EAAqCmB,GAArC,EAA0C;AACtC,qBAAK4F,cAAL,CAAoBK,SAASjG,CAAT,CAApB;AACH;AACJ,SAxViD;;AA0VlD4F,wBAAgB,wBAAUd,IAAV,EAAgB;AAC5B,gBAAI,KAAKxG,WAAL,CAAiByD,OAAjB,CAAyB+C,IAAzB,MAAmC,CAAC,CAAxC,EACI,KAAKxG,WAAL,CAAiB6B,IAAjB,CAAsB2E,IAAtB;AACJ,gBAAI,KAAKtG,aAAL,IAAsB,IAA1B,EAAgC;AAC5B,oBAAI6H,eAAevB,IAAnB;AACA,oBAAI,EAAEuB,wBAAwB9I,QAA1B,KAAuC,CAACuH,KAAKtG,aAAjD,EAAgE;AAAC;AAC7D,wBAAIyH,WAAWnB,KAAKjE,cAAL,EAAf;AACAoF,6BAAS9F,IAAT,CAAc2E,IAAd;AACA,yBAAK,IAAIoB,OAAJ,EAAalG,IAAI,CAAtB,EAAyBA,IAAIiG,SAASpH,MAAtC,EAA8CmB,GAA9C,EAAmD;AAC/CkG,kCAAUD,SAASjG,CAAT,CAAV;AACAkG,gCAAQE,gBAAR,CAAyB,KAAK5H,aAA9B;AACA,4BAAI8H,WAAWJ,QAAQ1F,OAAR,EAAf;AACA,4BAAI,CAAC,KAAKhC,aAAL,CAAmB6G,YAAnB,CAAgCiB,QAAhC,CAAL,EAAgD;AAC5C,iCAAK9H,aAAL,CAAmB6G,YAAnB,CAAgCa,QAAQ1F,OAAR,EAAhC,IAAqD0F,OAArD;AACA,iCAAK1H,aAAL,CAAmB2E,cAAnB,GAAoC,IAApC;AACA,iCAAK3E,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACH,yBAJD,MAIO;AACH9F,+BAAGQ,GAAH,CAAO,4CAAP,EAAqDwI,QAArD,EAA+D,KAAK9H,aAAL,CAAmBgC,OAAnB,EAA/D;AACA,iCAAKhC,aAAL,CAAmB2E,cAAnB,GAAoC,IAApC;AACA,iCAAK3E,aAAL,CAAmB4E,mBAAnB,GAAyC,IAAzC;AACH;AACJ;AACJ;AACJ;AACJ,SAlXiD;;AAoXlDmD,qBAAa,uBAAY;AACrB,gBAAIC,MAAM,KAAK9G,UAAf;AACA;AACA,gBAAI,CAAC,KAAKwD,QAAV,EACI;;AAEJ,gBAAIuD,YAAYD,IAAIE,kBAAJ,EAAhB;AACA,gBAAID,SAAJ,EACID,IAAIG,SAAJ,GAAgBF,UAAUE,SAAV,GAAsB,CAAtC;;AAEJ;AACA,gBAAI3G,CAAJ;AAAA,gBAAO4G,WAAW,KAAKrI,UAAvB;AAAA,gBAAmCiD,KAAnC;AACA;AACAgF,gBAAIK,WAAJ,CAAgBJ,SAAhB;AACA,gBAAIK,MAAMF,SAAS/H,MAAnB;AACA,gBAAIiI,MAAM,CAAV,EAAa;AACT,qBAAKC,eAAL;AACA;AACA,qBAAK/G,IAAI,CAAT,EAAYA,IAAI8G,GAAhB,EAAqB9G,GAArB,EAA0B;AACtBwB,4BAAQoF,SAAS5G,CAAT,CAAR;AACA,wBAAIwB,MAAMwF,YAAN,GAAqB,CAAzB,EACIxF,MAAMjC,KAAN,CAAY,IAAZ,EADJ,KAGI;AACP;AACD,uBAAOS,IAAI8G,GAAX,EAAgB9G,GAAhB;AACI4G,6BAAS5G,CAAT,EAAYT,KAAZ,CAAkB,IAAlB;AADJ;AAEH;AACDiH,gBAAIS,UAAJ,GAAiB,CAAjB;AACH,SAjZiD;;AAmZlDpB,wBAAgB,wBAAUjG,IAAV,EAAgB;AAC5B,iBAAKrB,UAAL,CAAgB4B,IAAhB,CAAqBP,IAArB;AACA,gBAAIA,KAAK0C,YAAT,EAAuB;AACnB,oBAAIJ,YAAYtC,KAAK0C,YAAL,EAAhB;AACA,oBAAI,KAAKpE,UAAL,CAAgBkE,GAAhB,KAAwBF,UAAUE,GAAlC,IAAyC,KAAKlE,UAAL,CAAgBmE,GAAhB,KAAwBH,UAAUG,GAA/E,EACIzC,KAAKqC,YAAL,CAAkB,KAAK/D,UAAvB;AACP;AACJ,SA1ZiD;;AA4ZlD6H,6BAAqB,6BAAUnG,IAAV,EAAgB;AACjCtC,eAAG6I,iBAAH,CAAqB,KAAK5H,UAA1B,EAAsCqB,IAAtC;AACH,SA9ZiD;;AAgalDmH,yBAAiB,2BAAY;AACzB,iBAAKG,UAAL,CAAgB,KAAK5I,WAArB;AACA,iBAAK4I,UAAL,CAAgB,KAAK3I,UAArB;AACAlB,iBAAKyB,SAAL,CAAeiI,eAAf,CAA+BhI,IAA/B,CAAoC,IAApC;AACH,SApaiD;;AAsalDmI,oBAAY,oBAAUC,KAAV,EAAiB;AACzB,gBAAI,CAACA,KAAL,EACI;AACJ,gBAAIL,MAAMK,MAAMtI,MAAhB;AAAA,gBAAwBmB,CAAxB;AAAA,gBAA2BoB,CAA3B;AAAA,gBAA8BgG,GAA9B;AACA,iBAAKpH,IAAI,CAAT,EAAYA,IAAI8G,GAAhB,EAAqB9G,GAArB,EAA0B;AACtBoH,sBAAMD,MAAMnH,CAAN,CAAN;AACAoB,oBAAIpB,IAAI,CAAR;AACA,uBAAOoB,KAAK,CAAZ,EAAe;AACX,wBAAIgG,IAAIJ,YAAJ,GAAmBG,MAAM/F,CAAN,EAAS4F,YAAhC,EAA8C;AAC1CG,8BAAM/F,IAAI,CAAV,IAAe+F,MAAM/F,CAAN,CAAf;AACH,qBAFD,MAEO,IAAIgG,IAAIJ,YAAJ,KAAqBG,MAAM/F,CAAN,EAAS4F,YAA9B,IAA8CI,IAAIC,YAAJ,GAAmBF,MAAM/F,CAAN,EAASiG,YAA9E,EAA4F;AAC/FF,8BAAM/F,IAAI,CAAV,IAAe+F,MAAM/F,CAAN,CAAf;AACH,qBAFM,MAEA;AACH;AACH;AACDA;AACH;AACD+F,sBAAM/F,IAAI,CAAV,IAAegG,GAAf;AACH;AACJ,SAzbiD;;AA2blD9H,yBAAiB,2BAAY;AACzB,gBAAIgI,iBAAiB,KAAK7I,eAA1B;AAAA,gBACI8I,sBAAsB,KAAK7H,UAAL,CAAgB8H,oBAD1C;AAEA,gBAAI,KAAKpJ,WAAL,IAAoBkJ,eAAe,CAAf,EAAkBtI,CAAlB,GAAsBuI,oBAAoBvI,CAA9D,IACAsI,eAAe,CAAf,EAAkBrI,CAAlB,IAAuB,KAAKZ,UAAL,GAAkB,CAAlB,GAAsBkJ,oBAAoBtI,CADrE,EACwE;;AAEpEqI,+BAAe,CAAf,EAAkBtI,CAAlB,GAAsBsI,eAAe,CAAf,EAAkBrI,CAAlB,GAAsBqI,eAAe,CAAf,EAAkBrI,CAAlB,GAAsB,CAAlE;AACAqI,+BAAe,CAAf,EAAkBtI,CAAlB,GAAsBsI,eAAe,CAAf,EAAkBtI,CAAlB,GAAsB,KAAKZ,WAAL,GAAmB,EAA/D;AACAkJ,+BAAe,CAAf,EAAkBrI,CAAlB,GAAsB,KAAKZ,UAAL,GAAkB,EAAxC;AACAiJ,+BAAe,CAAf,EAAkBrI,CAAlB,GAAsB,CAACqI,eAAe,CAAf,EAAkBrI,CAAzC;AACAqI,+BAAe,CAAf,EAAkBtI,CAAlB,GAAsB,KAAKZ,WAA3B;;AAEA,qBAAK,IAAI4B,IAAI,CAAb,EAAgBA,IAAIsH,eAAezI,MAAnC,EAA2CmB,GAA3C,EAAgD;AAC5CsH,mCAAetH,CAAf,EAAkBhB,CAAlB,IAAuBuI,oBAAoBvI,CAA3C;AACAsI,mCAAetH,CAAf,EAAkBf,CAAlB,IAAuBsI,oBAAoBtI,CAA3C;AACH;;AAED,qBAAKS,UAAL,CAAgB+H,gBAAhB,CAAiCH,cAAjC;AACH;AACJ,SA9ciD;;AAgdlDI,0BAAkB,4BAAY;AAC1B,gBAAIpK,GAAGqK,WAAH,KAAmBrK,GAAGsK,IAAH,CAAQC,kBAA/B,EACI,OAAO,IAAIC,iBAAJ,CAAsB,IAAtB,CAAP,CADJ,KAGI,OAAO,IAAIC,gBAAJ,CAAqB,IAArB,CAAP;AACP;AArdiD,KAAvC,CAAf;;AAwdA3K,aAAS4K,MAAT,GAAkB,UAAUnJ,MAAV,EAAkBK,KAAlB,EAAyB;AACvC;AACA;AACA;AACA,eAAO,IAAI+I,KAAK7K,QAAT,CAAkByB,MAAlB,EAA0BK,KAA1B,CAAP;AACH,KALD;;AAOA,QAAI4I,oBAAqB,YAAY;;AAEjC,YAAIA,oBAAoB,SAApBA,iBAAoB,CAAUI,IAAV,EAAgB;AACpC,iBAAKC,SAAL,CAAeD,IAAf;AACA,iBAAKnF,MAAL,GAAc,KAAd;AACA,iBAAKqF,MAAL,GAAc9K,GAAG4B,KAAH,CAASC,KAAvB;AACA,iBAAKkJ,SAAL,GAAiB,IAAI/K,GAAGgL,QAAP,EAAjB;AACH,SALD;;AAOA,YAAIC,QAAQT,kBAAkBhJ,SAAlB,GAA8B0J,OAAOR,MAAP,CAAc3K,KAAKoL,eAAL,CAAqB3J,SAAnC,CAA1C;AACAyJ,cAAMG,WAAN,GAAoBZ,iBAApB;;AAEAS,cAAMd,gBAAN,GAAyB,UAAUkB,MAAV,EAAkB;AACvC,iBAAKN,SAAL,CAAeO,KAAf;AACA,iBAAKP,SAAL,CAAeQ,QAAf,CAAwBF,MAAxB,EAAgC,KAAKP,MAArC,EAA6C,CAA7C,EAAgD,KAAKA,MAArD;AACH,SAHD;;AAKAG,cAAMO,SAAN,GAAkB,UAAUrC,SAAV,EAAqBsC,SAArB,EAAgC;AAC9C,gBAAI7D,eAAe,KAAK8D,KAAL,CAAWxK,aAA9B;AACA,iBAAKyK,eAAL,CAAqBxC,SAArB,EAAgCsC,SAAhC;AACA,gBAAI7D,gBAAgBA,aAAaxF,UAAb,CAAwBqD,MAA5C,EAAoD;AAChD,qBAAKsF,SAAL,CAAe3I,UAAf,CAA0BoJ,SAA1B,CAAoC,IAApC;AACH;AACJ,SAND;;AAQA,eAAOhB,iBAAP;AAEH,KA3BuB,EAAxB;;AA6BA,QAAIC,mBAAoB,YAAY;;AAEhC,YAAIA,mBAAmB,SAAnBA,gBAAmB,CAAUG,IAAV,EAAgB;AACnC,iBAAKC,SAAL,CAAeD,IAAf;AACA,iBAAKnF,MAAL,GAAc,KAAd;AACA,iBAAKqF,MAAL,GAAc9K,GAAG4B,KAAH,CAASC,KAAvB;AACA,iBAAKkJ,SAAL,GAAiB,IAAI/K,GAAGgL,QAAP,EAAjB;AACH,SALD;;AAOA,YAAIC,QAAQR,iBAAiBjJ,SAAjB,GAA6B0J,OAAOR,MAAP,CAAc3K,KAAK6L,cAAL,CAAoBpK,SAAlC,CAAzC;AACAyJ,cAAMG,WAAN,GAAoBX,gBAApB;;AAEAQ,cAAMd,gBAAN,GAAyB,UAAUkB,MAAV,EAAkB;AACvC,iBAAKN,SAAL,CAAeO,KAAf;AACA,iBAAKP,SAAL,CAAeQ,QAAf,CAAwBF,MAAxB,EAAgC,KAAKP,MAArC,EAA6C,CAA7C,EAAgD,KAAKA,MAArD;AACH,SAHD;;AAKAG,cAAMO,SAAN,GAAkB,UAAUrC,SAAV,EAAqBsC,SAArB,EAAgC;AAC9C,gBAAI7D,eAAe,KAAK8D,KAAL,CAAWxK,aAA9B;AACA,iBAAKyK,eAAL,CAAqBxC,SAArB,EAAgCsC,SAAhC;AACA,gBAAI7D,gBAAgBA,aAAaxF,UAAb,CAAwBqD,MAA5C,EAAoD;AAChD,qBAAKsF,SAAL,CAAe3I,UAAf,CAA0BoJ,SAA1B,CAAoC,IAApC;AACH;AACJ,SAND;;AAQA,eAAOf,gBAAP;AAEH,KA3BsB,EAAvB;;AA6BA,WAAO3K,QAAP;AAEH,CA1iBc,EAAf","file":"CCBoneNode.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/timeline","sourcesContent":["/****************************************************************************\n Copyright (c) 2015-2016 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n//9980397\n\n/**\n * BoneNode\n * base class\n * @class\n */\nccs.BoneNode = (function () {\n\n    var Node = cc.Node;\n    var SkinNode = ccs.SkinNode;\n    var BlendFunc = cc.BlendFunc;\n    var type = {\n        p: cc.p,\n        size: cc.size,\n        rect: cc.rect\n    };\n    var debug = {\n        log: cc.log,\n        assert: cc.assert\n    };\n\n    var BoneNode = Node.extend(/** @lends ccs.BoneNode# */{\n        _customCommand: null,\n        _blendFunc: null,\n\n        _rackColor: null,\n\n        _rackLength: null,\n        _rackWidth: null,\n\n        _childBones: null,\n        _boneSkins: null,\n        _rootSkeleton: null,\n\n        _squareVertices: null,\n        _squareColors: null,\n        _noMVPVertices: null,\n\n        ctor: function (length) {\n            Node.prototype.ctor.call(this);\n            // null\n            // length\n            // _isRackShow -> _renderCmd._debug\n            if (this._squareVertices === null)\n                this._squareVertices = [\n                    {x: 0, y: 0}, {x: 0, y: 0}, {x: 0, y: 0}, {x: 0, y: 0}\n                ];\n\n            this._rackColor = cc.color.WHITE;\n            this._blendFunc = BlendFunc.ALPHA_NON_PREMULTIPLIED;\n\n            this._childBones = [];\n            this._boneSkins = [];\n\n            this._rackLength = length === undefined ? 50 : length;\n            this._rackWidth = 20;\n            this._updateVertices();\n            //this._updateColor();\n        },\n\n        visit: function (parent) {\n            this._visit && this._visit(parent && parent._renderCmd);\n        },\n\n        addSkin: function (skin, display, hideOthers/*false*/) {\n            // skin, display\n            // skin, display, hideOthers\n            var boneSkins = this._boneSkins;\n            debug.assert(skin != null, \"Argument must be non-nil\");\n            if (hideOthers) {\n                for (var i = 0; i < boneSkins.length; i++) {\n                    boneSkins[i].setVisible(false);\n                }\n            }\n            Node.prototype.addChild.call(this, skin);\n            this._boneSkins.push(skin);\n            skin.setVisible(display);\n        },\n\n        getChildBones: function () {\n            return this._childBones;\n        },\n\n        getSkins: function () {\n            return this._boneSkins;\n        },\n\n        displaySkin: function (skin, hideOthers) {\n            var boneSkins = this._boneSkins;\n            var boneSkin, i;\n            if (typeof skin === \"string\") {\n                for (i = 0; i < boneSkins.length; i++) {\n                    boneSkin = boneSkins[i];\n                    if (skin == boneSkin.getName()) {\n                        boneSkin.setVisible(true);\n                    } else if (hideOthers) {\n                        boneSkin.setVisible(false);\n                    }\n                }\n            } else {\n                for (i = 0; i < boneSkins.length; i++) {\n                    boneSkin = boneSkins[i];\n                    if (boneSkin == skin) {\n                        boneSkin.setVisible(true);\n                    } else if (hideOthers) {\n                        boneSkin.setVisible(false);\n                    }\n                }\n            }\n        },\n\n        getVisibleSkins: function () {\n            var displayingSkins = [];\n            var boneSkins = this._boneSkins;\n            for (var boneSkin, i = 0; i < boneSkins.length; i++) {\n                boneSkin = boneSkins[i];\n                if (boneSkin.isVisible()) {\n                    displayingSkins.push(boneSkin);\n                }\n            }\n            return displayingSkins;\n        },\n\n        getRootSkeletonNode: function () {\n            return this._rootSkeleton;\n        },\n\n        getAllSubBones: function () {\n            var allBones = [];\n            var boneStack = []; // for avoid recursive\n            var childBones = this._childBones;\n            for (var i = 0; i < childBones.length; i++) {\n                boneStack.push(childBones[i]);\n            }\n\n            while (boneStack.length > 0) {\n                var top = boneStack.pop();\n                allBones.push(top);\n                var topChildren = top.getChildBones();\n                for (var j = 0; j < topChildren; j++) {\n                    boneStack.push(topChildren[j]);\n                }\n            }\n            return allBones;\n        },\n\n        getAllSubSkins: function () {\n            var allBones = this.getAllSubBones();\n            var allSkins = [];\n            for (var i = 0; i < allBones.length; i++) {\n                var skins = allBones[i].getSkins();\n                for (var j = 0; j < skins.length; j++) {\n                    allSkins.push(skins[i]);\n                }\n            }\n            return allSkins;\n        },\n\n        addChild: function (child, localZOrder, tag) {\n            //child, localZOrder, tag\n            //child, localZOrder, name\n            Node.prototype.addChild.call(this, child, localZOrder, tag);\n            this._addToChildrenListHelper(child);\n        },\n\n        removeChild: function (child, cleanup) {\n            if (this._children.indexOf(child) !== -1) {\n                Node.prototype.removeChild.call(this, child, cleanup);\n                this._removeFromChildrenListHelper(child);\n            }\n        },\n\n        setBlendFunc: function (blendFunc) {\n            var ob = this._blendFunc;\n            if (blendFunc && ob.src !== blendFunc.src && ob.dst !== blendFunc.dst) {\n                this._blendFunc = blendFunc;\n                var boneSkins = this._boneSkins;\n                for (var boneSkin, i = 0; i < boneSkins.length; i++) {\n                    boneSkin = boneSkins[i];\n                    boneSkin.setBlendFunc(blendFunc);\n                }\n            }\n        },\n\n        getBlendFunc: function () {\n            return this._blendFunc;\n        },\n\n        setDebugDrawLength: function (length) {\n            this._rackLength = length;\n            this._updateVertices();\n        },\n\n        getDebugDrawLength: function () {\n            return this._rackLength;\n        },\n\n        setDebugDrawWidth: function (width) {\n            this._rackWidth = width;\n            this._updateVertices();\n        },\n\n        getDebugDrawWidth: function () {\n            return this._rackWidth;\n        },\n\n        setDebugDrawEnabled: function (isDebugDraw) {\n            var renderCmd = this._renderCmd;\n            if (renderCmd._debug === isDebugDraw)\n                return;\n\n            renderCmd._debug = isDebugDraw;\n            cc.renderer.childrenOrderDirty = true;\n\n            if (this._visible && null != this._rootSkeleton) {\n                this._rootSkeleton._subBonesDirty = true;\n                this._rootSkeleton._subBonesOrderDirty = true;\n            }\n        },\n\n        isDebugDrawEnabled: function () {\n            return this._renderCmd._debug;\n        },\n\n        setDebugDrawColor: function (color) {\n            this._rackColor = color;\n        },\n\n        getDebugDrawColor: function () {\n            return this._rackColor;\n        },\n\n        getVisibleSkinsRect: function () {\n            var minx, miny, maxx, maxy = 0;\n            minx = miny = maxx = maxy;\n            var first = true;\n\n            var displayRect = type.rect(0, 0, 0, 0);\n            if (this._renderCmd._debug && this._rootSkeleton != null && this._rootSkeleton._renderCmd._debug) {\n                maxx = this._rackWidth;\n                maxy = this._rackLength;\n                first = false;\n            }\n\n            var boneSkins = this._boneSkins;\n            for (var skin, i = 0; i < boneSkins.length; i++) {\n                skin = boneSkins[i];\n                var r = skin.getBoundingBox();\n                if (!skin.isVisible() || (r.x === 0 && r.y === 0 && r.width === 0 && r.height === 0))\n                    continue;\n\n                if (first) {\n                    minx = cc.rectGetMinX(r);\n                    miny = cc.rectGetMinY(r);\n                    maxx = cc.rectGetMaxX(r);\n                    maxy = cc.rectGetMaxY(r);\n\n                    first = false;\n                } else {\n                    minx = Math.min(cc.rectGetMinX(r), minx);\n                    miny = Math.min(cc.rectGetMinY(r), miny);\n                    maxx = Math.max(cc.rectGetMaxX(r), maxx);\n                    maxy = Math.max(cc.rectGetMaxY(r), maxy);\n                }\n                displayRect.setRect(minx, miny, maxx - minx, maxy - miny);\n            }\n            return displayRect;\n        },\n\n        getBoundingBox: function () {\n            var boundingBox = this.getVisibleSkinsRect();\n            return cc.rectApplyAffineTransform(boundingBox, this.getNodeToParentAffineTransform());\n        },\n\n        batchBoneDrawToSkeleton: function (bone) {\n        },\n\n        setLocalZOrder: function (localZOrder) {\n            Node.prototype.setLocalZOrder.call(this, localZOrder);\n            if (this._rootSkeleton != null)\n                this._rootSkeleton._subBonesOrderDirty = true;\n        },\n\n        setName: function (name) {\n            var rootSkeleton = this._rootSkeleton;\n            var oldName = this.getName();\n            Node.prototype.setName.call(this, name);\n            if (rootSkeleton != null) {\n                var oIter = rootSkeleton._subBonesMap[oldName];\n                var nIter = rootSkeleton._subBonesMap[name];\n                if (oIter && !nIter) {\n                    delete rootSkeleton._subBonesMap[oIter];\n                    rootSkeleton._subBonesMap[name] = oIter;\n                }\n            }\n        },\n\n        setContentSize: function (contentSize) {\n            Node.prototype.setContentSize.call(this, contentSize);\n            this._updateVertices();\n        },\n\n        setAnchorPoint: function (anchorPoint) {\n            Node.prototype.setAnchorPoint.call(this, anchorPoint);\n            this._updateVertices();\n        },\n\n        setVisible: function (visible) {\n            if (this._visible == visible)\n                return;\n            Node.prototype.setVisible.call(this, visible);\n            if (this._rootSkeleton != null) {\n                this._rootSkeleton._subBonesDirty = true;\n                this._rootSkeleton._subBonesOrderDirty = true;\n            }\n        },\n\n        _addToChildrenListHelper: function (child) {\n            if (child instanceof BoneNode) {\n                this._addToBoneList(child);\n            } else {\n                //if (child instanceof SkinNode) {\n                this._addToSkinList(child);\n                //}\n            }\n        },\n\n        _removeFromChildrenListHelper: function (child) {\n            if (child instanceof BoneNode) {\n                this._removeFromBoneList(child);\n            } else {\n                if (child instanceof SkinNode)\n                    this._removeFromSkinList(skin);\n            }\n        },\n\n        _removeFromBoneList: function (bone) {\n            if (\n                this._rootSkeleton != null &&\n                bone instanceof ccs.SkeletonNode &&\n                bone._rootSkeleton === this._rootSkeleton\n            ) {\n                bone._rootSkeleton = null;\n                var subBones = bone.getAllSubBones();\n                subBones.push(bone);\n                for (var subBone, i = 0; i < subBones.length; i++) {\n                    subBone = subBones[i];\n                    subBone._rootSkeleton = null;\n                    delete this._rootSkeleton._subBonesMap[subBone.getName()];\n                    this._rootSkeleton._subBonesDirty = true;\n                    this._rootSkeleton._subBonesOrderDirty = true;\n                }\n            } else {\n                this._rootSkeleton._subBonesDirty = true;\n                this._rootSkeleton._subBonesOrderDirty = true;\n            }\n            cc.arrayRemoveObject(this._childBones, bone);\n        },\n\n        _setRootSkeleton: function (rootSkeleton) {\n            this._rootSkeleton = rootSkeleton;\n            var subBones = this.getAllSubBones();\n            for (var i = 0; i < subBones.length; i++) {\n                this._addToBoneList(subBones[i]);\n            }\n        },\n\n        _addToBoneList: function (bone) {\n            if (this._childBones.indexOf(bone) === -1)\n                this._childBones.push(bone);\n            if (this._rootSkeleton != null) {\n                var skeletonNode = bone;\n                if (!(skeletonNode instanceof SkinNode) && !bone._rootSkeleton) {// not nest skeleton\n                    var subBones = bone.getAllSubBones();\n                    subBones.push(bone);\n                    for (var subBone, i = 0; i < subBones.length; i++) {\n                        subBone = subBones[i];\n                        subBone._setRootSkeleton(this._rootSkeleton);\n                        var bonename = subBone.getName();\n                        if (!this._rootSkeleton._subBonesMap[bonename]) {\n                            this._rootSkeleton._subBonesMap[subBone.getName()] = subBone;\n                            this._rootSkeleton._subBonesDirty = true;\n                            this._rootSkeleton._subBonesOrderDirty = true;\n                        } else {\n                            cc.log(\"already has a bone named %s in skeleton %s\", bonename, this._rootSkeleton.getName());\n                            this._rootSkeleton._subBonesDirty = true;\n                            this._rootSkeleton._subBonesOrderDirty = true;\n                        }\n                    }\n                }\n            }\n        },\n\n        _visitSkins: function () {\n            var cmd = this._renderCmd;\n            // quick return if not visible\n            if (!this._visible)\n                return;\n\n            var parentCmd = cmd.getParentRenderCmd();\n            if (parentCmd)\n                cmd._curLevel = parentCmd._curLevel + 1;\n\n            //visit for canvas\n            var i, children = this._boneSkins, child;\n            //var i, children = this._children, child;\n            cmd._syncStatus(parentCmd);\n            var len = children.length;\n            if (len > 0) {\n                this.sortAllChildren();\n                // draw children zOrder < 0\n                for (i = 0; i < len; i++) {\n                    child = children[i];\n                    if (child._localZOrder < 0)\n                        child.visit(this);\n                    else\n                        break;\n                }\n                for (; i < len; i++)\n                    children[i].visit(this);\n            }\n            cmd._dirtyFlag = 0;\n        },\n\n        _addToSkinList: function (skin) {\n            this._boneSkins.push(skin);\n            if (skin.getBlendFunc) {\n                var blendFunc = skin.getBlendFunc();\n                if (this._blendFunc.src !== blendFunc.src && this._blendFunc.dst !== blendFunc.dst)\n                    skin.setBlendFunc(this._blendFunc);\n            }\n        },\n\n        _removeFromSkinList: function (skin) {\n            cc.arrayRemoveObject(this._boneSkins, skin);\n        },\n\n        sortAllChildren: function () {\n            this._sortArray(this._childBones);\n            this._sortArray(this._boneSkins);\n            Node.prototype.sortAllChildren.call(this);\n        },\n\n        _sortArray: function (array) {\n            if (!array)\n                return;\n            var len = array.length, i, j, tmp;\n            for (i = 1; i < len; i++) {\n                tmp = array[i];\n                j = i - 1;\n                while (j >= 0) {\n                    if (tmp._localZOrder < array[j]._localZOrder) {\n                        array[j + 1] = array[j];\n                    } else if (tmp._localZOrder === array[j]._localZOrder && tmp.arrivalOrder < array[j].arrivalOrder) {\n                        array[j + 1] = array[j];\n                    } else {\n                        break;\n                    }\n                    j--;\n                }\n                array[j + 1] = tmp;\n            }\n        },\n\n        _updateVertices: function () {\n            var squareVertices = this._squareVertices,\n                anchorPointInPoints = this._renderCmd._anchorPointInPoints;\n            if (this._rackLength != squareVertices[2].x - anchorPointInPoints.x ||\n                squareVertices[3].y != this._rackWidth / 2 - anchorPointInPoints.y) {\n\n                squareVertices[1].x = squareVertices[1].y = squareVertices[3].y = 0;\n                squareVertices[0].x = squareVertices[2].x = this._rackLength * .1;\n                squareVertices[2].y = this._rackWidth * .5;\n                squareVertices[0].y = -squareVertices[2].y;\n                squareVertices[3].x = this._rackLength;\n\n                for (var i = 0; i < squareVertices.length; i++) {\n                    squareVertices[i].x += anchorPointInPoints.x;\n                    squareVertices[i].y += anchorPointInPoints.y;\n                }\n\n                this._renderCmd.updateDebugPoint(squareVertices);\n            }\n        },\n\n        _createRenderCmd: function () {\n            if (cc._renderType === cc.game.RENDER_TYPE_CANVAS)\n                return new BoneNodeCanvasCmd(this);\n            else\n                return new BoneNodeWebGLCmd(this);\n        }\n    });\n\n    BoneNode.create = function (length, color) {\n        // null\n        // length\n        // length, color\n        return new ccui.BoneNode(length, color);\n    };\n\n    var BoneNodeCanvasCmd = (function () {\n\n        var BoneNodeCanvasCmd = function (node) {\n            this._rootCtor(node);\n            this._debug = false;\n            this._color = cc.color.WHITE;\n            this._drawNode = new cc.DrawNode();\n        };\n\n        var proto = BoneNodeCanvasCmd.prototype = Object.create(Node.CanvasRenderCmd.prototype);\n        proto.constructor = BoneNodeCanvasCmd;\n\n        proto.updateDebugPoint = function (points) {\n            this._drawNode.clear();\n            this._drawNode.drawPoly(points, this._color, 0, this._color);\n        };\n\n        proto.transform = function (parentCmd, recursive) {\n            var rootSkeleton = this._node._rootSkeleton;\n            this.originTransform(parentCmd, recursive);\n            if (rootSkeleton && rootSkeleton._renderCmd._debug) {\n                this._drawNode._renderCmd.transform(this);\n            }\n        };\n\n        return BoneNodeCanvasCmd;\n\n    })();\n\n    var BoneNodeWebGLCmd = (function () {\n\n        var BoneNodeWebGLCmd = function (node) {\n            this._rootCtor(node);\n            this._debug = false;\n            this._color = cc.color.WHITE;\n            this._drawNode = new cc.DrawNode();\n        };\n\n        var proto = BoneNodeWebGLCmd.prototype = Object.create(Node.WebGLRenderCmd.prototype);\n        proto.constructor = BoneNodeWebGLCmd;\n\n        proto.updateDebugPoint = function (points) {\n            this._drawNode.clear();\n            this._drawNode.drawPoly(points, this._color, 0, this._color);\n        };\n\n        proto.transform = function (parentCmd, recursive) {\n            var rootSkeleton = this._node._rootSkeleton;\n            this.originTransform(parentCmd, recursive);\n            if (rootSkeleton && rootSkeleton._renderCmd._debug) {\n                this._drawNode._renderCmd.transform(this);\n            }\n        };\n\n        return BoneNodeWebGLCmd;\n\n    })();\n\n    return BoneNode;\n\n})();\n"]}