{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/shape-nodes/assets/frameworks/cocos2d-html5/cocos2d/shape-nodes/CCDrawNodeCanvasRenderCmd.js"],"names":["cc","DrawNode","CanvasRenderCmd","renderableObject","_rootCtor","_needDraw","_buffer","_drawColor","_blendFunc","prototype","Object","create","Node","constructor","getLocalBB","node","_node","_localBB","extend","rendering","ctx","scaleX","scaleY","wrapper","_renderContext","context","getContext","alpha","_displayedOpacity","setTransform","_worldTransform","setGlobalAlpha","src","SRC_ALPHA","dst","ONE","setCompositeOperation","locBuffer","i","len","length","element","type","TYPE_DOT","_drawDot","TYPE_SEGMENT","_drawSegment","TYPE_POLY","_drawPoly","locColor","fillColor","locPos","verts","locRadius","lineWidth","setFillStyle","r","g","b","a","beginPath","arc","x","y","Math","PI","closePath","fill","lineColor","locFrom","locTo","locLineWidth","locLineCap","lineCap","setStrokeStyle","moveTo","lineTo","stroke","locVertices","locFillColor","locLineColor","locIsClosePolygon","isClosePolygon","locIsFill","isFill","locIsStroke","isStroke","firstPoint"],"mappings":"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","file":"CCDrawNodeCanvasRenderCmd.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/shape-nodes","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n\n    cc.DrawNode.CanvasRenderCmd = function (renderableObject) {\n        this._rootCtor(renderableObject);\n        this._needDraw = true;\n        this._buffer = null;\n        this._drawColor = null;\n        this._blendFunc = null;\n    };\n\n\n    cc.DrawNode.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n    cc.DrawNode.CanvasRenderCmd.prototype.constructor = cc.DrawNode.CanvasRenderCmd;\n\n    cc.DrawNode.CanvasRenderCmd.prototype.getLocalBB = function () {\n        var node = this._node;\n        return node._localBB;\n    };\n\n    cc.extend(cc.DrawNode.CanvasRenderCmd.prototype, {\n        rendering: function (ctx, scaleX, scaleY) {\n            var wrapper = ctx || cc._renderContext, context = wrapper.getContext(), node = this._node;\n            var alpha = this._displayedOpacity / 255;\n            if (alpha === 0)\n                return;\n\n            wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n\n            //context.save();\n            wrapper.setGlobalAlpha(alpha);\n            if ((this._blendFunc && (this._blendFunc.src === cc.SRC_ALPHA) && (this._blendFunc.dst === cc.ONE)))\n                wrapper.setCompositeOperation('lighter');               //todo: need refactor\n            var locBuffer = this._buffer;\n            for (var i = 0, len = locBuffer.length; i < len; i++) {\n                var element = locBuffer[i];\n                switch (element.type) {\n                    case cc.DrawNode.TYPE_DOT:\n                        this._drawDot(wrapper, element, scaleX, scaleY);\n                        break;\n                    case cc.DrawNode.TYPE_SEGMENT:\n                        this._drawSegment(wrapper, element, scaleX, scaleY);\n                        break;\n                    case cc.DrawNode.TYPE_POLY:\n                        this._drawPoly(wrapper, element, scaleX, scaleY);\n                        break;\n                }\n            }\n            //context.restore();            //todo It can be reserve\n        },\n\n        _drawDot: function (wrapper, element) {\n            var locColor = element.fillColor, locPos = element.verts[0], locRadius = element.lineWidth;\n\n            var ctx = wrapper.getContext();\n            wrapper.setFillStyle(\"rgba(\" + (0 | locColor.r) + \",\" + (0 | locColor.g) + \",\" + (0 | locColor.b) + \",\" + locColor.a / 255 + \")\");\n\n            ctx.beginPath();\n            ctx.arc(locPos.x, -locPos.y, locRadius, 0, Math.PI * 2, false);\n            ctx.closePath();\n            ctx.fill();\n        },\n\n        _drawSegment: function (wrapper, element, scaleX) {\n            var locColor = element.lineColor;\n            var locFrom = element.verts[0], locTo = element.verts[1];\n            var locLineWidth = element.lineWidth, locLineCap = element.lineCap;\n\n            var ctx = wrapper.getContext();\n            wrapper.setStrokeStyle(\"rgba(\" + (0 | locColor.r) + \",\" + (0 | locColor.g) + \",\" + (0 | locColor.b) + \",\" + locColor.a / 255 + \")\");\n\n            ctx.lineWidth = locLineWidth * scaleX;\n            ctx.beginPath();\n            ctx.lineCap = locLineCap;\n            ctx.moveTo(locFrom.x, -locFrom.y);\n            ctx.lineTo(locTo.x, -locTo.y);\n            ctx.stroke();\n        },\n\n        _drawPoly: function (wrapper, element, scaleX) {\n            var locVertices = element.verts, locLineCap = element.lineCap;\n            if (locVertices == null)\n                return;\n\n            var locFillColor = element.fillColor, locLineWidth = element.lineWidth;\n            var locLineColor = element.lineColor, locIsClosePolygon = element.isClosePolygon;\n            var locIsFill = element.isFill, locIsStroke = element.isStroke;\n\n            var ctx = wrapper.getContext();\n            var firstPoint = locVertices[0];\n            ctx.lineCap = locLineCap;\n            if (locFillColor)\n                wrapper.setFillStyle(\"rgba(\" + (0 | locFillColor.r) + \",\" + (0 | locFillColor.g) + \",\"\n                    + (0 | locFillColor.b) + \",\" + locFillColor.a / 255 + \")\");\n            if (locLineWidth)\n                ctx.lineWidth = locLineWidth * scaleX;\n            if (locLineColor)\n                wrapper.setStrokeStyle(\"rgba(\" + (0 | locLineColor.r) + \",\" + (0 | locLineColor.g) + \",\"\n                    + (0 | locLineColor.b) + \",\" + locLineColor.a / 255 + \")\");\n\n            ctx.beginPath();\n            ctx.moveTo(firstPoint.x, -firstPoint.y);\n            for (var i = 1, len = locVertices.length; i < len; i++)\n                ctx.lineTo(locVertices[i].x, -locVertices[i].y);\n\n            if (locIsClosePolygon)\n                ctx.closePath();\n            if (locIsFill)\n                ctx.fill();\n            if (locIsStroke)\n                ctx.stroke();\n        }\n    });\n    \n})();\n"]}