{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/renderer/assets/frameworks/cocos2d-html5/cocos2d/core/renderer/DirtyRegion.js"],"names":["Region","_minX","_minY","_maxX","_maxY","_width","_height","_area","regionProto","prototype","regionPool","regionCreate","region","pop","regionRelease","push","setTo","minX","minY","maxX","maxY","updateArea","intValues","Math","floor","ceil","union","target","setEmpty","isEmpty","intersects","max","min","updateRegion","bounds","matrix","width","height","m","a","b","c","d","tx","ty","x","y","xMax","yMax","x0","y0","x1","y1","x2","y2","x3","y3","tmp","unionArea","r1","r2","DirtyRegion","dirtyList","hasClipRect","clipWidth","clipHeight","clipArea","clipRectChanged","dirtyRegionProto","setClipRect","addRegion","mergeDirtyList","clear","length","i","getDirtyRegions","numDirty","bestDelta","Number","POSITIVE_INFINITY","mergeA","mergeB","totalArea","regionA","area","j","regionB","delta","splice","cc"],"mappings":"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","file":"DirtyRegion.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/renderer","sourcesContent":["//Region is used to label a rect which world axis aligned.\nvar Region = function () {\n    this._minX = 0;\n    this._minY = 0;\n    this._maxX = 0;\n    this._maxY = 0;\n\n    this._width = 0;\n    this._height = 0;\n    this._area = 0;\n    //this.moved = false;\n};\n\nvar regionProto = Region.prototype;\n\nvar regionPool = [];\n\nfunction regionCreate() {\n    var region = regionPool.pop();\n    if (!region) {\n        region = new Region();\n    }\n    return region;\n}\n\nfunction regionRelease(region) {\n    regionPool.push(region);\n}\n\nregionProto.setTo = function (minX, minY, maxX, maxY) {\n    this._minX = minX;\n    this._minY = minY;\n    this._maxX = maxX;\n    this._maxY = maxY;\n    this.updateArea();\n    return this;\n};\n\n//convert region to int values which is fast for clipping\nregionProto.intValues = function () {\n    this._minX = Math.floor(this._minX);\n    this._minY = Math.floor(this._minY);\n    this._maxX = Math.ceil(this._maxX);\n    this._maxY = Math.ceil(this._maxY);\n    this.updateArea();\n};\n\n//update the area of region\nregionProto.updateArea = function () {\n    this._width = this._maxX - this._minX;\n    this._height = this._maxY - this._minY;\n    this._area = this._width * this._height;\n};\n\n//merge two region into one\nregionProto.union = function (target) {\n    if(this._width <= 0 || this._height <= 0) {\n        this.setTo(target._minX, target._minY, target._maxX, target._maxY);\n        return;\n    }\n    if (this._minX > target._minX) {\n        this._minX = target._minX;\n    }\n    if (this._minY > target._minY) {\n        this._minY = target._minY;\n    }\n    if (this._maxX < target._maxX) {\n        this._maxX = target._maxX;\n    }\n    if (this._maxY < target._maxY) {\n        this._maxY = target._maxY;\n    }\n    this.updateArea();\n};\n\n//regionProto.intersect = function (target) {\n//    if (this._minX < target._minX) {\n//        this._minX = target._minX;\n//    }\n//    if (this._maxX > target._maxX) {\n//        this._maxX = target._maxX;\n//    }\n//    if (this._minX >= this._maxX) {\n//        this.setEmpty();\n//        return;\n//    }\n//    if (this._minY < target._minY) {\n//        this._minY = target._minY;\n//    }\n//\n//    if (this._maxY > target._maxY) {\n//        this._maxY = target._maxY;\n//    }\n//    if (this._minY >= this._maxY) {\n//        this.setEmpty();\n//        return;\n//    }\n//    this.updateArea();\n//};\n\n//set region to empty\nregionProto.setEmpty = function () {\n    this._minX = 0;\n    this._minY = 0;\n    this._maxX = 0;\n    this._maxY = 0;\n    this._width = 0;\n    this._height = 0;\n    this._area = 0;\n};\n\nregionProto.isEmpty = function () {\n    return this._width <= 0 || this._height <= 0;\n};\n\n//check whether two region is intersects or not\nregionProto.intersects = function (target) {\n    if (this._width <= 0 || this._height <= 0 || target._width <= 0 || target._height <= 0) {\n        return false;\n    }\n    var max = this._minX > target._minX ? this._minX : target._minX;\n    var min = this._maxX < target._maxX ? this._maxX : target._maxX;\n    if (max > min) {\n        return false;\n    }\n\n    max = this._minY > target._minY ? this._minY : target._minY;\n    min = this._maxY < target._maxY ? this._maxY : target._maxY;\n    return max <= min;\n};\n\n//update region by a rotated bounds\nregionProto.updateRegion = function (bounds, matrix) {\n    if (bounds.width == 0 || bounds.height == 0) {\n        this.setEmpty();\n        return;\n    }\n    var m = matrix;\n    var a = m.a;\n    var b = m.b;\n    var c = m.c;\n    var d = m.d;\n    var tx = m.tx;\n    var ty = m.ty;\n    var x = bounds.x;\n    var y = bounds.y;\n    var xMax = x + bounds.width;\n    var yMax = y + bounds.height;\n    var minX, minY, maxX, maxY;\n    if (a == 1.0 && b == 0.0 && c == 0.0 && d == 1.0) {\n        minX = x + tx - 1;\n        minY = y + ty - 1;\n        maxX = xMax + tx + 1;\n        maxY = yMax + ty + 1;\n    }\n    else {\n        var x0 = a * x + c * y + tx;\n        var y0 = b * x + d * y + ty;\n        var x1 = a * xMax + c * y + tx;\n        var y1 = b * xMax + d * y + ty;\n        var x2 = a * xMax + c * yMax + tx;\n        var y2 = b * xMax + d * yMax + ty;\n        var x3 = a * x + c * yMax + tx;\n        var y3 = b * x + d * yMax + ty;\n\n        var tmp = 0;\n\n        if (x0 > x1) {\n            tmp = x0;\n            x0 = x1;\n            x1 = tmp;\n        }\n        if (x2 > x3) {\n            tmp = x2;\n            x2 = x3;\n            x3 = tmp;\n        }\n\n        minX = (x0 < x2 ? x0 : x2) - 1;\n        maxX = (x1 > x3 ? x1 : x3) + 1;\n\n        if (y0 > y1) {\n            tmp = y0;\n            y0 = y1;\n            y1 = tmp;\n        }\n        if (y2 > y3) {\n            tmp = y2;\n            y2 = y3;\n            y3 = tmp;\n        }\n\n        minY = (y0 < y2 ? y0 : y2) - 1;\n        maxY = (y1 > y3 ? y1 : y3) + 1;\n    }\n    this._minX = minX;\n    this._minY = minY;\n    this._maxX = maxX;\n    this._maxY = maxY;\n    this._width = maxX - minX;\n    this._height = maxY - minY;\n    this._area = this._width * this._height;\n};\n\n//get the area of the unioned region of r1 and r2\nfunction unionArea(r1, r2) {\n    var minX = r1._minX < r2._minX ? r1._minX : r2._minX;\n    var minY = r1._minY < r2._minY ? r1._minY : r2._minY;\n    var maxX = r1._maxX > r2._maxX ? r1._maxX : r2._maxX;\n    var maxY = r1._maxY > r2._maxY ? r1._maxY : r2._maxY;\n    return (maxX - minX) * (maxY - minY);\n}\n\n//DirtyRegion is used to collect the dirty area which need to be rerendered in canvas\n//there may be many small regions which is dirty, the dirty region will merge it into several big one to optimise performance\nvar DirtyRegion = function() {\n    this.dirtyList = [];\n    this.hasClipRect = false;\n    this.clipWidth = 0;\n    this.clipHeight = 0;\n    this.clipArea = 0;\n    this.clipRectChanged = false;\n};\nvar dirtyRegionProto = DirtyRegion.prototype;\n\n//clip rect, regions will not be considered if it is outside\ndirtyRegionProto.setClipRect = function(width, height) {\n    this.hasClipRect = true;\n    this.clipRectChanged = true;\n    this.clipWidth = Math.ceil(width);\n    this.clipHeight = Math.ceil(height);\n    this.clipArea = this.clipWidth * this.clipHeight;\n};\n\n//add a new region which is dirty (need to be rendered)\ndirtyRegionProto.addRegion = function(target) {\n    var minX = target._minX, minY = target._minY, maxX = target._maxX, maxY = target._maxY;\n\n    if (this.hasClipRect) {\n        if (minX < 0) {\n            minX = 0;\n        }\n        if (minY < 0) {\n            minY = 0;\n        }\n        if (maxX > this.clipWidth) {\n            maxX = this.clipWidth;\n        }\n        if (maxY > this.clipHeight) {\n            maxY = this.clipHeight;\n        }\n    }\n    if (minX >= maxX || minY >= maxY) {\n        return false;\n    }\n    if (this.clipRectChanged) {\n        return true;\n    }\n    var dirtyList = this.dirtyList;\n    var region = regionCreate();\n    dirtyList.push(region.setTo(minX, minY, maxX, maxY));\n    this.mergeDirtyList(dirtyList);\n    return true;\n};\n\n//clear all the dirty regions\ndirtyRegionProto.clear = function() {\n    var dirtyList = this.dirtyList;\n    var length = dirtyList.length;\n    for (var i = 0; i < length; i++) {\n        regionRelease(dirtyList[i]);\n    }\n    dirtyList.length = 0;\n};\n\n//get the merged dirty regions\ndirtyRegionProto.getDirtyRegions = function() {\n    var dirtyList = this.dirtyList;\n    if (this.clipRectChanged) {\n        this.clipRectChanged = false;\n        this.clear();\n        var region = regionCreate();\n        dirtyList.push(region.setTo(0, 0, this.clipWidth, this.clipHeight));\n    }\n    else {\n        while (this.mergeDirtyList(dirtyList)) {\n        }\n    }\n    var numDirty = this.dirtyList.length;\n    if (numDirty > 0) {\n        for (var i = 0; i < numDirty; i++) {\n            this.dirtyList[i].intValues();\n        }\n    }\n    return this.dirtyList;\n};\n\n//merge the small dirty regions into bigger region, to improve the performance of dirty regions\ndirtyRegionProto.mergeDirtyList = function(dirtyList) {\n    var length = dirtyList.length;\n    if (length < 2) {\n        return false;\n    }\n    var hasClipRect = this.hasClipRect;\n    var bestDelta = length > 3 ? Number.POSITIVE_INFINITY : 0;\n    var mergeA = 0;\n    var mergeB = 0;\n    var totalArea = 0;\n    for (var i = 0; i < length - 1; i++) {\n        var regionA = dirtyList[i];\n        hasClipRect && (totalArea += regionA.area);\n        for (var j = i + 1; j < length; j++) {\n            var regionB = dirtyList[j];\n            var delta = unionArea(regionA, regionB) - regionA.area - regionB.area;\n            if (bestDelta > delta) {\n                mergeA = i;\n                mergeB = j;\n                bestDelta = delta;\n            }\n        }\n    }\n    //if the area of dirty region exceed 95% of the screen, skip the following dirty regions merge\n    if (hasClipRect && (totalArea / this.clipArea) > 0.95) {\n        this.clipRectChanged = true;\n    }\n    if (mergeA != mergeB) {\n        var region = dirtyList[mergeB];\n        dirtyList[mergeA].union(region);\n        regionRelease(region);\n        dirtyList.splice(mergeB, 1);\n        return true;\n    }\n    return false;\n};\n\ncc.Region = Region;\ncc.DirtyRegion = DirtyRegion;\n"]}