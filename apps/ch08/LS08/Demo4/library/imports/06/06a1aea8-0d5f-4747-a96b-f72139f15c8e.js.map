{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/textures/assets/frameworks/cocos2d-html5/cocos2d/core/textures/TexturesWebGL.js"],"names":["cc","_tmp","WebGLTexture2D","Texture2D","Class","extend","_pVRHaveAlphaPremultiplied","_pixelFormat","_pixelsWide","_pixelsHigh","_name","_contentSize","maxS","maxT","_hasPremultipliedAlpha","_hasMipmaps","shaderProgram","_textureLoaded","_htmlElementObj","_webTextureObj","url","ctor","size","defaultPixelFormat","releaseTexture","_renderContext","deleteTexture","loader","release","getPixelFormat","getPixelsWide","getPixelsHigh","getName","getContentSize","width","contentScaleFactor","height","_getWidth","_getHeight","getContentSizeInPixels","getMaxS","setMaxS","getMaxT","setMaxT","getShaderProgram","setShaderProgram","hasPremultipliedAlpha","hasMipmaps","description","_t","releaseData","data","keepData","length","initWithData","pixelFormat","pixelsWide","pixelsHigh","contentSize","self","tex2d","gl","format","RGBA","type","UNSIGNED_BYTE","bitsPerPixel","_B","bytesPerRow","pixelStorei","UNPACK_ALIGNMENT","createTexture","glBindTexture2D","texParameteri","TEXTURE_2D","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","PIXEL_FORMAT_RGBA8888","PIXEL_FORMAT_RGB888","RGB","PIXEL_FORMAT_RGBA4444","UNSIGNED_SHORT_4_4_4_4","PIXEL_FORMAT_RGB5A1","UNSIGNED_SHORT_5_5_5_1","PIXEL_FORMAT_RGB565","UNSIGNED_SHORT_5_6_5","PIXEL_FORMAT_AI88","LUMINANCE_ALPHA","PIXEL_FORMAT_A8","ALPHA","PIXEL_FORMAT_I8","LUMINANCE","assert","_LogInfos","Texture2D_initWithData","texImage2D","shaderCache","programForKey","SHADER_POSITION_TEXTURE","drawAtPoint","point","coordinates","vertices","x","y","_glProgramState","apply","_glprogram","setUniformsForBuiltins","enableVertexAttribArray","VERTEX_ATTRIB_POSITION","VERTEX_ATTRIB_TEX_COORDS","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","drawInRect","rect","initWithImage","uiImage","log","Texture2D_initWithImage","imageWidth","getWidth","imageHeight","getHeight","maxTextureSize","configuration","getMaxTextureSize","Texture2D_initWithImage_2","_initPremultipliedATextureWithImage","initWithElement","element","getHtmlElementObj","isLoaded","handleLoadedTexture","premultiplied","undefined","game","_rendererInitialized","UNPACK_PREMULTIPLY_ALPHA_WEBGL","window","ENABLE_IMAEG_POOL","dispatchEvent","initWithString","text","fontName","fontSize","dimensions","hAlignment","vAlignment","Texture2D_initWithString","initWithETCFile","file","Texture2D_initWithETCFile_2","initWithPVRFile","Texture2D_initWithPVRFile_2","initWithPVRTCData","level","bpp","hasAlpha","Texture2D_initWithPVRTCData_2","setTexParameters","texParams","magFilter","wrapS","wrapT","minFilter","NextPOT","setAntiAliasTexParameters","LINEAR_MIPMAP_NEAREST","setAliasTexParameters","NEAREST","NEAREST_MIPMAP_NEAREST","generateMipmap","stringForFormat","_M","bitsPerPixelForFormat","value","Texture2D_bitsPerPixelForFormat","tempData","getData","inPixel32","inPixel8","outPixel16","imageSize","getBitsPerComponent","Texture2D__initPremultipliedATextureWithImage","i","Uint16Array","Uint8Array","isPremultipliedAlpha","addLoadedEventListener","callback","target","addEventListener","removeLoadedEventListener","removeEventTarget","WebGLTextureAtlas","_p","TextureAtlas","prototype","_setupVBO","_buffersVBO","createBuffer","_quadsWebBuffer","_mapBuffers","bindBuffer","ARRAY_BUFFER","bufferData","_quadsArrayBuffer","DYNAMIC_DRAW","ELEMENT_ARRAY_BUFFER","_indices","STATIC_DRAW","drawNumberOfQuads","n","start","texture","dirty","VERTEX_ATTRIB_COLOR","TEXTURE_ATLAS_USE_TRIANGLE_STRIP","drawElements","UNSIGNED_SHORT","BYTES_PER_ELEMENT","TRIANGLES","g_NumberOfDraws","WebGLTextureCache","textureCache","img","locTexs","_textures","tex","ext","_loadedTexturesBefore","path","extname","addImage","cb","Texture2D_addImage_2","_getAliase","call","basePath","getBasePath","resPath","loadImg","join","err","texResult","addImageAsync"],"mappings":"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","file":"TexturesWebGL.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/textures","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\ncc._tmp.WebGLTexture2D = function () {\n\n    /**\n     * <p>\n     * This class allows to easily create OpenGL or Canvas 2D textures from images, text or raw data.                                    <br/>\n     * The created cc.Texture2D object will always have power-of-two dimensions.                                                <br/>\n     * Depending on how you create the cc.Texture2D object, the actual image area of the texture might be smaller than the texture dimensions <br/>\n     *  i.e. \"contentSize\" != (pixelsWide, pixelsHigh) and (maxS, maxT) != (1.0, 1.0).                                           <br/>\n     * Be aware that the content of the generated textures will be upside-down! </p>\n     * @name cc.Texture2D\n     * @class\n     * @extends cc.Class\n     *\n     * @property {WebGLTexture}     name            - <@readonly> WebGLTexture Object\n     * @property {Number}           pixelFormat     - <@readonly> Pixel format of the texture\n     * @property {Number}           pixelsWidth     - <@readonly> Width in pixels\n     * @property {Number}           pixelsHeight    - <@readonly> Height in pixels\n     * @property {Number}           width           - Content width in points\n     * @property {Number}           height          - Content height in points\n     * @property {cc.GLProgram}     shaderProgram   - The shader program used by drawAtPoint and drawInRect\n     * @property {Number}           maxS            - Texture max S\n     * @property {Number}           maxT            - Texture max T\n     */\n        //Original : Texture2DWebGL\n    cc.Texture2D = cc.Class.extend(/** @lends cc.Texture2D# */{\n        // By default PVR images are treated as if they don't have the alpha channel premultiplied\n        _pVRHaveAlphaPremultiplied: true,\n        _pixelFormat: null,\n        _pixelsWide: 0,\n        _pixelsHigh: 0,\n        _name: \"\",\n        _contentSize: null,\n        maxS: 0,\n        maxT: 0,\n        _hasPremultipliedAlpha: false,\n        _hasMipmaps: false,\n\n        shaderProgram: null,\n\n        _textureLoaded: false,\n        _htmlElementObj: null,\n        _webTextureObj: null,\n\n        url: null,\n\n        /**\n         * constructor of cc.Texture2D\n         */\n        ctor: function () {\n            this._contentSize = cc.size(0, 0);\n            this._pixelFormat = cc.Texture2D.defaultPixelFormat;\n        },\n\n        /**\n         * release texture\n         */\n        releaseTexture: function () {\n            if (this._webTextureObj)\n                cc._renderContext.deleteTexture(this._webTextureObj);\n            this._htmlElementObj = null;\n            cc.loader.release(this.url);\n        },\n\n        /**\n         * pixel format of the texture\n         * @return {Number}\n         */\n        getPixelFormat: function () {\n            return this._pixelFormat;\n        },\n\n        /**\n         * width in pixels\n         * @return {Number}\n         */\n        getPixelsWide: function () {\n            return this._pixelsWide;\n        },\n\n        /**\n         * height in pixels\n         * @return {Number}\n         */\n        getPixelsHigh: function () {\n            return this._pixelsHigh;\n        },\n\n        /**\n         * get WebGLTexture Object\n         * @return {WebGLTexture}\n         */\n        getName: function () {\n            return this._webTextureObj;\n        },\n\n        /**\n         * content size\n         * @return {cc.Size}\n         */\n        getContentSize: function () {\n            return cc.size(this._contentSize.width / cc.contentScaleFactor(), this._contentSize.height / cc.contentScaleFactor());\n        },\n\n        _getWidth: function () {\n            return this._contentSize.width / cc.contentScaleFactor();\n        },\n        _getHeight: function () {\n            return this._contentSize.height / cc.contentScaleFactor();\n        },\n\n        /**\n         * get content size in pixels\n         * @return {cc.Size}\n         */\n        getContentSizeInPixels: function () {\n            return this._contentSize;\n        },\n\n        /**\n         * texture max S\n         * @return {Number}\n         */\n        getMaxS: function () {\n            return this.maxS;\n        },\n\n        /**\n         * set texture max S\n         * @param {Number} maxS\n         */\n        setMaxS: function (maxS) {\n            this.maxS = maxS;\n        },\n\n        /**\n         * get texture max T\n         * @return {Number}\n         */\n        getMaxT: function () {\n            return this.maxT;\n        },\n\n        /**\n         * set texture max T\n         * @param {Number} maxT\n         */\n        setMaxT: function (maxT) {\n            this.maxT = maxT;\n        },\n\n        /**\n         * return shader program used by drawAtPoint and drawInRect\n         * @return {cc.GLProgram}\n         */\n        getShaderProgram: function () {\n            return this.shaderProgram;\n        },\n\n        /**\n         * set shader program used by drawAtPoint and drawInRect\n         * @param {cc.GLProgram} shaderProgram\n         */\n        setShaderProgram: function (shaderProgram) {\n            this.shaderProgram = shaderProgram;\n        },\n\n        /**\n         * whether or not the texture has their Alpha premultiplied\n         * @return {Boolean}\n         */\n        hasPremultipliedAlpha: function () {\n            return this._hasPremultipliedAlpha;\n        },\n\n        /**\n         * whether or not use mipmap\n         * @return {Boolean}\n         */\n        hasMipmaps: function () {\n            return this._hasMipmaps;\n        },\n\n        /**\n         * description\n         * @return {string}\n         */\n        description: function () {\n            var _t = this;\n            return \"<cc.Texture2D | Name = \" + _t._name + \" | Dimensions = \" + _t._pixelsWide + \" x \" + _t._pixelsHigh\n                + \" | Coordinates = (\" + _t.maxS + \", \" + _t.maxT + \")>\";\n        },\n\n        /**\n         * These functions are needed to create mutable textures\n         * @param {Array} data\n         */\n        releaseData: function (data) {\n            data = null;\n        },\n\n        keepData: function (data, length) {\n            //The texture data mustn't be saved because it isn't a mutable texture.\n            return data;\n        },\n\n        /**\n         * Intializes with a texture2d with data\n         * @param {Array} data\n         * @param {Number} pixelFormat\n         * @param {Number} pixelsWide\n         * @param {Number} pixelsHigh\n         * @param {cc.Size} contentSize\n         * @return {Boolean}\n         */\n        initWithData: function (data, pixelFormat, pixelsWide, pixelsHigh, contentSize) {\n            var self = this, tex2d = cc.Texture2D;\n            var gl = cc._renderContext;\n            var format = gl.RGBA, type = gl.UNSIGNED_BYTE;\n\n            var bitsPerPixel = cc.Texture2D._B[pixelFormat];\n\n            var bytesPerRow = pixelsWide * bitsPerPixel / 8;\n            if (bytesPerRow % 8 === 0) {\n                gl.pixelStorei(gl.UNPACK_ALIGNMENT, 8);\n            } else if (bytesPerRow % 4 === 0) {\n                gl.pixelStorei(gl.UNPACK_ALIGNMENT, 4);\n            } else if (bytesPerRow % 2 === 0) {\n                gl.pixelStorei(gl.UNPACK_ALIGNMENT, 2);\n            } else {\n                gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n            }\n\n            self._webTextureObj = gl.createTexture();\n            cc.glBindTexture2D(self);\n\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n            // Specify OpenGL texture image\n            switch (pixelFormat) {\n                case tex2d.PIXEL_FORMAT_RGBA8888:\n                    format = gl.RGBA;\n                    break;\n                case tex2d.PIXEL_FORMAT_RGB888:\n                    format = gl.RGB;\n                    break;\n                case tex2d.PIXEL_FORMAT_RGBA4444:\n                    type = gl.UNSIGNED_SHORT_4_4_4_4;\n                    break;\n                case tex2d.PIXEL_FORMAT_RGB5A1:\n                    type = gl.UNSIGNED_SHORT_5_5_5_1;\n                    break;\n                case tex2d.PIXEL_FORMAT_RGB565:\n                    type = gl.UNSIGNED_SHORT_5_6_5;\n                    break;\n                case tex2d.PIXEL_FORMAT_AI88:\n                    format = gl.LUMINANCE_ALPHA;\n                    break;\n                case tex2d.PIXEL_FORMAT_A8:\n                    format = gl.ALPHA;\n                    break;\n                case tex2d.PIXEL_FORMAT_I8:\n                    format = gl.LUMINANCE;\n                    break;\n                default:\n                    cc.assert(0, cc._LogInfos.Texture2D_initWithData);\n            }\n            gl.texImage2D(gl.TEXTURE_2D, 0, format, pixelsWide, pixelsHigh, 0, format, type, data);\n\n\n            self._contentSize.width = contentSize.width;\n            self._contentSize.height = contentSize.height;\n            self._pixelsWide = pixelsWide;\n            self._pixelsHigh = pixelsHigh;\n            self._pixelFormat = pixelFormat;\n            self.maxS = contentSize.width / pixelsWide;\n            self.maxT = contentSize.height / pixelsHigh;\n\n            self._hasPremultipliedAlpha = false;\n            self._hasMipmaps = false;\n            self.shaderProgram = cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);\n\n            self._textureLoaded = true;\n\n            return true;\n        },\n\n        /**\n         Drawing extensions to make it easy to draw basic quads using a CCTexture2D object.\n         These functions require gl.TEXTURE_2D and both gl.VERTEX_ARRAY and gl.TEXTURE_COORD_ARRAY client states to be enabled.\n         */\n\n        /**\n         * draws a texture at a given point\n         * @param {cc.Point} point\n         */\n        drawAtPoint: function (point) {\n            var self = this;\n            var coordinates = [\n                    0.0, self.maxT,\n                    self.maxS, self.maxT,\n                    0.0, 0.0,\n                    self.maxS, 0.0],\n                gl = cc._renderContext;\n\n            var width = self._pixelsWide * self.maxS,\n                height = self._pixelsHigh * self.maxT;\n\n            var vertices = [\n                point.x, point.y, 0.0,\n                width + point.x, point.y, 0.0,\n                point.x, height + point.y, 0.0,\n                width + point.x, height + point.y, 0.0];\n\n            self._glProgramState.apply();\n            self._glProgramState._glprogram.setUniformsForBuiltins();\n\n            cc.glBindTexture2D(self);\n\n            gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);\n            gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);\n            gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION, 2, gl.FLOAT, false, 0, vertices);\n            gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS, 2, gl.FLOAT, false, 0, coordinates);\n\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        },\n\n        /**\n         * draws a texture inside a rect\n         * @param {cc.Rect} rect\n         */\n        drawInRect: function (rect) {\n            var self = this;\n            var coordinates = [\n                0.0, self.maxT,\n                self.maxS, self.maxT,\n                0.0, 0.0,\n                self.maxS, 0.0];\n\n            var vertices = [rect.x, rect.y, /*0.0,*/\n                rect.x + rect.width, rect.y, /*0.0,*/\n                rect.x, rect.y + rect.height, /*0.0,*/\n                rect.x + rect.width, rect.y + rect.height        /*0.0*/];\n\n            self._glProgramState.apply();\n            self._glProgramState._glprogram.setUniformsForBuiltins();\n\n            cc.glBindTexture2D(self);\n\n            var gl = cc._renderContext;\n            gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);\n            gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);\n            gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION, 2, gl.FLOAT, false, 0, vertices);\n            gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS, 2, gl.FLOAT, false, 0, coordinates);\n\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        },\n\n        /**\n         Extensions to make it easy to create a CCTexture2D object from an image file.\n         Note that RGBA type textures will have their alpha premultiplied - use the blending mode (gl.ONE, gl.ONE_MINUS_SRC_ALPHA).\n         */\n\n        /**\n         * Initializes a texture from a UIImage object\n         * @param uiImage\n         * @return {Boolean}\n         */\n        initWithImage: function (uiImage) {\n            if (uiImage == null) {\n                cc.log(cc._LogInfos.Texture2D_initWithImage);\n                return false;\n            }\n\n            var imageWidth = uiImage.getWidth();\n            var imageHeight = uiImage.getHeight();\n\n            var maxTextureSize = cc.configuration.getMaxTextureSize();\n            if (imageWidth > maxTextureSize || imageHeight > maxTextureSize) {\n                cc.log(cc._LogInfos.Texture2D_initWithImage_2, imageWidth, imageHeight, maxTextureSize, maxTextureSize);\n                return false;\n            }\n            this._textureLoaded = true;\n\n            // always load premultiplied images\n            return this._initPremultipliedATextureWithImage(uiImage, imageWidth, imageHeight);\n        },\n\n        /**\n         * init with HTML element\n         * @param {HTMLImageElement|HTMLCanvasElement} element\n         */\n        initWithElement: function (element) {\n            if (!element)\n                return;\n            this._webTextureObj = cc._renderContext.createTexture();\n            this._htmlElementObj = element;\n            this._textureLoaded = true;\n            // Textures should be loaded with premultiplied alpha in order to avoid gray bleeding\n            // when semitransparent textures are interpolated (e.g. when scaled).\n            this._hasPremultipliedAlpha = true;\n        },\n\n        /**\n         * HTMLElement Object getter\n         * @return {HTMLElement}\n         */\n        getHtmlElementObj: function () {\n            return this._htmlElementObj;\n        },\n\n        /**\n         * whether texture is loaded\n         * @return {Boolean}\n         */\n        isLoaded: function () {\n            return this._textureLoaded;\n        },\n\n        /**\n         * handler of texture loaded event\n         * @param {Boolean} [premultiplied=false]\n         */\n        handleLoadedTexture: function (premultiplied) {\n            var self = this;\n            premultiplied =\n                (premultiplied !== undefined)\n                    ? premultiplied\n                    : self._hasPremultipliedAlpha;\n            // Not sure about this ! Some texture need to be updated even after loaded\n            if (!cc.game._rendererInitialized)\n                return;\n            if (!self._htmlElementObj)\n                return;\n            if (!self._htmlElementObj.width || !self._htmlElementObj.height)\n                return;\n\n            //upload image to buffer\n            var gl = cc._renderContext;\n\n            cc.glBindTexture2D(self);\n\n            gl.pixelStorei(gl.UNPACK_ALIGNMENT, 4);\n            if (premultiplied)\n                gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);\n\n            // Specify OpenGL texture image\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, self._htmlElementObj);\n\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n            self.shaderProgram = cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);\n            cc.glBindTexture2D(null);\n            if (premultiplied)\n                gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\n\n            var pixelsWide = self._htmlElementObj.width;\n            var pixelsHigh = self._htmlElementObj.height;\n\n            self._pixelsWide = self._contentSize.width = pixelsWide;\n            self._pixelsHigh = self._contentSize.height = pixelsHigh;\n            self._pixelFormat = cc.Texture2D.PIXEL_FORMAT_RGBA8888;\n            self.maxS = 1;\n            self.maxT = 1;\n\n            self._hasPremultipliedAlpha = premultiplied;\n            self._hasMipmaps = false;\n            if (window.ENABLE_IMAEG_POOL) {\n                self._htmlElementObj = null;\n            }\n\n            //dispatch load event to listener.\n            self.dispatchEvent(\"load\");\n        },\n\n        /**\n         Extensions to make it easy to create a cc.Texture2D object from a string of text.\n         Note that the generated textures are of type A8 - use the blending mode (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA).\n         */\n        /**\n         * Initializes a texture from a string with dimensions, alignment, font name and font size (note: initWithString does not support on HTML5)\n         * @param {String} text\n         * @param {String | cc.FontDefinition} fontName or fontDefinition\n         * @param {Number} fontSize\n         * @param {cc.Size} dimensions\n         * @param {Number} hAlignment\n         * @param {Number} vAlignment\n         * @return {Boolean}\n         */\n        initWithString: function (text, fontName, fontSize, dimensions, hAlignment, vAlignment) {\n            cc.log(cc._LogInfos.Texture2D_initWithString);\n            return null;\n        },\n\n        /**\n         * Initializes a texture from a ETC file  (note: initWithETCFile does not support on HTML5)\n         * @note Compatible to Cocos2d-x\n         * @param {String} file\n         * @return {Boolean}\n         */\n        initWithETCFile: function (file) {\n            cc.log(cc._LogInfos.Texture2D_initWithETCFile_2);\n            return false;\n        },\n\n        /**\n         * Initializes a texture from a PVR file\n         * @param {String} file\n         * @return {Boolean}\n         */\n        initWithPVRFile: function (file) {\n            cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2);\n            return false;\n        },\n\n        /**\n         Extensions to make it easy to create a cc.Texture2D object from a PVRTC file\n         Note that the generated textures don't have their alpha premultiplied - use the blending mode (gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA).\n         */\n        /**\n         * Initializes a texture from a PVRTC buffer\n         * @note compatible to cocos2d-iphone interface.\n         * @param {Array} data\n         * @param {Number} level\n         * @param {Number} bpp\n         * @param {Boolean} hasAlpha\n         * @param {Number} length\n         * @param {Number} pixelFormat\n         * @return {Boolean}\n         */\n        initWithPVRTCData: function (data, level, bpp, hasAlpha, length, pixelFormat) {\n            cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2);\n            return false;\n        },\n\n        /**\n         * sets the min filter, mag filter, wrap s and wrap t texture parameters. <br/>\n         * If the texture size is NPOT (non power of 2), then in can only use gl.CLAMP_TO_EDGE in gl.TEXTURE_WRAP_{S,T}.\n         * @param {Object|Number} texParams texParams object or minFilter\n         * @param {Number} [magFilter]\n         * @param {Number} [wrapS]\n         * @param {Number} [wrapT]\n         */\n        setTexParameters: function (texParams, magFilter, wrapS, wrapT) {\n            var _t = this;\n            var gl = cc._renderContext;\n\n            if (magFilter !== undefined)\n                texParams = {minFilter: texParams, magFilter: magFilter, wrapS: wrapS, wrapT: wrapT};\n\n            cc.assert((_t._pixelsWide === cc.NextPOT(_t._pixelsWide) && _t._pixelsHigh === cc.NextPOT(_t._pixelsHigh)) ||\n                (texParams.wrapS === gl.CLAMP_TO_EDGE && texParams.wrapT === gl.CLAMP_TO_EDGE),\n                \"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures\");\n\n            cc.glBindTexture2D(_t);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, texParams.minFilter);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, texParams.magFilter);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParams.wrapS);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParams.wrapT);\n        },\n\n        /**\n         * sets antialias texture parameters:              <br/>\n         *  - GL_TEXTURE_MIN_FILTER = GL_NEAREST           <br/>\n         *  - GL_TEXTURE_MAG_FILTER = GL_NEAREST\n         */\n        setAntiAliasTexParameters: function () {\n            var gl = cc._renderContext;\n\n            cc.glBindTexture2D(this);\n            if (!this._hasMipmaps)\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            else\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        },\n\n        /**\n         *  sets alias texture parameters:\n         *   GL_TEXTURE_MIN_FILTER = GL_NEAREST\n         *   GL_TEXTURE_MAG_FILTER = GL_NEAREST\n         */\n        setAliasTexParameters: function () {\n            var gl = cc._renderContext;\n\n            cc.glBindTexture2D(this);\n            if (!this._hasMipmaps)\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n            else\n                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST_MIPMAP_NEAREST);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        },\n\n        /**\n         *  Generates mipmap images for the texture.<br/>\n         *  It only works if the texture size is POT (power of 2).\n         */\n        generateMipmap: function () {\n            var _t = this;\n            cc.assert(_t._pixelsWide === cc.NextPOT(_t._pixelsWide) && _t._pixelsHigh === cc.NextPOT(_t._pixelsHigh), \"Mimpap texture only works in POT textures\");\n\n            cc.glBindTexture2D(_t);\n            cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D);\n            _t._hasMipmaps = true;\n        },\n\n        /**\n         * returns the pixel format.\n         * @return {String}\n         */\n        stringForFormat: function () {\n            return cc.Texture2D._M[this._pixelFormat];\n        },\n\n        /**\n         * returns the bits-per-pixel of the in-memory OpenGL texture\n         * @return {Number}\n         */\n        bitsPerPixelForFormat: function (format) {//TODO I want to delete the format argument, use this._pixelFormat\n            format = format || this._pixelFormat;\n            var value = cc.Texture2D._B[format];\n            if (value != null) return value;\n            cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat, format);\n            return -1;\n        },\n\n        _initPremultipliedATextureWithImage: function (uiImage, width, height) {\n            var tex2d = cc.Texture2D;\n            var tempData = uiImage.getData();\n            var inPixel32 = null;\n            var inPixel8 = null;\n            var outPixel16 = null;\n            var hasAlpha = uiImage.hasAlpha();\n            var imageSize = cc.size(uiImage.getWidth(), uiImage.getHeight());\n            var pixelFormat = tex2d.defaultPixelFormat;\n            var bpp = uiImage.getBitsPerComponent();\n\n            // compute pixel format\n            if (!hasAlpha) {\n                if (bpp >= 8) {\n                    pixelFormat = tex2d.PIXEL_FORMAT_RGB888;\n                } else {\n                    cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage);\n                    pixelFormat = tex2d.PIXEL_FORMAT_RGB565;\n                }\n            }\n\n            // Repack the pixel data into the right format\n            var i, length = width * height;\n\n            if (pixelFormat === tex2d.PIXEL_FORMAT_RGB565) {\n                if (hasAlpha) {\n                    // Convert \"RRRRRRRRRGGGGGGGGBBBBBBBBAAAAAAAA\" to \"RRRRRGGGGGGBBBBB\"\n                    tempData = new Uint16Array(width * height);\n                    inPixel32 = uiImage.getData();\n\n                    for (i = 0; i < length; ++i) {\n                        tempData[i] =\n                            ((((inPixel32[i] >> 0) & 0xFF) >> 3) << 11) | // R\n                            ((((inPixel32[i] >> 8) & 0xFF) >> 2) << 5) | // G\n                            ((((inPixel32[i] >> 16) & 0xFF) >> 3) << 0);    // B\n                    }\n                } else {\n                    // Convert \"RRRRRRRRRGGGGGGGGBBBBBBBB\" to \"RRRRRGGGGGGBBBBB\"\n                    tempData = new Uint16Array(width * height);\n                    inPixel8 = uiImage.getData();\n\n                    for (i = 0; i < length; ++i) {\n                        tempData[i] =\n                            (((inPixel8[i] & 0xFF) >> 3) << 11) | // R\n                            (((inPixel8[i] & 0xFF) >> 2) << 5) | // G\n                            (((inPixel8[i] & 0xFF) >> 3) << 0);    // B\n                    }\n                }\n            } else if (pixelFormat === tex2d.PIXEL_FORMAT_RGBA4444) {\n                // Convert \"RRRRRRRRRGGGGGGGGBBBBBBBBAAAAAAAA\" to \"RRRRGGGGBBBBAAAA\"\n                tempData = new Uint16Array(width * height);\n                inPixel32 = uiImage.getData();\n\n                for (i = 0; i < length; ++i) {\n                    tempData[i] =\n                        ((((inPixel32[i] >> 0) & 0xFF) >> 4) << 12) | // R\n                        ((((inPixel32[i] >> 8) & 0xFF) >> 4) << 8) | // G\n                        ((((inPixel32[i] >> 16) & 0xFF) >> 4) << 4) | // B\n                        ((((inPixel32[i] >> 24) & 0xFF) >> 4) << 0);  // A\n                }\n            } else if (pixelFormat === tex2d.PIXEL_FORMAT_RGB5A1) {\n                // Convert \"RRRRRRRRRGGGGGGGGBBBBBBBBAAAAAAAA\" to \"RRRRRGGGGGBBBBBA\"\n                tempData = new Uint16Array(width * height);\n                inPixel32 = uiImage.getData();\n\n                for (i = 0; i < length; ++i) {\n                    tempData[i] =\n                        ((((inPixel32[i] >> 0) & 0xFF) >> 3) << 11) | // R\n                        ((((inPixel32[i] >> 8) & 0xFF) >> 3) << 6) | // G\n                        ((((inPixel32[i] >> 16) & 0xFF) >> 3) << 1) | // B\n                        ((((inPixel32[i] >> 24) & 0xFF) >> 7) << 0);  // A\n                }\n            } else if (pixelFormat === tex2d.PIXEL_FORMAT_A8) {\n                // Convert \"RRRRRRRRRGGGGGGGGBBBBBBBBAAAAAAAA\" to \"AAAAAAAA\"\n                tempData = new Uint8Array(width * height);\n                inPixel32 = uiImage.getData();\n\n                for (i = 0; i < length; ++i) {\n                    tempData[i] = (inPixel32 >> 24) & 0xFF;  // A\n                }\n            }\n\n            if (hasAlpha && pixelFormat === tex2d.PIXEL_FORMAT_RGB888) {\n                // Convert \"RRRRRRRRRGGGGGGGGBBBBBBBBAAAAAAAA\" to \"RRRRRRRRGGGGGGGGBBBBBBBB\"\n                inPixel32 = uiImage.getData();\n                tempData = new Uint8Array(width * height * 3);\n\n                for (i = 0; i < length; ++i) {\n                    tempData[i * 3] = (inPixel32 >> 0) & 0xFF; // R\n                    tempData[i * 3 + 1] = (inPixel32 >> 8) & 0xFF; // G\n                    tempData[i * 3 + 2] = (inPixel32 >> 16) & 0xFF; // B\n                }\n            }\n\n            this.initWithData(tempData, pixelFormat, width, height, imageSize);\n\n            if (tempData != uiImage.getData())\n                tempData = null;\n\n            this._hasPremultipliedAlpha = uiImage.isPremultipliedAlpha();\n            return true;\n        },\n\n        /**\n         * add listener for loaded event\n         * @param {Function} callback\n         * @param {cc.Node} target\n         * @deprecated since 3.1, please use addEventListener instead\n         */\n        addLoadedEventListener: function (callback, target) {\n            this.addEventListener(\"load\", callback, target);\n        },\n\n        /**\n         * remove listener from listeners by target\n         * @param {cc.Node} target\n         */\n        removeLoadedEventListener: function (target) {\n            this.removeEventTarget(\"load\", target);\n        }\n    });\n};\n\ncc._tmp.WebGLTextureAtlas = function () {\n    var _p = cc.TextureAtlas.prototype;\n    _p._setupVBO = function () {\n        var _t = this;\n        var gl = cc._renderContext;\n        //create WebGLBuffer\n        _t._buffersVBO[0] = gl.createBuffer();\n        _t._buffersVBO[1] = gl.createBuffer();\n\n        _t._quadsWebBuffer = gl.createBuffer();\n        _t._mapBuffers();\n    };\n\n    _p._mapBuffers = function () {\n        var _t = this;\n        var gl = cc._renderContext;\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, _t._quadsWebBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, _t._quadsArrayBuffer, gl.DYNAMIC_DRAW);\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _t._buffersVBO[1]);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, _t._indices, gl.STATIC_DRAW);\n\n        //cc.checkGLErrorDebug();\n    };\n\n    /**\n     * <p>Draws n quads from an index (offset). <br />\n     * n + start can't be greater than the capacity of the atlas</p>\n     * @param {Number} n\n     * @param {Number} start\n     */\n    _p.drawNumberOfQuads = function (n, start) {\n        var _t = this;\n        start = start || 0;\n        if (0 === n || !_t.texture || !_t.texture.isLoaded())\n            return;\n\n        var gl = cc._renderContext;\n        cc.glBindTexture2D(_t.texture);\n\n        //\n        // Using VBO without VAO\n        //\n        //vertices\n        //gl.bindBuffer(gl.ARRAY_BUFFER, _t._buffersVBO[0]);\n        // XXX: update is done in draw... perhaps it should be done in a timer\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, _t._quadsWebBuffer);\n        if (_t.dirty) {\n            gl.bufferData(gl.ARRAY_BUFFER, _t._quadsArrayBuffer, gl.DYNAMIC_DRAW);\n            _t.dirty = false;\n        }\n\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);\n        gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);\n\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION, 3, gl.FLOAT, false, 24, 0);               // vertices\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR, 4, gl.UNSIGNED_BYTE, true, 24, 12);          // colors\n        gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS, 2, gl.FLOAT, false, 24, 16);            // tex coords\n\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _t._buffersVBO[1]);\n\n        if (cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP)\n            gl.drawElements(gl.TRIANGLE_STRIP, n * 6, gl.UNSIGNED_SHORT, start * 6 * _t._indices.BYTES_PER_ELEMENT);\n        else\n            gl.drawElements(gl.TRIANGLES, n * 6, gl.UNSIGNED_SHORT, start * 6 * _t._indices.BYTES_PER_ELEMENT);\n\n        cc.g_NumberOfDraws++;\n        //cc.checkGLErrorDebug();\n    };\n};\n\ncc._tmp.WebGLTextureCache = function () {\n    var _p = cc.textureCache;\n\n    _p.handleLoadedTexture = function (url, img) {\n        var locTexs = this._textures, tex, ext;\n        //remove judge(webgl)\n        if (!cc.game._rendererInitialized) {\n            locTexs = this._loadedTexturesBefore;\n        }\n        tex = locTexs[url];\n        if (!tex) {\n            tex = locTexs[url] = new cc.Texture2D();\n            tex.url = url;\n        }\n        tex.initWithElement(img);\n        ext = cc.path.extname(url);\n        if (ext === \".png\") {\n            tex.handleLoadedTexture(true);\n        }\n        else {\n            tex.handleLoadedTexture();\n        }\n        return tex;\n    };\n\n    /**\n     * <p>Returns a Texture2D object given an file image <br />\n     * If the file image was not previously loaded, it will create a new Texture2D <br />\n     *  object and it will return it. It will use the filename as a key.<br />\n     * Otherwise it will return a reference of a previously loaded image. <br />\n     * Supported image extensions: .png, .jpg, .gif</p>\n     * @param {String} url\n     * @param {Function} cb\n     * @param {Object} target\n     * @return {cc.Texture2D}\n     * @example\n     * //example\n     * cc.textureCache.addImage(\"hello.png\");\n     */\n    _p.addImage = function (url, cb, target) {\n        cc.assert(url, cc._LogInfos.Texture2D_addImage_2);\n\n        var locTexs = this._textures;\n        //remove judge(webgl)\n        if (!cc.game._rendererInitialized) {\n            locTexs = this._loadedTexturesBefore;\n        }\n        var tex = locTexs[url] || locTexs[cc.loader._getAliase(url)];\n        if (tex) {\n            if (tex.isLoaded()) {\n                cb && cb.call(target, tex);\n                return tex;\n            }\n            else {\n                tex.addEventListener(\"load\", function () {\n                    cb && cb.call(target, tex);\n                }, target);\n                return tex;\n            }\n        }\n\n        tex = locTexs[url] = new cc.Texture2D();\n        tex.url = url;\n        var basePath = cc.loader.getBasePath ? cc.loader.getBasePath() : cc.loader.resPath;\n        cc.loader.loadImg(cc.path.join(basePath || \"\", url), function (err, img) {\n            if (err)\n                return cb && cb.call(target, err);\n\n            var texResult = cc.textureCache.handleLoadedTexture(url, img);\n            cb && cb.call(target, texResult);\n        });\n\n        return tex;\n    };\n\n    _p.addImageAsync = _p.addImage;\n    _p = null;\n};\n"]}