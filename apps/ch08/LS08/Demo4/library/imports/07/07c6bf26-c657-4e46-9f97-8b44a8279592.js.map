{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/shape-nodes/assets/frameworks/cocos2d-html5/cocos2d/shape-nodes/CCDrawNode.js"],"names":["cc","DrawNode","Node","extend","_buffer","_blendFunc","_lineWidth","_drawColor","getBlendFunc","setBlendFunc","blendFunc","dst","undefined","src","setLineWidth","width","getLineWidth","setDrawColor","color","locDrawColor","r","g","b","a","getDrawColor","create","TYPE_DOT","TYPE_SEGMENT","TYPE_POLY","game","addEventListener","EVENT_RENDERER_INITED","pMultOut","pin","floatVar","pout","x","y","_renderType","RENDER_TYPE_CANVAS","_DrawNodeElement","type","verts","fillColor","lineWidth","lineColor","lineCap","isClosePolygon","isFill","isStroke","_t","prototype","_className","ctor","call","locCmd","_renderCmd","BlendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","init","_localBB","Rect","setLocalBB","rectorX","height","localBB","drawRect","origin","destination","vertices","p","element","push","drawCircle","center","radius","angle","segments","drawLineToCenter","coef","Math","PI","i","rads","j","cos","k","sin","drawQuadBezier","control","t","pow","drawCubicBezier","control1","control2","drawCatmullRom","points","drawCardinalSpline","config","tension","lt","deltaT","length","dt","newPos","cardinalSplineAt","getControlPointAt","drawDot","pos","drawDots","len","drawSegment","from","to","drawPoly_","drawPoly","vertsCopy","clear","_createRenderCmd","CanvasRenderCmd","RENDER_TYPE_WEBGL","_sharedBuffer","FLOAT_PER_VERTEX","VERTEX_BYTE","FLOAT_PER_TRIANGLE","TRIANGLE_BYTES","MAX_INCREMENT","_vertices","_from","_to","_color","Uint32Array","_n","_nw","_tw","_extrude","_bufferCapacity","_vertexCount","_offset","_occupiedSize","_f32Buffer","_ui32Buffer","_dirty","manualRelease","capacity","GlobalVertexBuffer","_renderContext","DRAWNODE_TOTAL_VERTICES","_shaderProgram","shaderCache","programForKey","SHADER_POSITION_LENGTHTEXTURECOLOR","onEnter","_ensureCapacity","onExit","release","freeBuffer","count","prev","prevOffset","request","max","min","offset","requestBuffer","Float32Array","data","last","dataArray","warn","_drawSegments","_render","gl","updateSubData","bindBuffer","ARRAY_BUFFER","vertexBuffer","enableVertexAttribArray","VERTEX_ATTRIB_POSITION","VERTEX_ATTRIB_COLOR","VERTEX_ATTRIB_TEX_COORDS","vertexAttribPointer","FLOAT","UNSIGNED_BYTE","drawArrays","TRIANGLES","incrementGLDraws","appendVertexData","u","v","f32Buffer","l","vertexCount","succeed","pNormalizeIn","v0x","v0y","u0","v0","v1x","v1y","u1","v1","v2x","v2y","u2","v2","v3x","v3y","u3","v3","v4x","v4y","u4","v4","v5x","v5y","u5","v5","v6x","v6y","u6","v6","v7x","v7y","u7","v7","borderWidth","borderColor","factor","offx","offy","outline","triangleCount","inset","off0x","off0y","off1x","off1y","bw","in0x","in0y","in1x","in1y","out0x","out0y","out1x","out1y","closePoly","WebGLRenderCmd"],"mappings":"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","file":"CCDrawNode.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/shape-nodes","sourcesContent":["/****************************************************************************\n Copyright (c) 2008-2010 Ricardo Quesada\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n Copyright (c) 2012 Scott Lembcke and Howling Moon Software\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * <p>CCDrawNode                                                <br/>\n * Node that draws dots, segments and polygons.                        <br/>\n * Faster than the \"drawing primitives\" since it draws everything in one single batch.</p>\n * @class\n * @name cc.DrawNode\n * @extends cc.Node\n */\ncc.DrawNode = cc.Node.extend(/** @lends cc.DrawNode# */{\n//TODO need refactor\n\n    _buffer: null,\n    _blendFunc: null,\n    _lineWidth: 1,\n    _drawColor: null,\n\n    /**\n     * Gets the blend func\n     * @returns {Object}\n     */\n    getBlendFunc: function () {\n        return this._blendFunc;\n    },\n\n    /**\n     * Set the blend func\n     * @param blendFunc\n     * @param dst\n     */\n    setBlendFunc: function (blendFunc, dst) {\n        if (dst === undefined) {\n            this._blendFunc.src = blendFunc.src;\n            this._blendFunc.dst = blendFunc.dst;\n        } else {\n            this._blendFunc.src = blendFunc;\n            this._blendFunc.dst = dst;\n        }\n    },\n\n    /**\n     * line width setter\n     * @param {Number} width\n     */\n    setLineWidth: function (width) {\n        this._lineWidth = width;\n    },\n\n    /**\n     * line width getter\n     * @returns {Number}\n     */\n    getLineWidth: function () {\n        return this._lineWidth;\n    },\n\n    /**\n     * draw color setter\n     * @param {cc.Color} color\n     */\n    setDrawColor: function (color) {\n        var locDrawColor = this._drawColor;\n        locDrawColor.r = color.r;\n        locDrawColor.g = color.g;\n        locDrawColor.b = color.b;\n        locDrawColor.a = (color.a == null) ? 255 : color.a;\n    },\n\n    /**\n     * draw color getter\n     * @returns {cc.Color}\n     */\n    getDrawColor: function () {\n        return cc.color(this._drawColor.r, this._drawColor.g, this._drawColor.b, this._drawColor.a);\n    }\n});\n\n/**\n * Creates a DrawNode\n * @deprecated since v3.0 please use `new cc.DrawNode()` instead.\n * @return {cc.DrawNode}\n */\ncc.DrawNode.create = function () {\n    return new cc.DrawNode();\n};\n\ncc.DrawNode.TYPE_DOT = 0;\ncc.DrawNode.TYPE_SEGMENT = 1;\ncc.DrawNode.TYPE_POLY = 2;\n\ncc.game.addEventListener(cc.game.EVENT_RENDERER_INITED, function () {\n\n    function pMultOut(pin, floatVar, pout) {\n        pout.x = pin.x * floatVar;\n        pout.y = pin.y * floatVar;\n    }\n\n    if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n\n        cc._DrawNodeElement = function (type, verts, fillColor, lineWidth, lineColor, lineCap, isClosePolygon, isFill, isStroke) {\n            var _t = this;\n            _t.type = type;\n            _t.verts = verts || null;\n            _t.fillColor = fillColor || null;\n            _t.lineWidth = lineWidth || 0;\n            _t.lineColor = lineColor || null;\n            _t.lineCap = lineCap || \"butt\";\n            _t.isClosePolygon = isClosePolygon || false;\n            _t.isFill = isFill || false;\n            _t.isStroke = isStroke || false;\n        };\n\n        cc.extend(cc.DrawNode.prototype, /** @lends cc.DrawNode# */{\n            _className: \"DrawNodeCanvas\",\n\n            /**\n             * <p>The cc.DrawNodeCanvas's constructor. <br/>\n             * This function will automatically be invoked when you create a node using new construction: \"var node = new cc.DrawNodeCanvas()\".<br/>\n             * Override it to extend its behavior, remember to call \"this._super()\" in the extended \"ctor\" function.</p>\n             */\n            ctor: function () {\n                cc.Node.prototype.ctor.call(this);\n                var locCmd = this._renderCmd;\n                locCmd._buffer = this._buffer = [];\n                locCmd._drawColor = this._drawColor = cc.color(255, 255, 255, 255);\n                locCmd._blendFunc = this._blendFunc = new cc.BlendFunc(cc.SRC_ALPHA, cc.ONE_MINUS_SRC_ALPHA);\n\n                this.init();\n                this._localBB = new cc.Rect();\n            },\n\n            setLocalBB: function (rectorX, y, width, height) {\n                var localBB = this._localBB;\n                if (y === undefined) {\n                    localBB.x = rectorX.x;\n                    localBB.y = rectorX.y;\n                    localBB.width = rectorX.width;\n                    localBB.height = rectorX.height;\n                } else {\n                    localBB.x = rectorX;\n                    localBB.y = y;\n                    localBB.width = width;\n                    localBB.height = height;\n                }\n            },\n            /**\n             * draws a rectangle given the origin and destination point measured in points.\n             * @param {cc.Point} origin\n             * @param {cc.Point} destination\n             * @param {cc.Color} fillColor\n             * @param {Number} lineWidth\n             * @param {cc.Color} lineColor\n             */\n            drawRect: function (origin, destination, fillColor, lineWidth, lineColor) {\n                lineWidth = (lineWidth == null) ? this._lineWidth : lineWidth;\n                lineColor = lineColor || this.getDrawColor();\n                if (lineColor.a == null)\n                    lineColor.a = 255;\n\n                var vertices = [\n                    origin,\n                    cc.p(destination.x, origin.y),\n                    destination,\n                    cc.p(origin.x, destination.y)\n                ];\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n                element.verts = vertices;\n                element.lineWidth = lineWidth;\n                element.lineColor = lineColor;\n                element.isClosePolygon = true;\n                element.isStroke = true;\n                element.lineCap = \"butt\";\n                element.fillColor = fillColor;\n                if (fillColor) {\n                    if (fillColor.a == null)\n                        fillColor.a = 255;\n                    element.isFill = true;\n                }\n                this._buffer.push(element);\n            },\n\n            /**\n             * draws a circle given the center, radius and number of segments.\n             * @override\n             * @param {cc.Point} center center of circle\n             * @param {Number} radius\n             * @param {Number} angle angle in radians\n             * @param {Number} segments\n             * @param {Boolean} drawLineToCenter\n             * @param {Number} lineWidth\n             * @param {cc.Color} color\n             */\n            drawCircle: function (center, radius, angle, segments, drawLineToCenter, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n\n                var coef = 2.0 * Math.PI / segments;\n                var vertices = [];\n                for (var i = 0; i <= segments; i++) {\n                    var rads = i * coef;\n                    var j = radius * Math.cos(rads + angle) + center.x;\n                    var k = radius * Math.sin(rads + angle) + center.y;\n                    vertices.push(cc.p(j, k));\n                }\n                if (drawLineToCenter) {\n                    vertices.push(cc.p(center.x, center.y));\n                }\n\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n                element.verts = vertices;\n                element.lineWidth = lineWidth;\n                element.lineColor = color;\n                element.isClosePolygon = true;\n                element.isStroke = true;\n                this._buffer.push(element);\n            },\n\n            /**\n             * draws a quad bezier path\n             * @override\n             * @param {cc.Point} origin\n             * @param {cc.Point} control\n             * @param {cc.Point} destination\n             * @param {Number} segments\n             * @param {Number} lineWidth\n             * @param {cc.Color} color\n             */\n            drawQuadBezier: function (origin, control, destination, segments, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n\n                var vertices = [], t = 0.0;\n                for (var i = 0; i < segments; i++) {\n                    var x = Math.pow(1 - t, 2) * origin.x + 2.0 * (1 - t) * t * control.x + t * t * destination.x;\n                    var y = Math.pow(1 - t, 2) * origin.y + 2.0 * (1 - t) * t * control.y + t * t * destination.y;\n                    vertices.push(cc.p(x, y));\n                    t += 1.0 / segments;\n                }\n                vertices.push(cc.p(destination.x, destination.y));\n\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n                element.verts = vertices;\n                element.lineWidth = lineWidth;\n                element.lineColor = color;\n                element.isStroke = true;\n                element.lineCap = \"round\";\n                this._buffer.push(element);\n            },\n\n            /**\n             * draws a cubic bezier path\n             * @override\n             * @param {cc.Point} origin\n             * @param {cc.Point} control1\n             * @param {cc.Point} control2\n             * @param {cc.Point} destination\n             * @param {Number} segments\n             * @param {Number} lineWidth\n             * @param {cc.Color} color\n             */\n            drawCubicBezier: function (origin, control1, control2, destination, segments, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n\n                var vertices = [], t = 0;\n                for (var i = 0; i < segments; i++) {\n                    var x = Math.pow(1 - t, 3) * origin.x + 3.0 * Math.pow(1 - t, 2) * t * control1.x + 3.0 * (1 - t) * t * t * control2.x + t * t * t * destination.x;\n                    var y = Math.pow(1 - t, 3) * origin.y + 3.0 * Math.pow(1 - t, 2) * t * control1.y + 3.0 * (1 - t) * t * t * control2.y + t * t * t * destination.y;\n                    vertices.push(cc.p(x, y));\n                    t += 1.0 / segments;\n                }\n                vertices.push(cc.p(destination.x, destination.y));\n\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n                element.verts = vertices;\n                element.lineWidth = lineWidth;\n                element.lineColor = color;\n                element.isStroke = true;\n                element.lineCap = \"round\";\n                this._buffer.push(element);\n            },\n\n            /**\n             * draw a CatmullRom curve\n             * @override\n             * @param {Array} points\n             * @param {Number} segments\n             * @param {Number} [lineWidth]\n             * @param {cc.Color} [color]\n             */\n            drawCatmullRom: function (points, segments, lineWidth, color) {\n                this.drawCardinalSpline(points, 0.5, segments, lineWidth, color);\n            },\n\n            /**\n             * draw a cardinal spline path\n             * @override\n             * @param {Array} config\n             * @param {Number} tension\n             * @param {Number} segments\n             * @param {Number} [lineWidth]\n             * @param {cc.Color} [color]\n             */\n            drawCardinalSpline: function (config, tension, segments, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n\n                var vertices = [], p, lt, deltaT = 1.0 / config.length;\n                for (var i = 0; i < segments + 1; i++) {\n                    var dt = i / segments;\n                    // border\n                    if (dt === 1) {\n                        p = config.length - 1;\n                        lt = 1;\n                    } else {\n                        p = 0 | (dt / deltaT);\n                        lt = (dt - deltaT * p) / deltaT;\n                    }\n\n                    // Interpolate\n                    var newPos = cc.cardinalSplineAt(\n                        cc.getControlPointAt(config, p - 1),\n                        cc.getControlPointAt(config, p - 0),\n                        cc.getControlPointAt(config, p + 1),\n                        cc.getControlPointAt(config, p + 2),\n                        tension, lt);\n                    vertices.push(newPos);\n                }\n\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n                element.verts = vertices;\n                element.lineWidth = lineWidth;\n                element.lineColor = color;\n                element.isStroke = true;\n                element.lineCap = \"round\";\n                this._buffer.push(element);\n            },\n\n            /**\n             * draw a dot at a position, with a given radius and color\n             * @param {cc.Point} pos\n             * @param {Number} radius\n             * @param {cc.Color} [color]\n             */\n            drawDot: function (pos, radius, color) {\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);\n                element.verts = [pos];\n                element.lineWidth = radius;\n                element.fillColor = color;\n                this._buffer.push(element);\n            },\n\n            /**\n             * draws an array of points.\n             * @override\n             * @param {Array} points point of array\n             * @param {Number} radius\n             * @param {cc.Color} [color]\n             */\n            drawDots: function (points, radius, color) {\n                if (!points || points.length == 0)\n                    return;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n                for (var i = 0, len = points.length; i < len; i++)\n                    this.drawDot(points[i], radius, color);\n            },\n\n            /**\n             * draw a segment with a radius and color\n             * @param {cc.Point} from\n             * @param {cc.Point} to\n             * @param {Number} [lineWidth]\n             * @param {cc.Color} [color]\n             */\n            drawSegment: function (from, to, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n                element.verts = [from, to];\n                element.lineWidth = lineWidth * 2;\n                element.lineColor = color;\n                element.isStroke = true;\n                element.lineCap = \"round\";\n                this._buffer.push(element);\n            },\n\n            /**\n             * draw a polygon with a fill color and line color without copying the vertex list\n             * @param {Array} verts\n             * @param {cc.Color|null} fillColor Fill color or `null` for a hollow polygon.\n             * @param {Number} [lineWidth]\n             * @param {cc.Color} [color]\n             */\n            drawPoly_: function (verts, fillColor, lineWidth, color) {\n                lineWidth = (lineWidth == null ) ? this._lineWidth : lineWidth;\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n                var element = new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);\n\n                element.verts = verts;\n                element.fillColor = fillColor;\n                element.lineWidth = lineWidth;\n                element.lineColor = color;\n                element.isClosePolygon = true;\n                element.isStroke = true;\n                element.lineCap = \"round\";\n                if (fillColor)\n                    element.isFill = true;\n                this._buffer.push(element);\n            },\n\n            /**\n             * draw a polygon with a fill color and line color, copying the vertex list\n             * @param {Array} verts\n             * @param {cc.Color|null} fillColor Fill color or `null` for a hollow polygon.\n             * @param {Number} [lineWidth]\n             * @param {cc.Color} [lineColor]\n             */\n            drawPoly: function (verts, fillColor, lineWidth, lineColor) {\n                var vertsCopy = [];\n                for (var i = 0; i < verts.length; i++) {\n                    vertsCopy.push(cc.p(verts[i].x, verts[i].y));\n                }\n                return this.drawPoly_(vertsCopy, fillColor, lineWidth, lineColor);\n            },\n\n            /**\n             * Clear the geometry in the node's buffer.\n             */\n            clear: function () {\n                this._buffer.length = 0;\n            },\n\n            _createRenderCmd: function () {\n                return new cc.DrawNode.CanvasRenderCmd(this);\n            }\n        });\n    }\n    else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n\n        // 9600 vertices by default configurable in ccConfig.js\n        // 20 is 2 float for position, 4 int for color and 2 float for uv\n        var _sharedBuffer = null;\n        var FLOAT_PER_VERTEX = 2 + 1 + 2;\n        var VERTEX_BYTE = FLOAT_PER_VERTEX * 4;\n        var FLOAT_PER_TRIANGLE = 3 * FLOAT_PER_VERTEX;\n        var TRIANGLE_BYTES = FLOAT_PER_TRIANGLE * 4;\n        var MAX_INCREMENT = 200;\n\n        var _vertices = [],\n            _from = cc.p(),\n            _to = cc.p(),\n            _color = new Uint32Array(1);\n\n        // Used in drawSegment\n        var _n = cc.p(), _t = cc.p(), _nw = cc.p(), _tw = cc.p(),\n            _extrude = [];\n\n        cc.extend(cc.DrawNode.prototype, {\n            _bufferCapacity: 0,\n            _vertexCount: 0,\n\n            _offset: 0,\n            _occupiedSize: 0,\n            _f32Buffer: null,\n            _ui32Buffer: null,\n\n            _dirty: false,\n            _className: \"DrawNodeWebGL\",\n\n            manualRelease: false,\n\n            ctor: function (capacity, manualRelease) {\n                cc.Node.prototype.ctor.call(this);\n\n                if (!_sharedBuffer) {\n                    _sharedBuffer = new GlobalVertexBuffer(cc._renderContext, cc.DRAWNODE_TOTAL_VERTICES * VERTEX_BYTE);\n                }\n\n                this._renderCmd._shaderProgram = cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR);\n                this._blendFunc = new cc.BlendFunc(cc.SRC_ALPHA, cc.ONE_MINUS_SRC_ALPHA);\n                this._drawColor = cc.color(255, 255, 255, 255);\n\n                this._bufferCapacity = capacity || 64;\n                this.manualRelease = manualRelease;\n\n                this._dirty = true;\n            },\n\n            onEnter: function () {\n                cc.Node.prototype.onEnter.call(this);\n                if (this._occupiedSize < this._bufferCapacity) {\n                    this._ensureCapacity(this._bufferCapacity);\n                }\n            },\n\n            onExit: function () {\n                if (!this.manualRelease) {\n                    this.release();\n                }\n                cc.Node.prototype.onExit.call(this);\n            },\n\n            release: function () {\n                if (this._occupiedSize > 0) {\n                    this._vertexCount = 0;\n                    _sharedBuffer.freeBuffer(this._offset, VERTEX_BYTE * this._occupiedSize);\n                    this._occupiedSize = 0;\n                }\n            },\n\n            _ensureCapacity: function (count) {\n                var _t = this;\n                var prev = _t._occupiedSize;\n                var prevOffset = _t._offset;\n                if (count > prev || _t._bufferCapacity > prev) {\n                    var request = Math.max(Math.min(prev + prev, MAX_INCREMENT), count, _t._bufferCapacity);\n                    // free previous buffer\n                    if (prev !== 0) {\n                        _sharedBuffer.freeBuffer(prevOffset, VERTEX_BYTE * prev);\n                        _t._occupiedSize = 0;\n                    }\n                    var offset = _t._offset = _sharedBuffer.requestBuffer(VERTEX_BYTE * request);\n                    if (offset >= 0) {\n                        _t._occupiedSize = _t._bufferCapacity = request;\n                        // 5 floats per vertex\n                        _t._f32Buffer = new Float32Array(_sharedBuffer.data, offset, FLOAT_PER_VERTEX * _t._occupiedSize);\n                        _t._ui32Buffer = new Uint32Array(_sharedBuffer.data, offset, FLOAT_PER_VERTEX * _t._occupiedSize);\n                        \n                        // Copy old data\n                        if (prev !== 0 && prevOffset !== offset) {\n                            // offset is in byte, we need to transform to float32 index\n                            var last = prevOffset / 4 + prev * FLOAT_PER_VERTEX;\n                            for (var i = offset / 4, j = prevOffset / 4; j < last; i++, j++) {\n                                _sharedBuffer.dataArray[i] = _sharedBuffer.dataArray[j];\n                            }\n                        }\n\n                        return true;\n                    }\n                    else {\n                        cc.warn('Failed to allocate buffer for DrawNode: buffer for ' + request + ' vertices requested');\n                        return false;\n                    }\n                }\n                else {\n                    return true;\n                }\n            },\n\n            drawRect: function (origin, destination, fillColor, lineWidth, lineColor) {\n                lineWidth = (lineWidth == null) ? this._lineWidth : lineWidth;\n                lineColor = lineColor || this._drawColor;\n                _vertices.length = 0;\n                _vertices.push(origin.x, origin.y, destination.x, origin.y, destination.x, destination.y, origin.x, destination.y);\n                if (fillColor == null)\n                    this._drawSegments(_vertices, lineWidth, lineColor, true);\n                else\n                    this.drawPoly(_vertices, fillColor, lineWidth, lineColor);\n                _vertices.length = 0;\n            },\n\n            drawCircle: function (center, radius, angle, segments, drawLineToCenter, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this._drawColor;\n                var coef = 2.0 * Math.PI / segments, i, len;\n                _vertices.length = 0;\n                for (i = 0; i <= segments; i++) {\n                    var rads = i * coef;\n                    var j = radius * Math.cos(rads + angle) + center.x;\n                    var k = radius * Math.sin(rads + angle) + center.y;\n                    _vertices.push(j, k);\n                }\n                if (drawLineToCenter)\n                    _vertices.push(center.x, center.y);\n\n                lineWidth *= 0.5;\n                for (i = 0, len = _vertices.length - 2; i < len; i += 2) {\n                    _from.x = _vertices[i];\n                    _from.y = _vertices[i + 1];\n                    _to.x = _vertices[i + 2];\n                    _to.y = _vertices[i + 3];\n                    this.drawSegment(_from, _to, lineWidth, color);\n                }\n                _vertices.length = 0;\n            },\n\n            drawQuadBezier: function (origin, control, destination, segments, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this._drawColor;\n                var t = 0.0;\n                _vertices.length = 0;\n                for (var i = 0; i < segments; i++) {\n                    var x = Math.pow(1 - t, 2) * origin.x + 2.0 * (1 - t) * t * control.x + t * t * destination.x;\n                    var y = Math.pow(1 - t, 2) * origin.y + 2.0 * (1 - t) * t * control.y + t * t * destination.y;\n                    _vertices.push(x, y);\n                    t += 1.0 / segments;\n                }\n                _vertices.push(destination.x, destination.y);\n                this._drawSegments(_vertices, lineWidth, color, false);\n                _vertices.length = 0;\n            },\n\n            drawCubicBezier: function (origin, control1, control2, destination, segments, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this._drawColor;\n                var t = 0;\n                _vertices.length = 0;\n                for (var i = 0; i < segments; i++) {\n                    var x = Math.pow(1 - t, 3) * origin.x + 3.0 * Math.pow(1 - t, 2) * t * control1.x + 3.0 * (1 - t) * t * t * control2.x + t * t * t * destination.x;\n                    var y = Math.pow(1 - t, 3) * origin.y + 3.0 * Math.pow(1 - t, 2) * t * control1.y + 3.0 * (1 - t) * t * t * control2.y + t * t * t * destination.y;\n                    _vertices.push(x, y);\n                    t += 1.0 / segments;\n                }\n                _vertices.push(destination.x, destination.y);\n                this._drawSegments(_vertices, lineWidth, color, false);\n                _vertices.length = 0;\n            },\n\n            drawCatmullRom: function (points, segments, lineWidth, color) {\n                this.drawCardinalSpline(points, 0.5, segments, lineWidth, color);\n            },\n\n            drawCardinalSpline: function (config, tension, segments, lineWidth, color) {\n                lineWidth = lineWidth || this._lineWidth;\n                color = color || this._drawColor;\n                var p, lt, deltaT = 1.0 / config.length;\n                _vertices.length = 0;\n\n                for (var i = 0; i < segments + 1; i++) {\n                    var dt = i / segments;\n\n                    // border\n                    if (dt === 1) {\n                        p = config.length - 1;\n                        lt = 1;\n                    } else {\n                        p = 0 | (dt / deltaT);\n                        lt = (dt - deltaT * p) / deltaT;\n                    }\n\n                    // Interpolate\n                    cc.cardinalSplineAt(\n                        cc.getControlPointAt(config, p - 1),\n                        cc.getControlPointAt(config, p - 0),\n                        cc.getControlPointAt(config, p + 1),\n                        cc.getControlPointAt(config, p + 2),\n                        tension, lt, _from);\n                    _vertices.push(_from.x, _from.y);\n                }\n\n                lineWidth *= 0.5;\n                for (var j = 0, len = _vertices.length - 2; j < len; j += 2) {\n                    _from.x = _vertices[j];\n                    _from.y = _vertices[j + 1];\n                    _to.x = _vertices[j + 2];\n                    _to.y = _vertices[j + 3];\n                    this.drawSegment(_from, _to, lineWidth, color);\n                }\n                _vertices.length = 0;\n            },\n\n            drawDots: function (points, radius, color) {\n                if (!points || points.length === 0)\n                    return;\n                color = color || this._drawColor;\n                for (var i = 0, len = points.length; i < len; i++) {\n                    this.drawDot(points[i], radius, color);\n                }\n            },\n\n            _render: function () {\n                var gl = cc._renderContext;\n                if (this._offset < 0 || this._vertexCount <= 0) {\n                    return;\n                }\n\n                if (this._dirty) {\n                    // bindBuffer is done in updateSubData\n                    _sharedBuffer.updateSubData(this._offset, this._f32Buffer);\n                    this._dirty = false;\n                }\n                else {\n                    gl.bindBuffer(gl.ARRAY_BUFFER, _sharedBuffer.vertexBuffer);\n                }\n\n                gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);\n                gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);\n                gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);\n\n                // vertex\n                gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION, 2, gl.FLOAT, false, VERTEX_BYTE, 0);\n                // color\n                gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR, 4, gl.UNSIGNED_BYTE, true, VERTEX_BYTE, 8);\n                // texcood\n                gl.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS, 2, gl.FLOAT, false, VERTEX_BYTE, 12);\n\n                gl.drawArrays(gl.TRIANGLES, this._offset / VERTEX_BYTE, this._vertexCount);\n                cc.incrementGLDraws(1);\n                //cc.checkGLErrorDebug();\n            },\n\n            appendVertexData: function (x, y, color, u, v) {\n                var f32Buffer = this._f32Buffer;\n                // Float offset = byte offset / 4 + vertex count * floats by vertex\n                var offset = this._vertexCount * FLOAT_PER_VERTEX;\n                f32Buffer[offset] = x;\n                f32Buffer[offset + 1] = y;\n                _color[0] = ((color.a << 24) | (color.b << 16) | (color.g << 8) | color.r);\n                this._ui32Buffer[offset + 2] = _color[0];\n                f32Buffer[offset + 3] = u;\n                f32Buffer[offset + 4] = v;\n                this._vertexCount++;\n            },\n\n            drawDot: function (pos, radius, color) {\n                color = color || this._drawColor;\n                if (color.a == null)\n                    color.a = 255;\n                var l = pos.x - radius,\n                    b = pos.y - radius,\n                    r = pos.x + radius,\n                    t = pos.y + radius;\n\n                var vertexCount = 2 * 3;\n                var succeed = this._ensureCapacity(this._vertexCount + vertexCount);\n                if (!succeed)\n                    return;\n\n                // lb, lt, rt, lb, rt, rb\n                this.appendVertexData(l, b, color, -1, -1);\n                this.appendVertexData(l, t, color, -1, 1);\n                this.appendVertexData(r, t, color, 1, 1);\n                this.appendVertexData(l, b, color, -1, -1);\n                this.appendVertexData(r, t, color, 1, 1);\n                this.appendVertexData(r, b, color, 1, -1);\n\n                this._dirty = true;\n            },\n\n            drawSegment: function (from, to, radius, color) {\n                color = color || this.getDrawColor();\n                if (color.a == null)\n                    color.a = 255;\n                radius = radius || (this._lineWidth * 0.5);\n                var vertexCount = 6 * 3;\n                var succeed = this._ensureCapacity(this._vertexCount + vertexCount);\n                if (!succeed)\n                    return;\n\n                var a = from, b = to;\n                // var n = normalize(perp(sub(b, a)))\n                _n.x = a.y - b.y; _n.y = b.x - a.x;\n                cc.pNormalizeIn(_n);\n                // var t = perp(n);\n                _t.x = -_n.y; _t.y = _n.x;\n                // var nw = mult(n, radius), tw = mult(t, radius);\n                pMultOut(_n, radius, _nw);\n                pMultOut(_t, radius, _tw);\n\n                // var v0 = sub(b, add(nw, tw)); uv0 = neg(add(n, t))\n                var v0x = b.x - _nw.x - _tw.x, v0y = b.y - _nw.y - _tw.y, u0 = -(_n.x + _t.x), v0 = -(_n.y + _t.y);\n                // var v1 = add(b, sub(nw, tw)); uv1 = sub(n, t)\n                var v1x = b.x + _nw.x - _tw.x, v1y = b.y + _nw.y - _tw.y, u1 = _n.x - _t.x, v1 = _n.y - _t.y;\n                // var v2 = sub(b, nw); uv2 = neg(n)\n                var v2x = b.x - _nw.x, v2y = b.y - _nw.y, u2 = -_n.x, v2 = -_n.y;\n                // var v3 = add(b, nw); uv3 = n\n                var v3x = b.x + _nw.x, v3y = b.y + _nw.y, u3 = _n.x, v3 = _n.y;\n                // var v4 = sub(a, nw); uv4 = neg(n)\n                var v4x = a.x - _nw.x, v4y = a.y - _nw.y, u4 = u2, v4 = v2;\n                // var v5 = add(a, nw); uv5 = n\n                var v5x = a.x + _nw.x, v5y = a.y + _nw.y, u5 = _n.x, v5 = _n.y;\n                // var v6 = sub(a, sub(nw, tw)); uv6 = sub(t, n)\n                var v6x = a.x - _nw.x + _tw.x, v6y = a.y - _nw.y + _tw.y, u6 = _t.x - _n.x, v6 = _t.y - _n.y;\n                // var v7 = add(a, add(nw, tw)); uv7 = add(n, t)\n                var v7x = a.x + _nw.x + _tw.x, v7y = a.y + _nw.y + _tw.y, u7 = _n.x + _t.x, v7 = _n.y + _t.y;\n\n                this.appendVertexData(v0x, v0y, color, u0, v0);\n                this.appendVertexData(v1x, v1y, color, u1, v1);\n                this.appendVertexData(v2x, v2y, color, u2, v2);\n\n                this.appendVertexData(v3x, v3y, color, u3, v3);\n                this.appendVertexData(v1x, v1y, color, u1, v1);\n                this.appendVertexData(v2x, v2y, color, u2, v2);\n\n                this.appendVertexData(v3x, v3y, color, u3, v3);\n                this.appendVertexData(v4x, v4y, color, u4, v4);\n                this.appendVertexData(v2x, v2y, color, u2, v2);\n\n                this.appendVertexData(v3x, v3y, color, u3, v3);\n                this.appendVertexData(v4x, v4y, color, u4, v4);\n                this.appendVertexData(v5x, v5y, color, u5, v5);\n\n                this.appendVertexData(v6x, v6y, color, u6, v6);\n                this.appendVertexData(v4x, v4y, color, u4, v4);\n                this.appendVertexData(v5x, v5y, color, u5, v5);\n\n                this.appendVertexData(v6x, v6y, color, u6, v6);\n                this.appendVertexData(v7x, v7y, color, u7, v7);\n                this.appendVertexData(v5x, v5y, color, u5, v5);\n                this._dirty = true;\n            },\n\n            drawPoly: function (verts, fillColor, borderWidth, borderColor) {\n                // Backward compatibility\n                if (typeof verts[0] === 'object') {\n                    _vertices.length = 0;\n                    for (var i = 0; i < verts.length; i++) {\n                        _vertices.push(verts[i].x, verts[i].y);\n                    }\n                    verts = _vertices;\n                }\n\n                if (fillColor == null) {\n                    this._drawSegments(verts, borderWidth, borderColor, true);\n                    return;\n                }\n                if (fillColor.a == null)\n                    fillColor.a = 255;\n                if (borderColor.a == null)\n                    borderColor.a = 255;\n                borderWidth = (borderWidth == null) ? this._lineWidth : borderWidth;\n                borderWidth *= 0.5;\n                var v0x, v0y, v1x, v1y, v2x, v2y,\n                    factor, offx, offy,\n                    i, count = verts.length;\n                _extrude.length = 0;\n                for (i = 0; i < count; i += 2) {\n                    v0x = verts[(i - 2 + count) % count];\n                    v0y = verts[(i - 1 + count) % count];\n                    v1x = verts[i];\n                    v1y = verts[i + 1];\n                    v2x = verts[(i + 2) % count];\n                    v2y = verts[(i + 3) % count];\n                    // var n1 = normalize(perp(sub(v1, v0)));\n                    // var n2 = normalize(perp(sub(v2, v1)));\n                    _n.x = v0y - v1y; _n.y = v1x - v0x;\n                    _nw.x = v1y - v2y; _nw.y = v2x - v1x;\n                    cc.pNormalizeIn(_n);\n                    cc.pNormalizeIn(_nw);\n                    // var offset = mult(add(n1, n2), 1.0 / (dot(n1, n2) + 1.0));\n                    factor = _n.x * _nw.x + _n.y * _nw.y + 1;\n                    offx = (_n.x + _nw.x) / factor;\n                    offy = (_n.y + _nw.y) / factor;\n                    // extrude[i] = {offset: offset, n: n2};\n                    _extrude.push(offx, offy, _nw.x, _nw.y);\n                }\n                // The actual input vertex count\n                count = count / 2;\n                var outline = (borderWidth > 0.0), triangleCount = 3 * count - 2, vertexCount = 3 * triangleCount;\n                var succeed = this._ensureCapacity(this._vertexCount + vertexCount);\n                if (!succeed)\n                    return;\n\n                var inset = (outline == false ? 0.5 : 0.0);\n                for (i = 0; i < count - 2; i++) {\n                    // v0 = sub(verts[0], multi(extrude[0].offset, inset));\n                    v0x = verts[0] - _extrude[0] * inset;\n                    v0y = verts[1] - _extrude[1] * inset;\n                    // v1 = sub(verts[i + 1], multi(extrude[i + 1].offset, inset));\n                    v1x = verts[i * 2 + 2] - _extrude[(i + 1) * 4] * inset;\n                    v1y = verts[i * 2 + 3] - _extrude[(i + 1) * 4 + 1] * inset;\n                    // v2 = sub(verts[i + 2], multi(extrude[i + 2].offset, inset));\n                    v2x = verts[i * 2 + 4] - _extrude[(i + 2) * 4] * inset;\n                    v2y = verts[i * 2 + 5] - _extrude[(i + 2) * 4 + 1] * inset;\n\n                    this.appendVertexData(v0x, v0y, fillColor, 0, 0);\n                    this.appendVertexData(v1x, v1y, fillColor, 0, 0);\n                    this.appendVertexData(v2x, v2y, fillColor, 0, 0);\n                }\n\n                var off0x, off0y, off1x, off1y,\n                    bw = outline ? borderWidth : 0.5,\n                    color = outline ? borderColor : fillColor,\n                    in0x, in0y, in1x, in1y, out0x, out0y, out1x, out1y;\n                for (i = 0; i < count; i++) {\n                    var j = (i + 1) % count;\n                    v0x = verts[i * 2];\n                    v0y = verts[i * 2 + 1];\n                    v1x = verts[j * 2];\n                    v1y = verts[j * 2 + 1];\n\n                    _n.x = _extrude[i * 4 + 2];\n                    _n.y = _extrude[i * 4 + 3];\n                    _nw.x = outline ? -_n.x : 0;\n                    _nw.y = outline ? -_n.y : 0;\n                    off0x = _extrude[i * 4];\n                    off0y = _extrude[i * 4 + 1];\n                    off1x = _extrude[j * 4];\n                    off1y = _extrude[j * 4 + 1];\n\n                    in0x = v0x - off0x * bw; in0y = v0y - off0y * bw;\n                    in1x = v1x - off1x * bw; in1y = v1y - off1y * bw;\n                    out0x = v0x + off0x * bw; out0y = v0y + off0y * bw;\n                    out1x = v1x + off1x * bw; out1y = v1y + off1y * bw;\n\n                    this.appendVertexData(in0x, in0y, color, _nw.x, _nw.y);\n                    this.appendVertexData(in1x, in1y, color, _nw.x, _nw.y);\n                    this.appendVertexData(out1x, out1y, color, _n.x, _n.y);\n\n                    this.appendVertexData(in0x, in0y, color, _nw.x, _nw.y);\n                    this.appendVertexData(out0x, out0y, color, _n.x, _n.y);\n                    this.appendVertexData(out1x, out1y, color, _n.x, _n.y);\n                }\n                _extrude.length = 0;\n                _vertices.length = 0;\n                this._dirty = true;\n            },\n\n            _drawSegments: function (verts, borderWidth, borderColor, closePoly) {\n                borderWidth = (borderWidth == null) ? this._lineWidth : borderWidth;\n                if (borderWidth <= 0)\n                    return;\n\n                borderColor = borderColor || this._drawColor;\n                if (borderColor.a == null)\n                    borderColor.a = 255;\n                borderWidth *= 0.5;\n\n                var v0x, v0y, v1x, v1y, v2x, v2y,\n                    factor, offx, offy,\n                    i, count = verts.length;\n                _extrude.length = 0;\n                for (i = 0; i < count; i += 2) {\n                    v0x = verts[(i - 2 + count) % count];\n                    v0y = verts[(i - 1 + count) % count];\n                    v1x = verts[i];\n                    v1y = verts[i + 1];\n                    v2x = verts[(i + 2) % count];\n                    v2y = verts[(i + 3) % count];\n                    // var n1 = normalize(perp(sub(v1, v0)));\n                    // var n2 = normalize(perp(sub(v2, v1)));\n                    _n.x = v0y - v1y; _n.y = v1x - v0x;\n                    _nw.x = v1y - v2y; _nw.y = v2x - v1x;\n                    cc.pNormalizeIn(_n);\n                    cc.pNormalizeIn(_nw);\n                    // var offset = multi(add(n1, n2), 1.0 / (dot(n1, n2) + 1.0));\n                    factor = _n.x * _nw.x + _n.y * _nw.y + 1;\n                    offx = (_n.x + _nw.x) / factor;\n                    offy = (_n.y + _nw.y) / factor;\n                    // extrude[i] = {offset: offset, n: n2};\n                    _extrude.push(offx, offy, _nw.x, _nw.y);\n                }\n\n                // The actual input vertex count\n                count = count / 2;\n                var triangleCount = 3 * count - 2, vertexCount = 3 * triangleCount;\n                var succeed = this._ensureCapacity(this._vertexCount + vertexCount);\n                if (!succeed)\n                    return;\n\n                var len = closePoly ? count : count - 1,\n                    off0x, off0y, off1x, off1y,\n                    in0x, in0y, in1x, in1y, out0x, out0y, out1x, out1y;\n                for (i = 0; i < len; i++) {\n                    var j = (i + 1) % count;\n                    v0x = verts[i * 2];\n                    v0y = verts[i * 2 + 1];\n                    v1x = verts[j * 2];\n                    v1y = verts[j * 2 + 1];\n\n                    _n.x = _extrude[i * 4 + 2];\n                    _n.y = _extrude[i * 4 + 3];\n                    off0x = _extrude[i * 4];\n                    off0y = _extrude[i * 4 + 1];\n                    off1x = _extrude[j * 4];\n                    off1y = _extrude[j * 4 + 1];\n                    in0x = v0x - off0x * borderWidth; in0y = v0y - off0y * borderWidth;\n                    in1x = v1x - off1x * borderWidth; in1y = v1y - off1y * borderWidth;\n                    out0x = v0x + off0x * borderWidth; out0y = v0y + off0y * borderWidth;\n                    out1x = v1x + off1x * borderWidth; out1y = v1y + off1y * borderWidth;\n\n                    this.appendVertexData(in0x, in0y, borderColor, -_n.x, -_n.y);\n                    this.appendVertexData(in1x, in1y, borderColor, -_n.x, -_n.y);\n                    this.appendVertexData(out1x, out1y, borderColor, _n.x, _n.y);\n\n                    this.appendVertexData(in0x, in0y, borderColor, -_n.x, -_n.y);\n                    this.appendVertexData(out0x, out0y, borderColor, _n.x, _n.y);\n                    this.appendVertexData(out1x, out1y, borderColor, _n.x, _n.y);\n                }\n                _extrude.length = 0;\n                this._dirty = true;\n            },\n\n            clear: function () {\n                this.release();\n                this._dirty = true;\n            },\n\n            _createRenderCmd: function () {\n                return new cc.DrawNode.WebGLRenderCmd(this);\n            }\n        });\n    }\n});\n"]}