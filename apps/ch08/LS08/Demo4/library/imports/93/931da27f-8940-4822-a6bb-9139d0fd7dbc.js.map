{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/uiwidgets/assets/frameworks/cocos2d-html5/extensions/ccui/uiwidgets/UIWebView.js"],"names":["ccui","WebView","Widget","extend","ctor","path","prototype","call","_EventList","loadURL","visit","cmd","_renderCmd","div","_div","container","cc","eventManager","_visible","appendChild","_listener","addCustomListener","game","EVENT_RESIZE","resize","hasChild","contains","compareDocumentPosition","removeChild","list","_listenersMap","getFixedPriorityListeners","_removeListenerInVector","updateStatus","view","setJavascriptInterfaceScheme","scheme","loadData","data","MIMEType","encoding","baseURL","loadHTMLString","string","url","updateURL","_dispatchEvent","EventType","LOADING","stopLoading","log","reload","iframe","_iframe","win","contentWindow","location","canGoBack","canGoForward","goBack","_polyfill","closeHistory","history","back","error","err","goForward","forward","evaluateJS","str","eval","JS_EVALUATED","console","setScalesPageToFit","setEventListener","event","callback","removeEventListener","src","_createRenderCmd","RenderCmd","setContentSize","w","h","undefined","height","width","changeSize","cleanup","removeDom","stopAllActions","unscheduleAllCallbacks","LOADED","ERROR","polyfill","devicePixelRatio","enableDiv","sys","os","OS_IOS","isMobile","browserType","BROWSER_TYPE_FIREFOX","enableBG","BROWSER_TYPE_IE","_renderType","RENDER_TYPE_WEBGL","Node","WebGLRenderCmd","CanvasRenderCmd","node","_rootCtor","document","createElement","style","addEventListener","overflow","initStyle","proto","Object","create","constructor","transform","parentCmd","recursive","originTransform","updateMatrix","_worldTransform","_scaleX","_scaleY","isRetinaEnabled","flags","_dirtyFlags","locFlag","_dirtyFlag","transformDirty","getParentRenderCmd","orderDirty","_node","_parent","t","scaleX","scaleY","dpr","getDevicePixelRatio","_loaded","containerStyle","offsetX","parseInt","paddingLeft","offsetY","paddingBottom","cw","_contentSize","ch","a","b","c","d","tx","ty","matrix","position","bottom","left","self","cb"],"mappings":"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","file":"UIWebView.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/uiwidgets","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n * @class\n * @extends ccui.Widget\n * @brief A View that displays web pages.\n *\n * @note WebView displays web pages based on DOM element\n * WebView will be rendered above all other graphical elements.\n *\n * @property {String}   path - The url to be shown in the web view\n */\nccui.WebView = ccui.Widget.extend(/** @lends ccui.WebView# */{\n\n    ctor: function (path) {\n        ccui.Widget.prototype.ctor.call(this);\n        this._EventList = {};\n        if (path)\n            this.loadURL(path);\n    },\n\n    visit: function () {\n        var cmd = this._renderCmd,\n            div = cmd._div,\n            container = cc.container,\n            eventManager = cc.eventManager;\n        if (this._visible) {\n            container.appendChild(div);\n            if (this._listener === null)\n                this._listener = eventManager.addCustomListener(cc.game.EVENT_RESIZE, function () {\n                    cmd.resize();\n                });\n        } else {\n            var hasChild = false;\n            if ('contains' in container) {\n                hasChild = container.contains(div);\n            } else {\n                hasChild = container.compareDocumentPosition(div) % 16;\n            }\n            if (hasChild)\n                container.removeChild(div);\n            var list = eventManager._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();\n            eventManager._removeListenerInVector(list, cmd._listener);\n            cmd._listener = null;\n        }\n        cmd.updateStatus();\n        cmd.resize(cc.view);\n    },\n\n    setJavascriptInterfaceScheme: function (scheme) {\n    },\n    loadData: function (data, MIMEType, encoding, baseURL) {\n    },\n    loadHTMLString: function (string, baseURL) {\n    },\n\n\n    /**\n     * Load an URL\n     * @param {String} url\n     */\n    loadURL: function (url) {\n        this._renderCmd.updateURL(url);\n        this._dispatchEvent(ccui.WebView.EventType.LOADING);\n    },\n\n    /**\n     * Stop loading\n     */\n    stopLoading: function () {\n        cc.log(\"Web does not support loading\");\n    },\n\n    /**\n     * Reload the WebView\n     */\n    reload: function () {\n        var iframe = this._renderCmd._iframe;\n        if (iframe) {\n            var win = iframe.contentWindow;\n            if (win && win.location)\n                win.location.reload();\n        }\n    },\n\n    /**\n     * Determine whether to go back\n     */\n    canGoBack: function () {\n        cc.log(\"Web does not support query history\");\n        return true;\n    },\n\n    /**\n     * Determine whether to go forward\n     */\n    canGoForward: function () {\n        cc.log(\"Web does not support query history\");\n        return true;\n    },\n\n    /**\n     * go back\n     */\n    goBack: function () {\n        try {\n            if (ccui.WebView._polyfill.closeHistory)\n                return cc.log(\"The current browser does not support the GoBack\");\n            var iframe = this._renderCmd._iframe;\n            if (iframe) {\n                var win = iframe.contentWindow;\n                if (win && win.location)\n                    try {\n                        win.history.back.call(win);\n                    } catch (error) {\n                        win.history.back();\n                    }\n            }\n        } catch (err) {\n            cc.log(err);\n        }\n    },\n\n    /**\n     * go forward\n     */\n    goForward: function () {\n        try {\n            if (ccui.WebView._polyfill.closeHistory)\n                return cc.log(\"The current browser does not support the GoForward\");\n            var iframe = this._renderCmd._iframe;\n            if (iframe) {\n                var win = iframe.contentWindow;\n                if (win && win.location)\n                    try {\n                        win.history.forward.call(win);\n                    } catch (error) {\n                        win.history.forward();\n                    }\n            }\n        } catch (err) {\n            cc.log(err);\n        }\n    },\n\n    /**\n     * In the webview execution within a period of js string\n     * @param {String} str\n     */\n    evaluateJS: function (str) {\n        var iframe = this._renderCmd._iframe;\n        if (iframe) {\n            var win = iframe.contentWindow;\n            try {\n                win.eval(str);\n                this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED);\n            } catch (err) {\n                console.error(err);\n            }\n        }\n    },\n\n    /**\n     * Limited scale\n     */\n    setScalesPageToFit: function () {\n        cc.log(\"Web does not support zoom\");\n    },\n\n    /**\n     * The binding event\n     * @param {ccui.WebView.EventType} event\n     * @param {Function} callback\n     */\n    setEventListener: function (event, callback) {\n        this._EventList[event] = callback;\n    },\n\n    /**\n     * Delete events\n     * @param {ccui.WebView.EventType} event\n     */\n    removeEventListener: function (event) {\n        this._EventList[event] = null;\n    },\n\n    _dispatchEvent: function (event) {\n        var callback = this._EventList[event];\n        if (callback)\n            callback.call(this, this, this._renderCmd._iframe.src);\n    },\n\n    _createRenderCmd: function () {\n        return new ccui.WebView.RenderCmd(this);\n    },\n\n    /**\n     * Set the contentSize\n     * @param {Number} w\n     * @param {Number} h\n     */\n    setContentSize: function (w, h) {\n        ccui.Widget.prototype.setContentSize.call(this, w, h);\n        if (h === undefined) {\n            h = w.height;\n            w = w.width;\n        }\n        this._renderCmd.changeSize(w, h);\n    },\n\n    /**\n     * remove node\n     */\n    cleanup: function () {\n        this._renderCmd.removeDom();\n        this.stopAllActions();\n        this.unscheduleAllCallbacks();\n    }\n});\n\n/**\n * The WebView support list of events\n * @type {{LOADING: string, LOADED: string, ERROR: string}}\n */\nccui.WebView.EventType = {\n    LOADING: \"loading\",\n    LOADED: \"load\",\n    ERROR: \"error\",\n    JS_EVALUATED: \"js\"\n};\n\n(function () {\n\n    var polyfill = ccui.WebView._polyfill = {\n        devicePixelRatio: false,\n        enableDiv: false\n    };\n\n    if (cc.sys.os === cc.sys.OS_IOS)\n        polyfill.enableDiv = true;\n\n    if (cc.sys.isMobile) {\n        if (cc.sys.browserType === cc.sys.BROWSER_TYPE_FIREFOX) {\n            polyfill.enableBG = true;\n        }\n    } else {\n        if (cc.sys.browserType === cc.sys.BROWSER_TYPE_IE) {\n            polyfill.closeHistory = true;\n        }\n    }\n\n\n})();\n\n(function (polyfill) {\n\n    var RenderCmd = null;\n    if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n        RenderCmd = cc.Node.WebGLRenderCmd;\n    } else {\n        RenderCmd = cc.Node.CanvasRenderCmd;\n    }\n\n    ccui.WebView.RenderCmd = function (node) {\n        this._rootCtor(node);\n\n        this._div = null;\n        this._iframe = null;\n\n        if (polyfill.enableDiv) {\n            this._div = document.createElement(\"div\");\n            this._div.style[\"-webkit-overflow\"] = \"auto\";\n            this._div.style[\"-webkit-overflow-scrolling\"] = \"touch\";\n            this._iframe = document.createElement(\"iframe\");\n            this._iframe.style[\"width\"] = \"100%\";\n            this._iframe.style[\"height\"] = \"100%\";\n            this._div.appendChild(this._iframe);\n        } else {\n            this._div = this._iframe = document.createElement(\"iframe\");\n        }\n\n        if (polyfill.enableBG)\n            this._div.style[\"background\"] = \"#FFF\";\n\n        this._iframe.addEventListener(\"load\", function () {\n            node._dispatchEvent(ccui.WebView.EventType.LOADED);\n        });\n        this._iframe.addEventListener(\"error\", function () {\n            node._dispatchEvent(ccui.WebView.EventType.ERROR);\n        });\n        this._div.style[\"background\"] = \"#FFF\";\n        this._div.style.height = \"200px\";\n        this._div.style.width = \"300px\";\n        this._div.style.overflow = \"scroll\";\n        this._div.style[\"border\"] = \"none\";\n        this._listener = null;\n        this.initStyle();\n    };\n\n    var proto = ccui.WebView.RenderCmd.prototype = Object.create(RenderCmd.prototype);\n    proto.constructor = ccui.WebView.RenderCmd;\n\n    proto.transform = function (parentCmd, recursive) {\n        this.originTransform(parentCmd, recursive);\n        this.updateMatrix(this._worldTransform, cc.view._scaleX, cc.view._scaleY);\n    };\n\n    proto.updateStatus = function () {\n        polyfill.devicePixelRatio = cc.view.isRetinaEnabled();\n        var flags = cc.Node._dirtyFlags, locFlag = this._dirtyFlag;\n        if (locFlag & flags.transformDirty) {\n            //update the transform\n            this.transform(this.getParentRenderCmd(), true);\n            this.updateMatrix(this._worldTransform, cc.view._scaleX, cc.view._scaleY);\n            this._dirtyFlag = this._dirtyFlag & cc.Node._dirtyFlags.transformDirty ^ this._dirtyFlag;\n        }\n\n        if (locFlag & flags.orderDirty) {\n            this._dirtyFlag = this._dirtyFlag & flags.orderDirty ^ this._dirtyFlag;\n        }\n    };\n\n    proto.resize = function (view) {\n        view = view || cc.view;\n        var node = this._node,\n            eventManager = cc.eventManager;\n        if (node._parent && node._visible)\n            this.updateMatrix(this._worldTransform, view._scaleX, view._scaleY);\n        else {\n            var list = eventManager._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();\n            eventManager._removeListenerInVector(list, this._listener);\n            this._listener = null;\n        }\n    };\n\n    proto.updateMatrix = function (t, scaleX, scaleY) {\n        var node = this._node;\n        if (polyfill.devicePixelRatio) {\n            var dpr = cc.view.getDevicePixelRatio();\n            scaleX = scaleX / dpr;\n            scaleY = scaleY / dpr;\n        }\n        if (this._loaded === false) return;\n        var containerStyle = cc.game.container.style,\n            offsetX = parseInt(containerStyle.paddingLeft),\n            offsetY = parseInt(containerStyle.paddingBottom),\n            cw = node._contentSize.width,\n            ch = node._contentSize.height;\n        var a = t.a * scaleX,\n            b = t.b,\n            c = t.c,\n            d = t.d * scaleY,\n            tx = offsetX + t.tx * scaleX - cw / 2 + cw * node._scaleX / 2 * scaleX,\n            ty = offsetY + t.ty * scaleY - ch / 2 + ch * node._scaleY / 2 * scaleY;\n        var matrix = \"matrix(\" + a + \",\" + b + \",\" + c + \",\" + d + \",\" + tx + \",\" + -ty + \")\";\n        this._div.style[\"transform\"] = matrix;\n        this._div.style[\"-webkit-transform\"] = matrix;\n    };\n\n    proto.initStyle = function () {\n        if (!this._div)  return;\n        var div = this._div;\n        div.style.position = \"absolute\";\n        div.style.bottom = \"0px\";\n        div.style.left = \"0px\";\n    };\n\n    proto.updateURL = function (url) {\n        var iframe = this._iframe;\n        iframe.src = url;\n        var self = this;\n        var cb = function () {\n            self._loaded = true;\n            iframe.removeEventListener(\"load\", cb);\n        };\n        iframe.addEventListener(\"load\", cb);\n    };\n\n    proto.changeSize = function (w, h) {\n        var div = this._div;\n        if (div) {\n            div.style[\"width\"] = w + \"px\";\n            div.style[\"height\"] = h + \"px\";\n        }\n    };\n\n    proto.removeDom = function () {\n        var div = this._div;\n        if (div) {\n            var hasChild = false;\n            if ('contains' in cc.container) {\n                hasChild = cc.container.contains(div);\n            } else {\n                hasChild = cc.container.compareDocumentPosition(div) % 16;\n            }\n            if (hasChild)\n                cc.container.removeChild(div);\n        }\n    };\n\n})(ccui.WebView._polyfill);\n"]}