{"version":3,"sources":["../../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/utils/assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/utils/ScriptStore.js"],"names":["DevToolsUtils","noop","ScriptStore","_scripts","NoDeleteSet","prototype","addScript","script","add","addScripts","scripts","i","len","length","getSources","Set","items","map","s","source","getAllScripts","getScriptsBySourceActor","sourceActor","getScriptsBySource","getScriptsByURL","_originalUrl","getScriptsBySourceActorAndLine","line","getScriptsBySourceAndLine","getScriptsByURLAndLine","results","push","startLine","lineCount","url","_set","item","has"],"mappings":"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","file":"ScriptStore.js","sourceRoot":"../../../../../../../../../../../../assets/frameworks/cocos2d-x/cocos/scripting/js-bindings/script/debugger/actors/utils","sourcesContent":["/****************************************************************************\n Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.\n \n http://www.cocos2d-x.org\n \n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n \n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n \n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/* -*- indent-tabs-mode: nil; js-indent-level: 2; js-indent-level: 2 -*- */\n/* vim: set ft=javascript ts=2 et sw=2 tw=80: */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n\"use strict\";\n\nconst { noop } = DevToolsUtils;\n\n/**\n * A `ScriptStore` is a cache of `Debugger.Script` instances. It holds strong\n * references to the cached scripts to alleviate the GC-sensitivity issues that\n * plague `Debugger.prototype.findScripts`, but this means that its lifetime\n * must be managed carefully. It is the `ScriptStore` user's responsibility to\n * ensure that the `ScriptStore` stays up to date.\n *\n * Implementation Notes:\n *\n * The ScriptStore's prototype methods are very hot, in general. To help the\n * JIT, they avoid ES6-isms and higher-order iteration functions, for the most\n * part. You might be wondering why we don't maintain indices on, say,\n * Debugger.Source for faster querying, if these methods are so hot. First, the\n * hottest method is actually just getting all scripts; second, populating the\n * store becomes prohibitively expensive. So we fall back to linear queries\n * (which isn't so bad, because Debugger.prototype.findScripts is also linear).\n */\nfunction ScriptStore() {\n  // Set of every Debugger.Script in the cache.\n  this._scripts = new NoDeleteSet;\n}\n\n// module.exports = ScriptStore;\n\nScriptStore.prototype = {\n  // Populating a ScriptStore.\n\n  /**\n   * Add one script to the cache.\n   *\n   * @param Debugger.Script script\n   */\n  addScript: function(script) {\n    this._scripts.add(script);\n  },\n\n  /**\n   * Add many scripts to the cache at once.\n   *\n   * @param Array scripts\n   *        The set of Debugger.Scripts to add to the cache.\n   */\n  addScripts: function(scripts) {\n    for (var i = 0, len = scripts.length; i < len; i++) {\n      this.addScript(scripts[i]);\n    }\n  },\n\n  // Querying a ScriptStore.\n\n  /**\n   * Get all the sources for which we have scripts cached.\n   *\n   * @returns Array of Debugger.Source\n   */\n  getSources: function() {\n    return [...new Set(this._scripts.items.map(s => s.source))];\n  },\n\n  /**\n   * Get all the scripts in the cache.\n   *\n   * @returns read-only Array of Debugger.Script.\n   *\n   * NB: The ScriptStore retains ownership of the returned array, and the\n   * ScriptStore's consumers MUST NOT MODIFY its contents!\n   */\n  getAllScripts: function() {\n    return this._scripts.items;\n  },\n\n  getScriptsBySourceActor: function(sourceActor) {\n    return sourceActor.source ?\n           this.getScriptsBySource(sourceActor.source) :\n           this.getScriptsByURL(sourceActor._originalUrl);\n  },\n\n  getScriptsBySourceActorAndLine: function(sourceActor, line) {\n    return sourceActor.source ?\n           this.getScriptsBySourceAndLine(sourceActor.source, line) :\n           this.getScriptsByURLAndLine(sourceActor._originalUrl, line);\n  },\n\n  /**\n   * Get all scripts produced from the given source.\n   *\n   * @param Debugger.Source source\n   * @returns Array of Debugger.Script\n   */\n  getScriptsBySource: function(source) {\n    var results = [];\n    var scripts = this._scripts.items;\n    var length = scripts.length;\n    for (var i = 0; i < length; i++) {\n      if (scripts[i].source === source) {\n        results.push(scripts[i]);\n      }\n    }\n    return results;\n  },\n\n  /**\n   * Get all scripts produced from the given source whose source code definition\n   * spans the given line.\n   *\n   * @param Debugger.Source source\n   * @param Number line\n   * @returns Array of Debugger.Script\n   */\n  getScriptsBySourceAndLine: function(source, line) {\n    var results = [];\n    var scripts = this._scripts.items;\n    var length = scripts.length;\n    for (var i = 0; i < length; i++) {\n      var script = scripts[i];\n      if (script.source === source &&\n          script.startLine <= line &&\n          (script.startLine + script.lineCount) > line) {\n        results.push(script);\n      }\n    }\n    return results;\n  },\n\n  /**\n   * Get all scripts defined by a source at the given URL.\n   *\n   * @param String url\n   * @returns Array of Debugger.Script\n   */\n  getScriptsByURL: function(url) {\n    var results = [];\n    var scripts = this._scripts.items;\n    var length = scripts.length;\n    for (var i = 0; i < length; i++) {\n      if (scripts[i].url === url) {\n        results.push(scripts[i]);\n      }\n    }\n    return results;\n  },\n\n  /**\n   * Get all scripts defined by a source a the given URL and whose source code\n   * definition spans the given line.\n   *\n   * @param String url\n   * @param Number line\n   * @returns Array of Debugger.Script\n   */\n  getScriptsByURLAndLine: function(url, line) {\n    var results = [];\n    var scripts = this._scripts.items;\n    var length = scripts.length;\n    for (var i = 0; i < length; i++) {\n      var script = scripts[i];\n      if (script.url === url &&\n          script.startLine <= line &&\n          (script.startLine + script.lineCount) > line) {\n        results.push(script);\n      }\n    }\n    return results;\n  },\n};\n\n\n/**\n * A set which can only grow, and does not support the delete operation.\n * Provides faster iteration than the native Set by maintaining an array of all\n * items, in addition to the internal set of all items, which allows direct\n * iteration (without the iteration protocol and calling into C++, which are\n * both expensive).\n */\nfunction NoDeleteSet() {\n  this._set = new Set();\n  this.items = [];\n}\n\nNoDeleteSet.prototype = {\n  /**\n   * An array containing every item in the set for convenience and faster\n   * iteration. This is public for reading only, and consumers MUST NOT modify\n   * this array!\n   */\n  items: null,\n\n  /**\n   * Add an item to the set.\n   *\n   * @param any item\n   */\n  add: function(item) {\n    if (!this._set.has(item)) {\n      this._set.add(item);\n      this.items.push(item);\n    }\n  },\n\n  /**\n   * Return true if the item is in the set, false otherwise.\n   *\n   * @param any item\n   * @returns Boolean\n   */\n  has: function(item) {\n    return this._set.has(item);\n  }\n};\n"]}