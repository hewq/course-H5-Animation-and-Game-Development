{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library/assets/frameworks/cocos2d-html5/external/gaf/Library/GAFSpriteWebGLRenderCmd.js"],"names":["gaf","Sprite","WebGLRenderCmd","renderable","cc","call","_defualtShader","shaderCache","programForKey","SHADER_POSITION_TEXTURECOLOR","_customShader","_Shaders","Alpha","_tintMult","_tintOffset","_ctxMatrixBody","_ctxMatrixAppendix","proto","prototype","Object","create","constructor","_identityVec","_zeroVec","_identityMat","_disableCtx","setShaderProgram","_enableCtx","_applyCtxState","gafObject","tintMult","_cascadeColorMult","r","g","b","a","tintOffset","_cascadeColorOffset","filterStack","_filterStack","length","type","EFFECT_COLOR_MATRIX","m","colorMatrix","rr","rg","rb","ra","gr","gg","gb","ga","br","bg","bb","ba","ar","ag","ab","aa","_setUniforms","_shaderProgram","use","setUniformLocationWith4fv","_Uniforms","ColorTransformMult","ColorTransformOffset","setUniformLocationWithMatrix4fv","ColorMatrixBody","ColorMatrixAppendix","rendering","ctx"],"mappings":";;;;;;AACA,CAAC,YAAU;AACPA,QAAIC,MAAJ,CAAWC,cAAX,GAA4B,UAAUC,UAAV,EAAsB;AAC9CC,WAAGH,MAAH,CAAUC,cAAV,CAAyBG,IAAzB,CAA8B,IAA9B,EAAoCF,UAApC;AACA,aAAKG,cAAL,GAAsBF,GAAGG,WAAH,CAAeC,aAAf,CAA6BJ,GAAGK,4BAAhC,CAAtB;AACA,aAAKC,aAAL,GAAqBV,IAAIW,QAAJ,CAAaC,KAAlC;;AAEA;;AAEA,aAAKC,SAAL,GAAiB,IAAjB;AACA,aAAKC,WAAL,GAAmB,IAAnB;AACA,aAAKC,cAAL,GAAsB,IAAtB;AACA,aAAKC,kBAAL,GAA0B,IAA1B;AACH,KAXD;;AAaA,QAAIC,QAAQjB,IAAIC,MAAJ,CAAWC,cAAX,CAA0BgB,SAA1B,GAAsCC,OAAOC,MAAP,CAAchB,GAAGH,MAAH,CAAUC,cAAV,CAAyBgB,SAAvC,CAAlD;AACAD,UAAMI,WAAN,GAAoBrB,IAAIC,MAAJ,CAAWC,cAA/B;;AAEAe,UAAMK,YAAN,GAAqB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAArB;AACAL,UAAMM,QAAN,GAAiB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAAjB;AACAN,UAAMO,YAAN,GAAqB,CACjB,CADiB,EACd,CADc,EACX,CADW,EACR,CADQ,EAEjB,CAFiB,EAEd,CAFc,EAEX,CAFW,EAER,CAFQ,EAGjB,CAHiB,EAGd,CAHc,EAGX,CAHW,EAGR,CAHQ,EAIjB,CAJiB,EAId,CAJc,EAIX,CAJW,EAIR,CAJQ,CAArB;;AAOAP,UAAMQ,WAAN,GAAoB,YAAU;AAC1B,aAAKC,gBAAL,CAAsB,KAAKpB,cAA3B;AACH,KAFD;;AAIAW,UAAMU,UAAN,GAAmB,YAAU;AACzB,aAAKD,gBAAL,CAAsB,KAAKhB,aAA3B;AACH,KAFD;;AAIAO,UAAMW,cAAN,GAAuB,UAASC,SAAT,EAAmB;AACtC,YAAIC,WAAWD,UAAUE,iBAAzB;AACA,aAAKlB,SAAL,GAAiB,CACbiB,SAASE,CAAT,GAAa,GADA,EAEbF,SAASG,CAAT,GAAa,GAFA,EAGbH,SAASI,CAAT,GAAa,GAHA,EAIbJ,SAASK,CAAT,GAAa,GAJA,CAAjB;;AAOA,YAAIC,aAAaP,UAAUQ,mBAA3B;AACA,aAAKvB,WAAL,GAAmB,CACfsB,WAAWJ,CAAX,GAAe,GADA,EAEfI,WAAWH,CAAX,GAAe,GAFA,EAGfG,WAAWF,CAAX,GAAe,GAHA,EAIfE,WAAWD,CAAX,GAAe,GAJA,CAAnB;;AAOA,YAAIG,cAAcT,UAAUU,YAA5B;AACA,YAAGD,eAAeA,YAAYE,MAAZ,GAAqB,CAApC,IAAyCF,YAAY,CAAZ,EAAeG,IAAf,KAAwBzC,IAAI0C,mBAAxE,EACA;AACI,gBAAIC,IAAIL,YAAY,CAAZ,EAAeM,WAAvB;AACA,iBAAK7B,cAAL,GAAsB,CAClB4B,EAAEE,EADgB,EACZF,EAAEG,EADU,EACNH,EAAEI,EADI,EACAJ,EAAEK,EADF,EAElBL,EAAEM,EAFgB,EAEZN,EAAEO,EAFU,EAENP,EAAEQ,EAFI,EAEAR,EAAES,EAFF,EAGlBT,EAAEU,EAHgB,EAGZV,EAAEW,EAHU,EAGNX,EAAEY,EAHI,EAGAZ,EAAEa,EAHF,EAIlBb,EAAEc,EAJgB,EAIZd,EAAEe,EAJU,EAINf,EAAEgB,EAJI,EAIAhB,EAAEiB,EAJF,CAAtB;AAMA,iBAAK5C,kBAAL,GAA0B,CACtB2B,EAAEX,CAAF,GAAM,GADgB,EAEtBW,EAAEV,CAAF,GAAM,GAFgB,EAGtBU,EAAET,CAAF,GAAM,GAHgB,EAItBS,EAAER,CAAF,GAAM,GAJgB,CAA1B;AAMH,SAfD,MAiBA;AACI,iBAAKpB,cAAL,GAAsB,IAAtB;AACA,iBAAKC,kBAAL,GAA0B,IAA1B;AACH;AACJ,KAvCD;;AAyCAC,UAAM4C,YAAN,GAAqB,YACrB;AACI,YAAG,KAAKC,cAAL,KAAwB,KAAKpD,aAAhC,EACA;AACI,iBAAKoD,cAAL,CAAoBC,GAApB;AACA;AACI,qBAAKD,cAAL,CAAoBE,yBAApB,CACIhE,IAAIiE,SAAJ,CAAcC,kBADlB,EAEI,KAAKrD,SAFT,EAGI,CAHJ;AAKA,qBAAKiD,cAAL,CAAoBE,yBAApB,CACIhE,IAAIiE,SAAJ,CAAcE,oBADlB,EAEI,KAAKrD,WAFT,EAGI,CAHJ;AAKH;;AAED,gBAAG,KAAKC,cAAL,IAAuB,KAAKC,kBAA/B,EACA;AACI,qBAAK8C,cAAL,CAAoBM,+BAApB,CACIpE,IAAIiE,SAAJ,CAAcI,eADlB,EAEI,KAAKtD,cAFT,EAGI,CAHJ;AAKA,qBAAK+C,cAAL,CAAoBE,yBAApB,CACIhE,IAAIiE,SAAJ,CAAcK,mBADlB,EAEI,KAAKtD,kBAFT,EAGI,CAHJ;AAKH,aAZD,MAcA;AACI,qBAAK8C,cAAL,CAAoBM,+BAApB,CACIpE,IAAIiE,SAAJ,CAAcI,eADlB,EAEI,KAAK7C,YAFT,EAGI,CAHJ;AAKA,qBAAKsC,cAAL,CAAoBE,yBAApB,CACIhE,IAAIiE,SAAJ,CAAcK,mBADlB,EAEI,KAAK/C,QAFT,EAGI,CAHJ;AAKH;AACJ;AACJ,KA7CD;;AA+CAN,UAAMsD,SAAN,GAAkB,UAASC,GAAT,EAClB;AACI,aAAKX,YAAL;;AAEA;AACAzD,WAAGH,MAAH,CAAUC,cAAV,CAAyBgB,SAAzB,CAAmCqD,SAAnC,CAA6ClE,IAA7C,CAAkD,IAAlD,EAAwDmE,GAAxD;AACH,KAND;AAQH,CAlID","file":"GAFSpriteWebGLRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/external/gaf/Library","sourcesContent":["\n(function(){\n    gaf.Sprite.WebGLRenderCmd = function (renderable) {\n        cc.Sprite.WebGLRenderCmd.call(this, renderable);\n        this._defualtShader = cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);\n        this._customShader = gaf._Shaders.Alpha;\n\n        //this._shaderProgram = this._defualtShader;\n\n        this._tintMult = null;\n        this._tintOffset = null;\n        this._ctxMatrixBody = null;\n        this._ctxMatrixAppendix = null;\n    };\n\n    var proto = gaf.Sprite.WebGLRenderCmd.prototype = Object.create(cc.Sprite.WebGLRenderCmd.prototype);\n    proto.constructor = gaf.Sprite.WebGLRenderCmd;\n\n    proto._identityVec = [1.0, 1.0, 1.0, 1.0];\n    proto._zeroVec = [0.0, 0.0, 0.0, 0.0];\n    proto._identityMat = [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1\n    ];\n\n    proto._disableCtx = function(){\n        this.setShaderProgram(this._defualtShader);\n    };\n\n    proto._enableCtx = function(){\n        this.setShaderProgram(this._customShader);\n    };\n\n    proto._applyCtxState = function(gafObject){\n        var tintMult = gafObject._cascadeColorMult;\n        this._tintMult = [\n            tintMult.r / 255,\n            tintMult.g / 255,\n            tintMult.b / 255,\n            tintMult.a / 255\n        ];\n\n        var tintOffset = gafObject._cascadeColorOffset;\n        this._tintOffset = [\n            tintOffset.r / 255,\n            tintOffset.g / 255,\n            tintOffset.b / 255,\n            tintOffset.a / 255\n        ];\n\n        var filterStack = gafObject._filterStack;\n        if(filterStack && filterStack.length > 0 && filterStack[0].type === gaf.EFFECT_COLOR_MATRIX)\n        {\n            var m = filterStack[0].colorMatrix;\n            this._ctxMatrixBody = [\n                m.rr, m.rg, m.rb, m.ra,\n                m.gr, m.gg, m.gb, m.ga,\n                m.br, m.bg, m.bb, m.ba,\n                m.ar, m.ag, m.ab, m.aa\n            ];\n            this._ctxMatrixAppendix = [\n                m.r / 255,\n                m.g / 255,\n                m.b / 255,\n                m.a / 255\n            ];\n        }\n        else\n        {\n            this._ctxMatrixBody = null;\n            this._ctxMatrixAppendix = null;\n        }\n    };\n\n    proto._setUniforms = function()\n    {\n        if(this._shaderProgram === this._customShader)\n        {\n            this._shaderProgram.use();\n            {\n                this._shaderProgram.setUniformLocationWith4fv(\n                    gaf._Uniforms.ColorTransformMult,\n                    this._tintMult,\n                    1\n                );\n                this._shaderProgram.setUniformLocationWith4fv(\n                    gaf._Uniforms.ColorTransformOffset,\n                    this._tintOffset,\n                    1\n                );\n            }\n\n            if(this._ctxMatrixBody && this._ctxMatrixAppendix)\n            {\n                this._shaderProgram.setUniformLocationWithMatrix4fv(\n                    gaf._Uniforms.ColorMatrixBody,\n                    this._ctxMatrixBody,\n                    1\n                );\n                this._shaderProgram.setUniformLocationWith4fv(\n                    gaf._Uniforms.ColorMatrixAppendix,\n                    this._ctxMatrixAppendix,\n                    1\n                );\n            }\n            else\n            {\n                this._shaderProgram.setUniformLocationWithMatrix4fv(\n                    gaf._Uniforms.ColorMatrixBody,\n                    this._identityMat,\n                    1\n                );\n                this._shaderProgram.setUniformLocationWith4fv(\n                    gaf._Uniforms.ColorMatrixAppendix,\n                    this._zeroVec,\n                    1\n                );\n            }\n        }\n    };\n\n    proto.rendering = function(ctx)\n    {\n        this._setUniforms();\n\n        // Super call\n        cc.Sprite.WebGLRenderCmd.prototype.rendering.call(this, ctx);\n    };\n\n})();\n"]}