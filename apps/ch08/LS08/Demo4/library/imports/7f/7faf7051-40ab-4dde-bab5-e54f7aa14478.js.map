{"version":3,"sources":["../../../../../../../assets/frameworks/cocos2d-html5/extensions/spine/assets/frameworks/cocos2d-html5/extensions/spine/CCSkeletonCanvasRenderCmd.js"],"names":["spine","sp","Skeleton","CanvasRenderCmd","renderableObject","_rootCtor","_needDraw","proto","prototype","Object","create","cc","Node","constructor","rendering","wrapper","scaleX","scaleY","node","_node","i","n","slot","slotNode","_renderContext","locSkeleton","_skeleton","drawOrder","length","_slotNode","_visible","_renderCmd","currentSprite","transform","_dirtyFlag","_debugSlots","_debugBones","setTransform","_worldTransform","setGlobalAlpha","attachment","drawingUtil","_drawingUtil","setDrawColor","setLineWidth","points","slots","RegionAttachment","_updateRegionAttachmentSlot","drawPoly","bone","bones","x","data","a","worldX","y","c","worldY","drawLine","pointSize","drawPoint","updateStatus","originUpdateStatus","_updateCurrentRegions","_regionFlag","RegionStatus","DirtyDouble","_dirtyFlags","contentDirty","getLocalBB","getBoundingBox","vertices","Utils","setArraySize","Array","computeWorldVertices","VERTEX","push","p","OX1","OY1","OX4","OY4","OX3","OY3","OX2","OY2","_createChildFormSkeletonData","spriteName","sprite","region","name","_createSprite","currentSpriteName","addChild","MeshAttachment","loaded","texture","rendererObject","rect","Rect","width","height","initWithTexture","rotate","_rect","setContentSize","setRotation","rotation","setScale","originalWidth","originalHeight","getRealTexture","Sprite","isLoaded","addEventListener","sprites","_updateChild","color","_displayedColor","opacity","_displayedOpacity","selSprite","ax","ay","setVisible","undefined","offsetX","offsetY","offset","setPosition","b","d","getWorldScaleX","getWorldScaleY","_flippedX","skeleton","flipX","_flippedY","flipY","getWorldRotationX","r","g","setColor","_updateColor"],"mappings":"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","file":"CCSkeletonCanvasRenderCmd.js","sourceRoot":"../../../../../../../assets/frameworks/cocos2d-html5/extensions/spine","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n\nvar spine = sp.spine;\n\nsp.Skeleton.CanvasRenderCmd = function (renderableObject) {\n    this._rootCtor(renderableObject);\n    this._needDraw = true;\n};\n\nvar proto = sp.Skeleton.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\nproto.constructor = sp.Skeleton.CanvasRenderCmd;\n\nproto.rendering = function (wrapper, scaleX, scaleY) {\n    var node = this._node, i, n, slot, slotNode;\n    wrapper = wrapper || cc._renderContext;\n\n    var locSkeleton = node._skeleton, drawOrder = locSkeleton.drawOrder;\n    for (i = 0, n = drawOrder.length; i < n; i++) {\n        slot = drawOrder[i];\n        slotNode = slot._slotNode;\n        if (slotNode._visible && slotNode._renderCmd && slot.currentSprite) {\n            slotNode._renderCmd.transform(this, true);\n            slot.currentSprite._renderCmd.rendering(wrapper, scaleX, scaleY);\n            slotNode._renderCmd._dirtyFlag = slot.currentSprite._renderCmd._dirtyFlag = 0;\n        }\n    }\n\n    if (!node._debugSlots && !node._debugBones)\n        return;\n\n    wrapper.setTransform(this._worldTransform, scaleX, scaleY);\n    wrapper.setGlobalAlpha(1);\n    var attachment, drawingUtil = cc._drawingUtil;\n    if (node._debugSlots) {\n        // Slots.\n        drawingUtil.setDrawColor(0, 0, 255, 255);\n        drawingUtil.setLineWidth(1);\n\n        var points = [];\n        for (i = 0, n = locSkeleton.slots.length; i < n; i++) {\n            slot = locSkeleton.drawOrder[i];\n            if (!slot.attachment || !(slot.attachment instanceof spine.RegionAttachment))\n                continue;\n            attachment = slot.attachment;\n            this._updateRegionAttachmentSlot(attachment, slot, points);\n            drawingUtil.drawPoly(points, 4, true);\n        }\n    }\n\n    if (node._debugBones) {\n        // Bone lengths.\n        var bone;\n        drawingUtil.setLineWidth(2);\n        drawingUtil.setDrawColor(255, 0, 0, 255);\n\n        for (i = 0, n = locSkeleton.bones.length; i < n; i++) {\n            bone = locSkeleton.bones[i];\n            var x = bone.data.length * bone.a + bone.worldX;\n            var y = bone.data.length * bone.c + bone.worldY;\n            drawingUtil.drawLine(\n                {x: bone.worldX, y: bone.worldY},\n                {x: x, y: y});\n        }\n\n        // Bone origins.\n        var pointSize = 4;\n        drawingUtil.setDrawColor(0, 0, 255, 255); // Root bone is blue.\n\n        for (i = 0, n = locSkeleton.bones.length; i < n; i++) {\n            bone = locSkeleton.bones[i];\n            drawingUtil.drawPoint({x: bone.worldX, y: bone.worldY}, pointSize);\n            if (i === 0)\n                drawingUtil.setDrawColor(0, 255, 0, 255);\n        }\n    }\n};\n\nproto.updateStatus = function() {\n    this.originUpdateStatus();\n    this._updateCurrentRegions();\n    this._regionFlag = cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble;\n    this._dirtyFlag &= ~cc.Node._dirtyFlags.contentDirty;\n};\n\nproto.getLocalBB = function() {\n    return this._node.getBoundingBox();\n};\n\nproto._updateRegionAttachmentSlot = function (attachment, slot, points) {\n    if (!points)\n        return;\n\n    var vertices = spine.Utils.setArraySize(new Array(), 8, 0);\n    attachment.computeWorldVertices(slot.bone, vertices, 0, 2);\n    var VERTEX = spine.RegionAttachment;\n    points.length = 0;\n    points.push(cc.p(vertices[VERTEX.OX1], vertices[VERTEX.OY1]));\n    points.push(cc.p(vertices[VERTEX.OX4], vertices[VERTEX.OY4]));\n    points.push(cc.p(vertices[VERTEX.OX3], vertices[VERTEX.OY3]));\n    points.push(cc.p(vertices[VERTEX.OX2], vertices[VERTEX.OY2]));\n};\n\nproto._createChildFormSkeletonData = function () {\n    var node = this._node;\n    var locSkeleton = node._skeleton, spriteName, sprite;\n    for (var i = 0, n = locSkeleton.slots.length; i < n; i++) {\n        var slot = locSkeleton.slots[i], attachment = slot.attachment;\n        var slotNode = new cc.Node();\n        slot._slotNode = slotNode;\n\n        if (attachment instanceof spine.RegionAttachment) {\n            spriteName = attachment.region.name;\n            sprite = this._createSprite(slot, attachment);\n            slot.currentSprite = sprite;\n            slot.currentSpriteName = spriteName;\n            slotNode.addChild(sprite);\n        } else if (attachment instanceof spine.MeshAttachment) {\n            //todo for mesh\n        }\n    }\n};\n\nvar loaded = function (sprite, texture, attachment) {\n    var rendererObject = attachment.region;\n    var rect = new cc.Rect(rendererObject.x, rendererObject.y, rendererObject.width, rendererObject.height);\n    sprite.initWithTexture(texture, rect, rendererObject.rotate, false);\n    sprite._rect.width = attachment.width;\n    sprite._rect.height = attachment.height;\n    sprite.setContentSize(attachment.width, attachment.height);\n    sprite.setRotation(-attachment.rotation);\n    sprite.setScale(rendererObject.width / rendererObject.originalWidth * attachment.scaleX,\n        rendererObject.height / rendererObject.originalHeight * attachment.scaleY);\n};\n\nproto._createSprite = function (slot, attachment) {\n    var rendererObject = attachment.region;\n    var texture = rendererObject.texture.getRealTexture();\n    var sprite = new cc.Sprite();\n    if (texture.isLoaded()) {\n        loaded(sprite, texture, attachment);\n    } else {\n        texture.addEventListener('load', function () {\n            loaded(sprite, texture, attachment);\n        }, this);\n    }\n    slot.sprites = slot.sprites || {};\n    slot.sprites[rendererObject.name] = sprite;\n    return sprite;\n};\n\nproto._updateChild = function () {\n    var locSkeleton = this._node._skeleton, slots = locSkeleton.slots;\n    var color = this._displayedColor, opacity = this._displayedOpacity;\n    var i, n, selSprite, ax, ay;\n\n    var slot, attachment, slotNode;\n    for (i = 0, n = slots.length; i < n; i++) {\n        slot = slots[i];\n        attachment = slot.attachment;\n        slotNode = slot._slotNode;\n        if (!attachment) {\n            slotNode.setVisible(false);\n            continue;\n        }\n        if (attachment instanceof spine.RegionAttachment) {\n            if (attachment.region) {\n                if (!slot.currentSpriteName || slot.currentSpriteName !== attachment.name) {\n                    var spriteName = attachment.region.name;\n                    if (slot.currentSprite !== undefined)\n                        slot.currentSprite.setVisible(false);\n                    slot.sprites = slot.sprites || {};\n                    if (slot.sprites[spriteName] !== undefined)\n                        slot.sprites[spriteName].setVisible(true);\n                    else {\n                        var sprite = this._createSprite(slot, attachment);\n                        slotNode.addChild(sprite);\n                    }\n                    slot.currentSprite = slot.sprites[spriteName];\n                    slot.currentSpriteName = spriteName;\n                }\n            }\n            var bone = slot.bone;\n            if (attachment.region.offsetX === 0 && attachment.region.offsetY === 0) {\n                ax = attachment.x;\n                ay = attachment.y;\n            }\n            else {\n                //var regionScaleX = attachment.width / attachment.regionOriginalWidth * attachment.scaleX;\n                //ax = attachment.x + attachment.regionOffsetX * regionScaleX - (attachment.width * attachment.scaleX - attachment.regionWidth * regionScaleX) / 2;\n                ax = (attachment.offset[0] + attachment.offset[4]) * 0.5;\n                ay = (attachment.offset[1] + attachment.offset[5]) * 0.5;\n            }\n            slotNode.setPosition(bone.worldX + ax * bone.a + ay * bone.b, bone.worldY + ax * bone.c + ay * bone.d);\n            slotNode.setScale(bone.getWorldScaleX(), bone.getWorldScaleY());\n\n            //set the color and opacity\n            selSprite = slot.currentSprite;\n            selSprite._flippedX = bone.skeleton.flipX;\n            selSprite._flippedY = bone.skeleton.flipY;\n            if (selSprite._flippedY || selSprite._flippedX) {\n                slotNode.setRotation(bone.getWorldRotationX());\n                selSprite.setRotation(attachment.rotation);\n            } else {\n                slotNode.setRotation(-bone.getWorldRotationX());\n                selSprite.setRotation(-attachment.rotation);\n            }\n\n            //hack for sprite\n            selSprite._renderCmd._displayedOpacity = 0 | (opacity * slot.color.a);\n            var r = 0 | (color.r * slot.color.r), g = 0 | (color.g * slot.color.g), b = 0 | (color.b * slot.color.b);\n            selSprite.setColor(cc.color(r, g, b));\n            selSprite._renderCmd._updateColor();\n        } else if (attachment instanceof spine.MeshAttachment) {\n            // Can not render mesh\n        } else {\n            slotNode.setVisible(false);\n            continue;\n        }\n        slotNode.setVisible(true);\n    }\n};\n\n})();\n"]}