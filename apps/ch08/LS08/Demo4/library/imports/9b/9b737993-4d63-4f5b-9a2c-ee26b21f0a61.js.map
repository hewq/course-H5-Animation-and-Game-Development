{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/event-manager/assets/frameworks/cocos2d-html5/cocos2d/core/event-manager/CCEventManager.js"],"names":["cc","_EventListenerVector","Class","extend","_fixedListeners","_sceneGraphListeners","gt0Index","ctor","size","length","empty","push","listener","_getFixedPriority","clearSceneGraphListeners","clearFixedListeners","clear","getFixedPriorityListeners","getSceneGraphPriorityListeners","__getListenerID","event","eventType","Event","getType","_type","ACCELERATION","_EventListenerAcceleration","LISTENER_ID","CUSTOM","_eventName","KEYBOARD","_EventListenerKeyboard","MOUSE","_EventListenerMouse","FOCUS","_EventListenerFocus","TOUCH","log","_LogInfos","eventManager","DIRTY_NONE","DIRTY_FIXED_PRIORITY","DIRTY_SCENE_GRAPH_PRIORITY","DIRTY_ALL","_listenersMap","_priorityDirtyFlagMap","_nodeListenersMap","_nodePriorityMap","_globalZOrderNodeMap","_toAddedListeners","_toRemovedListeners","_dirtyNodes","_inDispatch","_isEnabled","_nodePriorityIndex","_internalCustomListenerIDs","game","EVENT_HIDE","EVENT_SHOW","_setDirtyForNode","node","__instanceId","_children","getChildren","i","len","pauseTarget","recursive","listeners","_setPaused","locChildren","resumeTarget","_addListener","_forceAddEventListener","listenerID","_getListenerID","_setDirty","_getSceneGraphPriority","eventManager__forceAddEventListener","_associateNodeAndEventListener","isRunning","_getListeners","_updateDirtyFlagForSceneGraph","locDirtyNodes","selListeners","selListener","locNodeListenersMap","j","listenersLen","_removeAllListenersInVector","listenerVector","_setRegistered","_dissociateNodeAndEventListener","_setSceneGraphPriority","arrayRemoveObject","_removeListenersForListenerID","fixedPriorityListeners","sceneGraphPriorityListeners","locToAddedListeners","_sortEventListeners","dirtyFlag","locFlagMap","_sortListenersOfFixedPriority","rootNode","director","getRunningScene","_sortListenersOfSceneGraphPriority","sceneGraphListener","_visitTarget","sort","_sortEventListenersOfSceneGraphPriorityDes","l1","l2","locNodePriorityMap","node1","node2","fixedListeners","_sortListenersOfFixedPriorityAsc","index","_onUpdateListeners","idx","toRemovedListeners","_isRegistered","indexOf","splice","frameUpdateListeners","locListenersMap","locPriorityDirtyFlagMap","selKey","_cleanToRemovedListeners","_updateTouchListeners","locInDispatch","assert","EventManager__updateListeners","_EventListenerTouchOneByOne","_EventListenerTouchAllAtOnce","EventManager__updateListeners_2","_onTouchEventCallback","argsObj","selTouch","_setCurrentTarget","_node","isClaimed","removedIdx","getCode","getEventCode","eventCode","EventTouch","EventCode","BEGAN","onTouchBegan","_registered","_claimedTouches","MOVED","onTouchMoved","ENDED","onTouchEnded","CANCELLED","onTouchCancelled","isStopped","swallowTouches","needsMutableSet","touches","_dispatchTouchEvent","oneByOneListeners","allAtOnceListeners","originalTouches","getTouches","mutableTouches","copyArray","oneByOneArgsObj","_dispatchEventToListeners","_onTouchesEventCallback","callbackParams","onTouchesBegan","onTouchesMoved","onTouchesEnded","onTouchesCancelled","onEvent","eventOrArgs","shouldStopPropagation","isEnabled","_isPaused","flag","locDirtyFlagMap","isRootNode","children","childrenCount","locGlobalZOrderNodeMap","child","getLocalZOrder","getGlobalZOrder","globalZOrders","_sortNumberAsc","zOrdersLen","selZOrders","a","b","addListener","nodeOrPriority","eventManager_addListener_2","EventListener","isNumber","eventManager_addListener_3","create","eventManager_addListener_4","checkAvailable","eventManager_addListener","_setFixedPriority","addCustomListener","eventName","callback","target","_EventListenerCustom","removeListener","isFound","locListener","_removeListenerInVector","_removeListenerInCallback","_onCustomEvent","_onEvent","removeListeners","listenerType","_t","Node","listenersCopy","TOUCH_ONE_BY_ONE","TOUCH_ALL_AT_ONCE","eventManager_removeListeners","removeCustomListeners","customEventName","removeAllListeners","locListeners","locInternalCustomEventIDs","setPriority","fixedPriority","found","eventManager_setPriority","setEnabled","enabled","dispatchEvent","Error","_onListenerCallback","dispatchCustomEvent","optionalUserData","ev","EventCustom","setUserData"],"mappings":"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","file":"CCEventManager.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/cocos2d/core/event-manager","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2015 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n\n/**\n * @ignore\n */\ncc._EventListenerVector = cc.Class.extend({\n    _fixedListeners: null,\n    _sceneGraphListeners: null,\n    gt0Index: 0,\n\n    ctor: function () {\n        this._fixedListeners = [];\n        this._sceneGraphListeners = [];\n    },\n\n    size: function () {\n        return this._fixedListeners.length + this._sceneGraphListeners.length;\n    },\n\n    empty: function () {\n        return (this._fixedListeners.length === 0) && (this._sceneGraphListeners.length === 0);\n    },\n\n    push: function (listener) {\n        if (listener._getFixedPriority() === 0)\n            this._sceneGraphListeners.push(listener);\n        else\n            this._fixedListeners.push(listener);\n    },\n\n    clearSceneGraphListeners: function () {\n        this._sceneGraphListeners.length = 0;\n    },\n\n    clearFixedListeners: function () {\n        this._fixedListeners.length = 0;\n    },\n\n    clear: function () {\n        this._sceneGraphListeners.length = 0;\n        this._fixedListeners.length = 0;\n    },\n\n    getFixedPriorityListeners: function () {\n        return this._fixedListeners;\n    },\n\n    getSceneGraphPriorityListeners: function () {\n        return this._sceneGraphListeners;\n    }\n});\n\nfunction __getListenerID (event) {\n    var eventType = cc.Event, getType = event._type;\n    if (getType === eventType.ACCELERATION)\n        return cc._EventListenerAcceleration.LISTENER_ID;\n    if (getType === eventType.CUSTOM)\n        return event._eventName;\n    if (getType === eventType.KEYBOARD)\n        return cc._EventListenerKeyboard.LISTENER_ID;\n    if (getType === eventType.MOUSE)\n        return cc._EventListenerMouse.LISTENER_ID;\n    if (getType === eventType.FOCUS)\n        return cc._EventListenerFocus.LISTENER_ID;\n    if (getType === eventType.TOUCH) {\n        // Touch listener is very special, it contains two kinds of listeners, EventListenerTouchOneByOne and EventListenerTouchAllAtOnce.\n        // return UNKNOWN instead.\n        cc.log(cc._LogInfos.__getListenerID);\n    }\n    return \"\";\n}\n\n/**\n * <p>\n *  cc.eventManager is a singleton object which manages event listener subscriptions and event dispatching. <br/>\n *                                                                                                              <br/>\n *  The EventListener list is managed in such way so that event listeners can be added and removed          <br/>\n *  while events are being dispatched.\n * </p>\n * @class\n * @name cc.eventManager\n */\ncc.eventManager = /** @lends cc.eventManager# */{\n    //Priority dirty flag\n    DIRTY_NONE: 0,\n    DIRTY_FIXED_PRIORITY: 1 << 0,\n    DIRTY_SCENE_GRAPH_PRIORITY: 1 << 1,\n    DIRTY_ALL: 3,\n\n    _listenersMap: {},\n    _priorityDirtyFlagMap: {},\n    _nodeListenersMap: {},\n    _nodePriorityMap: {},\n    _globalZOrderNodeMap: {},\n    _toAddedListeners: [],\n    _toRemovedListeners: [],\n    _dirtyNodes: [],\n    _inDispatch: 0,\n    _isEnabled: false,\n    _nodePriorityIndex: 0,\n\n    _internalCustomListenerIDs: [cc.game.EVENT_HIDE, cc.game.EVENT_SHOW],\n\n    _setDirtyForNode: function (node) {\n        // Mark the node dirty only when there is an event listener associated with it.\n        if (this._nodeListenersMap[node.__instanceId] != null)\n            this._dirtyNodes.push(node);\n        var _children = node.getChildren();\n        for(var i = 0, len = _children.length; i < len; i++)\n            this._setDirtyForNode(_children[i]);\n    },\n\n    /**\n     * Pauses all listeners which are associated the specified target.\n     * @param {cc.Node} node\n     * @param {Boolean} [recursive=false]\n     */\n    pauseTarget: function (node, recursive) {\n        var listeners = this._nodeListenersMap[node.__instanceId], i, len;\n        if (listeners) {\n            for (i = 0, len = listeners.length; i < len; i++)\n                listeners[i]._setPaused(true);\n        }\n        if (recursive === true) {\n            var locChildren = node.getChildren();\n            for (i = 0, len = locChildren.length; i < len; i++)\n                this.pauseTarget(locChildren[i], true);\n        }\n    },\n\n    /**\n     * Resumes all listeners which are associated the specified target.\n     * @param {cc.Node} node\n     * @param {Boolean} [recursive=false]\n     */\n    resumeTarget: function (node, recursive) {\n        var listeners = this._nodeListenersMap[node.__instanceId], i, len;\n        if (listeners) {\n            for (i = 0, len = listeners.length; i < len; i++)\n                listeners[i]._setPaused(false);\n        }\n        this._setDirtyForNode(node);\n        if (recursive === true) {\n            var locChildren = node.getChildren();\n            for (i = 0, len = locChildren.length; i< len; i++)\n                this.resumeTarget(locChildren[i], true);\n        }\n    },\n\n    _addListener: function (listener) {\n        if (this._inDispatch === 0)\n            this._forceAddEventListener(listener);\n        else\n            this._toAddedListeners.push(listener);\n    },\n\n    _forceAddEventListener: function (listener) {\n        var listenerID = listener._getListenerID();\n        var listeners = this._listenersMap[listenerID];\n        if (!listeners) {\n            listeners = new cc._EventListenerVector();\n            this._listenersMap[listenerID] = listeners;\n        }\n        listeners.push(listener);\n\n        if (listener._getFixedPriority() === 0) {\n            this._setDirty(listenerID, this.DIRTY_SCENE_GRAPH_PRIORITY);\n\n            var node = listener._getSceneGraphPriority();\n            if (node === null)\n                cc.log(cc._LogInfos.eventManager__forceAddEventListener);\n\n            this._associateNodeAndEventListener(node, listener);\n            if (node.isRunning())\n                this.resumeTarget(node);\n        } else\n            this._setDirty(listenerID, this.DIRTY_FIXED_PRIORITY);\n    },\n\n    _getListeners: function (listenerID) {\n        return this._listenersMap[listenerID];\n    },\n\n    _updateDirtyFlagForSceneGraph: function () {\n        if (this._dirtyNodes.length === 0)\n            return;\n\n        var locDirtyNodes = this._dirtyNodes, selListeners, selListener, locNodeListenersMap = this._nodeListenersMap;\n        for (var i = 0, len = locDirtyNodes.length; i < len; i++) {\n            selListeners = locNodeListenersMap[locDirtyNodes[i].__instanceId];\n            if (selListeners) {\n                for (var j = 0, listenersLen = selListeners.length; j < listenersLen; j++) {\n                    selListener = selListeners[j];\n                    if (selListener)\n                        this._setDirty(selListener._getListenerID(), this.DIRTY_SCENE_GRAPH_PRIORITY);\n                }\n            }\n        }\n        this._dirtyNodes.length = 0;\n    },\n\n    _removeAllListenersInVector: function (listenerVector) {\n        if (!listenerVector)\n            return;\n        var selListener;\n        for (var i = 0; i < listenerVector.length;) {\n            selListener = listenerVector[i];\n            selListener._setRegistered(false);\n            if (selListener._getSceneGraphPriority() != null) {\n                this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(), selListener);\n                selListener._setSceneGraphPriority(null);   // NULL out the node pointer so we don't have any dangling pointers to destroyed nodes.\n            }\n\n            if (this._inDispatch === 0)\n                cc.arrayRemoveObject(listenerVector, selListener);\n            else\n                ++i;\n        }\n    },\n\n    _removeListenersForListenerID: function (listenerID) {\n        var listeners = this._listenersMap[listenerID], i;\n        if (listeners) {\n            var fixedPriorityListeners = listeners.getFixedPriorityListeners();\n            var sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\n\n            this._removeAllListenersInVector(sceneGraphPriorityListeners);\n            this._removeAllListenersInVector(fixedPriorityListeners);\n\n            // Remove the dirty flag according the 'listenerID'.\n            // No need to check whether the dispatcher is dispatching event.\n            delete this._priorityDirtyFlagMap[listenerID];\n\n            if (!this._inDispatch) {\n                listeners.clear();\n            }\n            delete this._listenersMap[listenerID];\n        }\n\n        var locToAddedListeners = this._toAddedListeners, listener;\n        for (i = 0; i < locToAddedListeners.length;) {\n            listener = locToAddedListeners[i];\n            if (listener && listener._getListenerID() === listenerID)\n                cc.arrayRemoveObject(locToAddedListeners, listener);\n            else\n                ++i;\n        }\n    },\n\n    _sortEventListeners: function (listenerID) {\n        var dirtyFlag = this.DIRTY_NONE, locFlagMap = this._priorityDirtyFlagMap;\n        if (locFlagMap[listenerID])\n            dirtyFlag = locFlagMap[listenerID];\n\n        if (dirtyFlag !== this.DIRTY_NONE) {\n            // Clear the dirty flag first, if `rootNode` is null, then set its dirty flag of scene graph priority\n            locFlagMap[listenerID] = this.DIRTY_NONE;\n\n            if (dirtyFlag & this.DIRTY_FIXED_PRIORITY)\n                this._sortListenersOfFixedPriority(listenerID);\n\n            if (dirtyFlag & this.DIRTY_SCENE_GRAPH_PRIORITY) {\n                var rootNode = cc.director.getRunningScene();\n                if (rootNode)\n                    this._sortListenersOfSceneGraphPriority(listenerID, rootNode);\n                else\n                    locFlagMap[listenerID] = this.DIRTY_SCENE_GRAPH_PRIORITY;\n            }\n        }\n    },\n\n    _sortListenersOfSceneGraphPriority: function (listenerID, rootNode) {\n        var listeners = this._getListeners(listenerID);\n        if (!listeners)\n            return;\n\n        var sceneGraphListener = listeners.getSceneGraphPriorityListeners();\n        if (!sceneGraphListener || sceneGraphListener.length === 0)\n            return;\n\n        // Reset priority index\n        this._nodePriorityIndex = 0;\n        this._nodePriorityMap = {};\n\n        this._visitTarget(rootNode, true);\n\n        // After sort: priority < 0, > 0\n        listeners.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes);\n    },\n\n    _sortEventListenersOfSceneGraphPriorityDes: function (l1, l2) {\n        var locNodePriorityMap = cc.eventManager._nodePriorityMap, node1 = l1._getSceneGraphPriority(),\n            node2 = l2._getSceneGraphPriority();\n        if (!l2 || !node2 || !locNodePriorityMap[node2.__instanceId])\n            return -1;\n        else if (!l1 || !node1 || !locNodePriorityMap[node1.__instanceId])\n            return 1;\n        return locNodePriorityMap[l2._getSceneGraphPriority().__instanceId] - locNodePriorityMap[l1._getSceneGraphPriority().__instanceId];\n    },\n\n    _sortListenersOfFixedPriority: function (listenerID) {\n        var listeners = this._listenersMap[listenerID];\n        if (!listeners)\n            return;\n\n        var fixedListeners = listeners.getFixedPriorityListeners();\n        if (!fixedListeners || fixedListeners.length === 0)\n            return;\n        // After sort: priority < 0, > 0\n        fixedListeners.sort(this._sortListenersOfFixedPriorityAsc);\n\n        // FIXME: Should use binary search\n        var index = 0;\n        for (var len = fixedListeners.length; index < len;) {\n            if (fixedListeners[index]._getFixedPriority() >= 0)\n                break;\n            ++index;\n        }\n        listeners.gt0Index = index;\n    },\n\n    _sortListenersOfFixedPriorityAsc: function (l1, l2) {\n        return l1._getFixedPriority() - l2._getFixedPriority();\n    },\n\n    _onUpdateListeners: function (listeners) {\n        var fixedPriorityListeners = listeners.getFixedPriorityListeners();\n        var sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\n        var i, selListener, idx, toRemovedListeners = this._toRemovedListeners;\n\n        if (sceneGraphPriorityListeners) {\n            for (i = 0; i < sceneGraphPriorityListeners.length;) {\n                selListener = sceneGraphPriorityListeners[i];\n                if (!selListener._isRegistered()) {\n                    cc.arrayRemoveObject(sceneGraphPriorityListeners, selListener);\n                    // if item in toRemove list, remove it from the list\n                    idx = toRemovedListeners.indexOf(selListener);\n                    if(idx !== -1)\n                        toRemovedListeners.splice(idx, 1);\n                } else\n                    ++i;\n            }\n        }\n\n        if (fixedPriorityListeners) {\n            for (i = 0; i < fixedPriorityListeners.length;) {\n                selListener = fixedPriorityListeners[i];\n                if (!selListener._isRegistered()) {\n                    cc.arrayRemoveObject(fixedPriorityListeners, selListener);\n                    // if item in toRemove list, remove it from the list\n                    idx = toRemovedListeners.indexOf(selListener);\n                    if(idx !== -1)\n                        toRemovedListeners.splice(idx, 1);\n                } else\n                    ++i;\n            }\n        }\n\n        if (sceneGraphPriorityListeners && sceneGraphPriorityListeners.length === 0)\n            listeners.clearSceneGraphListeners();\n\n        if (fixedPriorityListeners && fixedPriorityListeners.length === 0)\n            listeners.clearFixedListeners();\n    },\n\n    frameUpdateListeners: function () {\n        var locListenersMap = this._listenersMap, locPriorityDirtyFlagMap = this._priorityDirtyFlagMap;\n        for (var selKey in locListenersMap) {\n            if (locListenersMap[selKey].empty()) {\n                delete locPriorityDirtyFlagMap[selKey];\n                delete locListenersMap[selKey];\n            }\n        }\n\n        var locToAddedListeners = this._toAddedListeners;\n        if (locToAddedListeners.length !== 0) {\n            for (var i = 0, len = locToAddedListeners.length; i < len; i++)\n                this._forceAddEventListener(locToAddedListeners[i]);\n            locToAddedListeners.length = 0;\n        }\n        if (this._toRemovedListeners.length !== 0) {\n            this._cleanToRemovedListeners();\n        }\n    },\n\n    _updateTouchListeners: function (event) {\n        var locInDispatch = this._inDispatch;\n        cc.assert(locInDispatch > 0, cc._LogInfos.EventManager__updateListeners);\n\n        if (locInDispatch > 1)\n            return;\n\n        var listeners;\n        listeners = this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID];\n        if (listeners) {\n            this._onUpdateListeners(listeners);\n        }\n        listeners = this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID];\n        if (listeners) {\n            this._onUpdateListeners(listeners);\n        }\n\n        cc.assert(locInDispatch === 1, cc._LogInfos.EventManager__updateListeners_2);\n\n        var locToAddedListeners = this._toAddedListeners;\n        if (locToAddedListeners.length !== 0) {\n            for (var i = 0, len = locToAddedListeners.length; i < len; i++)\n                this._forceAddEventListener(locToAddedListeners[i]);\n            locToAddedListeners.length = 0;\n        }\n        if (this._toRemovedListeners.length !== 0) {\n            this._cleanToRemovedListeners();\n        }\n    },\n\n    //Remove all listeners in _toRemoveListeners list and cleanup\n    _cleanToRemovedListeners: function () {\n        var toRemovedListeners = this._toRemovedListeners;\n        for (var i = 0; i < toRemovedListeners.length; i++) {\n            var selListener = toRemovedListeners[i];\n            var listeners = this._listenersMap[selListener._getListenerID()];\n            if (!listeners)\n                continue;\n\n            var idx, fixedPriorityListeners = listeners.getFixedPriorityListeners(),\n                sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\n\n            if (sceneGraphPriorityListeners) {\n                idx = sceneGraphPriorityListeners.indexOf(selListener);\n                if (idx !== -1) {\n                    sceneGraphPriorityListeners.splice(idx, 1);\n                }\n            }\n            if (fixedPriorityListeners) {\n                idx = fixedPriorityListeners.indexOf(selListener);\n                if (idx !== -1) {\n                    fixedPriorityListeners.splice(idx, 1);\n                }\n            }\n        }\n        toRemovedListeners.length = 0;\n    },\n\n    _onTouchEventCallback: function (listener, argsObj) {\n        // Skip if the listener was removed.\n        if (!listener._isRegistered)\n            return false;\n\n        var event = argsObj.event, selTouch = argsObj.selTouch;\n        event._setCurrentTarget(listener._node);\n\n        var isClaimed = false, removedIdx;\n        var getCode = event.getEventCode(), eventCode = cc.EventTouch.EventCode;\n        if (getCode === eventCode.BEGAN) {\n            if (listener.onTouchBegan) {\n                isClaimed = listener.onTouchBegan(selTouch, event);\n                if (isClaimed && listener._registered)\n                    listener._claimedTouches.push(selTouch);\n            }\n        } else if (listener._claimedTouches.length > 0\n            && ((removedIdx = listener._claimedTouches.indexOf(selTouch)) !== -1)) {\n            isClaimed = true;\n            if (getCode === eventCode.MOVED && listener.onTouchMoved) {\n                listener.onTouchMoved(selTouch, event);\n            } else if (getCode === eventCode.ENDED) {\n                if (listener.onTouchEnded)\n                    listener.onTouchEnded(selTouch, event);\n                if (listener._registered)\n                    listener._claimedTouches.splice(removedIdx, 1);\n            } else if (getCode === eventCode.CANCELLED) {\n                if (listener.onTouchCancelled)\n                    listener.onTouchCancelled(selTouch, event);\n                if (listener._registered)\n                    listener._claimedTouches.splice(removedIdx, 1);\n            }\n        }\n\n        // If the event was stopped, return directly.\n        if (event.isStopped()) {\n            cc.eventManager._updateTouchListeners(event);\n            return true;\n        }\n\n        if (isClaimed && listener._registered && listener.swallowTouches) {\n            if (argsObj.needsMutableSet)\n                argsObj.touches.splice(selTouch, 1);\n            return true;\n        }\n        return false;\n    },\n\n    _dispatchTouchEvent: function (event) {\n        this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);\n        this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);\n\n        var oneByOneListeners = this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);\n        var allAtOnceListeners = this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);\n\n        // If there aren't any touch listeners, return directly.\n        if (null === oneByOneListeners && null === allAtOnceListeners)\n            return;\n\n        var originalTouches = event.getTouches(), mutableTouches = cc.copyArray(originalTouches);\n        var oneByOneArgsObj = {event: event, needsMutableSet: (oneByOneListeners && allAtOnceListeners), touches: mutableTouches, selTouch: null};\n\n        //\n        // process the target handlers 1st\n        //\n        if (oneByOneListeners) {\n            for (var i = 0; i < originalTouches.length; i++) {\n                oneByOneArgsObj.selTouch = originalTouches[i];\n                this._dispatchEventToListeners(oneByOneListeners, this._onTouchEventCallback, oneByOneArgsObj);\n                if (event.isStopped())\n                    return;\n            }\n        }\n\n        //\n        // process standard handlers 2nd\n        //\n        if (allAtOnceListeners && mutableTouches.length > 0) {\n            this._dispatchEventToListeners(allAtOnceListeners, this._onTouchesEventCallback, {event: event, touches: mutableTouches});\n            if (event.isStopped())\n                return;\n        }\n        this._updateTouchListeners(event);\n    },\n\n    _onTouchesEventCallback: function (listener, callbackParams) {\n        // Skip if the listener was removed.\n        if (!listener._registered)\n            return false;\n\n        var eventCode = cc.EventTouch.EventCode, event = callbackParams.event, touches = callbackParams.touches, getCode = event.getEventCode();\n        event._setCurrentTarget(listener._node);\n        if (getCode === eventCode.BEGAN && listener.onTouchesBegan)\n            listener.onTouchesBegan(touches, event);\n        else if (getCode === eventCode.MOVED && listener.onTouchesMoved)\n            listener.onTouchesMoved(touches, event);\n        else if (getCode === eventCode.ENDED && listener.onTouchesEnded)\n            listener.onTouchesEnded(touches, event);\n        else if (getCode === eventCode.CANCELLED && listener.onTouchesCancelled)\n            listener.onTouchesCancelled(touches, event);\n\n        // If the event was stopped, return directly.\n        if (event.isStopped()) {\n            cc.eventManager._updateTouchListeners(event);\n            return true;\n        }\n        return false;\n    },\n\n    _associateNodeAndEventListener: function (node, listener) {\n        var listeners = this._nodeListenersMap[node.__instanceId];\n        if (!listeners) {\n            listeners = [];\n            this._nodeListenersMap[node.__instanceId] = listeners;\n        }\n        listeners.push(listener);\n    },\n\n    _dissociateNodeAndEventListener: function (node, listener) {\n        var listeners = this._nodeListenersMap[node.__instanceId];\n        if (listeners) {\n            cc.arrayRemoveObject(listeners, listener);\n            if (listeners.length === 0)\n                delete this._nodeListenersMap[node.__instanceId];\n        }\n    },\n\n    _dispatchEventToListeners: function (listeners, onEvent, eventOrArgs) {\n        var shouldStopPropagation = false;\n        var fixedPriorityListeners = listeners.getFixedPriorityListeners();\n        var sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\n\n        var i = 0, j, selListener;\n        if (fixedPriorityListeners) {  // priority < 0\n            if (fixedPriorityListeners.length !== 0) {\n                for (; i < listeners.gt0Index; ++i) {\n                    selListener = fixedPriorityListeners[i];\n                    if (selListener.isEnabled() && !selListener._isPaused() && selListener._isRegistered() && onEvent(selListener, eventOrArgs)) {\n                        shouldStopPropagation = true;\n                        break;\n                    }\n                }\n            }\n        }\n\n        if (sceneGraphPriorityListeners && !shouldStopPropagation) {    // priority == 0, scene graph priority\n            for (j = 0; j < sceneGraphPriorityListeners.length; j++) {\n                selListener = sceneGraphPriorityListeners[j];\n                if (selListener.isEnabled() && !selListener._isPaused() && selListener._isRegistered() && onEvent(selListener, eventOrArgs)) {\n                    shouldStopPropagation = true;\n                    break;\n                }\n            }\n        }\n\n        if (fixedPriorityListeners && !shouldStopPropagation) {    // priority > 0\n            for (; i < fixedPriorityListeners.length; ++i) {\n                selListener = fixedPriorityListeners[i];\n                if (selListener.isEnabled() && !selListener._isPaused() && selListener._isRegistered() && onEvent(selListener, eventOrArgs)) {\n                    shouldStopPropagation = true;\n                    break;\n                }\n            }\n        }\n    },\n\n    _setDirty: function (listenerID, flag) {\n        var locDirtyFlagMap = this._priorityDirtyFlagMap;\n        if (locDirtyFlagMap[listenerID] == null)\n            locDirtyFlagMap[listenerID] = flag;\n        else\n            locDirtyFlagMap[listenerID] = flag | locDirtyFlagMap[listenerID];\n    },\n\n    _visitTarget: function (node, isRootNode) {\n        var children = node.getChildren(), i = 0;\n        var childrenCount = children.length, locGlobalZOrderNodeMap = this._globalZOrderNodeMap, locNodeListenersMap = this._nodeListenersMap;\n\n        if (childrenCount > 0) {\n            var child;\n            // visit children zOrder < 0\n            for (; i < childrenCount; i++) {\n                child = children[i];\n                if (child && child.getLocalZOrder() < 0)\n                    this._visitTarget(child, false);\n                else\n                    break;\n            }\n\n            if (locNodeListenersMap[node.__instanceId] != null) {\n                if (!locGlobalZOrderNodeMap[node.getGlobalZOrder()])\n                    locGlobalZOrderNodeMap[node.getGlobalZOrder()] = [];\n                locGlobalZOrderNodeMap[node.getGlobalZOrder()].push(node.__instanceId);\n            }\n\n            for (; i < childrenCount; i++) {\n                child = children[i];\n                if (child)\n                    this._visitTarget(child, false);\n            }\n        } else {\n            if (locNodeListenersMap[node.__instanceId] != null) {\n                if (!locGlobalZOrderNodeMap[node.getGlobalZOrder()])\n                    locGlobalZOrderNodeMap[node.getGlobalZOrder()] = [];\n                locGlobalZOrderNodeMap[node.getGlobalZOrder()].push(node.__instanceId);\n            }\n        }\n\n        if (isRootNode) {\n            var globalZOrders = [];\n            for (var selKey in locGlobalZOrderNodeMap)\n                globalZOrders.push(selKey);\n\n            globalZOrders.sort(this._sortNumberAsc);\n\n            var zOrdersLen = globalZOrders.length, selZOrders, j, locNodePriorityMap = this._nodePriorityMap;\n            for (i = 0; i < zOrdersLen; i++) {\n                selZOrders = locGlobalZOrderNodeMap[globalZOrders[i]];\n                for (j = 0; j < selZOrders.length; j++)\n                    locNodePriorityMap[selZOrders[j]] = ++this._nodePriorityIndex;\n            }\n            this._globalZOrderNodeMap = {};\n        }\n    },\n\n    _sortNumberAsc: function (a, b) {\n        return a - b;\n    },\n\n    /**\n     * <p>\n     * Adds a event listener for a specified event.                                                                                                            <br/>\n     * if the parameter \"nodeOrPriority\" is a node, it means to add a event listener for a specified event with the priority of scene graph.                   <br/>\n     * if the parameter \"nodeOrPriority\" is a Number, it means to add a event listener for a specified event with the fixed priority.                          <br/>\n     * </p>\n     * @param {cc.EventListener|Object} listener The listener of a specified event or a object of some event parameters.\n     * @param {cc.Node|Number} nodeOrPriority The priority of the listener is based on the draw order of this node or fixedPriority The fixed priority of the listener.\n     * @note  The priority of scene graph will be fixed value 0. So the order of listener item in the vector will be ' <0, scene graph (0 priority), >0'.\n     *         A lower priority will be called before the ones that have a higher value. 0 priority is forbidden for fixed priority since it's used for scene graph based priority.\n     *         The listener must be a cc.EventListener object when adding a fixed priority listener, because we can't remove a fixed priority listener without the listener handler,\n     *         except calls removeAllListeners().\n     * @return {cc.EventListener} Return the listener. Needed in order to remove the event from the dispatcher.\n     */\n    addListener: function (listener, nodeOrPriority) {\n        cc.assert(listener && nodeOrPriority, cc._LogInfos.eventManager_addListener_2);\n        if (!(listener instanceof cc.EventListener)) {\n            cc.assert(!cc.isNumber(nodeOrPriority), cc._LogInfos.eventManager_addListener_3);\n            listener = cc.EventListener.create(listener);\n        } else {\n            if (listener._isRegistered()) {\n                cc.log(cc._LogInfos.eventManager_addListener_4);\n                return;\n            }\n        }\n\n        if (!listener.checkAvailable())\n            return;\n\n        if (cc.isNumber(nodeOrPriority)) {\n            if (nodeOrPriority === 0) {\n                cc.log(cc._LogInfos.eventManager_addListener);\n                return;\n            }\n\n            listener._setSceneGraphPriority(null);\n            listener._setFixedPriority(nodeOrPriority);\n            listener._setRegistered(true);\n            listener._setPaused(false);\n            this._addListener(listener);\n        } else {\n            listener._setSceneGraphPriority(nodeOrPriority);\n            listener._setFixedPriority(0);\n            listener._setRegistered(true);\n            this._addListener(listener);\n        }\n\n        return listener;\n    },\n\n    /**\n     * Adds a Custom event listener. It will use a fixed priority of 1.\n     * @param {string} eventName\n     * @param {function} callback\n     * @return {cc.EventListener} the generated event. Needed in order to remove the event from the dispatcher\n     */\n    addCustomListener: function (eventName, callback, target) {\n        var listener = new cc._EventListenerCustom(eventName, callback, target);\n        this.addListener(listener, 1);\n        return listener;\n    },\n\n    /**\n     * Remove a listener\n     * @param {cc.EventListener} listener an event listener or a registered node target\n     */\n    removeListener: function (listener) {\n        if (listener == null)\n            return;\n\n        var isFound, locListener = this._listenersMap;\n        for (var selKey in locListener) {\n            var listeners = locListener[selKey];\n            var fixedPriorityListeners = listeners.getFixedPriorityListeners(), sceneGraphPriorityListeners = listeners.getSceneGraphPriorityListeners();\n\n            isFound = this._removeListenerInVector(sceneGraphPriorityListeners, listener);\n            if (isFound){\n                // fixed #4160: Dirty flag need to be updated after listeners were removed.\n               this._setDirty(listener._getListenerID(), this.DIRTY_SCENE_GRAPH_PRIORITY);\n            }else{\n                isFound = this._removeListenerInVector(fixedPriorityListeners, listener);\n                if (isFound)\n                    this._setDirty(listener._getListenerID(), this.DIRTY_FIXED_PRIORITY);\n            }\n\n            if (listeners.empty()) {\n                delete this._priorityDirtyFlagMap[listener._getListenerID()];\n                delete locListener[selKey];\n            }\n\n            if (isFound)\n                break;\n        }\n\n        if (!isFound) {\n            var locToAddedListeners = this._toAddedListeners;\n            for (var i = 0, len = locToAddedListeners.length; i < len; i++) {\n                var selListener = locToAddedListeners[i];\n                if (selListener === listener) {\n                    cc.arrayRemoveObject(locToAddedListeners, selListener);\n                    selListener._setRegistered(false);\n                    break;\n                }\n            }\n        }\n    },\n\n    _removeListenerInCallback: function (listeners, callback) {\n        if (listeners == null)\n            return false;\n\n        for (var i = 0, len = listeners.length; i < len; i++) {\n            var selListener = listeners[i];\n            if (selListener._onCustomEvent === callback || selListener._onEvent === callback) {\n                selListener._setRegistered(false);\n                if (selListener._getSceneGraphPriority() != null) {\n                    this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(), selListener);\n                    selListener._setSceneGraphPriority(null);         // NULL out the node pointer so we don't have any dangling pointers to destroyed nodes.\n                }\n\n                if (this._inDispatch === 0)\n                    cc.arrayRemoveObject(listeners, selListener);\n                return true;\n            }\n        }\n        return false;\n    },\n\n    _removeListenerInVector: function (listeners, listener) {\n        if (listeners == null)\n            return false;\n\n        for (var i = 0, len = listeners.length; i < len; i++) {\n            var selListener = listeners[i];\n            if (selListener === listener) {\n                selListener._setRegistered(false);\n                if (selListener._getSceneGraphPriority() != null) {\n                    this._dissociateNodeAndEventListener(selListener._getSceneGraphPriority(), selListener);\n                    selListener._setSceneGraphPriority(null);         // NULL out the node pointer so we don't have any dangling pointers to destroyed nodes.\n                }\n\n                if (this._inDispatch === 0)\n                    cc.arrayRemoveObject(listeners, selListener);\n                else\n                    this._toRemovedListeners.push(selListener);\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /**\n     * Removes all listeners with the same event listener type or removes all listeners of a node\n     * @param {Number|cc.Node} listenerType listenerType or a node\n     * @param {Boolean} [recursive=false]\n     */\n    removeListeners: function (listenerType, recursive) {\n        var _t = this;\n        if (listenerType instanceof cc.Node) {\n            // Ensure the node is removed from these immediately also.\n            // Don't want any dangling pointers or the possibility of dealing with deleted objects..\n            delete _t._nodePriorityMap[listenerType.__instanceId];\n            cc.arrayRemoveObject(_t._dirtyNodes, listenerType);\n            var listeners = _t._nodeListenersMap[listenerType.__instanceId], i;\n            if (listeners) {\n                var listenersCopy = cc.copyArray(listeners);\n                for (i = 0; i < listenersCopy.length; i++)\n                    _t.removeListener(listenersCopy[i]);\n                listenersCopy.length = 0;\n            }\n\n            // Bug fix: ensure there are no references to the node in the list of listeners to be added.\n            // If we find any listeners associated with the destroyed node in this list then remove them.\n            // This is to catch the scenario where the node gets destroyed before it's listener\n            // is added into the event dispatcher fully. This could happen if a node registers a listener\n            // and gets destroyed while we are dispatching an event (touch etc.)\n            var locToAddedListeners = _t._toAddedListeners;\n            for (i = 0; i < locToAddedListeners.length; ) {\n                var listener = locToAddedListeners[i];\n                if (listener._getSceneGraphPriority() === listenerType) {\n                    listener._setSceneGraphPriority(null);                      // Ensure no dangling ptr to the target node.\n                    listener._setRegistered(false);\n                    locToAddedListeners.splice(i, 1);\n                } else\n                    ++i;\n            }\n\n            if (recursive === true) {\n                var locChildren = listenerType.getChildren(), len;\n                for (i = 0, len = locChildren.length; i< len; i++)\n                    _t.removeListeners(locChildren[i], true);\n            }\n        } else {\n            if (listenerType === cc.EventListener.TOUCH_ONE_BY_ONE)\n                _t._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID);\n            else if (listenerType === cc.EventListener.TOUCH_ALL_AT_ONCE)\n                _t._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID);\n            else if (listenerType === cc.EventListener.MOUSE)\n                _t._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID);\n            else if (listenerType === cc.EventListener.ACCELERATION)\n                _t._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID);\n            else if (listenerType === cc.EventListener.KEYBOARD)\n                _t._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID);\n            else\n                cc.log(cc._LogInfos.eventManager_removeListeners);\n        }\n    },\n\n    /**\n     * Removes all custom listeners with the same event name\n     * @param {string} customEventName\n     */\n    removeCustomListeners: function (customEventName) {\n        this._removeListenersForListenerID(customEventName);\n    },\n\n    /**\n     * Removes all listeners\n     */\n    removeAllListeners: function () {\n        var locListeners = this._listenersMap, locInternalCustomEventIDs = this._internalCustomListenerIDs;\n        for (var selKey in locListeners) {\n            if (locInternalCustomEventIDs.indexOf(selKey) === -1)\n                this._removeListenersForListenerID(selKey);\n        }\n    },\n\n    /**\n     * Sets listener's priority with fixed value.\n     * @param {cc.EventListener} listener\n     * @param {Number} fixedPriority\n     */\n    setPriority: function (listener, fixedPriority) {\n        if (listener == null)\n            return;\n\n        var locListeners = this._listenersMap;\n        for (var selKey in locListeners) {\n            var selListeners = locListeners[selKey];\n            var fixedPriorityListeners = selListeners.getFixedPriorityListeners();\n            if (fixedPriorityListeners) {\n                var found = fixedPriorityListeners.indexOf(listener);\n                if (found !== -1) {\n                    if (listener._getSceneGraphPriority() != null)\n                        cc.log(cc._LogInfos.eventManager_setPriority);\n                    if (listener._getFixedPriority() !== fixedPriority) {\n                        listener._setFixedPriority(fixedPriority);\n                        this._setDirty(listener._getListenerID(), this.DIRTY_FIXED_PRIORITY);\n                    }\n                    return;\n                }\n            }\n        }\n    },\n\n    /**\n     * Whether to enable dispatching events\n     * @param {boolean} enabled\n     */\n    setEnabled: function (enabled) {\n        this._isEnabled = enabled;\n    },\n\n    /**\n     * Checks whether dispatching events is enabled\n     * @returns {boolean}\n     */\n    isEnabled: function () {\n        return this._isEnabled;\n    },\n\n    /**\n     * Dispatches the event, also removes all EventListeners marked for deletion from the event dispatcher list.\n     * @param {cc.Event} event\n     */\n    dispatchEvent: function (event) {\n        if (!this._isEnabled)\n            return;\n\n        this._updateDirtyFlagForSceneGraph();\n        this._inDispatch++;\n        if (!event || !event.getType)\n            throw new Error(\"event is undefined\");\n        if (event._type === cc.Event.TOUCH) {\n            this._dispatchTouchEvent(event);\n            this._inDispatch--;\n            return;\n        }\n\n        var listenerID = __getListenerID(event);\n        this._sortEventListeners(listenerID);\n        var selListeners = this._listenersMap[listenerID];\n        if (selListeners) {\n            this._dispatchEventToListeners(selListeners, this._onListenerCallback, event);\n            this._onUpdateListeners(selListeners);\n        }\n        \n        this._inDispatch--;\n    },\n\n    _onListenerCallback: function (listener, event) {\n        event._setCurrentTarget(listener._getSceneGraphPriority());\n        listener._onEvent(event);\n        return event.isStopped();\n    },\n\n    /**\n     * Dispatches a Custom Event with a event name an optional user data\n     * @param {string} eventName\n     * @param {*} optionalUserData\n     */\n    dispatchCustomEvent: function (eventName, optionalUserData) {\n        var ev = new cc.EventCustom(eventName);\n        ev.setUserData(optionalUserData);\n        this.dispatchEvent(ev);\n    }\n};\n\n})();\n"]}