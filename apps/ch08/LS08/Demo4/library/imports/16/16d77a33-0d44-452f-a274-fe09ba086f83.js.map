{"version":3,"sources":["../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/base-classes/assets/frameworks/cocos2d-html5/extensions/ccui/base-classes/CCProtectedNodeCanvasRenderCmd.js"],"names":["cc","ProtectedNode","RenderCmd","_updateDisplayColor","parentColor","node","_node","locDispColor","_displayedColor","locRealColor","_realColor","i","len","selChildren","item","_cascadeColorEnabledDirty","_cascadeColorEnabled","r","g","b","whiteColor","Color","_children","length","_renderCmd","undefined","locParent","_parent","getDisplayedColor","color","WHITE","_updateColor","_protectedChildren","_dirtyFlag","Node","_dirtyFlags","colorDirty","_updateDisplayOpacity","parentOpacity","_cascadeOpacityEnabledDirty","_cascadeOpacityEnabled","_displayedOpacity","_realOpacity","getDisplayedOpacity","opacityDirty","_changeProtectedChild","child","cmd","dirty","flags","CanvasRenderCmd","renderable","_rootCtor","_cachedParent","_cacheDirty","proto","prototype","Object","create","inject","constructor","_pNodeCmdCtor","transform","parentCmd","recursive","_changePosition","originTransform","locChildren","pNodeTransform"],"mappings":"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","file":"CCProtectedNodeCanvasRenderCmd.js","sourceRoot":"../../../../../../../../assets/frameworks/cocos2d-html5/extensions/ccui/base-classes","sourcesContent":["/****************************************************************************\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n(function () {\n    cc.ProtectedNode.RenderCmd = {\n        _updateDisplayColor: function (parentColor) {\n            var node = this._node;\n            var locDispColor = this._displayedColor, locRealColor = node._realColor;\n            var i, len, selChildren, item;\n            if (this._cascadeColorEnabledDirty && !node._cascadeColorEnabled) {\n                locDispColor.r = locRealColor.r;\n                locDispColor.g = locRealColor.g;\n                locDispColor.b = locRealColor.b;\n                var whiteColor = new cc.Color(255, 255, 255, 255);\n                selChildren = node._children;\n                for (i = 0, len = selChildren.length; i < len; i++) {\n                    item = selChildren[i];\n                    if (item && item._renderCmd)\n                        item._renderCmd._updateDisplayColor(whiteColor);\n                }\n                this._cascadeColorEnabledDirty = false;\n            } else {\n                if (parentColor === undefined) {\n                    var locParent = node._parent;\n                    if (locParent && locParent._cascadeColorEnabled)\n                        parentColor = locParent.getDisplayedColor();\n                    else\n                        parentColor = cc.color.WHITE;\n                }\n                locDispColor.r = 0 | (locRealColor.r * parentColor.r / 255.0);\n                locDispColor.g = 0 | (locRealColor.g * parentColor.g / 255.0);\n                locDispColor.b = 0 | (locRealColor.b * parentColor.b / 255.0);\n                if (node._cascadeColorEnabled) {\n                    selChildren = node._children;\n                    for (i = 0, len = selChildren.length; i < len; i++) {\n                        item = selChildren[i];\n                        if (item && item._renderCmd) {\n                            item._renderCmd._updateDisplayColor(locDispColor);\n                            item._renderCmd._updateColor();\n                        }\n                    }\n                }\n                selChildren = node._protectedChildren;\n                for (i = 0, len = selChildren.length; i < len; i++) {\n                    item = selChildren[i];\n                    if (item && item._renderCmd) {\n                        item._renderCmd._updateDisplayColor(locDispColor);\n                        item._renderCmd._updateColor();\n                    }\n                }\n            }\n            this._dirtyFlag = this._dirtyFlag & cc.Node._dirtyFlags.colorDirty ^ this._dirtyFlag;\n        },\n\n        _updateDisplayOpacity: function (parentOpacity) {\n            var node = this._node;\n            var i, len, selChildren, item;\n            if (this._cascadeOpacityEnabledDirty && !node._cascadeOpacityEnabled) {\n                this._displayedOpacity = node._realOpacity;\n                selChildren = node._children;\n                for (i = 0, len = selChildren.length; i < len; i++) {\n                    item = selChildren[i];\n                    if (item && item._renderCmd)\n                        item._renderCmd._updateDisplayOpacity(255);\n                }\n                this._cascadeOpacityEnabledDirty = false;\n            } else {\n                if (parentOpacity === undefined) {\n                    var locParent = node._parent;\n                    parentOpacity = 255;\n                    if (locParent && locParent._cascadeOpacityEnabled)\n                        parentOpacity = locParent.getDisplayedOpacity();\n                }\n                this._displayedOpacity = node._realOpacity * parentOpacity / 255.0;\n                if (node._cascadeOpacityEnabled) {\n                    selChildren = node._children;\n                    for (i = 0, len = selChildren.length; i < len; i++) {\n                        item = selChildren[i];\n                        if (item && item._renderCmd) {\n                            item._renderCmd._updateDisplayOpacity(this._displayedOpacity);\n                            item._renderCmd._updateColor();\n                        }\n                    }\n                }\n                selChildren = node._protectedChildren;\n                for (i = 0, len = selChildren.length; i < len; i++) {\n                    item = selChildren[i];\n                    if (item && item._renderCmd) {\n                        item._renderCmd._updateDisplayOpacity(this._displayedOpacity);\n                        item._renderCmd._updateColor();\n                    }\n                }\n            }\n            this._dirtyFlag = this._dirtyFlag & cc.Node._dirtyFlags.opacityDirty ^ this._dirtyFlag;\n        },\n\n        _changeProtectedChild: function (child) {\n            var cmd = child._renderCmd,\n                dirty = cmd._dirtyFlag,\n                flags = cc.Node._dirtyFlags;\n\n            if (this._dirtyFlag & flags.colorDirty)\n                dirty |= flags.colorDirty;\n\n            if (this._dirtyFlag & flags.opacityDirty)\n                dirty |= flags.opacityDirty;\n\n            var colorDirty = dirty & flags.colorDirty,\n                opacityDirty = dirty & flags.opacityDirty;\n\n            if (colorDirty)\n                cmd._updateDisplayColor(this._displayedColor);\n            if (opacityDirty)\n                cmd._updateDisplayOpacity(this._displayedOpacity);\n            if (colorDirty || opacityDirty)\n                cmd._updateColor();\n        }\n    };\n\n    cc.ProtectedNode.CanvasRenderCmd = function (renderable) {\n        this._rootCtor(renderable);\n        this._cachedParent = null;\n        this._cacheDirty = false;\n    };\n\n    var proto = cc.ProtectedNode.CanvasRenderCmd.prototype = Object.create(cc.Node.CanvasRenderCmd.prototype);\n    cc.inject(cc.ProtectedNode.RenderCmd, proto);\n    proto.constructor = cc.ProtectedNode.CanvasRenderCmd;\n    proto._pNodeCmdCtor = cc.ProtectedNode.CanvasRenderCmd;\n\n    proto.transform = function (parentCmd, recursive) {\n        var node = this._node;\n\n        if (node._changePosition)\n            node._changePosition();\n\n        this.originTransform(parentCmd, recursive);\n\n        var i, len, locChildren = node._protectedChildren;\n        if (recursive && locChildren && locChildren.length !== 0) {\n            for (i = 0, len = locChildren.length; i < len; i++) {\n                locChildren[i]._renderCmd.transform(this, recursive);\n            }\n        }\n    };\n\n    proto.pNodeTransform = proto.transform;\n})();\n"]}