{"version":3,"sources":["../../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/utils/assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/utils/CCTransformHelp.js"],"names":["ccs","TransformHelp","Class","extend","helpMatrix1","cc","affineTransformMake","helpMatrix2","helpPoint1","p","helpPoint2","helpParentNode","transformFromParent","bone","parentNode","nodeToMatrix","affineTransformInvert","affineTransformConcat","matrixToNode","transformToParent","node","transformFromParentWithoutScale","scaleX","scaleY","transformToParentWithoutScale","matrix","skewX","skewY","sine","Math","sin","cosine","cos","a","b","c","d","tx","x","ty","y","pointApplyAffineTransform","atan2","sqrt","nodeConcat","target","source","nodeSub"],"mappings":"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","file":"CCTransformHelp.js","sourceRoot":"../../../../../../../../../assets/frameworks/cocos2d-html5/extensions/cocostudio/armature/utils","sourcesContent":["/****************************************************************************\n Copyright (c) 2011-2012 cocos2d-x.org\n Copyright (c) 2013-2014 Chukong Technologies Inc.\n\n http://www.cocos2d-x.org\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n ****************************************************************************/\n\n/**\n *  use to calculate the matrix of node from parent node\n * @class ccs.TransformHelp\n * @extend ccs.Class\n */\nccs.TransformHelp = ccs.TransformHelp || ccs.Class.extend({});\n\nccs.TransformHelp.helpMatrix1 = cc.affineTransformMake(1, 0, 0, 1, 0, 0);\nccs.TransformHelp.helpMatrix2 = cc.affineTransformMake(1, 0, 0, 1, 0, 0);\nccs.TransformHelp.helpPoint1 = cc.p(0, 0);\nccs.TransformHelp.helpPoint2 = cc.p(0, 0);\nccs.TransformHelp.helpParentNode = {};\n\n/**\n * Calculate a BaseData's transform matrix from parent node.\n * @function\n * @static\n * @param {ccs.BaseData} bone\n * Constructor\n */\nccs.TransformHelp.transformFromParent = function (bone, parentNode) {\n    this.nodeToMatrix(bone, this.helpMatrix1);\n    this.nodeToMatrix(parentNode, this.helpMatrix2);\n\n    this.helpMatrix2 = cc.affineTransformInvert(this.helpMatrix2);\n    this.helpMatrix1 = cc.affineTransformConcat(this.helpMatrix1, this.helpMatrix2);\n\n    this.matrixToNode(this.helpMatrix1, bone);\n};\n\nccs.TransformHelp.transformToParent = function(node, parentNode){\n    this.nodeToMatrix(node, this.helpMatrix1);\n    this.nodeToMatrix(parentNode, this.helpMatrix2);\n\n    this.helpMatrix1 = cc.affineTransformConcat(this.helpMatrix1, this.helpMatrix2);\n\n    this.matrixToNode(this.helpMatrix1, node);\n};\n\nccs.TransformHelp.transformFromParentWithoutScale = function(node, parentNode){\n//    this.helpParentNode.copy(&parentNode);\n\n    for(var p in parentNode){\n        this.helpParentNode[p] = parentNode[p];\n    }\n    this.helpParentNode.scaleX = 1;\n    this.helpParentNode.scaleY = 1;\n\n    this.nodeToMatrix(node, this.helpMatrix1);\n    this.nodeToMatrix(this.helpParentNode, this.helpMatrix2);\n\n    this.helpMatrix2 = cc.affineTransformInvert(this.helpMatrix2);\n    this.helpMatrix1 = cc.affineTransformConcat(this.helpMatrix1, this.helpMatrix2);\n\n    this.matrixToNode(this.helpMatrix1, node);\n};\n\nccs.TransformHelp.transformToParentWithoutScale = function(node, parentNode){\n    for(var p in parentNode){\n        this.helpParentNode[p] = parentNode[p];\n    }\n    this.helpParentNode.scaleX = 1;\n    this.helpParentNode.scaleY = 1;\n\n    this.nodeToMatrix(node, this.helpMatrix1);\n    this.nodeToMatrix(this.helpParentNode, this.helpMatrix2);\n\n    this.helpMatrix1 = cc.affineTransformConcat(this.helpMatrix1, this.helpMatrix2);\n\n    this.matrixToNode(this.helpMatrix1, node);\n\n};\n\n/**\n * @function\n * @static\n * @param {ccs.BaseData} node\n * @param {cc.AffineTransform} matrix\n */\nccs.TransformHelp.nodeToMatrix = function (node, matrix) {\n    if (node.skewX === -node.skewY) {\n        var sine = Math.sin(node.skewX);\n        var cosine = Math.cos(node.skewX);\n        matrix.a = node.scaleX * cosine;\n        matrix.b = node.scaleX * -sine;\n        matrix.c = node.scaleY * sine;\n        matrix.d = node.scaleY * cosine;\n    } else {\n        matrix.a = node.scaleX * Math.cos(node.skewY);\n        matrix.b = node.scaleX * Math.sin(node.skewY);\n        matrix.c = node.scaleY * Math.sin(node.skewX);\n        matrix.d = node.scaleY * Math.cos(node.skewX);\n    }\n    matrix.tx = node.x;\n    matrix.ty = node.y;\n};\n\n/**\n * @function\n * @static\n * @param {cc.AffineTransform} matrix\n * @param {ccs.BaseData} node\n */\nccs.TransformHelp.matrixToNode = function (matrix, node) {\n    /*\n     *  In as3 language, there is a function called \"deltaTransformPoint\", it calculate a point used give Transform\n     *  but not used the tx, ty value. we simulate the function here\n     */\n    this.helpPoint1.x = 0;\n    this.helpPoint1.y = 1;\n    this.helpPoint1 = cc.pointApplyAffineTransform(this.helpPoint1, matrix);\n    this.helpPoint1.x -= matrix.tx;\n    this.helpPoint1.y -= matrix.ty;\n\n    this.helpPoint2.x = 1;\n    this.helpPoint2.y = 0;\n    this.helpPoint2 = cc.pointApplyAffineTransform(this.helpPoint2, matrix);\n    this.helpPoint2.x -= matrix.tx;\n    this.helpPoint2.y -= matrix.ty;\n\n    node.skewX = -(Math.atan2(this.helpPoint1.y, this.helpPoint1.x) - 1.5707964); //todo\n    //node.skewX = -Math.atan2(this.helpPoint2.y, this.helpPoint2.x);\n    node.skewY = Math.atan2(this.helpPoint2.y, this.helpPoint2.x);\n    node.scaleX = Math.sqrt(matrix.a * matrix.a + matrix.b * matrix.b);\n    node.scaleY = Math.sqrt(matrix.c * matrix.c + matrix.d * matrix.d);\n    node.x = matrix.tx;\n    node.y = matrix.ty;\n};\n\n/**\n * @function\n * @static\n * @param {ccs.BaseData} target\n * @param {ccs.BaseData} source\n */\nccs.TransformHelp.nodeConcat = function (target, source) {\n    target.x += source.x;\n    target.y += source.y;\n    target.skewX += source.skewX;\n    target.skewY += source.skewY;\n    target.scaleX += source.scaleX;\n    target.scaleY += source.scaleY;\n};\n\n/**\n * @function\n * @static\n * @param {ccs.BaseData} target\n * @param {ccs.BaseData} source\n */\nccs.TransformHelp.nodeSub = function (target, source) {\n    target.x -= source.x;\n    target.y -= source.y;\n    target.skewX -= source.skewX;\n    target.skewY -= source.skewY;\n    target.scaleX -= source.scaleX;\n    target.scaleY -= source.scaleY;\n};"]}